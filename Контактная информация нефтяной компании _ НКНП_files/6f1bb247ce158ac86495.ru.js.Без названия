(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["ymaps-vector"],{10:function(t,e,i){"use strict";var r=i(8),s=i(11),n=(i(35),Object(s.Symbol)("EventEmitter")),o=Object(s.Symbol)("EventEmitter.MixinConstructor"),a=Object(s.Symbol)("EventEmitter.MixinPrototype"),l=function(){function t(){}return t[o]=function(t){t._eventListenersHash={}},t[a]=function(e){e[n]=t.prototype[n],e.group=t.prototype.group,e.on=t.prototype.on,e.offSingle=t.prototype.offSingle,e._emit=t.prototype._emit},t.prototype.on=function(t,e){return this.group().on(t,e)},t.prototype.offSingle=function(t,e){var i=this._eventListenersHash[t];i&&i.delete(e)},t.prototype.group=function(){return new t._eventGroupImpl(this)},t.prototype._emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this._eventListenersHash[t];if(r){var s=[];r.forEach(function(t){return s.push(t)});for(var n=0,o=s;n<o.length;n++){var a=o[n];a(e[0])}}},t._eventGroupImpl=function(){function t(t){this._listeners=[],this._emitter=t}return t.prototype.on=function(t,e){var i=this._emitter._eventListenersHash[t];return i?i.add(e):(this._emitter._eventListenersHash[t]=new s.Set,this._emitter._eventListenersHash[t].add(e)),this._listeners.push([t,e]),this},t.prototype.offAll=function(){for(var t=0,e=this._listeners;t<e.length;t++){var i=e[t],r=i[0],s=i[1];this._emitter._eventListenersHash[r].delete(s)}this._listeners=[]},t}(),t}();l.prototype[n]=!0,i.d(e,"a",function(){return c});var h=function(){},c=function(t){return void 0===t&&(t=h),{with:function(){if(e=t.prototype,Boolean(e&&e[n]))return t;var e,i=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r=t.apply(this,e)||this;return l[o](r),r}return Object(r.b)(e,t),e}(t);return l[a](i.prototype),i}}}},103:function(t,e,i){"use strict";var r=i(8);function s(t,e){return t===e?null:{old:t,new:e}}var n=i(94),o=i(79),a=i(80),l=i(10);i(35);i.d(e,"a",function(){return h}),i.d(e,"c",function(){return c}),i.d(e,"b",function(){return d});var h=function(t){function e(e,i){var r=t.call(this)||this;return r._makeFields=function(t,e){return{tileSize:e.size||n.c,transparent:Boolean(e.transparent),clampMapZoom:Boolean(t.clampMapZoom),zoomRange:t.zoomRange||Object(o.c)(),fetchHotspots:e.fetchHotspots,hotspotAbortRadius:e.hotspotAbortRadius||n.a,vectorHotspots:t.vector&&t.vector.hotspots||{},awaitAllTilesOnFirstDisplay:Boolean(e.awaitAllTilesOnFirstDisplay)}},r.setSource(e),r.worldOptions=i,r}return Object(r.b)(e,t),Object.defineProperty(e.prototype,"rasterSourceDescription",{get:function(){return this._source.raster},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorSourceDescription",{get:function(){return this._source.vector},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalFindHostpotInPosition",{get:function(){var t;return null===(t=this._source.raster)||void 0===t?void 0:t._internalFindHotspotInPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorHotspots",{get:function(){return this._fields.vectorHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){return this._fields.zoomRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampMapZoom",{get:function(){return this._fields.clampMapZoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparent",{get:function(){return this._fields.transparent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileSize",{get:function(){return this._fields.tileSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fetchHotspots",{get:function(){return this._fields.fetchHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hotspotAbortRadius",{get:function(){return this._fields.hotspotAbortRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"awaitAllTilesOnFirstDisplay",{get:function(){return this._fields.awaitAllTilesOnFirstDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileRevealDuration",{get:function(){var t,e;return Math.max(null!==(e=null===(t=this._source.raster)||void 0===t?void 0:t.tileRevealDuration)&&void 0!==e?e:200,0)},enumerable:!1,configurable:!0}),e.prototype.getHotspotTileDataSource=function(){return this._rasterSource.fetchHotspots?{fetchHotspots:this._rasterSource.fetchHotspots,hotspotAbortRadius:this._rasterSource.hotspotAbortRadius||n.a,tileSize:this._rasterSource.size||n.c,inset:void 0===this._rasterSource.hotspotInset?n.b:this._rasterSource.hotspotInset,padding:this._rasterSource.hotspotPadding||0,zoomRange:this.zoomRange,internalFindHotspotInPosition:this.internalFindHostpotInPosition}:null},e.prototype.setSource=function(t){if(!t.raster)return this._source=t,this._emit("changed"),void this._emit("sourceChanged",{clampMapZoom:null,fetchHotspots:null,hotspotAbortRadius:null,tileSize:null,fetchTile:null,vectorHotspots:null,transparent:null,zoomRange:null,awaitAllTilesOnFirstDisplay:null});this._source=t;var e=this._makeFields(t,t.raster),i=Object(r.a)(Object(r.a)({},function(t,e){for(var i={},r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];i[o]=s(t[o],e[o])}return i}(this._fields||{},e)),{fetchTile:s(this._rasterSource&&this._rasterSource.tileUrl,t.raster.tileUrl)});this._rasterSource=t.raster,this._fields=e,"string"==typeof this._rasterSource.tileUrl&&(this._tileUrlGenerator=c(this._rasterSource.tileUrl)),this._emit("changed"),this._emit("sourceChanged",i)},e.prototype.generateTileUrl=function(t,e,i,r){var s=this.fitTileIntoWorld(t,e,i);if(!s)return null;var n=s.x,o=s.y;return this._tileUrlGenerator(n,o,i,r)},e.prototype.fitTileIntoWorld=function(t,e,i){var r=Object(a.d)(i,this.tileSize);return Object(a.f)({x:t,y:e},r,this.worldOptions)?Object(a.h)({x:t,y:e},r):null},e}(Object(l.a)().with());function c(t){return function(e,i,r,s){return t.replace("{{x}}",String(e)).replace("{{y}}",String(i)).replace("{{z}}",String(r)).replace("{{scale}}",String(s)).replace(/\{\{d\|(\d+)\}\}/,function(t,s){var n=(e+i+r)%Number(s)+1;return String(n)})}}function d(t,e){return t.fetchHotspots===e.fetchHotspots&&t.hotspotAbortRadius===e.hotspotAbortRadius&&t.tileSize===e.tileSize}},11:function(t,e,i){"use strict";i.r(e),i.d(e,"mathSign",function(){return n}),i.d(e,"mathLog2",function(){return o}),i.d(e,"mathLog10",function(){return a}),i.d(e,"arrayFindIndex",function(){return _}),i.d(e,"arrayFind",function(){return p}),i.d(e,"arrayFrom",function(){return m}),i.d(e,"arraySome",function(){return x}),i.d(e,"Symbol",function(){return h}),i.d(e,"Map",function(){return d}),i.d(e,"Set",function(){return f}),i.d(e,"WeakMap",function(){return u}),i.d(e,"MAX_SAFE_INTEGER",function(){return l});var r=i(14),s={},n=Math.sign?Math.sign.bind(Math):function(t){return t<0?-1:0===t?0:1},o=Math.log2?Math.log2.bind(Math):function(t){return Math.log(t)*Math.LOG2E},a=Math.log10?Math.log10.bind(Math):function(t){return Math.log(t)/Math.LN10},l=Number.MAX_SAFE_INTEGER||9007199254740991,h="undefined"==typeof Symbol?function(t){return"__Symbol_"+t+"_"+Date.now()+"_"+Math.random()}:Symbol,c=function(t){return new t([[s,1]]).has(s)?function(e){return new t(e)}:function(e){var i=new t;if(void 0!==e)for(var r=0,s=e;r<s.length;r++){var n=s[r],o=n[0],a=n[1];i.set(o,a)}return i}},d=c(Map),u=c(WeakMap),f=new Set([s]).has(s)?function(t){return new Set(t)}:function(t){var e=new Set;if(void 0!==t)for(var i=0,r=t;i<r.length;i++){var s=r[i];e.add(s)}return e};d.prototype=Map.prototype,u.prototype=WeakMap.prototype,f.prototype=Set.prototype;var _=Boolean(Array.prototype.findIndex)?function(t,e,i){return t.findIndex(e,i)}:function(t,e,i){for(var r=0;r<t.length;r++)if(e.call(i,t[r],r,t))return r;return-1},p=Boolean(Array.prototype.find)?function(t,e,i){return t.find(e,i)}:function(t,e,i){var r=_(t,e,i);return-1===r?void 0:t[r]},m=Array.from?Array.from:function(t){var e=this,i=Object(t);null==t&&Object(r.c)(new TypeError("Array.from requires an array-like object - not null or undefined"));var s=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;void 0===s||v(s)||Object(r.c)(new TypeError("Array.from: when provided, the second argument must be a function"));for(var o=y(i.length),a=v(e)?Object(new e(o)):new Array(o),l=0;l<o;){var h=i[l];a[l]=s?void 0===n?s(h,l):s.call(n,h,l):h,l+=1}return a.length=o,a},g=Object.prototype.toString;function v(t){return"function"==typeof t||"[object Function]"===g.call(t)}function y(t){var e=Number(t);return isNaN(e)||e<=0?0:Math.min(e,l)}var x=function(t,e,i){return-1!==_(t,e,i)}},114:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(17);function s(){return Object(r.b)(devicePixelRatio,1,3)}},115:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(11);function s(t,e,i,s,n,o){void 0===s&&(s=function(){}),void 0===n&&(n=function(){}),void 0===o&&(o=function(){return!0});var a=new r.Map,l=[],h=[],c=[];function d(t,e){s(t,e),c.push(t)}return e.forEach(function(e,r){var s=t.get(r);if(s&&o(s,e)?(n(s,e),h.push(s)):s&&(d(s,r),s=void 0),!s){var c=i(e);l.push(c),s=c}a.set(r,s)}),t.forEach(function(t,i){e.has(i)||d(t,i)}),{result:a,created:l,updated:h,removed:c}}},12:function(t,e,i){"use strict";i.r(e),i.d(e,"create",function(){return s}),i.d(e,"add",function(){return n}),i.d(e,"sub",function(){return o}),i.d(e,"muln",function(){return a}),i.d(e,"divn",function(){return c}),i.d(e,"mulv",function(){return l}),i.d(e,"divv",function(){return h}),i.d(e,"applyFunction",function(){return d}),i.d(e,"areEqual",function(){return f}),i.d(e,"areFuzzyEqual",function(){return u}),i.d(e,"normalize",function(){return _}),i.d(e,"length",function(){return p}),i.d(e,"length2",function(){return m}),i.d(e,"dot",function(){return g}),i.d(e,"avg",function(){return v}),i.d(e,"rotate",function(){return b}),i.d(e,"ORIGIN",function(){return r});var r=s(0,0);function s(t,e){return{x:t,y:e}}function n(t,e,i){return void 0===i&&(i=s(0,0)),i.x=t.x+e.x,i.y=t.y+e.y,i}function o(t,e,i){return void 0===i&&(i=s(0,0)),i.x=t.x-e.x,i.y=t.y-e.y,i}function a(t,e,i){return void 0===i&&(i=s(0,0)),i.x=t.x*e,i.y=t.y*e,i}function l(t,e,i){return void 0===i&&(i=s(0,0)),i.x=t.x*e.x,i.y=t.y*e.y,i}function h(t,e,i){return void 0===i&&(i=s(0,0)),i.x=t.x/e.x,i.y=t.y/e.y,i}function c(t,e,i){return void 0===i&&(i=s(0,0)),i.x=t.x/e,i.y=t.y/e,i}function d(t,e,i){return void 0===i&&(i=s(0,0)),i.x=e(t.x,1),i.y=e(t.y,2),i}function u(t,e,i){void 0===i&&(i=1e-6);var r=o(t,e);return-i<r.x&&r.x<i&&-i<r.y&&r.y<i}function f(t,e){return t.x===e.x&&t.y===e.y}function _(t,e){return void 0===e&&(e=s(0,0)),c(t,p(t),e)}function p(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function m(t){return Math.pow(t.x,2)+Math.pow(t.y,2)}function g(t,e){return t.x*e.x+t.y*e.y}function v(t,e){return void 0===e&&(e=s(0,0)),e.x=t.reduce(function(t,e){return t+e.x},0)/t.length,e.y=t.reduce(function(t,e){return t+e.y},0)/t.length,e}var y=Math.cos,x=Math.sin;function b(t,e,i){void 0===i&&(i=s(0,0));var r=t.x,n=t.y,o=y(e),a=x(e);return i.x=o*r-a*n,i.y=a*r+o*n,i}},17:function(t,e,i){"use strict";function r(t,e,i){return t-Math.floor((t-e)/(i-e))*(i-e)}function s(t,e,i){return Math.max(Math.min(t,i),e)}i.d(e,"a",function(){return r}),i.d(e,"b",function(){return s})},18:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var r=i(8),s=i(11),n=i(17),o=i(12),a={getScale:function(t,e){return Math.pow(2,e-t)},getWorldPixelSize:function(t){return 256*Math.pow(2,t)},worldToPixels:function(t,e){var i=Math.pow(2,e)/2*256;return o.muln({x:t.x+1,y:1-t.y},i)},worldToRelativePixels:function(t,e){var i=Math.pow(2,e)/2*256;return o.mulv(t,{x:i,y:-i})},worldToTile:function(t,e,i){var r=a.worldToPixels(t,e);return o.divn(r,i)},moveCloseToCenter:function(t,e,i){i=i||t;var r=o.sub(t,e).x;return Math.abs(r)>1?o.add(i,{x:-2*Object(s.mathSign)(r),y:0}):i},convertPixelSizeToWorldSize:function(t,e,i){var r=Math.pow(2,e)/2*256;return o.divv(t,{x:r,y:-r},i)},pixelsToWorld:function(t,e){var i=Math.pow(2,e)/2*256;return{x:t.x/i-1,y:1-t.y/i}},fitViewportToWorld:function(t,e){var i=e.zoom,r=e.worldOptions,s=e.size,n=void 0===s?o.ORIGIN:s;if(r.cycledX&&r.cycledY)return t;var h=a.convertPixelSizeToWorldSize(n,i);return{x:l(t.x,h.x,r.cycledX),y:l(t.y,-h.y,r.cycledY)}},restrictToZeroWorld:function(t,e){var i=Object(r.a)({},t);return e.cycledX&&(i.x=Object(n.a)(i.x,-1,1)),e.cycledY&&(i.y=Object(n.a)(i.y,-1,1)),i},computePixelPerfectWorldCoordinates:function(t,e,i,r,s){void 0===r&&(r=1),void 0===s&&(s={x:0,y:0});var n=a.getWorldPixelSize(e)/2*r*i;return o.applyFunction(t,function(t){return Math.round(t*n)/n},s)}};function l(t,e,i){var r=e/2;return i?Object(n.a)(t,-1,1):Object(n.b)(t,Math.min(0,r-1),Math.max(0,1-r))}},197:function(t,e,i){"use strict";i.d(e,"a",function(){return m});var r=i(8),s=i(11),n=i(25),o=i(80),a=i(10),l=i(43),h=i(95),c=i(18),d=i(57),u=i(17),f=i(12),_=i(14),p=function(){},m=function(t){function e(e,i,r,n,o,a){var l=t.call(this)||this;return l._newTiles=new s.Map,l._loadingTiles=new s.Map,l._readyTiles=new s.Map,l._size=e,l._camera=i,l._tileSource=r,l._zoomRoundingRule=a,l._worldOptions=o,l._queue=n,l}return Object(r.b)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return{tilesLoaded:0,tilesReady:0,tilesTotal:0,borderTotal:0,borderLoaded:0,borderReady:0}},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._loadingTiles.forEach(function(t){t.abortController.abort()})},e.prototype.preloadHotspotsInPoint=function(t){for(var e=this._zoomRoundingRule(this._camera.zoom),i=!1,r=0,s=this._computeAffectedTiles(t,e);r<s.length;r++){var n=s[r],a=Object(o.e)(n,n.zoom);this._isTileDataReadyOrLoading(a)||this._newTiles.has(a)||(this._newTiles.set(a,{id:n}),i=!0)}var l=this._stopLoadingTilesOutsideRadius(t);(i||l)&&this._emit("hotspotsChanged"),i&&this._emit("requestRender")},e.prototype.preloadHotspotsForViewport=function(){for(var t=this,e=!1,i=0,r=this._getTilesForViewport().filter(function(e){return!t._isTileDataReadyOrLoading(Object(o.e)(e,e.zoom))});i<r.length;i++){var s=r[i],n=Object(o.e)(s,s.zoom);this._isTileDataReadyOrLoading(n)||this._newTiles.has(n)||(this._newTiles.set(n,{id:s}),e=!0)}e&&(this._emit("hotspotsChanged"),this._emit("requestRender"))},e.prototype.resize=function(t){f.areEqual(t,this._size)||(this._size=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.update=function(t,e){var i=t.worldCenter,r=t.zoom;i===this._camera.worldCenter&&r===this._camera.zoom||(this._camera=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.render=function(t){var e=this;t.qualityHint<l.a.FULL||this._camera.zoom<this._tileSource.zoomRange.min||this._camera.zoom>this._tileSource.zoomRange.max||(this._newTiles.forEach(function(t){var i=Object(o.e)(t.id,t.id.zoom),s=e._loadTile(t);e._loadingTiles.set(i,s),Object(n.promiseFinally)(s.promise.then(function(n){var o=n.map(function(i){return"world"===i.type?i:function(t,e,i){var r=f.muln(e,i);return{type:"world",feature:t.feature,geometry:Object(d.d)(t.geometry,function(t){return c.a.pixelsToWorld(f.add(t,r),e.zoom)})}}(i,t.id,e._tileSource.tileSize)}),a=e._zoomRoundingRule(e._camera.zoom),l=e._tileSource.padding/c.a.getWorldPixelSize(a),h=0===e._tileSource.padding?o:o.map(function(t){return Object(r.a)(Object(r.a)({},t),{geometry:v(t.geometry,l)})});e._readyTiles.set(i,{id:s.id,hotspots:h}),e._emit("hotspotsChanged")}),function(){return e._loadingTiles.delete(i)}).catch(function(t){t&&"AbortError"===t.name||Object(_.c)(t)})}),this._newTiles.clear())},e.prototype.findObjectInPosition=function(t){for(var e,i,r=c.a.restrictToZeroWorld(t,this._worldOptions),s=this._zoomRoundingRule(this._camera.zoom),n=!0,a=0,l=this._computeAffectedTiles(r,s);a<l.length;a++){var d=l[a],u=this._readyTiles.get(Object(o.e)(d,s));if(u)for(var f=u.hotspots.length-1;f>=0;f--){var _=u.hotspots[f];if(Object(h.a)(_.geometry,r))return{type:"raw-hotspot",feature:_.feature}}else n=!1}var p=null===(i=(e=this._tileSource).internalFindHotspotInPosition)||void 0===i?void 0:i.call(e,r,s);return p||(n?null:void 0)},e.prototype._stopLoadingTilesOutsideRadius=function(t){var e=this._zoomRoundingRule(this._camera.zoom),i=f.divn(c.a.worldToPixels(t,e),this._tileSource.tileSize),r=Math.max(this._tileSource.hotspotAbortRadius,this._tileSource.inset)/this._tileSource.tileSize;return g(this._loadingTiles,function(t){return function(t,e,i){var r=f.create(Object(u.b)(e.x,t.x,t.x+1),Object(u.b)(e.y,t.y,t.y+1));return f.sub(r,e,r),f.length2(r)<=Math.pow(i,2)}(t.id,i,r)},function(t){return t.abortController.abort()})},e.prototype._removeTilesOutsideViewport=function(){var t=this._zoomRoundingRule(this._camera.zoom),e=c.a.getScale(t,this._camera.zoom),i=f.create(this._size.x+2*this._tileSource.inset,this._size.y+2*this._tileSource.inset),r=c.a.worldToPixels(this._camera.worldCenter,t),s=Object(o.a)(r,i,e,this._tileSource.tileSize),n=function(e){var i=e.id;return i.zoom===t&&i.x<=s.maxX&&i.x+1>=s.minX&&i.y<=s.maxY&&i.y+1>=s.minY},a=g(this._newTiles,n),l=g(this._loadingTiles,n,function(t){return t.abortController.abort()}),h=g(this._readyTiles,n);return a||l||h},e.prototype._isTileDataReadyOrLoading=function(t){return this._loadingTiles.has(t)||this._readyTiles.has(t)},e.prototype._getTilesForViewport=function(){for(var t=this._zoomRoundingRule(this._camera.zoom),e=c.a.getScale(t,this._camera.zoom),i=c.a.worldToPixels(this._camera.worldCenter,t),r=Object(o.a)(i,this._size,e,this._tileSource.tileSize),s=[],n=r.minX;n<=r.maxX;n++)for(var a=r.minY;a<=r.maxY;a++)s.push({x:n,y:a,zoom:t});return s},e.prototype._loadTile=function(t){var e=this,i=Object(o.d)(t.id.zoom,this._tileSource.tileSize),r=f.applyFunction(t.id,function(t){return Object(u.a)(t,0,i)}),s=this._queue.enqueue(function(i){var s=e._tileSource.fetchHotspots;return!i.aborted&&s?Promise.resolve(s(r.x,r.y,t.id.zoom,i)).catch(function(t){return Object(_.c)(t)}):Promise.resolve([])}),n=s.promise,a=s.abortController;return{id:t.id,abortController:a,promise:n}},e.prototype._computeAffectedTiles=function(t,e){var i=c.a.worldToTile(t,e,this._tileSource.tileSize),r=f.applyFunction(i,Math.floor),s=f.sub(i,r);f.muln(s,this._tileSource.tileSize,s);var n=s.x<this._tileSource.inset,o=s.x>this._tileSource.tileSize-this._tileSource.inset,a=s.y<this._tileSource.inset,l=s.y>this._tileSource.tileSize-this._tileSource.inset,h=[{x:r.x,y:r.y,zoom:e}];return n&&h.push({x:r.x-1,y:r.y,zoom:e}),o&&h.push({x:r.x+1,y:r.y,zoom:e}),a&&h.push({x:r.x,y:r.y-1,zoom:e}),l&&h.push({x:r.x,y:r.y+1,zoom:e}),n&&a&&h.push({x:r.x-1,y:r.y-1,zoom:e}),n&&l&&h.push({x:r.x-1,y:r.y+1,zoom:e}),o&&a&&h.push({x:r.x+1,y:r.y-1,zoom:e}),o&&l&&h.push({x:r.x+1,y:r.y+1,zoom:e}),h},e}(Object(a.a)().with());function g(t,e,i){void 0===i&&(i=p);var r=!1;return t.forEach(function(s,n){e(s)||(i(s),t.delete(n),r=!0)}),r}function v(t,e){if("Polygon"!==t.type)return t;for(var i=t.coordinates[0],r=i.reduce(function(t,e){return f.add(t,e,t)},f.create(0,0)),s=f.divn(r,i.length),n=1+e/i.reduce(function(t,e){return Math.max(t,f.length(f.sub(e,s)))},0),o=0,a=i;o<a.length;o++){var l=a[o],h=f.sub(l,s);f.muln(h,n,h),f.add(h,s,l)}return t}},21:function(t,e,i){"use strict";var r=i(8),s=i(12),n=i(64),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=16;function l(){return new Array(a)}function h(t,e){void 0===e&&(e=l());for(var i=0;i<a;++i)e[i]=t[i];return e}function c(t,e,i){void 0===i&&(i=l());for(var r=0;r<a;r+=4)for(var s=t[r],n=t[r+1],o=t[r+2],h=t[r+3],c=0;c<4;++c)i[r+c]=s*e[c]+n*e[4+c]+o*e[8+c]+h*e[12+c];return i}var d=h(o);function u(t,e,i){void 0===i&&(i=n.e(0,0,0));var r=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],s=(t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12])/r,o=(t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13])/r,a=(t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14])/r;return i.x=s,i.y=o,i.z=a,i}var f=i(18),_=i(14);function p(t,e){var i=e.container.getBoundingClientRect();return g({x:t.x-i.left,y:t.y-i.top},e)}function m(t,e){var i=v(t,e),r=e.container.getBoundingClientRect();return s.add(i,{x:r.left,y:r.top},i),i}function g(t,e){var i=e.size,s=e.zoom,o=e.worldCenter,a=e.azimuth,l=e.tilt,h=e.fov,c=Math.tan(.5*h),d={x:0,y:0,z:y(-f.a.convertPixelSizeToWorldSize(i,s).y,h)};n.k(d,l,d),n.l(d,a,d),n.c(d,Object(r.a)(Object(r.a)({},o),{z:0}),d);var u=i.x/i.y,p=n.e(c*u,c,1),m={x:2*(t.x-i.x/2)/i.x,y:2*(i.y/2-t.y)/i.y,z:-1};n.i(m,p,m),n.k(m,l,m),n.l(m,a,m);var g=n.h(n.b,{origin:d,direction:m});return g||Object(_.c)(new Error("Pointer above the horizon.")),g}function v(t,e){var i=e.size,_=e.zoom,p=e.worldCenter,m=e.azimuth,g=e.tilt,v=e.fov,x=f.a.convertPixelSizeToWorldSize(i,_),b=s.divn(x,2),w=y(-x.y,v),A={x:0,y:0,z:w};n.k(A,g,A),n.l(A,m,A),n.c(A,Object(r.a)(Object(r.a)({},p),{z:0}),A);var T=function(t,e,i,r,s){void 0===s&&(s=l());var o=n.m(e,i);n.j(o,o);var a=n.f(r,o);n.j(a,a);var h=n.f(o,a);return d[0]=a.x,d[1]=h.x,d[2]=o.x,d[4]=a.y,d[5]=h.y,d[6]=o.y,d[8]=a.z,d[9]=h.z,d[10]=o.z,d[12]=-n.g(a,e),d[13]=-n.g(h,e),d[14]=-n.g(o,e),c(t,d,s)}(o,A,Object(r.a)(Object(r.a)({},p),{z:0}),n.l({x:0,y:1,z:0},m));if(g>0){var P=-b.y*Math.sin(g),S=-P-w,R=P-w,M=b.x/-b.y,z=function(t,e,i,r,s,n){void 0===n&&(n=l());for(var o=1/Math.tan(.5*e),h=o/i,c=(r+s)/(r-s),d=2*r*s/(r-s),u=0;u<a;u+=4){n[u]=t[u]*h,n[u+1]=t[u+1]*o;var f=t[u+2],_=t[u+3];n[u+2]=f*c+_*d,n[u+3]=-f}return n}(h(o),v,M,S,R);return z[0]=z[0]*i.x/2,z[5]=z[5]*(-i.y/2),z[8]=-i.x/2,z[9]=-i.y/2,u(c(T,z),Object(r.a)(Object(r.a)({},t),{z:0}))}var C=u(T,Object(r.a)(Object(r.a)({},t),{z:0})),k=s.add(C,b);return f.a.worldToRelativePixels(k,_)}function y(t,e){return.5*t/Math.tan(.5*e)}i.d(e,"c",function(){return p}),i.d(e,"e",function(){return m}),i.d(e,"b",function(){return g}),i.d(e,"d",function(){return v}),i.d(e,"a",function(){return y})},25:function(t,e,i){"use strict";i.r(e),i.d(e,"queueMicrotask",function(){return n}),i.d(e,"Promise",function(){return r}),i.d(e,"promiseFinally",function(){return o});var r=Promise,s=r.resolve(),n=function(t){return s.then(t)},o=function(t,e){var i=Promise.resolve(t);return"finally"in i?i.finally(e):i.then(function(t){return Promise.resolve(e()).then(function(){return Promise.resolve(t)})},function(t){return Promise.resolve(e()).then(function(){return Promise.reject(t)})})}},35:function(t,e,i){"use strict";var r=i(8);!function(t){function e(e){var i=t.call(this,e)||this;return i.name="AssertionError",i}Object(r.b)(e,t)}(Error)},43:function(t,e,i){"use strict";i.d(e,"b",function(){return l}),i.d(e,"a",function(){return r});var r,s=i(8),n=i(10),o=i(77),a=i(14);!function(t){t[t.QUICK=1]="QUICK",t[t.INTERMEDIATE=2]="INTERMEDIATE",t[t.FULL=3]="FULL"}(r||(r={}));var l=function(t){function e(){var e=t.call(this)||this;return e._rafId=0,e._animationsCounter=0,e._framesSinceIntermediateRendering=0,e._renderFrame=function(){e._rafId=0,e._updateIsRequested=!1;var t=Date.now();try{e._emit("beforeRender",t);var i=e._getQualityForCurrentFrame();e._emit("render",{time:t,qualityHint:i})}catch(r){r&&"object"==typeof r&&e._lastTriggerStack&&(r.additionalInfo=e._lastTriggerStack),Object(a.c)(r)}e._isRunning&&e._requestFrame()},e._updateIsRequested=!1,e._isRunning=!1,e}return Object(s.b)(e,t),Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isRunning},enumerable:!1,configurable:!0}),e.prototype.start=function(){this._isRunning=!0,this._requestFrame(),this._lastTriggerStack=(new Error).stack},e.prototype.stop=function(){this._isRunning&&(this._isRunning=!1,this._updateIsRequested||this._cancelFrame(),this._lastTriggerStack=void 0)},e.prototype.renderImmediately=function(t){var e=Date.now();this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._updateIsRequested=!1,this._emit("beforeRender",e),this._emit("render",{time:e,qualityHint:t})},e.prototype.update=function(){this._isRunning||(this._lastTriggerStack=(new Error).stack),this._updateIsRequested=!0,this._requestFrame()},e.prototype.destroy=function(){this._cancelFrame()},e.prototype.animate=function(t){var e=this;0===this._animationsCounter&&this.start(),this._animationsCounter++;var i=!0,r=this.on("beforeRender",function(s){i?t(s):(r.offAll(),e._animationsCounter--,0===e._animationsCounter&&e.stop())}),s=new o.b;return{complete:s.promise,get isRunning(){return i},stop:function(){i?(i=!1,s.resolve()):console.warn("Trying to stop animation twice")}}},e.prototype.animateForDuration=function(t,e){var i=-1,r=this.animate(function(s){if(i<0)i=s;else{var n=(s-i)/e;n<1?t(n):(t(1),r.stop())}});return r},e.prototype._requestFrame=function(){this._rafId||(this._rafId=requestAnimationFrame(this._renderFrame))},e.prototype._cancelFrame=function(){cancelAnimationFrame(this._rafId),this._rafId=0},e.prototype._getQualityForCurrentFrame=function(){return this._isRunning?this._framesSinceIntermediateRendering<12?(this._framesSinceIntermediateRendering++,r.QUICK):(this._framesSinceIntermediateRendering=1,r.INTERMEDIATE):(this._framesSinceIntermediateRendering=0,r.FULL)},e}(Object(n.a)().with())},463:function(t,e){!function(t,e){for(var i in e)t[i]=e[i]}(e,function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=32)}([function(t,e){t.exports="varying lowp vec4 id;void main(void){gl_FragColor=id;}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexDisplacement;attribute vec4 vertexId;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform vec2 shift;const float A=pow(2.,16.);const float B=pow(2.,-31.);const float C=1.-pow(2.,-24.);varying vec4 id;void main(){vec4 D=viewProjMatrix*vec4((A*(vertexPosHigh-lookAtHigh)+(vertexPosLow-lookAtLow))*B,0,1);gl_Position=vec4(D.xy/D.w,C,1.);gl_Position.xy+=vertexDisplacement*pixelSize;gl_Position.xy+=shift;id=vec4(vertexId.xy/255.,0,1);}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosition;attribute vec2 vertexUv;uniform float zIndex;\n#ifndef YV_LEAST_16b_P\n#   ifdef GL_FRAGMENT_PRECISION_HIGH\n#       define YV_LEAST_16b_P highp\n#   else\n#       define YV_LEAST_16b_P mediump\n#   endif\n#endif\nvarying YV_LEAST_16b_P vec2 uv;void main(void){gl_Position=vec4(vertexPosition,zIndex,1);uv=vertexUv;}"},function(t,e){t.exports="#version 100\nprecision mediump float;uniform sampler2D atlas;varying highp vec2 uv;varying float weight;varying float smoothness;varying lowp vec4 color;void main(void){vec4 A=color;float B=texture2D(atlas,uv).a;float C=smoothstep(weight-smoothness,weight+smoothness,B);gl_FragColor=vec4(A.rgb,A.a*C);}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexNormal;attribute vec2 vertexDisplacement;attribute vec2 vertexUv;attribute vec4 vertexIconLocation;attribute float vertexScale;attribute vec4 vertexId;attribute vec2 vertexZoomRelatedData;attribute float vertexZIndex;varying highp vec2 textureCoordinates;varying vec4 iconLocation;varying vec4 id;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform highp float worldToPxFactor;uniform float zoom;uniform float zoomScaleFactor;const float A=256.;const float B=2048.;const float C=64.;const float D=1024.;const float E=pow(2.,16.);const float F=pow(2.,-31.);void main(void){float G=vertexZoomRelatedData[0]*C;float H=vertexZoomRelatedData[1]*D;float I=pow(2.,(zoom-G)*zoomScaleFactor);vec2 J=vec2(vertexNormal.y,-vertexNormal.x);gl_Position=viewProjMatrix*vec4((E*(vertexPosHigh-lookAtHigh)+(vertexPosLow-lookAtLow))*F+(vertexDisplacement.x*J+vertexDisplacement.y*vertexNormal)*A*worldToPxFactor*I,0,1);gl_Position.z=gl_Position.w*vertexZIndex;\n#ifndef YV_COLOR_ID\ntextureCoordinates=vertexUv*B*vertexScale;iconLocation=vertexIconLocation;float K=pow(2.,G-zoom)*I;textureCoordinates.x+=H*K*vertexScale;\n#else\nid=vertexId;\n#endif\n}"},function(t,e){t.exports="#version 100\nattribute vec4 vertexId;attribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexDisplacement;attribute vec2 vertexUV;attribute float vertexPriority;attribute lowp vec4 vertexColor;attribute lowp vec4 vertexOutlineColor;attribute float vertexScale;uniform float isOutlinePhase;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform vec2 atlasSize;uniform sampler2D visibility;uniform vec2 idHalfPxSize;uniform vec2 shift;uniform lowp float currentZoom;uniform float dpr;uniform bool isColorTransformed;uniform mat4 colorTransform;varying highp vec2 uv;varying float weight;varying float smoothness;varying lowp vec4 color;varying lowp vec4 id;const vec4 A=vec4(2,2,2,1);vec4 B(vec4 color,mat4 C){return C*vec4(color.rgb,1)*vec4(1,1,1,color.a);}const float D=pow(2.,16.);const float E=pow(2.,-31.);vec4 F(mat4 viewProjMatrix,vec2 lookAtHigh,vec2 lookAtLow,vec2 G,vec2 H,vec2 I,vec2 J){vec4 K=viewProjMatrix*vec4((D*(G-lookAtHigh)+(H-lookAtLow))*E,0,1);K=vec4(K.xy/K.w,0.,1.);return K+vec4(I*J,0.,0.);}const float L=0.5;float M(float N){return clamp(N,0.,L);}const float O=0.717;const float P=0.1;const float Q=0.12;float R(float N,bool S){return O+P*N+(S?-Q/N:0.);}const float T=0.1;const float U=0.06;float V(float N,float dpr){return(T+U/N)/dpr;}void main(void){float W=texture2D(visibility,vertexId.xy/256.+idHalfPxSize).a;if(W!=0.){gl_Position=F(viewProjMatrix,lookAtHigh,lookAtLow,vertexPosHigh,vertexPosLow,vertexDisplacement,pixelSize);\n#ifndef YV_COLOR_ID\nuv=vertexUV/atlasSize;bool S=isOutlinePhase>0.;float N=M(vertexScale);weight=R(N,S);smoothness=V(N,dpr);vec4 X=isColorTransformed?B(vertexColor,colorTransform):vertexColor;vec4 Y=vertexOutlineColor;Y.a=isColorTransformed?B(Y,colorTransform).a:Y.a;color=(isOutlinePhase*Y)+(1.-isOutlinePhase)*X;color.a*=W;\n#else\nid=vec4(vertexId.xy/255.,0,0);\n#endif\n}else{gl_Position=A;}}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexDisplacement;attribute vec2 vertexOffset;attribute vec2 vertexUV;attribute vec4 vertexId;attribute float vertexPriority;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform vec2 atlasSize;uniform sampler2D visibility;uniform vec2 idHalfPxSize;uniform vec2 extensionAndMinSize;varying vec2 uv;varying float alpha;varying vec4 id;const float A=32.;const float B=pow(2.,16.);const float C=pow(2.,-31.);const vec4 D=vec4(2,2,2,1);void main(){float E=texture2D(visibility,vertexId.xy/256.+idHalfPxSize).a;if(E!=0.){vec4 F=viewProjMatrix*vec4((B*(vertexPosHigh-lookAtHigh)+(vertexPosLow-lookAtLow))*C,0,1);vec2 G=vertexDisplacement/A;vec2 H=vertexOffset/A;float I=extensionAndMinSize.x;float J=extensionAndMinSize.y;vec2 K=max(vec2(J*0.5),I+abs(G))*sign(G)+H;gl_Position=vec4(F.xy/F.w+K*pixelSize,0.,1.);\n#ifndef YV_COLOR_ID\nuv=vertexUV/atlasSize;alpha=E;\n#else\nid=vec4(vertexId.xy/255.,0,0);\n#endif\n}else{gl_Position=D;}}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec4 vertexColor;attribute float vertexZIndex;attribute vec4 vertexId;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform bool isColorTransformed;uniform mat4 colorTransform;varying vec4 id;varying vec4 color;vec4 A(vec4 color,mat4 B){return B*vec4(color.rgb,1)*vec4(1,1,1,color.a);}const float C=pow(2.,16.);const float D=pow(2.,-31.);void main(void){gl_Position=viewProjMatrix*vec4((C*(vertexPosHigh-lookAtHigh)+(vertexPosLow-lookAtLow))*D,0,1);gl_Position.z=gl_Position.w*vertexZIndex;\n#ifndef YV_COLOR_ID\ncolor=isColorTransformed?A(vertexColor,colorTransform):vertexColor;\n#else\nid=vertexId;\n#endif\n}"},function(t,e){t.exports="#version 100\nattribute vec3 vertexPosHigh;attribute vec3 vertexPosLow;attribute float vertexHeight;attribute vec4 vertexColor;attribute vec4 vertexId;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform float zFactor;uniform bool isColorTransformed;uniform mat4 colorTransform;varying vec4 globalPosition;varying vec4 diffuseColor;varying vec4 id;const float A=pow(2.,16.);const float B=pow(2.,-31.);vec4 C(vec4 D,mat4 E){return E*vec4(D.rgb,1)*vec4(1,1,1,D.a);}void main(void){vec4 F=vec4((A*(vertexPosHigh.xy-lookAtHigh)+(vertexPosLow.xy-lookAtLow))*B,vertexHeight*zFactor,1);gl_Position=viewProjMatrix*F;\n#ifndef YV_COLOR_ID\ndiffuseColor=isColorTransformed?C(vertexColor,colorTransform):vertexColor;globalPosition=F;\n#else\nid=vertexId;\n#endif\n}"},function(t,e){t.exports="#version 100\nattribute vec4 vertexId;attribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec3 vertexDisplacements;attribute vec2 vertexUV;attribute float vertexPriority;attribute lowp vec4 vertexColor;attribute lowp vec4 vertexOutlineColor;attribute vec2 polylineLength_vertexScale;attribute vec4 leftPolylineRatios;attribute vec4 leftPolylineAngles;attribute vec4 rightPolylineRatios;attribute vec4 rightPolylineAngles;uniform float isOutlinePhase;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform vec2 atlasSize;uniform sampler2D visibility;uniform vec2 idHalfPxSize;uniform vec2 shift;uniform lowp float currentZoom;uniform float dpr;varying highp vec2 uv;varying float weight;varying float smoothness;varying lowp vec4 color;varying lowp vec4 id;const vec4 A=vec4(2,2,2,1);const float B=pow(2.,16.);const float C=pow(2.,-31.);const float D=3.1415927410125732;const int E=4;const float F=1000000.;const float G=1./256.;vec2 H(mat4 viewProjMatrix,vec2 lookAtHigh,vec2 lookAtLow,vec2 pixelSize,vec2 I,vec2 J,vec2 K){vec4 L=viewProjMatrix*vec4((B*(I-lookAtHigh)+(J-lookAtLow))*C+K,0,1);vec2 M=L.xy/L.w;return M/pixelSize;}vec2 N(float O,float P,float Q){float R=P*2.*D-D;float S=O*Q;return vec2(cos(R),sin(R))*S;}float T(vec4 R,int U){if(U==0)return R[0];if(U==1)return R[1];if(U==2)return R[2];return R[3];}vec4 V(mat4 viewProjMatrix,vec2 lookAtHigh,vec2 lookAtLow,vec2 W,vec2 X,vec2 Y,vec2 Z,float a,float Q,vec4 leftPolylineRatios,vec4 leftPolylineAngles,vec4 rightPolylineRatios,vec4 rightPolylineAngles){vec2 L=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,vec2(0,0));vec2 b=N(rightPolylineRatios[0],rightPolylineAngles[0],Q);vec2 c=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,b);bool d=a>0.;bool e=c.x<L.x;bool f=d^^e;if(d==e){b=f?N(rightPolylineRatios[0],rightPolylineAngles[0],Q):N(leftPolylineRatios[0],leftPolylineAngles[0],Q);c=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,b);}float g=abs(a);for(int U=1;U<=E;U++){vec2 h=c-L;bool i=U==E||T(f?rightPolylineRatios:leftPolylineRatios,U)<G;float j=i?F:length(h);if(j>g){float k=a>0.?1.:-1.;vec2 l=normalize(h);vec2 m=vec2(-l.y,l.x);L+=l*g;L+=k*l*Z.x;L+=k*m*Z.y;break;}else{g-=j;L+=h;vec2 n=f?N(T(rightPolylineRatios,U),T(rightPolylineAngles,U),Q):N(T(leftPolylineRatios,U),T(leftPolylineAngles,U),Q);c=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,n);}}return vec4(L*W,0.,1.);}const float o=0.5;float p(float q){return clamp(q,0.,o);}const float r=0.717;const float s=0.1;const float t=0.12;float u(float q,bool v){return r+s*q+(v?-t/q:0.);}const float w=0.1;const float x=0.06;float y(float q,float dpr){return(w+x/q)/dpr;}void main(void){float z=texture2D(visibility,vertexId.xy/256.+idHalfPxSize).a;if(z!=0.){vec2 AA=vertexDisplacements.xy;float AB=vertexDisplacements.z;float Q=polylineLength_vertexScale[0];float AC=polylineLength_vertexScale[1];gl_Position=V(viewProjMatrix,lookAtHigh,lookAtLow,pixelSize,vertexPosHigh,vertexPosLow,AA,AB,Q,leftPolylineRatios,leftPolylineAngles,rightPolylineRatios,rightPolylineAngles);\n#ifndef YV_COLOR_ID\nuv=vertexUV/atlasSize;bool v=isOutlinePhase>0.;float q=p(AC);weight=u(q,v);smoothness=y(q,dpr);color=v?vertexOutlineColor:vertexColor;color.a*=z;\n#else\nid=vec4(vertexId.xy/255.,0,0);\n#endif\n}else{gl_Position=A;}}"},function(t,e,i){t.exports=function(){return i(31)('!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=41)}([function(t,e,i){"use strict";function s(t,e){for(const i of t)if(e(i))return i}function*r(t,e){for(const i of t)yield e(i)}function*n(t,e){for(const i of t)e(i)&&(yield i)}function o(t,e,i){let s=i;for(const r of t)s=e(s,r);return s}function a(t,e){for(const i of t)if(e(i))return!0;return!1}function*l(t,e,i=((t,e)=>[t,e])){const s=t[Symbol.iterator](),r=e[Symbol.iterator]();for(let n=s.next(),o=r.next();!n.done&&!o.done;n=s.next(),o=r.next())yield i(n.value,o.value)}i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return n})),i.d(e,"e",(function(){return o})),i.d(e,"d",(function(){return a})),i.d(e,"f",(function(){return l}))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return batchPrimitiveDescriptions})),__webpack_require__.d(__webpack_exports__,"b",(function(){return batchTexturedPrimitiveDescriptions})),__webpack_require__.d(__webpack_exports__,"c",(function(){return createPrimitivesBatchingPredicate}));var _util_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_render_util_primitive_batching__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);function batchPrimitiveDescriptions(t,e=(()=>!0)){return Object(_util_iterable__WEBPACK_IMPORTED_MODULE_0__.c)(Object(_render_util_primitive_batching__WEBPACK_IMPORTED_MODULE_1__.a)(t,t=>t.location,t=>Object.assign(Object.assign({},t.location),{id:t.id}),e),t=>({location:t,id:t.id}))}function batchTexturedPrimitiveDescriptions(t,e=(()=>!0)){return Object(_util_iterable__WEBPACK_IMPORTED_MODULE_0__.c)(Object(_render_util_primitive_batching__WEBPACK_IMPORTED_MODULE_1__.a)(t,t=>t.location,t=>Object.assign(Object.assign({},t.location),{id:t.id,atlasId:t.atlasId}),(t,i)=>t.atlasId===i.atlasId&&e(t,i)),t=>({location:t,id:t.id,atlasId:t.atlasId}))}function createPrimitivesBatchingPredicate(rule,metadata){const predicate=eval(rule);if("function"!=typeof predicate)throw new Error("Predicate must be a function");return(t,e)=>{const i=void 0!==t.id?metadata.get(t.id):void 0,s=void 0!==e.id?metadata.get(e.id):void 0;return predicate(i,s,t,e)}}},function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)r(i,s)&&(t[s]=i[s])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,i,s,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+s),r);else for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){var e,i,s,r,n,o;for(s=0,e=0,i=t.length;e<i;e++)s+=t[e].length;for(o=new Uint8Array(s),r=0,e=0,i=t.length;e<i;e++)n=t[e],o.set(n,r),r+=n.length;return o}},o={arraySet:function(t,e,i,s,r){for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(s)},function(t,e,i){"use strict";(function(t){var s=e;function r(t,e,i){for(var s=Object.keys(e),r=0;r<s.length;++r)void 0!==t[s[r]]&&i||(t[s[r]]=e[s[r]]);return t}function n(t){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}s.asPromise=i(19),s.base64=i(20),s.EventEmitter=i(21),s.float=i(22),s.inquire=i(23),s.utf8=i(24),s.pool=i(25),s.LongBits=i(26),s.global="undefined"!=typeof window&&window||void 0!==t&&t||"undefined"!=typeof self&&self||this,s.emptyArray=Object.freeze?Object.freeze([]):[],s.emptyObject=Object.freeze?Object.freeze({}):{},s.isNode=Boolean(s.global.process&&s.global.process.versions&&s.global.process.versions.node),s.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},s.isString=function(t){return"string"==typeof t||t instanceof String},s.isObject=function(t){return t&&"object"==typeof t},s.isset=s.isSet=function(t,e){var i=t[e];return!(null==i||!t.hasOwnProperty(e))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},s.Buffer=function(){try{var t=s.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),s._Buffer_from=null,s._Buffer_allocUnsafe=null,s.newBuffer=function(t){return"number"==typeof t?s.Buffer?s._Buffer_allocUnsafe(t):new s.Array(t):s.Buffer?s._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},s.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,s.Long=s.global.dcodeIO&&s.global.dcodeIO.Long||s.global.Long||s.inquire("long"),s.key2Re=/^true|false|0|1$/,s.key32Re=/^-?(?:0|[1-9][0-9]*)$/,s.key64Re=/^(?:[\\\\x00-\\\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,s.longToHash=function(t){return t?s.LongBits.from(t).toHash():s.LongBits.zeroHash},s.longFromHash=function(t,e){var i=s.LongBits.fromHash(t);return s.Long?s.Long.fromBits(i.lo,i.hi,e):i.toNumber(Boolean(e))},s.merge=r,s.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},s.newError=n,s.ProtocolError=n("ProtocolError"),s.oneOfGetter=function(t){for(var e={},i=0;i<t.length;++i)e[t[i]]=1;return function(){for(var t=Object.keys(this),i=t.length-1;i>-1;--i)if(1===e[t[i]]&&void 0!==this[t[i]]&&null!==this[t[i]])return t[i]}},s.oneOfSetter=function(t){return function(e){for(var i=0;i<t.length;++i)t[i]!==e&&delete this[t[i]]}},s.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},s._configure=function(){var t=s.Buffer;t?(s._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,i){return new t(e,i)},s._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):s._Buffer_from=s._Buffer_allocUnsafe=null}}).call(this,i(18))},function(t,e,i){"use strict";var s,r,n,o,a,l,h,c,d,u,f,p,_,g,y=i(16),m=y.Reader,b=y.util,x=y.roots.default||(y.roots.default={});x.yandex=((g={}).maps=((_={}).proto=((p={}).renderer=((c={}).vmap2=((s={}).Tile=function(){function t(t){if(this.presentation=[],this.layers=[],this.indoorPlanId=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.presentation=b.emptyArray,t.prototype.points=null,t.prototype.polylines=null,t.prototype.polygons=null,t.prototype.pointLabels=null,t.prototype.polylineLabels=null,t.prototype.layers=b.emptyArray,t.prototype.indoorPlanId=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.presentation&&s.presentation.length||(s.presentation=[]),s.presentation.push(x.yandex.maps.proto.renderer.vmap2.Presentation.decode(t,t.uint32()));break;case 2:s.points=x.yandex.maps.proto.renderer.vmap2.Tile.PointObjects.decode(t,t.uint32());break;case 3:s.polylines=x.yandex.maps.proto.renderer.vmap2.Tile.PolylineObjects.decode(t,t.uint32());break;case 4:s.polygons=x.yandex.maps.proto.renderer.vmap2.Tile.PolygonObjects.decode(t,t.uint32());break;case 5:s.pointLabels=x.yandex.maps.proto.renderer.vmap2.Tile.StraightLabels.decode(t,t.uint32());break;case 6:s.polylineLabels=x.yandex.maps.proto.renderer.vmap2.Tile.CurvedLabels.decode(t,t.uint32());break;case 8:s.layers&&s.layers.length||(s.layers=[]),s.layers.push(x.yandex.maps.proto.renderer.vmap2.Tile.Layer.decode(t,t.uint32()));break;case 9:s.indoorPlanId&&s.indoorPlanId.length||(s.indoorPlanId=[]),s.indoorPlanId.push(t.string());break;default:t.skipType(7&r)}}return s},t.PointObjects=function(){function t(t){if(this.coordsx=[],this.coordsy=[],this.classId=[],this.zOrder=[],this.metadata=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.coordsx=b.emptyArray,t.prototype.coordsy=b.emptyArray,t.prototype.classId=b.emptyArray,t.prototype.zOrder=b.emptyArray,t.prototype.metadata=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.PointObjects;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:if(s.coordsx&&s.coordsx.length||(s.coordsx=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.coordsx.push(t.sint32());else s.coordsx.push(t.sint32());break;case 2:if(s.coordsy&&s.coordsy.length||(s.coordsy=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.coordsy.push(t.sint32());else s.coordsy.push(t.sint32());break;case 3:if(s.classId&&s.classId.length||(s.classId=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.classId.push(t.uint32());else s.classId.push(t.uint32());break;case 4:if(s.zOrder&&s.zOrder.length||(s.zOrder=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.zOrder.push(t.sint32());else s.zOrder.push(t.sint32());break;case 5:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(x.yandex.maps.proto.renderer.common.FeatureMetadata.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t}(),t.PolylineObjects=function(){function t(t){if(this.coordsx=[],this.coordsy=[],this.lineSize=[],this.distance=[],this.classId=[],this.pointVisibility=[],this.zOrderBegin=[],this.zOrderEnd=[],this.metadata=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.coordsx=b.emptyArray,t.prototype.coordsy=b.emptyArray,t.prototype.lineSize=b.emptyArray,t.prototype.distance=b.emptyArray,t.prototype.classId=b.emptyArray,t.prototype.pointVisibility=b.emptyArray,t.prototype.zOrderBegin=b.emptyArray,t.prototype.zOrderEnd=b.emptyArray,t.prototype.metadata=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.PolylineObjects;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:if(s.coordsx&&s.coordsx.length||(s.coordsx=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.coordsx.push(t.sint32());else s.coordsx.push(t.sint32());break;case 2:if(s.coordsy&&s.coordsy.length||(s.coordsy=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.coordsy.push(t.sint32());else s.coordsy.push(t.sint32());break;case 3:if(s.lineSize&&s.lineSize.length||(s.lineSize=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.lineSize.push(t.uint32());else s.lineSize.push(t.uint32());break;case 4:if(s.distance&&s.distance.length||(s.distance=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.distance.push(t.uint64());else s.distance.push(t.uint64());break;case 5:if(s.classId&&s.classId.length||(s.classId=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.classId.push(t.uint32());else s.classId.push(t.uint32());break;case 6:if(s.pointVisibility&&s.pointVisibility.length||(s.pointVisibility=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.pointVisibility.push(t.uint32());else s.pointVisibility.push(t.uint32());break;case 7:if(s.zOrderBegin&&s.zOrderBegin.length||(s.zOrderBegin=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.zOrderBegin.push(t.sint32());else s.zOrderBegin.push(t.sint32());break;case 8:if(s.zOrderEnd&&s.zOrderEnd.length||(s.zOrderEnd=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.zOrderEnd.push(t.sint32());else s.zOrderEnd.push(t.sint32());break;case 9:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(x.yandex.maps.proto.renderer.common.FeatureMetadata.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t}(),t.PolygonObjects=function(){function t(t){if(this.coordsx=[],this.coordsy=[],this.classId=[],this.ringCount=[],this.ringSize=[],this.contourIndex=[],this.contourCount=[],this.pointVisibility=[],this.height=[],this.zOrder=[],this.mesh=[],this.metadata=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.coordsx=b.emptyArray,t.prototype.coordsy=b.emptyArray,t.prototype.classId=b.emptyArray,t.prototype.ringCount=b.emptyArray,t.prototype.ringSize=b.emptyArray,t.prototype.contourIndex=b.emptyArray,t.prototype.contourCount=b.emptyArray,t.prototype.pointVisibility=b.emptyArray,t.prototype.height=b.emptyArray,t.prototype.zOrder=b.emptyArray,t.prototype.mesh=b.emptyArray,t.prototype.metadata=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.PolygonObjects;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:if(s.coordsx&&s.coordsx.length||(s.coordsx=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.coordsx.push(t.sint32());else s.coordsx.push(t.sint32());break;case 2:if(s.coordsy&&s.coordsy.length||(s.coordsy=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.coordsy.push(t.sint32());else s.coordsy.push(t.sint32());break;case 3:if(s.classId&&s.classId.length||(s.classId=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.classId.push(t.uint32());else s.classId.push(t.uint32());break;case 4:if(s.ringCount&&s.ringCount.length||(s.ringCount=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.ringCount.push(t.uint32());else s.ringCount.push(t.uint32());break;case 5:if(s.ringSize&&s.ringSize.length||(s.ringSize=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.ringSize.push(t.uint32());else s.ringSize.push(t.uint32());break;case 6:if(s.contourIndex&&s.contourIndex.length||(s.contourIndex=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.contourIndex.push(t.sint32());else s.contourIndex.push(t.sint32());break;case 7:if(s.contourCount&&s.contourCount.length||(s.contourCount=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.contourCount.push(t.sint32());else s.contourCount.push(t.sint32());break;case 8:if(s.pointVisibility&&s.pointVisibility.length||(s.pointVisibility=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.pointVisibility.push(t.uint32());else s.pointVisibility.push(t.uint32());break;case 9:if(s.height&&s.height.length||(s.height=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.height.push(t.sint32());else s.height.push(t.sint32());break;case 10:if(s.zOrder&&s.zOrder.length||(s.zOrder=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.zOrder.push(t.sint32());else s.zOrder.push(t.sint32());break;case 11:s.mesh&&s.mesh.length||(s.mesh=[]),s.mesh.push(x.yandex.maps.proto.renderer.vmap2.Tile.PolygonObjects.Mesh.decode(t,t.uint32()));break;case 12:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(x.yandex.maps.proto.renderer.common.FeatureMetadata.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t.BBox=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.minX=0,t.prototype.minY=0,t.prototype.maxX=0,t.prototype.maxY=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.PolygonObjects.BBox;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.minX=t.sint32();break;case 2:s.minY=t.sint32();break;case 3:s.maxX=t.sint32();break;case 4:s.maxY=t.sint32();break;default:t.skipType(7&r)}}return s},t}(),t.Mesh=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.polygonId=0,t.prototype.meshId="",t.prototype.bbox=null,t.prototype.objectId="",t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.PolygonObjects.Mesh;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.polygonId=t.uint32();break;case 2:s.meshId=t.string();break;case 3:s.bbox=x.yandex.maps.proto.renderer.vmap2.Tile.PolygonObjects.BBox.decode(t,t.uint32());break;case 4:s.objectId=t.string();break;default:t.skipType(7&r)}}return s},t}(),t}(),t.ShapedString=function(){function t(t){if(this.glyphs=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.glyphs=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.ShapedString;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:if(s.glyphs&&s.glyphs.length||(s.glyphs=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.glyphs.push(t.uint32());else s.glyphs.push(t.uint32());break;default:t.skipType(7&r)}}return s},t}(),t.ShapedText=function(){function t(t){if(this.strings=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.strings=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.ShapedText;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.strings&&s.strings.length||(s.strings=[]),s.strings.push(x.yandex.maps.proto.renderer.vmap2.Tile.ShapedString.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t}(),t.StraightLabels=function(){function t(t){if(this.classId=[],this.centerX=[],this.centerY=[],this.offsetX=[],this.offsetY=[],this.text=[],this.textAlt=[],this.priority=[],this.align=[],this.metadata=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}var e,i;return t.prototype.classId=b.emptyArray,t.prototype.centerX=b.emptyArray,t.prototype.centerY=b.emptyArray,t.prototype.offsetX=b.emptyArray,t.prototype.offsetY=b.emptyArray,t.prototype.text=b.emptyArray,t.prototype.textAlt=b.emptyArray,t.prototype.priority=b.emptyArray,t.prototype.align=b.emptyArray,t.prototype.metadata=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.StraightLabels;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:if(s.classId&&s.classId.length||(s.classId=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.classId.push(t.uint32());else s.classId.push(t.uint32());break;case 2:if(s.centerX&&s.centerX.length||(s.centerX=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.centerX.push(t.sint32());else s.centerX.push(t.sint32());break;case 3:if(s.centerY&&s.centerY.length||(s.centerY=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.centerY.push(t.sint32());else s.centerY.push(t.sint32());break;case 4:if(s.offsetX&&s.offsetX.length||(s.offsetX=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.offsetX.push(t.sint32());else s.offsetX.push(t.sint32());break;case 5:if(s.offsetY&&s.offsetY.length||(s.offsetY=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.offsetY.push(t.sint32());else s.offsetY.push(t.sint32());break;case 6:s.text&&s.text.length||(s.text=[]),s.text.push(x.yandex.maps.proto.renderer.vmap2.Tile.ShapedText.decode(t,t.uint32()));break;case 7:s.textAlt&&s.textAlt.length||(s.textAlt=[]),s.textAlt.push(x.yandex.maps.proto.renderer.vmap2.Tile.ShapedText.decode(t,t.uint32()));break;case 8:if(s.priority&&s.priority.length||(s.priority=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.priority.push(t.sint32());else s.priority.push(t.sint32());break;case 9:if(s.align&&s.align.length||(s.align=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.align.push(t.int32());else s.align.push(t.int32());break;case 10:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(x.yandex.maps.proto.renderer.common.FeatureMetadata.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t.AlignType=(e={},(i=Object.create(e))[e[0]="Left"]=0,i[e[1]="Center"]=1,i[e[2]="Right"]=2,i),t}(),t.CurvedLabels=function(){function t(t){if(this.classId=[],this.text=[],this.textAlt=[],this.priority=[],this.verticesCount=[],this.vertexX=[],this.vertexY=[],this.metadata=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.classId=b.emptyArray,t.prototype.text=b.emptyArray,t.prototype.textAlt=b.emptyArray,t.prototype.priority=b.emptyArray,t.prototype.verticesCount=b.emptyArray,t.prototype.vertexX=b.emptyArray,t.prototype.vertexY=b.emptyArray,t.prototype.metadata=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.CurvedLabels;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:if(s.classId&&s.classId.length||(s.classId=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.classId.push(t.uint32());else s.classId.push(t.uint32());break;case 2:s.text&&s.text.length||(s.text=[]),s.text.push(x.yandex.maps.proto.renderer.vmap2.Tile.ShapedString.decode(t,t.uint32()));break;case 3:s.textAlt&&s.textAlt.length||(s.textAlt=[]),s.textAlt.push(x.yandex.maps.proto.renderer.vmap2.Tile.ShapedString.decode(t,t.uint32()));break;case 4:if(s.priority&&s.priority.length||(s.priority=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.priority.push(t.sint32());else s.priority.push(t.sint32());break;case 5:if(s.verticesCount&&s.verticesCount.length||(s.verticesCount=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.verticesCount.push(t.uint32());else s.verticesCount.push(t.uint32());break;case 6:if(s.vertexX&&s.vertexX.length||(s.vertexX=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.vertexX.push(t.sint32());else s.vertexX.push(t.sint32());break;case 7:if(s.vertexY&&s.vertexY.length||(s.vertexY=[]),2==(7&r))for(n=t.uint32()+t.pos;t.pos<n;)s.vertexY.push(t.sint32());else s.vertexY.push(t.sint32());break;case 8:s.metadata&&s.metadata.length||(s.metadata=[]),s.metadata.push(x.yandex.maps.proto.renderer.common.FeatureMetadata.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t}(),t.Layer=function(){function t(t){if(this.ids=[],this.objectIndices=[],this.keys=[],this.values=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.name="",t.prototype.ids=b.emptyArray,t.prototype.objectIndices=b.emptyArray,t.prototype.keys=b.emptyArray,t.prototype.values=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Tile.Layer;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.name=t.string();break;case 2:s.ids&&s.ids.length||(s.ids=[]),s.ids.push(t.string());break;case 3:if(s.objectIndices&&s.objectIndices.length||(s.objectIndices=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.objectIndices.push(t.uint32());else s.objectIndices.push(t.uint32());break;case 4:s.keys&&s.keys.length||(s.keys=[]),s.keys.push(t.string());break;case 5:s.values&&s.values.length||(s.values=[]),s.values.push(t.string());break;default:t.skipType(7&r)}}return s},t}(),t}(),s.Presentation=function(){function t(t){if(this.classes=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.classes=b.emptyArray,t.prototype.name="",t.prototype.params=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.classes&&s.classes.length||(s.classes=[]),s.classes.push(x.yandex.maps.proto.renderer.vmap2.Presentation.Class.decode(t,t.uint32()));break;case 2:s.name=t.string();break;case 3:s.params=x.yandex.maps.proto.renderer.vmap2.Presentation.Parameters.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t.Class=function(){function t(t){if(this.slices=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id=0,t.prototype.name="",t.prototype.slices=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.id=t.uint32();break;case 2:s.name=t.string();break;case 3:s.slices&&s.slices.length||(s.slices=[]),s.slices.push(x.yandex.maps.proto.renderer.vmap2.Presentation.Class.ZoomSlice.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t.ZoomRange=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.min=0,t.prototype.max=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.ZoomRange;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.min=t.sint32();break;case 2:s.max=t.sint32();break;default:t.skipType(7&r)}}return s},t}(),t.Image=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id="",t.prototype.width=0,t.prototype.scale=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.Image;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.id=t.string();break;case 2:s.width=t.float();break;case 3:s.scale=t.float();break;default:t.skipType(7&r)}}return s},t}(),t.PointStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.icon=null,t.prototype.anchorX=0,t.prototype.anchorY=0,t.prototype.selectedIcon=null,t.prototype.selectedAnchorX=0,t.prototype.selectedAnchorY=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PointStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.icon=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.Image.decode(t,t.uint32());break;case 2:s.anchorX=t.float();break;case 3:s.anchorY=t.float();break;case 4:s.selectedIcon=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.Image.decode(t,t.uint32());break;case 5:s.selectedAnchorX=t.float();break;case 6:s.selectedAnchorY=t.float();break;default:t.skipType(7&r)}}return s},t}(),t.DashItem=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.fill=0,t.prototype.gap=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.DashItem;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.fill=t.float();break;case 2:s.gap=t.float();break;default:t.skipType(7&r)}}return s},t}(),t.DashStyle=function(){function t(t){if(this.dashes=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.dashes=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.DashStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.dashes&&s.dashes.length||(s.dashes=[]),s.dashes.push(x.yandex.maps.proto.renderer.vmap2.Presentation.Class.DashItem.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t}(),t.LineStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}var e,i;return t.prototype.color=0,t.prototype.width=0,t.prototype.caps=0,t.prototype.joins=1,t.prototype.dash=null,t.prototype.pattern=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LineStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.color=t.fixed32();break;case 2:s.width=t.float();break;case 3:s.caps=t.int32();break;case 4:s.joins=t.int32();break;case 5:s.dash=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.DashStyle.decode(t,t.uint32());break;case 6:s.pattern=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.Image.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t.CapStyle=(e={},(i=Object.create(e))[e[0]="CapRound"]=0,i[e[1]="CapButt"]=1,i[e[2]="CapSquare"]=2,i),t.JoinStyle=function(){var t={},e=Object.create(t);return e[t[0]="JoinMiter"]=0,e[t[1]="JoinRound"]=1,e[t[2]="JoinBevel"]=2,e}(),t}(),t.PolylineStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.line=null,t.prototype.outline=null,t.prototype.equidistantOffset=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PolylineStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.line=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LineStyle.decode(t,t.uint32());break;case 2:s.outline=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LineStyle.decode(t,t.uint32());break;case 3:s.equidistantOffset=t.float();break;default:t.skipType(7&r)}}return s},t}(),t.PolygonStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.pattern=null,t.prototype.color=0,t.prototype.extrusion=null,t.prototype.contour=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PolygonStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.pattern=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.Image.decode(t,t.uint32());break;case 2:s.color=t.fixed32();break;case 3:s.extrusion=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PolygonStyle.Extrusion.decode(t,t.uint32());break;case 4:s.contour=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LineStyle.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t.Extrusion=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.enabled=!1,t.prototype.height=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PolygonStyle.Extrusion;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.enabled=t.bool();break;case 3:s.height=t.float();break;default:t.skipType(7&r)}}return s},t}(),t}(),t.TextStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.color=0,t.prototype.fontId="",t.prototype.fontSize=0,t.prototype.outlineColor=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.TextStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.color=t.fixed32();break;case 2:s.fontId=t.string();break;case 3:s.fontSize=t.float();break;case 4:s.outlineColor=t.fixed32();break;default:t.skipType(7&r)}}return s},t}(),t.LabelStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.text=null,t.prototype.textAlt=null,t.prototype.hdistance=0,t.prototype.vdistance=0,t.prototype.background=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LabelStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.text=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.TextStyle.decode(t,t.uint32());break;case 2:s.textAlt=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.TextStyle.decode(t,t.uint32());break;case 3:s.hdistance=t.float();break;case 4:s.vdistance=t.float();break;case 5:s.background=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LabelBackgroundStyle.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t}(),t.LabelBackgroundStyle=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.hPadding=0,t.prototype.vPadding=0,t.prototype.color=0,t.prototype.outline=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LabelBackgroundStyle;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.hPadding=t.float();break;case 2:s.vPadding=t.float();break;case 3:s.color=t.fixed32();break;case 4:s.outline=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LineStyle.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t}(),t.ZoomSlice=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.zIndex=0,t.prototype.visibility=null,t.prototype.line=null,t.prototype.poly=null,t.prototype.point=null,t.prototype.label=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Class.ZoomSlice;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.zIndex=t.sint32();break;case 2:s.visibility=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.ZoomRange.decode(t,t.uint32());break;case 3:s.line=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PolylineStyle.decode(t,t.uint32());break;case 4:s.poly=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PolygonStyle.decode(t,t.uint32());break;case 5:s.point=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.PointStyle.decode(t,t.uint32());break;case 6:s.label=x.yandex.maps.proto.renderer.vmap2.Presentation.Class.LabelStyle.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t}(),t}(),t.Parameters=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.extrusion=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Parameters;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.extrusion=x.yandex.maps.proto.renderer.vmap2.Presentation.Parameters.Extrusion.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t.Extrusion=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.adjustMeshHeightK=0,t.prototype.adjustMeshHeightPow=0,t.prototype.adjustBoxHeightK=0,t.prototype.adjustBoxHeightPow=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.vmap2.Presentation.Parameters.Extrusion;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.adjustMeshHeightK=t.float();break;case 2:s.adjustMeshHeightPow=t.float();break;case 3:s.adjustBoxHeightK=t.float();break;case 4:s.adjustBoxHeightPow=t.float();break;default:t.skipType(7&r)}}return s},t}(),t}(),t}(),s),c.common=((r={}).FeatureMetadata=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype[".yandex.maps.proto.renderer.common.TAG_METADATA_DEPRECATED"]=null,t.prototype[".yandex.maps.proto.renderer.common.TAG_METADATA"]=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.common.FeatureMetadata;t.pos<i;){var r=t.uint32();switch(r>>>3){case 10:s[".yandex.maps.proto.renderer.common.TAG_METADATA_DEPRECATED"]=x.yandex.maps.proto.renderer.common.TagMetadata.decode(t,t.uint32());break;case 12:s[".yandex.maps.proto.renderer.common.TAG_METADATA"]=x.yandex.maps.proto.renderer.common.TagMetadata.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t}(),r.TagMetadata=function(){function t(t){if(this.tags=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.tags=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.common.TagMetadata;t.pos<i;){var r=t.uint32();switch(r>>>3){case 10:if(s.tags&&s.tags.length||(s.tags=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.tags.push(t.uint32());else s.tags.push(t.uint32());break;default:t.skipType(7&r)}}return s},t}(),r),c.layers=((l={}).basemap=((a={}).Tag=(n={},(o=Object.create(n))[n[0]="ROAD"]=0,o[n[1]="ROAD_1"]=1,o[n[2]="ROAD_2"]=2,o[n[3]="ROAD_3"]=3,o[n[4]="ROAD_4"]=4,o[n[5]="ROAD_5"]=5,o[n[6]="ROAD_6"]=6,o[n[7]="ROAD_7"]=7,o[n[8]="ROAD_LIMITED"]=8,o[n[9]="ROAD_UNCLASSIFIED"]=9,o[n[10]="ROAD_MINOR"]=10,o[n[11]="ROAD_CONSTRUCTION"]=11,o[n[12]="PATH"]=12,o[n[13]="CROSSWALK"]=13,o[n[34]="IS_TUNNEL"]=34,o[n[33]="TRAFFIC_LIGHT"]=33,o[n[14]="WATER"]=14,o[n[15]="LANDSCAPE"]=15,o[n[42]="NATIONAL_PARK"]=42,o[n[35]="LAND"]=35,o[n[16]="LANDCOVER"]=16,o[n[17]="VEGETATION"]=17,o[n[18]="URBAN_AREA"]=18,o[n[19]="RESIDENTIAL"]=19,o[n[43]="INDUSTRIAL"]=43,o[n[44]="CEMETERY"]=44,o[n[21]="PARK"]=21,o[n[45]="SPORTS_GROUND"]=45,o[n[46]="CONSTRUCTION_SITE"]=46,o[n[47]="MEDICAL"]=47,o[n[48]="BEACH"]=48,o[n[20]="POI"]=20,o[n[22]="ADMIN"]=22,o[n[23]="COUNTRY"]=23,o[n[24]="REGION"]=24,o[n[25]="LOCALITY"]=25,o[n[26]="DISTRICT"]=26,o[n[27]="ADDRESS"]=27,o[n[28]="TRANSPORT"]=28,o.TRANSIT=28,o[n[36]="TRANSIT_LOCATION"]=36,o[n[37]="TRANSIT_STOP"]=37,o[n[38]="TRANSIT_ENTRANCE"]=38,o[n[39]="IS_UNCLASSIFIED_TRANSIT"]=39,o[n[40]="TRANSIT_LINE"]=40,o[n[41]="TRANSIT_SCHEMA"]=41,o[n[29]="STRUCTURE"]=29,o[n[30]="BUILDING"]=30,o[n[31]="ENTRANCE"]=31,o[n[32]="FENCE"]=32,o[n[49]="MAJOR_LANDMARK"]=49,o[n[50]="OUTDOOR"]=50,o[n[51]="SHOPPING"]=51,o[n[52]="COMMERCIAL_SERVICES"]=52,o[n[53]="FOOD_AND_DRINK"]=53,o),a),l),c.glyphs=((h={}).Glyph=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id=0,t.prototype.bitmap=b.newBuffer([]),t.prototype.width=0,t.prototype.height=0,t.prototype.bearingX=0,t.prototype.bearingY=0,t.prototype.advance=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.glyphs.Glyph;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.id=t.uint32();break;case 2:s.bitmap=t.bytes();break;case 3:s.width=t.uint32();break;case 4:s.height=t.uint32();break;case 5:s.bearingX=t.sint32();break;case 6:s.bearingY=t.sint32();break;case 7:s.advance=t.uint32();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("id"))throw b.ProtocolError("missing required \'id\'",{instance:s});if(!s.hasOwnProperty("bitmap"))throw b.ProtocolError("missing required \'bitmap\'",{instance:s});if(!s.hasOwnProperty("width"))throw b.ProtocolError("missing required \'width\'",{instance:s});if(!s.hasOwnProperty("height"))throw b.ProtocolError("missing required \'height\'",{instance:s});if(!s.hasOwnProperty("bearingX"))throw b.ProtocolError("missing required \'bearingX\'",{instance:s});if(!s.hasOwnProperty("bearingY"))throw b.ProtocolError("missing required \'bearingY\'",{instance:s});if(!s.hasOwnProperty("advance"))throw b.ProtocolError("missing required \'advance\'",{instance:s});return s},t}(),h.FontDescription=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.fontId="",t.prototype.xheight=0,t.prototype.margin=3,t.prototype.height=0,t.prototype.ascender=0,t.prototype.descender=0,t.prototype.capHeight=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.glyphs.FontDescription;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.fontId=t.string();break;case 2:s.xheight=t.uint32();break;case 3:s.margin=t.sint32();break;case 4:s.height=t.uint32();break;case 5:s.ascender=t.uint32();break;case 6:s.descender=t.int32();break;case 7:s.capHeight=t.uint32();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("fontId"))throw b.ProtocolError("missing required \'fontId\'",{instance:s});if(!s.hasOwnProperty("xheight"))throw b.ProtocolError("missing required \'xheight\'",{instance:s});if(!s.hasOwnProperty("margin"))throw b.ProtocolError("missing required \'margin\'",{instance:s});return s},t}(),h.GlyphList=function(){function t(t){if(this.glyphs=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.font=null,t.prototype.glyphs=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.renderer.glyphs.GlyphList;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.font=x.yandex.maps.proto.renderer.glyphs.FontDescription.decode(t,t.uint32());break;case 2:s.glyphs&&s.glyphs.length||(s.glyphs=[]),s.glyphs.push(x.yandex.maps.proto.renderer.glyphs.Glyph.decode(t,t.uint32()));break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("font"))throw b.ProtocolError("missing required \'font\'",{instance:s});return s},t}(),h),c),p.indoor=((d={}).Level=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id="",t.prototype.name="",t.prototype.isUnderground=!1,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.indoor.Level;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.id=t.string();break;case 2:s.name=t.string();break;case 3:s.isUnderground=t.bool();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("id"))throw b.ProtocolError("missing required \'id\'",{instance:s});if(!s.hasOwnProperty("name"))throw b.ProtocolError("missing required \'name\'",{instance:s});return s},t}(),d.Plan=function(){function t(t){if(this.levels=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.levels=b.emptyArray,t.prototype.defaultLevelId="0",t.prototype.boundary=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.indoor.Plan;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.levels&&s.levels.length||(s.levels=[]),s.levels.push(x.yandex.maps.proto.indoor.Level.decode(t,t.uint32()));break;case 2:s.defaultLevelId=t.string();break;case 3:s.boundary=x.yandex.maps.proto.common2.geometry.BoundingBox.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t}(),d),p.common2=((f={}).geometry=((u={}).Point=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.lon=0,t.prototype.lat=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Point;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.lon=t.double();break;case 2:s.lat=t.double();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("lon"))throw b.ProtocolError("missing required \'lon\'",{instance:s});if(!s.hasOwnProperty("lat"))throw b.ProtocolError("missing required \'lat\'",{instance:s});return s},t}(),u.CoordSequence=function(){function t(t){if(this.deltas=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.first=0,t.prototype.deltas=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.CoordSequence;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.first=t.sint32();break;case 2:if(s.deltas&&s.deltas.length||(s.deltas=[]),2==(7&r))for(var n=t.uint32()+t.pos;t.pos<n;)s.deltas.push(t.sint32());else s.deltas.push(t.sint32());break;default:t.skipType(7&r)}}return s},t}(),u.Polyline=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.lons=null,t.prototype.lats=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Polyline;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.lons=x.yandex.maps.proto.common2.geometry.CoordSequence.decode(t,t.uint32());break;case 2:s.lats=x.yandex.maps.proto.common2.geometry.CoordSequence.decode(t,t.uint32());break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("lons"))throw b.ProtocolError("missing required \'lons\'",{instance:s});if(!s.hasOwnProperty("lats"))throw b.ProtocolError("missing required \'lats\'",{instance:s});return s},t}(),u.PolylinePosition=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.segmentIndex=0,t.prototype.segmentPosition=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.PolylinePosition;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.segmentIndex=t.uint32();break;case 2:s.segmentPosition=t.double();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("segmentIndex"))throw b.ProtocolError("missing required \'segmentIndex\'",{instance:s});if(!s.hasOwnProperty("segmentPosition"))throw b.ProtocolError("missing required \'segmentPosition\'",{instance:s});return s},t}(),u.Subpolyline=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.begin=null,t.prototype.end=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Subpolyline;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.begin=x.yandex.maps.proto.common2.geometry.PolylinePosition.decode(t,t.uint32());break;case 2:s.end=x.yandex.maps.proto.common2.geometry.PolylinePosition.decode(t,t.uint32());break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("begin"))throw b.ProtocolError("missing required \'begin\'",{instance:s});if(!s.hasOwnProperty("end"))throw b.ProtocolError("missing required \'end\'",{instance:s});return s},t}(),u.LinearRing=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.lons=null,t.prototype.lats=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.LinearRing;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.lons=x.yandex.maps.proto.common2.geometry.CoordSequence.decode(t,t.uint32());break;case 2:s.lats=x.yandex.maps.proto.common2.geometry.CoordSequence.decode(t,t.uint32());break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("lons"))throw b.ProtocolError("missing required \'lons\'",{instance:s});if(!s.hasOwnProperty("lats"))throw b.ProtocolError("missing required \'lats\'",{instance:s});return s},t}(),u.Polygon=function(){function t(t){if(this.innerRings=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.outerRing=null,t.prototype.innerRings=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Polygon;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.outerRing=x.yandex.maps.proto.common2.geometry.LinearRing.decode(t,t.uint32());break;case 2:s.innerRings&&s.innerRings.length||(s.innerRings=[]),s.innerRings.push(x.yandex.maps.proto.common2.geometry.LinearRing.decode(t,t.uint32()));break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("outerRing"))throw b.ProtocolError("missing required \'outerRing\'",{instance:s});return s},t}(),u.MultiPolygon=function(){function t(t){if(this.polygons=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.polygons=b.emptyArray,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.MultiPolygon;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.polygons&&s.polygons.length||(s.polygons=[]),s.polygons.push(x.yandex.maps.proto.common2.geometry.Polygon.decode(t,t.uint32()));break;default:t.skipType(7&r)}}return s},t}(),u.Geometry=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.point=null,t.prototype.polyline=null,t.prototype.polygon=null,t.prototype.multipolygon=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Geometry;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.point=x.yandex.maps.proto.common2.geometry.Point.decode(t,t.uint32());break;case 2:s.polyline=x.yandex.maps.proto.common2.geometry.Polyline.decode(t,t.uint32());break;case 3:s.polygon=x.yandex.maps.proto.common2.geometry.Polygon.decode(t,t.uint32());break;case 4:s.multipolygon=x.yandex.maps.proto.common2.geometry.MultiPolygon.decode(t,t.uint32());break;default:t.skipType(7&r)}}return s},t}(),u.BoundingBox=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.lowerCorner=null,t.prototype.upperCorner=null,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.BoundingBox;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.lowerCorner=x.yandex.maps.proto.common2.geometry.Point.decode(t,t.uint32());break;case 2:s.upperCorner=x.yandex.maps.proto.common2.geometry.Point.decode(t,t.uint32());break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("lowerCorner"))throw b.ProtocolError("missing required \'lowerCorner\'",{instance:s});if(!s.hasOwnProperty("upperCorner"))throw b.ProtocolError("missing required \'upperCorner\'",{instance:s});return s},t}(),u.Direction=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.azimuth=0,t.prototype.tilt=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Direction;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.azimuth=t.double();break;case 2:s.tilt=t.double();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("azimuth"))throw b.ProtocolError("missing required \'azimuth\'",{instance:s});if(!s.hasOwnProperty("tilt"))throw b.ProtocolError("missing required \'tilt\'",{instance:s});return s},t}(),u.Span=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.horizontalAngle=0,t.prototype.verticalAngle=0,t.decode=function(t,e){t instanceof m||(t=m.create(t));for(var i=void 0===e?t.len:t.pos+e,s=new x.yandex.maps.proto.common2.geometry.Span;t.pos<i;){var r=t.uint32();switch(r>>>3){case 1:s.horizontalAngle=t.double();break;case 2:s.verticalAngle=t.double();break;default:t.skipType(7&r)}}if(!s.hasOwnProperty("horizontalAngle"))throw b.ProtocolError("missing required \'horizontalAngle\'",{instance:s});if(!s.hasOwnProperty("verticalAngle"))throw b.ProtocolError("missing required \'verticalAngle\'",{instance:s});return s},t}(),u),f),p),_),g),t.exports=x},function(t,e,i){"use strict";var s={};(0,i(2).assign)(s,i(33),i(36),i(14)),t.exports=s},function(t,e,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,i){"use strict";function s(t,e){return e.vertexByteOffset+e.vertexByteLength===t.vertexByteOffset&&e.indexByteOffset+e.indexByteLength===t.indexByteOffset&&e.bufferId===t.bufferId&&(e.vertexByteLength+=t.vertexByteLength,e.indexByteLength+=t.indexByteLength,!0)}function*r(t,e,i,r=(()=>!0)){const n=t[Symbol.iterator]();let o=n.next().value;if(!o)return;let a=o,l=i(a);for(o=n.next().value;o;){const t=e(o);r(a,o,l)&&s(t,l)||(yield l,l=i(o)),a=o,o=n.next().value}yield l}i.d(e,"a",(function(){return r}))},function(t,e,i){"use strict";t.exports=d;var s,r=i(3),n=r.LongBits,o=r.base64,a=r.utf8;function l(t,e,i){this.fn=t,this.len=e,this.next=void 0,this.val=i}function h(){}function c(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function d(){this.len=0,this.head=new l(h,0,0),this.tail=this.head,this.states=null}function u(t,e,i){e[i]=255&t}function f(t,e){this.len=t,this.next=void 0,this.val=e}function p(t,e,i){for(;t.hi;)e[i++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[i++]=127&t.lo|128,t.lo=t.lo>>>7;e[i++]=t.lo}function _(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}d.create=r.Buffer?function(){return(d.create=function(){return new s})()}:function(){return new d},d.alloc=function(t){return new r.Array(t)},r.Array!==Array&&(d.alloc=r.pool(d.alloc,r.Array.prototype.subarray)),d.prototype._push=function(t,e,i){return this.tail=this.tail.next=new l(t,e,i),this.len+=e,this},f.prototype=Object.create(l.prototype),f.prototype.fn=function(t,e,i){for(;t>127;)e[i++]=127&t|128,t>>>=7;e[i]=t},d.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new f((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},d.prototype.int32=function(t){return t<0?this._push(p,10,n.fromNumber(t)):this.uint32(t)},d.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},d.prototype.uint64=function(t){var e=n.from(t);return this._push(p,e.length(),e)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(t){var e=n.from(t).zzEncode();return this._push(p,e.length(),e)},d.prototype.bool=function(t){return this._push(u,1,t?1:0)},d.prototype.fixed32=function(t){return this._push(_,4,t>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(t){var e=n.from(t);return this._push(_,4,e.lo)._push(_,4,e.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(t){return this._push(r.float.writeFloatLE,4,t)},d.prototype.double=function(t){return this._push(r.float.writeDoubleLE,8,t)};var g=r.Array.prototype.set?function(t,e,i){e.set(t,i)}:function(t,e,i){for(var s=0;s<t.length;++s)e[i+s]=t[s]};d.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(u,1,0);if(r.isString(t)){var i=d.alloc(e=o.length(t));o.decode(t,i,0),t=i}return this.uint32(e)._push(g,e,t)},d.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(u,1,0)},d.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(h,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(h,0,0),this.len=0),this},d.prototype.ldelim=function(){var t=this.head,e=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=e,this.len+=i),this},d.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e},d._configure=function(t){s=t}},function(t,e,i){"use strict";t.exports=l;var s,r=i(3),n=r.LongBits,o=r.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function l(t){this.buf=t,this.pos=0,this.len=t.length}var h,c="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new l(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new l(t);throw Error("illegal buffer")};function d(){var t=new n(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function u(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new n(u(this.buf,this.pos+=4),u(this.buf,this.pos+=4))}l.create=r.Buffer?function(t){return(l.create=function(t){return r.Buffer.isBuffer(t)?new s(t):c(t)})(t)}:c,l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(h=4294967295,function(){if(h=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return h;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return h}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return u(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|u(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},l.prototype.bytes=function(){var t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,i):e===i?new this.buf.constructor(0):this._slice.call(this.buf,e,i)},l.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},l.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},l._configure=function(t){s=t;var e=r.Long?"toLong":"toNumber";r.merge(l.prototype,{int64:function(){return d.call(this)[e](!1)},uint64:function(){return d.call(this)[e](!0)},sint64:function(){return d.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},function(t,e,i){"use strict";t.exports=function(t,e,i,s){for(var r=65535&t|0,n=t>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{n=n+(r=r+e[s++]|0)|0}while(--o);r%=65521,n%=65521}return r|n<<16|0}},function(t,e,i){"use strict";var s=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,e,i,r){var n=s,o=r+i;t^=-1;for(var a=r;a<o;a++)t=t>>>8^n[255&(t^e[a])];return-1^t}},function(t,e,i){"use strict";var s=i(2),r=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(h){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){n=!1}for(var o=new s.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function l(t,e){if(e<65534&&(t.subarray&&n||!t.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(t,e));for(var i="",o=0;o<e;o++)i+=String.fromCharCode(t[o]);return i}o[254]=o[254]=1,e.string2buf=function(t){var e,i,r,n,o,a=t.length,l=0;for(n=0;n<a;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new s.Buf8(l),o=0,n=0;o<l;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?e[o++]=i:i<2048?(e[o++]=192|i>>>6,e[o++]=128|63&i):i<65536?(e[o++]=224|i>>>12,e[o++]=128|i>>>6&63,e[o++]=128|63&i):(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63,e[o++]=128|i>>>6&63,e[o++]=128|63&i);return e},e.buf2binstring=function(t){return l(t,t.length)},e.binstring2buf=function(t){for(var e=new s.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},e.buf2string=function(t,e){var i,s,r,n,a=e||t.length,h=new Array(2*a);for(s=0,i=0;i<a;)if((r=t[i++])<128)h[s++]=r;else if((n=o[r])>4)h[s++]=65533,i+=n-1;else{for(r&=2===n?31:3===n?15:7;n>1&&i<a;)r=r<<6|63&t[i++],n--;n>1?h[s++]=65533:r<65536?h[s++]=r:(r-=65536,h[s++]=55296|r>>10&1023,h[s++]=56320|1023&r)}return l(h,s)},e.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+o[t[i]]>e?i:e}},function(t,e,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,i){"use strict";function s(t,e,i){i=i||2;var s,a,l,h,c,f,_,g=e&&e.length,y=g?e[0]*i:t.length,m=r(t,0,y,i,!0),b=[];if(!m)return b;if(g&&(m=function(t,e,i,s){var o,a,l,h,c,f=[];for(o=0,a=e.length;o<a;o++)l=e[o]*s,h=o<a-1?e[o+1]*s:t.length,(c=r(t,l,h,s,!1))===c.next&&(c.steiner=!0),f.push(p(c));for(f.sort(d),o=0;o<f.length;o++)u(f[o],i),i=n(i,i.next);return i}(t,e,m,i)),t.length>80*i){s=l=t[0],a=h=t[1];for(var x=i;x<y;x+=i)(c=t[x])<s&&(s=c),(f=t[x+1])<a&&(a=f),c>l&&(l=c),f>h&&(h=f);_=0!==(_=Math.max(l-s,h-a))?1/_:0}return o(m,b,i,s,a,_),b}function r(t,e,i,s,r){var n,o;if(r===T(t,e,i,s)>0)for(n=e;n<i;n+=s)o=w(n,t[n],t[n+1],o);else for(n=i-s;n>=e;n-=s)o=w(n,t[n],t[n+1],o);return o&&m(o,o.next)&&(k(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!m(s,s.next)&&0!==y(s.prev,s,s.next))s=s.next;else{if(k(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function o(t,e,i,s,r,d,u){if(t){!u&&d&&function(t,e,i,s){var r=t;do{null===r.z&&(r.z=f(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,s,r,n,o,a,l,h=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,s=i,a=0,e=0;e<h&&(a++,s=s.nextZ);e++);for(l=h;a>0||l>0&&s;)0!==a&&(0===l||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,l--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=s}n.nextZ=null,h*=2}while(o>1)}(r)}(t,s,r,d);for(var p,_,g=t;t.prev!==t.next;)if(p=t.prev,_=t.next,d?l(t,s,r,d):a(t))e.push(p.i/i),e.push(t.i/i),e.push(_.i/i),k(t),t=_.next,g=_.next;else if((t=_)===g){u?1===u?o(t=h(t,e,i),e,i,s,r,d,2):2===u&&c(t,e,i,s,r,d):o(n(t),e,i,s,r,d,1);break}}}function a(t){var e=t.prev,i=t,s=t.next;if(y(e,i,s)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(_(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,i,s){var r=t.prev,n=t,o=t.next;if(y(r,n,o)>=0)return!1;for(var a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,l=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,h=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,c=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,d=f(a,l,e,i,s),u=f(h,c,e,i,s),p=t.prevZ,g=t.nextZ;p&&p.z>=d&&g&&g.z<=u;){if(p!==t.prev&&p!==t.next&&_(r.x,r.y,n.x,n.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==t.prev&&g!==t.next&&_(r.x,r.y,n.x,n.y,o.x,o.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=d;){if(p!==t.prev&&p!==t.next&&_(r.x,r.y,n.x,n.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=u;){if(g!==t.prev&&g!==t.next&&_(r.x,r.y,n.x,n.y,o.x,o.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function h(t,e,i){var s=t;do{var r=s.prev,n=s.next.next;!m(r,n)&&b(r,s,s.next,n)&&x(r,n)&&x(n,r)&&(e.push(r.i/i),e.push(s.i/i),e.push(n.i/i),k(s),k(s.next),s=t=n),s=s.next}while(s!==t);return s}function c(t,e,i,s,r,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&g(l,h)){var c=v(l,h);return l=n(l,l.next),c=n(c,c.next),o(l,e,i,s,r,a),void o(c,e,i,s,r,a)}h=h.next}l=l.next}while(l!==t)}function d(t,e){return t.x-e.x}function u(t,e){if(e=function(t,e){var i,s=e,r=t.x,n=t.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=r&&a>o){if(o=a,a===r){if(n===s.y)return s;if(n===s.next.y)return s.next}i=s.x<s.next.x?s:s.next}}s=s.next}while(s!==e);if(!i)return null;if(r===o)return i.prev;var l,h=i,c=i.x,d=i.y,u=1/0;s=i.next;for(;s!==h;)r>=s.x&&s.x>=c&&r!==s.x&&_(n<d?r:o,n,c,d,n<d?o:r,n,s.x,s.y)&&((l=Math.abs(n-s.y)/(r-s.x))<u||l===u&&s.x>i.x)&&x(s,t)&&(i=s,u=l),s=s.next;return i}(t,e)){var i=v(e,t);n(i,i.next)}}function f(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function _(t,e,i,s,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(s-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&b(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&x(t,e)&&x(e,t)&&function(t,e){var i=t,s=!1,r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function m(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,i,s){return!!(m(t,e)&&m(i,s)||m(t,s)&&m(i,e))||y(t,e,i)>0!=y(t,e,s)>0&&y(i,s,t)>0!=y(i,s,e)>0}function x(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function v(t,e){var i=new A(t.i,t.x,t.y),s=new A(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function w(t,e,i,s){var r=new A(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function k(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function A(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,i,s){for(var r=0,n=e,o=i-s;n<i;n+=s)r+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return r}t.exports=s,t.exports.default=s,s.deviation=function(t,e,i,s){var r=e&&e.length,n=r?e[0]*i:t.length,o=Math.abs(T(t,0,n,i));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,c=a<l-1?e[a+1]*i:t.length;o-=Math.abs(T(t,h,c,i))}var d=0;for(a=0;a<s.length;a+=3){var u=s[a]*i,f=s[a+1]*i,p=s[a+2]*i;d+=Math.abs((t[u]-t[p])*(t[f+1]-t[u+1])-(t[u]-t[f])*(t[p+1]-t[u+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},s.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,r=0;r<t.length;r++){for(var n=0;n<t[r].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[r][n][o]);r>0&&(s+=t[r-1].length,i.holes.push(s))}return i}},function(t,e,i){"use strict";t.exports=i(17)},function(t,e,i){"use strict";var s=e;function r(){s.Reader._configure(s.BufferReader),s.util._configure()}s.build="minimal",s.Writer=i(8),s.BufferWriter=i(27),s.Reader=i(9),s.BufferReader=i(28),s.util=i(3),s.rpc=i(29),s.roots=i(31),s.configure=r,s.Writer._configure(s.BufferWriter),r()},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(s){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";t.exports=function(t,e){var i=new Array(arguments.length-1),s=0,r=2,n=!0;for(;r<arguments.length;)i[s++]=arguments[r++];return new Promise((function(r,o){i[s]=function(t){if(n)if(n=!1,t)o(t);else{for(var e=new Array(arguments.length-1),i=0;i<e.length;)e[i++]=arguments[i];r.apply(null,e)}};try{t.apply(e||null,i)}catch(a){n&&(n=!1,o(a))}}))}},function(t,e,i){"use strict";var s=e;s.length=function(t){var e=t.length;if(!e)return 0;for(var i=0;--e%4>1&&"="===t.charAt(e);)++i;return Math.ceil(3*t.length)/4-i};for(var r=new Array(64),n=new Array(123),o=0;o<64;)n[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;s.encode=function(t,e,i){for(var s,n=null,o=[],a=0,l=0;e<i;){var h=t[e++];switch(l){case 0:o[a++]=r[h>>2],s=(3&h)<<4,l=1;break;case 1:o[a++]=r[s|h>>4],s=(15&h)<<2,l=2;break;case 2:o[a++]=r[s|h>>6],o[a++]=r[63&h],l=0}a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),a=0)}return l&&(o[a++]=r[s],o[a++]=61,1===l&&(o[a++]=61)),n?(a&&n.push(String.fromCharCode.apply(String,o.slice(0,a))),n.join("")):String.fromCharCode.apply(String,o.slice(0,a))};s.decode=function(t,e,i){for(var s,r=i,o=0,a=0;a<t.length;){var l=t.charCodeAt(a++);if(61===l&&o>1)break;if(void 0===(l=n[l]))throw Error("invalid encoding");switch(o){case 0:s=l,o=1;break;case 1:e[i++]=s<<2|(48&l)>>4,s=l,o=2;break;case 2:e[i++]=(15&s)<<4|(60&l)>>2,s=l,o=3;break;case 3:e[i++]=(3&s)<<6|l,o=0}}if(1===o)throw Error("invalid encoding");return i-r},s.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},function(t,e,i){"use strict";function s(){this._listeners={}}t.exports=s,s.prototype.on=function(t,e,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:i||this}),this},s.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var i=this._listeners[t],s=0;s<i.length;)i[s].fn===e?i.splice(s,1):++s;return this},s.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var i=[],s=1;s<arguments.length;)i.push(arguments[s++]);for(s=0;s<e.length;)e[s].fn.apply(e[s++].ctx,i)}return this}},function(t,e,i){"use strict";function s(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),i=new Uint8Array(e.buffer),s=128===i[3];function r(t,s,r){e[0]=t,s[r]=i[0],s[r+1]=i[1],s[r+2]=i[2],s[r+3]=i[3]}function n(t,s,r){e[0]=t,s[r]=i[3],s[r+1]=i[2],s[r+2]=i[1],s[r+3]=i[0]}function o(t,s){return i[0]=t[s],i[1]=t[s+1],i[2]=t[s+2],i[3]=t[s+3],e[0]}function a(t,s){return i[3]=t[s],i[2]=t[s+1],i[1]=t[s+2],i[0]=t[s+3],e[0]}t.writeFloatLE=s?r:n,t.writeFloatBE=s?n:r,t.readFloatLE=s?o:a,t.readFloatBE=s?a:o}():function(){function e(t,e,i,s){var r=e<0?1:0;if(r&&(e=-e),0===e)t(1/e>0?0:2147483648,i,s);else if(isNaN(e))t(2143289344,i,s);else if(e>34028234663852886e22)t((r<<31|2139095040)>>>0,i,s);else if(e<11754943508222875e-54)t((r<<31|Math.round(e/1401298464324817e-60))>>>0,i,s);else{var n=Math.floor(Math.log(e)/Math.LN2);t((r<<31|n+127<<23|8388607&Math.round(e*Math.pow(2,-n)*8388608))>>>0,i,s)}}function i(t,e,i){var s=t(e,i),r=2*(s>>31)+1,n=s>>>23&255,o=8388607&s;return 255===n?o?NaN:r*(1/0):0===n?1401298464324817e-60*r*o:r*Math.pow(2,n-150)*(o+8388608)}t.writeFloatLE=e.bind(null,r),t.writeFloatBE=e.bind(null,n),t.readFloatLE=i.bind(null,o),t.readFloatBE=i.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),i=new Uint8Array(e.buffer),s=128===i[7];function r(t,s,r){e[0]=t,s[r]=i[0],s[r+1]=i[1],s[r+2]=i[2],s[r+3]=i[3],s[r+4]=i[4],s[r+5]=i[5],s[r+6]=i[6],s[r+7]=i[7]}function n(t,s,r){e[0]=t,s[r]=i[7],s[r+1]=i[6],s[r+2]=i[5],s[r+3]=i[4],s[r+4]=i[3],s[r+5]=i[2],s[r+6]=i[1],s[r+7]=i[0]}function o(t,s){return i[0]=t[s],i[1]=t[s+1],i[2]=t[s+2],i[3]=t[s+3],i[4]=t[s+4],i[5]=t[s+5],i[6]=t[s+6],i[7]=t[s+7],e[0]}function a(t,s){return i[7]=t[s],i[6]=t[s+1],i[5]=t[s+2],i[4]=t[s+3],i[3]=t[s+4],i[2]=t[s+5],i[1]=t[s+6],i[0]=t[s+7],e[0]}t.writeDoubleLE=s?r:n,t.writeDoubleBE=s?n:r,t.readDoubleLE=s?o:a,t.readDoubleBE=s?a:o}():function(){function e(t,e,i,s,r,n){var o=s<0?1:0;if(o&&(s=-s),0===s)t(0,r,n+e),t(1/s>0?0:2147483648,r,n+i);else if(isNaN(s))t(0,r,n+e),t(2146959360,r,n+i);else if(s>17976931348623157e292)t(0,r,n+e),t((o<<31|2146435072)>>>0,r,n+i);else{var a;if(s<22250738585072014e-324)t((a=s/5e-324)>>>0,r,n+e),t((o<<31|a/4294967296)>>>0,r,n+i);else{var l=Math.floor(Math.log(s)/Math.LN2);1024===l&&(l=1023),t(4503599627370496*(a=s*Math.pow(2,-l))>>>0,r,n+e),t((o<<31|l+1023<<20|1048576*a&1048575)>>>0,r,n+i)}}}function i(t,e,i,s,r){var n=t(s,r+e),o=t(s,r+i),a=2*(o>>31)+1,l=o>>>20&2047,h=4294967296*(1048575&o)+n;return 2047===l?h?NaN:a*(1/0):0===l?5e-324*a*h:a*Math.pow(2,l-1075)*(h+4503599627370496)}t.writeDoubleLE=e.bind(null,r,0,4),t.writeDoubleBE=e.bind(null,n,4,0),t.readDoubleLE=i.bind(null,o,0,4),t.readDoubleBE=i.bind(null,a,4,0)}(),t}function r(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}function n(t,e,i){e[i]=t>>>24,e[i+1]=t>>>16&255,e[i+2]=t>>>8&255,e[i+3]=255&t}function o(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function a(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=s(s)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(t,e,i){"use strict";var s=e;s.length=function(t){for(var e=0,i=0,s=0;s<t.length;++s)(i=t.charCodeAt(s))<128?e+=1:i<2048?e+=2:55296==(64512&i)&&56320==(64512&t.charCodeAt(s+1))?(++s,e+=4):e+=3;return e},s.read=function(t,e,i){if(i-e<1)return"";for(var s,r=null,n=[],o=0;e<i;)(s=t[e++])<128?n[o++]=s:s>191&&s<224?n[o++]=(31&s)<<6|63&t[e++]:s>239&&s<365?(s=((7&s)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,n[o++]=55296+(s>>10),n[o++]=56320+(1023&s)):n[o++]=(15&s)<<12|(63&t[e++])<<6|63&t[e++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,n)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,n.slice(0,o))),r.join("")):String.fromCharCode.apply(String,n.slice(0,o))},s.write=function(t,e,i){for(var s,r,n=i,o=0;o<t.length;++o)(s=t.charCodeAt(o))<128?e[i++]=s:s<2048?(e[i++]=s>>6|192,e[i++]=63&s|128):55296==(64512&s)&&56320==(64512&(r=t.charCodeAt(o+1)))?(s=65536+((1023&s)<<10)+(1023&r),++o,e[i++]=s>>18|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128,e[i++]=63&s|128):(e[i++]=s>>12|224,e[i++]=s>>6&63|128,e[i++]=63&s|128);return i-n}},function(t,e,i){"use strict";t.exports=function(t,e,i){var s=i||8192,r=s>>>1,n=null,o=s;return function(i){if(i<1||i>r)return t(i);o+i>s&&(n=t(s),o=0);var a=e.call(n,o,o+=i);return 7&o&&(o=1+(7|o)),a}}},function(t,e,i){"use strict";t.exports=r;var s=i(3);function r(t,e){this.lo=t>>>0,this.hi=e>>>0}var n=r.zero=new r(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var o=r.zeroHash="\\0\\0\\0\\0\\0\\0\\0\\0";r.fromNumber=function(t){if(0===t)return n;var e=t<0;e&&(t=-t);var i=t>>>0,s=(t-i)/4294967296>>>0;return e&&(s=~s>>>0,i=~i>>>0,++i>4294967295&&(i=0,++s>4294967295&&(s=0))),new r(i,s)},r.from=function(t){if("number"==typeof t)return r.fromNumber(t);if(s.isString(t)){if(!s.Long)return r.fromNumber(parseInt(t,10));t=s.Long.fromString(t)}return t.low||t.high?new r(t.low>>>0,t.high>>>0):n},r.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,i=~this.hi>>>0;return e||(i=i+1>>>0),-(e+4294967296*i)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(t){return s.Long?new s.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;r.fromHash=function(t){return t===o?n:new r((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},r.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},r.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:i<128?9:10}},function(t,e,i){"use strict";t.exports=o;var s=i(8);(o.prototype=Object.create(s.prototype)).constructor=o;var r=i(3),n=r.Buffer;function o(){s.call(this)}o.alloc=function(t){return(o.alloc=r._Buffer_allocUnsafe)(t)};var a=n&&n.prototype instanceof Uint8Array&&"set"===n.prototype.set.name?function(t,e,i){e.set(t,i)}:function(t,e,i){if(t.copy)t.copy(e,i,0,t.length);else for(var s=0;s<t.length;)e[i++]=t[s++]};function l(t,e,i){t.length<40?r.utf8.write(t,e,i):e.utf8Write(t,i)}o.prototype.bytes=function(t){r.isString(t)&&(t=r._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(a,e,t),this},o.prototype.string=function(t){var e=n.byteLength(t);return this.uint32(e),e&&this._push(l,e,t),this}},function(t,e,i){"use strict";t.exports=n;var s=i(9);(n.prototype=Object.create(s.prototype)).constructor=n;var r=i(3);function n(t){s.call(this,t)}r.Buffer&&(n.prototype._slice=r.Buffer.prototype.slice),n.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))}},function(t,e,i){"use strict";e.Service=i(30)},function(t,e,i){"use strict";t.exports=r;var s=i(3);function r(t,e,i){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");s.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(i)}(r.prototype=Object.create(s.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function t(e,i,r,n,o){if(!n)throw TypeError("request must be specified");var a=this;if(!o)return s.asPromise(t,a,e,i,r,n);if(a.rpcImpl)try{return a.rpcImpl(e,i[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),(function(t,i){if(t)return a.emit("error",t,e),o(t);if(null!==i){if(!(i instanceof r))try{i=r[a.responseDelimited?"decodeDelimited":"decode"](i)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",i,e),o(null,i)}a.end(!0)}))}catch(l){return a.emit("error",l,e),void setTimeout((function(){o(l)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},r.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(t,e,i){"use strict";t.exports={}},function(t,e,i){"use strict";!function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct \'TextEncoder\': The encoding label provided (\'${t}\') is invalid.`)}function i(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct \'TextDecoder\': The encoding label provided (\'${t}\') is invalid.`);if(e.fatal)throw new Error("Failed to construct \'TextDecoder\': the \'fatal\' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the \'stream\' option is unsupported.");let i=0;const s=t.length;let r=0,n=Math.max(32,s+(s>>1)+7),o=new Uint8Array(n>>3<<3);for(;i<s;){let e=t.charCodeAt(i++);if(e>=55296&&e<=56319){if(i<s){const s=t.charCodeAt(i);56320==(64512&s)&&(++i,e=((1023&e)<<10)+(1023&s)+65536)}if(e>=55296&&e<=56319)continue}if(r+4>o.length){n+=8,n*=1+i/t.length*2,n=n>>3<<3;const e=new Uint8Array(n);e.set(o),o=e}if(0!=(4294967168&e)){if(0==(4294965248&e))o[r++]=e>>6&31|192;else if(0==(4294901760&e))o[r++]=e>>12&15|224,o[r++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;o[r++]=e>>18&7|240,o[r++]=e>>12&63|128,o[r++]=e>>6&63|128}o[r++]=63&e|128}else o[r++]=e}return o.slice(0,r)},Object.defineProperty(i.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(i.prototype,"fatal",{value:!1}),Object.defineProperty(i.prototype,"ignoreBOM",{value:!1}),i.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the \'stream\' option is unsupported.");const i=new Uint8Array(t);let s=0;const r=i.length,n=[];for(;s<r;){const t=i[s++];if(0===t)break;if(0==(128&t))n.push(t);else if(192==(224&t)){const e=63&i[s++];n.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&i[s++],r=63&i[s++];n.push((31&t)<<12|e<<6|r)}else if(240==(248&t)){let e=(7&t)<<18|(63&i[s++])<<12|(63&i[s++])<<6|63&i[s++];e>65535&&(e-=65536,n.push(e>>>10&1023|55296),e=56320|1023&e),n.push(e)}}return String.fromCharCode.apply(null,n)},t.TextEncoder=e,t.TextDecoder=i}("undefined"!=typeof window?window:"undefined"!=typeof self?self:this)},function(t,e,i){"use strict";var s=i(34),r=i(2),n=i(12),o=i(6),a=i(13),l=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==i)throw new Error(o[i]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var c;if(c="string"==typeof e.dictionary?n.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(i=s.deflateSetDictionary(this.strm,c)))throw new Error(o[i]);this._dict_set=!0}}function c(t,e){var i=new h(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}h.prototype.push=function(t,e){var i,o,a=this.strm,h=this.options.chunkSize;if(this.ended)return!1;o=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=n.string2buf(t):"[object ArrayBuffer]"===l.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(h),a.next_out=0,a.avail_out=h),1!==(i=s.deflate(a,o))&&0!==i)return this.onEnd(i),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(n.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==i);return 4===o?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==o||(this.onEnd(0),a.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=h,e.deflate=c,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,c(t,e)}},function(t,e,i){"use strict";var s,r=i(2),n=i(35),o=i(10),a=i(11),l=i(6);function h(t,e){return t.msg=l[e],e}function c(t){return(t<<1)-(t>4?9:0)}function d(t){for(var e=t.length;--e>=0;)t[e]=0}function u(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function f(t,e){n._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,u(t.strm)}function p(t,e){t.pending_buf[t.pending++]=e}function _(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function g(t,e){var i,s,r=t.max_chain_length,n=t.strstart,o=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,c=t.w_mask,d=t.prev,u=t.strstart+258,f=h[n+o-1],p=h[n+o];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(h[(i=e)+o]===p&&h[i+o-1]===f&&h[i]===h[n]&&h[++i]===h[n+1]){n+=2,i++;do{}while(h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&n<u);if(s=258-(u-n),n=u-258,s>o){if(t.match_start=e,o=s,s>=a)break;f=h[n+o-1],p=h[n+o]}}}while((e=d[e&c])>l&&0!=--r);return o<=t.lookahead?o:t.lookahead}function y(t){var e,i,s,n,l,h,c,d,u,f,p=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-262)){r.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=i=t.hash_size;do{s=t.head[--e],t.head[e]=s>=p?s-p:0}while(--i);e=i=p;do{s=t.prev[--e],t.prev[e]=s>=p?s-p:0}while(--i);n+=p}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,d=t.strstart+t.lookahead,u=n,f=void 0,(f=h.avail_in)>u&&(f=u),i=0===f?0:(h.avail_in-=f,r.arraySet(c,h.input,h.next_in,f,d),1===h.state.wrap?h.adler=o(h.adler,c,f,d):2===h.state.wrap&&(h.adler=a(h.adler,c,f,d)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=3)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function m(t,e){for(var i,s;;){if(t.lookahead<262){if(y(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-262&&(t.match_length=g(t,i)),t.match_length>=3)if(s=n._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else s=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}function b(t,e){for(var i,s,r;;){if(t.lookahead<262){if(y(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-262&&(t.match_length=g(t,i),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,s=n._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(f(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((s=n._tr_tally(t,0,t.window[t.strstart-1]))&&f(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=n._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}function x(t,e,i,s,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=r}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,n._tr_init(e),0):h(t,-2)}function k(t){var e,i=w(t);return 0===i&&((e=t.state).window_size=2*e.w_size,d(e.head),e.max_lazy_match=s[e.level].max_lazy,e.good_match=s[e.level].good_length,e.nice_match=s[e.level].nice_length,e.max_chain_length=s[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),i}function A(t,e,i,s,n,o){if(!t)return-2;var a=1;if(-1===e&&(e=6),s<0?(a=0,s=-s):s>15&&(a=2,s-=16),n<1||n>9||8!==i||s<8||s>15||e<0||e>9||o<0||o>4)return h(t,-2);8===s&&(s=9);var l=new v;return t.state=l,l.strm=t,l.wrap=a,l.gzhead=null,l.w_bits=s,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=n+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<n+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=o,l.method=i,k(t)}s=[new x(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(y(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var s=t.block_start+i;if((0===t.strstart||t.strstart>=s)&&(t.lookahead=t.strstart-s,t.strstart=s,f(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(f(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(f(t,!1),t.strm.avail_out),1)})),new x(4,4,8,4,m),new x(4,5,16,8,m),new x(4,6,32,32,m),new x(4,4,16,16,b),new x(8,16,32,32,b),new x(8,16,128,128,b),new x(8,32,128,256,b),new x(32,128,258,1024,b),new x(32,258,258,4096,b)],e.deflateInit=function(t,e){return A(t,e,8,15,8,0)},e.deflateInit2=A,e.deflateReset=k,e.deflateResetKeep=w,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},e.deflate=function(t,e){var i,r,o,l;if(!t||!t.state||e>5||e<0)return t?h(t,-2):-2;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&4!==e)return h(t,0===t.avail_out?-5:-2);if(r.strm=t,i=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,p(r,31),p(r,139),p(r,8),r.gzhead?(p(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),p(r,255&r.gzhead.time),p(r,r.gzhead.time>>8&255),p(r,r.gzhead.time>>16&255),p(r,r.gzhead.time>>24&255),p(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),p(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(p(r,255&r.gzhead.extra.length),p(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=a(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(p(r,0),p(r,0),p(r,0),p(r,0),p(r,0),p(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),p(r,3),r.status=113);else{var g=8+(r.w_bits-8<<4)<<8;g|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(g|=32),g+=31-g%31,r.status=113,_(r,g),0!==r.strstart&&(_(r,t.adler>>>16),_(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),u(t),o=r.pending,r.pending!==r.pending_buf_size));)p(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),u(t),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,p(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),u(t),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,p(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(t.adler=a(t.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&u(t),r.pending+2<=r.pending_buf_size&&(p(r,255&t.adler),p(r,t.adler>>8&255),t.adler=0,r.status=113)):r.status=113),0!==r.pending){if(u(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&c(e)<=c(i)&&4!==e)return h(t,-5);if(666===r.status&&0!==t.avail_in)return h(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&666!==r.status){var m=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(y(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,i=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var i,s,r,o,a=t.window;;){if(t.lookahead<=258){if(y(t),t.lookahead<=258&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(s=a[r=t.strstart-1])===a[++r]&&s===a[++r]&&s===a[++r]){o=t.strstart+258;do{}while(s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&s===a[++r]&&r<o);t.match_length=258-(o-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=n._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(f(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(f(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(f(t,!1),0===t.strm.avail_out)?1:2}(r,e):s[r.level].func(r,e);if(3!==m&&4!==m||(r.status=666),1===m||3===m)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===m&&(1===e?n._tr_align(r):5!==e&&(n._tr_stored_block(r,0,0,!1),3===e&&(d(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),u(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(p(r,255&t.adler),p(r,t.adler>>8&255),p(r,t.adler>>16&255),p(r,t.adler>>24&255),p(r,255&t.total_in),p(r,t.total_in>>8&255),p(r,t.total_in>>16&255),p(r,t.total_in>>24&255)):(_(r,t.adler>>>16),_(r,65535&t.adler)),u(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?h(t,-2):(t.state=null,113===e?h(t,-3):0):-2},e.deflateSetDictionary=function(t,e){var i,s,n,a,l,h,c,u,f=e.length;if(!t||!t.state)return-2;if(2===(a=(i=t.state).wrap)||1===a&&42!==i.status||i.lookahead)return-2;for(1===a&&(t.adler=o(t.adler,e,f,0)),i.wrap=0,f>=i.w_size&&(0===a&&(d(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new r.Buf8(i.w_size),r.arraySet(u,e,f-i.w_size,i.w_size,0),e=u,f=i.w_size),l=t.avail_in,h=t.next_in,c=t.input,t.avail_in=f,t.next_in=0,t.input=e,y(i);i.lookahead>=3;){s=i.strstart,n=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+3-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--n);i.strstart=s,i.lookahead=2,y(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=h,t.input=c,t.avail_in=l,i.wrap=a,0},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,i){"use strict";var s=i(2);function r(t){for(var e=t.length;--e>=0;)t[e]=0}var n=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=new Array(576);r(h);var c=new Array(60);r(c);var d=new Array(512);r(d);var u=new Array(256);r(u);var f=new Array(29);r(f);var p,_,g,y=new Array(30);function m(t,e,i,s,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=t&&t.length}function b(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function x(t){return t<256?d[t]:d[256+(t>>>7)]}function v(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function w(t,e,i){t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,v(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function k(t,e,i){w(t,i[2*e],i[2*e+1])}function A(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function T(t,e,i){var s,r,n=new Array(16),o=0;for(s=1;s<=15;s++)n[s]=o=o+i[s-1]<<1;for(r=0;r<=e;r++){var a=t[2*r+1];0!==a&&(t[2*r]=A(n[a]++,a))}}function S(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function R(t){t.bi_valid>8?v(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function P(t,e,i,s){var r=2*e,n=2*i;return t[r]<t[n]||t[r]===t[n]&&s[e]<=s[i]}function I(t,e,i){for(var s=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&P(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!P(e,s,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=s}function z(t,e,i){var s,r,a,l,h=0;if(0!==t.last_lit)do{s=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===s?k(t,r,e):(k(t,(a=u[r])+256+1,e),0!==(l=n[a])&&w(t,r-=f[a],l),k(t,a=x(--s),i),0!==(l=o[a])&&w(t,s-=y[a],l))}while(h<t.last_lit);k(t,256,e)}function C(t,e){var i,s,r,n=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<l;i++)0!==n[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):n[2*i+1]=0;for(;t.heap_len<2;)n[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,a&&(t.static_len-=o[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)I(t,n,i);r=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],I(t,n,1),s=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=s,n[2*r]=n[2*i]+n[2*s],t.depth[r]=(t.depth[i]>=t.depth[s]?t.depth[i]:t.depth[s])+1,n[2*i+1]=n[2*s+1]=r,t.heap[1]=r++,I(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,s,r,n,o,a,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,d=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,_=0;for(n=0;n<=15;n++)t.bl_count[n]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)(n=l[2*l[2*(s=t.heap[i])+1]+1]+1)>p&&(n=p,_++),l[2*s+1]=n,s>h||(t.bl_count[n]++,o=0,s>=f&&(o=u[s-f]),a=l[2*s],t.opt_len+=a*(n+o),d&&(t.static_len+=a*(c[2*s+1]+o)));if(0!==_){do{for(n=p-1;0===t.bl_count[n];)n--;t.bl_count[n]--,t.bl_count[n+1]+=2,t.bl_count[p]--,_-=2}while(_>0);for(n=p;0!==n;n--)for(s=t.bl_count[n];0!==s;)(r=t.heap[--i])>h||(l[2*r+1]!==n&&(t.opt_len+=(n-l[2*r+1])*l[2*r],l[2*r+1]=n),s--)}}(t,e),T(n,h,t.bl_count)}function O(t,e,i){var s,r,n=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)r=o,o=e[2*(s+1)+1],++a<l&&r===o||(a<h?t.bl_tree[2*r]+=a:0!==r?(r!==n&&t.bl_tree[2*r]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,n=r,0===o?(l=138,h=3):r===o?(l=6,h=3):(l=7,h=4))}function E(t,e,i){var s,r,n=-1,o=e[1],a=0,l=7,h=4;for(0===o&&(l=138,h=3),s=0;s<=i;s++)if(r=o,o=e[2*(s+1)+1],!(++a<l&&r===o)){if(a<h)do{k(t,r,t.bl_tree)}while(0!=--a);else 0!==r?(r!==n&&(k(t,r,t.bl_tree),a--),k(t,16,t.bl_tree),w(t,a-3,2)):a<=10?(k(t,17,t.bl_tree),w(t,a-3,3)):(k(t,18,t.bl_tree),w(t,a-11,7));a=0,n=r,0===o?(l=138,h=3):r===o?(l=6,h=3):(l=7,h=4)}}r(y);var M=!1;function B(t,e,i,r){w(t,0+(r?1:0),3),function(t,e,i,r){R(t),r&&(v(t,i),v(t,~i)),s.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}e._tr_init=function(t){M||(!function(){var t,e,i,s,r,l=new Array(16);for(i=0,s=0;s<28;s++)for(f[s]=i,t=0;t<1<<n[s];t++)u[i++]=s;for(u[i-1]=s,r=0,s=0;s<16;s++)for(y[s]=r,t=0;t<1<<o[s];t++)d[r++]=s;for(r>>=7;s<30;s++)for(y[s]=r<<7,t=0;t<1<<o[s]-7;t++)d[256+r++]=s;for(e=0;e<=15;e++)l[e]=0;for(t=0;t<=143;)h[2*t+1]=8,t++,l[8]++;for(;t<=255;)h[2*t+1]=9,t++,l[9]++;for(;t<=279;)h[2*t+1]=7,t++,l[7]++;for(;t<=287;)h[2*t+1]=8,t++,l[8]++;for(T(h,287,l),t=0;t<30;t++)c[2*t+1]=5,c[2*t]=A(t,5);p=new m(h,n,257,286,15),_=new m(c,o,0,30,15),g=new m(new Array(0),a,0,19,7)}(),M=!0),t.l_desc=new b(t.dyn_ltree,p),t.d_desc=new b(t.dyn_dtree,_),t.bl_desc=new b(t.bl_tree,g),t.bi_buf=0,t.bi_valid=0,S(t)},e._tr_stored_block=B,e._tr_flush_block=function(t,e,i,s){var r,n,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),C(t,t.l_desc),C(t,t.d_desc),o=function(t){var e;for(O(t,t.dyn_ltree,t.l_desc.max_code),O(t,t.dyn_dtree,t.d_desc.max_code),C(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(n=t.static_len+3+7>>>3)<=r&&(r=n)):r=n=i+5,i+4<=r&&-1!==e?B(t,e,i,s):4===t.strategy||n===r?(w(t,2+(s?1:0),3),z(t,h,c)):(w(t,4+(s?1:0),3),function(t,e,i,s){var r;for(w(t,e-257,5),w(t,i-1,5),w(t,s-4,4),r=0;r<s;r++)w(t,t.bl_tree[2*l[r]+1],3);E(t,t.dyn_ltree,e-1),E(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),z(t,t.dyn_ltree,t.dyn_dtree)),S(t),s&&R(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(u[i]+256+1)]++,t.dyn_dtree[2*x(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){w(t,2,3),k(t,256,h),function(t){16===t.bi_valid?(v(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,i){"use strict";var s=i(37),r=i(2),n=i(12),o=i(14),a=i(6),l=i(13),h=i(40),c=Object.prototype.toString;function d(t){if(!(this instanceof d))return new d(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=s.inflateInit2(this.strm,e.windowBits);if(i!==o.Z_OK)throw new Error(a[i]);if(this.header=new h,s.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=n.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=s.inflateSetDictionary(this.strm,e.dictionary))!==o.Z_OK))throw new Error(a[i])}function u(t,e){var i=new d(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}d.prototype.push=function(t,e){var i,a,l,h,d,u=this.strm,f=this.options.chunkSize,p=this.options.dictionary,_=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof t?u.input=n.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?u.input=new Uint8Array(t):u.input=t,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new r.Buf8(f),u.next_out=0,u.avail_out=f),(i=s.inflate(u,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(i=s.inflateSetDictionary(this.strm,p)),i===o.Z_BUF_ERROR&&!0===_&&(i=o.Z_OK,_=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&i!==o.Z_STREAM_END&&(0!==u.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=n.utf8border(u.output,u.next_out),h=u.next_out-l,d=n.buf2string(u.output,l),u.next_out=h,u.avail_out=f-h,h&&r.arraySet(u.output,u.output,l,h,0),this.onData(d)):this.onData(r.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(_=!0)}while((u.avail_in>0||0===u.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(i=s.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),u.avail_out=0,!0)},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=d,e.inflate=u,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},e.ungzip=u},function(t,e,i){"use strict";var s=i(2),r=i(10),n=i(11),o=i(38),a=i(39);function l(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function c(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new s.Buf32(852),e.distcode=e.distdyn=new s.Buf32(592),e.sane=1,e.back=-1,0):-2}function d(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,c(t)):-2}function u(t,e){var i,s;return t&&t.state?(s=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,d(t))):-2}function f(t,e){var i,s;return t?(s=new h,t.state=s,s.window=null,0!==(i=u(t,e))&&(t.state=null),i):-2}var p,_,g=!0;function y(t){if(g){var e;for(p=new s.Buf32(512),_=new s.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(1,t.lens,0,288,p,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(2,t.lens,0,32,_,0,t.work,{bits:5}),g=!1}t.lencode=p,t.lenbits=9,t.distcode=_,t.distbits=5}function m(t,e,i,r){var n,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new s.Buf8(o.wsize)),r>=o.wsize?(s.arraySet(o.window,e,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>r&&(n=r),s.arraySet(o.window,e,i-r,n,o.wnext),(r-=n)?(s.arraySet(o.window,e,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}e.inflateReset=d,e.inflateReset2=u,e.inflateResetKeep=c,e.inflateInit=function(t){return f(t,15)},e.inflateInit2=f,e.inflate=function(t,e){var i,h,c,d,u,f,p,_,g,b,x,v,w,k,A,T,S,R,P,I,z,C,O,E,M=0,B=new s.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(i=t.state).mode&&(i.mode=13),u=t.next_out,c=t.output,p=t.avail_out,d=t.next_in,h=t.input,f=t.avail_in,_=i.hold,g=i.bits,b=f,x=p,C=0;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;g<16;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(2&i.wrap&&35615===_){i.check=0,B[0]=255&_,B[1]=_>>>8&255,i.check=n(i.check,B,2,0),_=0,g=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&_)){t.msg="unknown compression method",i.mode=30;break}if(g-=4,z=8+(15&(_>>>=4)),0===i.wbits)i.wbits=z;else if(z>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<z,t.adler=i.check=1,i.mode=512&_?10:12,_=0,g=0;break;case 2:for(;g<16;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(i.flags=_,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=_>>8&1),512&i.flags&&(B[0]=255&_,B[1]=_>>>8&255,i.check=n(i.check,B,2,0)),_=0,g=0,i.mode=3;case 3:for(;g<32;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}i.head&&(i.head.time=_),512&i.flags&&(B[0]=255&_,B[1]=_>>>8&255,B[2]=_>>>16&255,B[3]=_>>>24&255,i.check=n(i.check,B,4,0)),_=0,g=0,i.mode=4;case 4:for(;g<16;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&i.flags&&(B[0]=255&_,B[1]=_>>>8&255,i.check=n(i.check,B,2,0)),_=0,g=0,i.mode=5;case 5:if(1024&i.flags){for(;g<16;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}i.length=_,i.head&&(i.head.extra_len=_),512&i.flags&&(B[0]=255&_,B[1]=_>>>8&255,i.check=n(i.check,B,2,0)),_=0,g=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((v=i.length)>f&&(v=f),v&&(i.head&&(z=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),s.arraySet(i.head.extra,h,d,v,z)),512&i.flags&&(i.check=n(i.check,h,v,d)),f-=v,d+=v,i.length-=v),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===f)break t;v=0;do{z=h[d+v++],i.head&&z&&i.length<65536&&(i.head.name+=String.fromCharCode(z))}while(z&&v<f);if(512&i.flags&&(i.check=n(i.check,h,v,d)),f-=v,d+=v,z)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===f)break t;v=0;do{z=h[d+v++],i.head&&z&&i.length<65536&&(i.head.comment+=String.fromCharCode(z))}while(z&&v<f);if(512&i.flags&&(i.check=n(i.check,h,v,d)),f-=v,d+=v,z)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;g<16;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(_!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}_=0,g=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;g<32;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}t.adler=i.check=l(_),_=0,g=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=u,t.avail_out=p,t.next_in=d,t.avail_in=f,i.hold=_,i.bits=g,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){_>>>=7&g,g-=7&g,i.mode=27;break}for(;g<3;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}switch(i.last=1&_,g-=1,3&(_>>>=1)){case 0:i.mode=14;break;case 1:if(y(i),i.mode=20,6===e){_>>>=2,g-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}_>>>=2,g-=2;break;case 14:for(_>>>=7&g,g-=7&g;g<32;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if((65535&_)!=(_>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&_,_=0,g=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(v=i.length){if(v>f&&(v=f),v>p&&(v=p),0===v)break t;s.arraySet(c,h,d,v,u),f-=v,d+=v,p-=v,u+=v,i.length-=v;break}i.mode=12;break;case 17:for(;g<14;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(i.nlen=257+(31&_),_>>>=5,g-=5,i.ndist=1+(31&_),_>>>=5,g-=5,i.ncode=4+(15&_),_>>>=4,g-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;g<3;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}i.lens[L[i.have++]]=7&_,_>>>=3,g-=3}for(;i.have<19;)i.lens[L[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,O={bits:i.lenbits},C=a(0,i.lens,0,19,i.lencode,0,i.work,O),i.lenbits=O.bits,C){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;T=(M=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,S=65535&M,!((A=M>>>24)<=g);){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(S<16)_>>>=A,g-=A,i.lens[i.have++]=S;else{if(16===S){for(E=A+2;g<E;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(_>>>=A,g-=A,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}z=i.lens[i.have-1],v=3+(3&_),_>>>=2,g-=2}else if(17===S){for(E=A+3;g<E;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}g-=A,z=0,v=3+(7&(_>>>=A)),_>>>=3,g-=3}else{for(E=A+7;g<E;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}g-=A,z=0,v=11+(127&(_>>>=A)),_>>>=7,g-=7}if(i.have+v>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;v--;)i.lens[i.have++]=z}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,O={bits:i.lenbits},C=a(1,i.lens,0,i.nlen,i.lencode,0,i.work,O),i.lenbits=O.bits,C){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,O={bits:i.distbits},C=a(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,O),i.distbits=O.bits,C){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(f>=6&&p>=258){t.next_out=u,t.avail_out=p,t.next_in=d,t.avail_in=f,i.hold=_,i.bits=g,o(t,x),u=t.next_out,c=t.output,p=t.avail_out,d=t.next_in,h=t.input,f=t.avail_in,_=i.hold,g=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;T=(M=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,S=65535&M,!((A=M>>>24)<=g);){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(T&&0==(240&T)){for(R=A,P=T,I=S;T=(M=i.lencode[I+((_&(1<<R+P)-1)>>R)])>>>16&255,S=65535&M,!(R+(A=M>>>24)<=g);){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}_>>>=R,g-=R,i.back+=R}if(_>>>=A,g-=A,i.back+=A,i.length=S,0===T){i.mode=26;break}if(32&T){i.back=-1,i.mode=12;break}if(64&T){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&T,i.mode=22;case 22:if(i.extra){for(E=i.extra;g<E;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,g-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;T=(M=i.distcode[_&(1<<i.distbits)-1])>>>16&255,S=65535&M,!((A=M>>>24)<=g);){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(0==(240&T)){for(R=A,P=T,I=S;T=(M=i.distcode[I+((_&(1<<R+P)-1)>>R)])>>>16&255,S=65535&M,!(R+(A=M>>>24)<=g);){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}_>>>=R,g-=R,i.back+=R}if(_>>>=A,g-=A,i.back+=A,64&T){t.msg="invalid distance code",i.mode=30;break}i.offset=S,i.extra=15&T,i.mode=24;case 24:if(i.extra){for(E=i.extra;g<E;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,g-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===p)break t;if(v=x-p,i.offset>v){if((v=i.offset-v)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}v>i.wnext?(v-=i.wnext,w=i.wsize-v):w=i.wnext-v,v>i.length&&(v=i.length),k=i.window}else k=c,w=u-i.offset,v=i.length;v>p&&(v=p),p-=v,i.length-=v;do{c[u++]=k[w++]}while(--v);0===i.length&&(i.mode=21);break;case 26:if(0===p)break t;c[u++]=i.length,p--,i.mode=21;break;case 27:if(i.wrap){for(;g<32;){if(0===f)break t;f--,_|=h[d++]<<g,g+=8}if(x-=p,t.total_out+=x,i.total+=x,x&&(t.adler=i.check=i.flags?n(i.check,c,x,u-x):r(i.check,c,x,u-x)),x=p,(i.flags?_:l(_))!==i.check){t.msg="incorrect data check",i.mode=30;break}_=0,g=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;g<32;){if(0===f)break t;f--,_+=h[d++]<<g,g+=8}if(_!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}_=0,g=0}i.mode=29;case 29:C=1;break t;case 30:C=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=u,t.avail_out=p,t.next_in=d,t.avail_in=f,i.hold=_,i.bits=g,(i.wsize||x!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&m(t,t.output,t.next_out,x-t.avail_out)?(i.mode=31,-4):(b-=t.avail_in,x-=t.avail_out,t.total_in+=b,t.total_out+=x,i.total+=x,i.wrap&&x&&(t.adler=i.check=i.flags?n(i.check,c,x,t.next_out-x):r(i.check,c,x,t.next_out-x)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0===b&&0===x||4===e)&&0===C&&(C=-5),C)},e.inflateEnd=function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?-2:(i.head=e,e.done=!1,0):-2},e.inflateSetDictionary=function(t,e){var i,s=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?-2:11===i.mode&&r(1,e,s,0)!==i.check?-3:m(t,e,s,s)?(i.mode=31,-4):(i.havedict=1,0):-2},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,i){"use strict";t.exports=function(t,e){var i,s,r,n,o,a,l,h,c,d,u,f,p,_,g,y,m,b,x,v,w,k,A,T,S;i=t.state,s=t.next_in,T=t.input,r=s+(t.avail_in-5),n=t.next_out,S=t.output,o=n-(e-t.avail_out),a=n+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,d=i.wnext,u=i.window,f=i.hold,p=i.bits,_=i.lencode,g=i.distcode,y=(1<<i.lenbits)-1,m=(1<<i.distbits)-1;t:do{p<15&&(f+=T[s++]<<p,p+=8,f+=T[s++]<<p,p+=8),b=_[f&y];e:for(;;){if(f>>>=x=b>>>24,p-=x,0===(x=b>>>16&255))S[n++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=_[(65535&b)+(f&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}v=65535&b,(x&=15)&&(p<x&&(f+=T[s++]<<p,p+=8),v+=f&(1<<x)-1,f>>>=x,p-=x),p<15&&(f+=T[s++]<<p,p+=8,f+=T[s++]<<p,p+=8),b=g[f&m];i:for(;;){if(f>>>=x=b>>>24,p-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=g[(65535&b)+(f&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&b,p<(x&=15)&&(f+=T[s++]<<p,(p+=8)<x&&(f+=T[s++]<<p,p+=8)),(w+=f&(1<<x)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(f>>>=x,p-=x,w>(x=n-o)){if((x=w-x)>c&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(k=0,A=u,0===d){if(k+=h-x,x<v){v-=x;do{S[n++]=u[k++]}while(--x);k=n-w,A=S}}else if(d<x){if(k+=h+d-x,(x-=d)<v){v-=x;do{S[n++]=u[k++]}while(--x);if(k=0,d<v){v-=x=d;do{S[n++]=u[k++]}while(--x);k=n-w,A=S}}}else if(k+=d-x,x<v){v-=x;do{S[n++]=u[k++]}while(--x);k=n-w,A=S}for(;v>2;)S[n++]=A[k++],S[n++]=A[k++],S[n++]=A[k++],v-=3;v&&(S[n++]=A[k++],v>1&&(S[n++]=A[k++]))}else{k=n-w;do{S[n++]=S[k++],S[n++]=S[k++],S[n++]=S[k++],v-=3}while(v>2);v&&(S[n++]=S[k++],v>1&&(S[n++]=S[k++]))}break}}break}}while(s<r&&n<a);s-=v=p>>3,f&=(1<<(p-=v<<3))-1,t.next_in=s,t.next_out=n,t.avail_in=s<r?r-s+5:5-(s-r),t.avail_out=n<a?a-n+257:257-(n-a),i.hold=f,i.bits=p}},function(t,e,i){"use strict";var s=i(2),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,l,h,c,d,u){var f,p,_,g,y,m,b,x,v,w=u.bits,k=0,A=0,T=0,S=0,R=0,P=0,I=0,z=0,C=0,O=0,E=null,M=0,B=new s.Buf16(16),L=new s.Buf16(16),U=null,D=0;for(k=0;k<=15;k++)B[k]=0;for(A=0;A<l;A++)B[e[i+A]]++;for(R=w,S=15;S>=1&&0===B[S];S--);if(R>S&&(R=S),0===S)return h[c++]=20971520,h[c++]=20971520,u.bits=1,0;for(T=1;T<S&&0===B[T];T++);for(R<T&&(R=T),z=1,k=1;k<=15;k++)if(z<<=1,(z-=B[k])<0)return-1;if(z>0&&(0===t||1!==S))return-1;for(L[1]=0,k=1;k<15;k++)L[k+1]=L[k]+B[k];for(A=0;A<l;A++)0!==e[i+A]&&(d[L[e[i+A]]++]=A);if(0===t?(E=U=d,m=19):1===t?(E=r,M-=257,U=n,D-=257,m=256):(E=o,U=a,m=-1),O=0,A=0,k=T,y=c,P=R,I=0,_=-1,g=(C=1<<R)-1,1===t&&C>852||2===t&&C>592)return 1;for(;;){b=k-I,d[A]<m?(x=0,v=d[A]):d[A]>m?(x=U[D+d[A]],v=E[M+d[A]]):(x=96,v=0),f=1<<k-I,T=p=1<<P;do{h[y+(O>>I)+(p-=f)]=b<<24|x<<16|v|0}while(0!==p);for(f=1<<k-1;O&f;)f>>=1;if(0!==f?(O&=f-1,O+=f):O=0,A++,0==--B[k]){if(k===S)break;k=e[i+d[A]]}if(k>R&&(O&g)!==_){for(0===I&&(I=R),y+=T,z=1<<(P=k-I);P+I<S&&!((z-=B[P+I])<=0);)P++,z<<=1;if(C+=1<<P,1===t&&C>852||2===t&&C>592)return 1;h[_=O&g]=R<<24|P<<16|y-c|0}}return 0!==O&&(h[y+O]=k-I<<24|64<<16|0),u.bits=R,0}},function(t,e,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,i){"use strict";i.r(e);class s{constructor(){this._listeners=new Map}addListener(t,e){this._listeners.set(t,e)}removeListener(t){this._listeners.delete(t)}fire(...t){for(const[e,i]of this._listeners)e.call(i,...t)}}class r{constructor(t){this._rootCommunicator=t,this._listeners={},this._rootCommunicator.onMessage.addListener(this._onMessage,this)}destructor(){this._rootCommunicator.onMessage.removeListener(this._onMessage)}getCommunicator(t){let e=this._listeners[t];return e||(e=new s,this._listeners[t]=e),{onMessage:e,sendMessage:(e,i,...s)=>{this._rootCommunicator.sendMessage({type:t,message:e},i,...s)}}}_onMessage(t){const e=this._listeners[t.type];e&&e.fire(t.message)}}class n{constructor(t){this._worker=t,this._scheduledFlush=function(t,e=!1){let i=!1;return(...s)=>{e&&i||(Promise.resolve().then(()=>{t(...s),i=!1}),i=!0)}}(()=>t.flushMessages()),this.onMessage=this._onMessage=new s,t.onMessage(t=>{this._onMessage.fire(t)})}sendMessage(t,e,...i){this._worker.addMessage(t,i),e&&this._scheduledFlush()}}class o{constructor(){this._contentPortions=[]}destructor(){for(const t of this._contentPortions)if(t.resources)for(const e of t.resources)e.release()}addContent(t,e){const i={content:t,resources:e};if(this._contentPortions.push(i),i.resources)for(const s of i.resources)s.retain()}hasContent(){return 0!==this._contentPortions.length}}class a extends o{constructor(t,e){super(),this.id=t.id,this.tile=t,this._state=e,this.onStateChanged=this._onStateChanged=new s}get state(){return this._state}set state(t){const e=this._state;t!==e&&(this._state=t,this._onStateChanged.fire(this,e,t))}destructor(){this.state=3,super.destructor()}}class l extends class{constructor(){this._items=new Map,this.onAdded=this._onAdded=new s,this.onRemoved=this._onRemoved=new s}get size(){return this._items.size}get items(){return this._items.values()}get(t){return this._items.get(t)}has(t){return this._items.has(t)}_add(t,e){this._items.set(t,e),this._onAdded.fire(e)}_remove(t){const e=this._items.get(t);e&&(this._items.delete(t),this._onRemoved.fire(e))}}{add(t,e){this._add(t,e)}remove(t){this._remove(t)}}class h extends l{constructor(t){super(),this._communicator=t}add(t,e){super.add(t,e),this._communicator.sendMessage({type:0,id:t,item:this._serialize(e)},!1)}remove(t){super.remove(t),this._communicator.sendMessage({type:1,id:t},!1)}}class c extends h{getOrCreate(t,e){const i=this.get(t.id);if(i)return i;{const i=new a(t,e);return this.add(t.id,i),i}}_serialize(t){return Object.assign(Object.assign({},t.tile),{id:t.id})}}function d(t,e){return t.x+"_"+t.y+"_"+t.zoom+"_"+e}function u(t,e){return Object.assign(Object.assign({},t),{id:d(t,e)})}function f(t,e){const i=[];for(const[s,r]of t)e.has(s)||i.push(r);return i}function p(t,e,i){let s=t.get(e);return s||(s=i(),t.set(e,s)),s}function _(t,e,i=1e-6){const s=t-e;return-i<s&&s<i}function g(t,e){return{x:t,y:e}}const y=g(0,0);g(1,0),g(-1,0),g(0,1),g(0,-1);function m(t,e=g(0,0)){return e.x=t.x,e.y=t.y,e}function b(t,e,i=g(0,0)){return i.x=t.x+e.x,i.y=t.y+e.y,i}function x(t,e,i=g(0,0)){return i.x=t.x-e.x,i.y=t.y-e.y,i}function v(t,e,i=g(0,0)){return i.x=t.x/e,i.y=t.y/e,i}function w(t,e,i=g(0,0)){const s=t.x,r=t.y,n=Math.cos(e),o=Math.sin(e);return i.x=n*s-o*r,i.y=o*s+n*r,i}function k(t,e=g(0,0)){const i=t.y;return e.y=t.x,e.x=-i,e}function A(t){return Math.hypot(t.x,t.y)}function T(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function S(t,e=g(0,0)){return v(t,A(t),e)}function R(t,e){return t.x*e.x+t.y*e.y}const P={minX:0,maxX:0,minY:0,maxY:0};function I(t,e,i,s){return{minX:t,maxX:e,minY:i,maxY:s}}function z(t,e=I(0,0,0,0)){return e.minX=t.minX,e.maxX=t.maxX,e.minY=t.minY,e.maxY=t.maxY,e}function C(t,e,i={minX:0,maxX:0,minY:0,maxY:0}){return i.minX=Math.min(t.minX,e.minX),i.minY=Math.min(t.minY,e.minY),i.maxX=Math.max(t.maxX,e.maxX),i.maxY=Math.max(t.maxY,e.maxY),i}function O({minX:t,maxX:e,minY:i,maxY:s}){return g((t+e)/2,(i+s)/2)}function E(t,e,i){return`${t}:${e}:${i}`}function M(t){return E(t.x,t.y,t.zoom)}function B(t,e,i){return e<t?t<i?t:i:e}function L(t,e,i){const s=(t-e)/(i-e);return e+(i-e)*(s-Math.floor(s))}function U(t,e,i){return(1-i)*t+i*e}function D(t,e,i){const s=B((i-t)/(e-t),0,1);return s*s*(3-2*s)}const j={direction:g(0,-1),normal:g(-1,0),diagonal:g(-1,-1),prevSide:()=>W,nextSide:()=>V},N={direction:g(0,1),normal:g(1,0),diagonal:g(1,1),prevSide:()=>V,nextSide:()=>W},V={direction:g(1,0),normal:g(0,-1),diagonal:g(1,-1),prevSide:()=>j,nextSide:()=>N},W={direction:g(-1,0),normal:g(0,1),diagonal:g(-1,1),prevSide:()=>N,nextSide:()=>j};function q(t,e,i,s,r){t.x=s?L(t.x,0,i):t.x,t.y=r?L(t.y,0,i):t.y,0<=t.x&&t.x<i&&0<=t.y&&t.y<i&&e.set(M(t),t)}function F(t,e,i,s,r,n){for(let l=1;l<=i;l++)q({x:e.currentTile.x+l*e.currentTileSide.normal.x,y:e.currentTile.y+l*e.currentTileSide.normal.y,zoom:e.currentTile.zoom},e.beltTiles,s,r,n);const o=t.get(E(e.currentTile.x+e.currentTileSide.diagonal.x,e.currentTile.y+e.currentTileSide.diagonal.y,e.currentTile.zoom));if(o)return e.currentTile=o,void(e.currentTileSide=e.currentTileSide.prevSide());const a=t.get(E(e.currentTile.x+e.currentTileSide.direction.x,e.currentTile.y+e.currentTileSide.direction.y,e.currentTile.zoom));if(a)e.currentTile=a;else{for(let t=1;t<=i;t++)for(let o=1;o<=i;o++)q({x:e.currentTile.x+t*e.currentTileSide.diagonal.x,y:e.currentTile.y+o*e.currentTileSide.diagonal.y,zoom:e.currentTile.zoom},e.beltTiles,s,r,n);e.currentTileSide=e.currentTileSide.nextSide()}}class Y{constructor(t,e){this._communicator=t,this._storage=e,this._visibleTiles=new Map,this._beltTiles=new Map,this.onViewportChanged=this._onViewportChanged=new s,this._cameraPosition={x:0,y:0,zoom:0},this._communicator.onMessage.addListener(this._onMessage,this)}get cameraPosition(){return this._cameraPosition}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}_onMessage(t){switch(t.type){case 0:this._onSetup(t);break;case 1:this._onViewportUpdate(t)}}_onSetup(t){this._tileIdPrefix=t.tileIdPrefix,this._preloadedTilesBeltWidth=t.preloadedTilesBeltWidth,this._useLowPrecisionBeltTiles=t.useLowPrecisionBeltTiles,this._wrapModeX=t.wrapModeX,this._wrapModeY=t.wrapModeY}_onViewportUpdate(t){const e=this._visibleTiles;for(const o of t.visibleTilesToAdd)this._visibleTiles.set(o.id,o);for(const o of t.visibleTilesToRemove)this._visibleTiles.delete(o.id);const i=this._beltTiles,s=this._calculateBeltTiles(e),r=f(s,i),n=f(i,s);for(const o of t.visibleTilesToAdd){this._storage.getOrCreate(o,0).state=0}for(const o of r){this._storage.getOrCreate(o,1).state=1}for(const o of t.visibleTilesToRemove){const t=this._storage.getOrCreate(o,0);1!==t.state&&(t.state=2)}for(const o of n){const t=this._storage.getOrCreate(o,1);0!==t.state&&(t.state=2)}this._visibleTiles=e,this._beltTiles=s,this._cameraPosition=t.cameraPosition,this._onViewportChanged.fire({cameraPosition:t.cameraPosition,visibleAdded:t.visibleTilesToAdd,visibleRemoved:t.visibleTilesToRemove,preloadedAdded:r,preloadedRemoved:n})}_calculateBeltTiles(t){const e=new Map;let i;if(this._useLowPrecisionBeltTiles){i=this._getCoveringParents(t);for(const s of i.values())for(let i=0;i<=1;i++)for(let r=0;r<=1;r++){const n=u({x:2*s.x+i,y:2*s.y+r,zoom:s.zoom+1},this._tileIdPrefix);t.has(n.id)||e.set(n.id,n)}}else i=t;for(const s of function(t,e,i,s){const r=new Map,n=new Map;for(const a of t)r.set(M(a),a);const o=new Map(r);for(;o.size>0;){let t={x:Number.POSITIVE_INFINITY,y:0,zoom:0};for(const e of o.values())e.x<t.x&&(t=e);const r=[],a=[],l={currentTile:t,currentTileSide:j,beltTiles:n},h=Object.assign({},l),c=Math.pow(2,t.zoom);do{F(o,h,e,c,i,s);const t=h.currentTile.x-l.currentTile.x;r[t]=void 0===r[t]?h.currentTile.y:Math.max(r[t],h.currentTile.y),a[t]=void 0===a[t]?h.currentTile.y:Math.min(a[t],h.currentTile.y)}while(h.currentTile!==l.currentTile||h.currentTileSide!==l.currentTileSide);const d=t.zoom;for(let e=0;e<r.length;e++){const i=t.x+e;for(let t=a[e];t<=r[e];t++)o.delete(E(i,t,d))}}for(const a of n.keys())r.has(a)&&n.delete(a);return n.values()}(i.values(),this._preloadedTilesBeltWidth,2===this._wrapModeX,2===this._wrapModeY)){const t=u(s,this._tileIdPrefix);e.set(t.id,t)}return e}_getCoveringParents(t){const e=new Map;for(const i of t.values()){const t=i.zoom-1;if(t>=0){const s=u({x:i.x/2|0,y:i.y/2|0,zoom:t},this._tileIdPrefix);e.set(s.id,s)}}return e}}var X=i(0),G=i(4),Z=G.yandex.maps.proto.renderer.vmap2.Presentation,H=G.yandex.maps.proto.renderer.vmap2.Tile,K=G.yandex.maps.proto.renderer.glyphs.GlyphList,Q=G.yandex.maps.proto.renderer.layers.basemap.Tag,$=G.yandex.maps.proto.indoor.Plan;G.yandex.maps.proto.common2.geometry.BoundingBox;function J(t){return t?t.classId.length:0}function tt(t,e,i,s,r,n){let o=t.get(e);o||(o=new Map,t.set(e,o));for(let a=0;a<i.length;++a)o.set(i[a],s[r+a]);o.set("objectId",n)}function et(t,e=!1){const i={points:new Map,polylines:new Map,polygons:new Map,pointLabels:new Map,curvedLabels:new Map},{points:s,polylines:r,polygons:n,pointLabels:o,layers:a}=t,l=J(s),h=l+J(r),c=h+J(n),d=c+J(o);for(const u of a){const{keys:t,values:e}=u;if(0!==t.length)for(let s=0,r=0,n=u.ids.length;s<n;++s,r+=t.length){const n=u.objectIndices[s],o=u.ids[s];switch(!0){case n>=d:tt(i.curvedLabels,n-d,t,e,r,o);break;case n>=c:tt(i.pointLabels,n-c,t,e,r,o);break;case n>=h:tt(i.polygons,n-h,t,e,r,o);break;case n>=l:tt(i.polylines,n-l,t,e,r,o);break;default:tt(i.points,n,t,e,r,o)}}}if(function(t,e){const{polygons:i}=t;if(i)for(let s=0,r=0;s<i.classId.length;s++){const t=i.contourIndex[s],n=e.polygons.get(s);if(!n||t<0)continue;const o=i.contourCount[r];for(let i=0;i<o;i++)e.polylines.set(t+i,n);r++}}(t,i),e){const e=()=>{const t=new Map([["_vector_id","0"]]);return()=>t};it(t.points,i.points,e()),it(t.polylines,i.polylines,e()),it(t.polygons,i.polygons,e()),it(t.pointLabels,i.pointLabels,e()),it(t.polylineLabels,i.curvedLabels,e())}return i}function it(t,e,i=(()=>new Map)){if(t)for(let s=0;s<t.classId.length;s++)e.has(s)||e.set(s,i())}function st(t){return 2/(1<<t)}class rt{constructor(t){this._zoom=Math.ceil(B(t,0,31)),this._tileSize=st(this._zoom)}getZoom(){return this._zoom}getTileSize(){return this._tileSize}getTileOffset(t){return{x:this.getTileSize()*t.x-1,y:1-this.getTileSize()*t.y}}toTileCoordinates(t){return{x:(t.x+1)/this._tileSize,y:(1-t.y)/this._tileSize}}}function nt(t,e){return-16384===t||16383===t||-16384===e||16383===e}class ot{constructor(t){const e=new rt(t.zoom),i=e.getTileOffset(t),s=e.getTileSize(),r=s/2;this._tileCenter=g(i.x+r,i.y-r),this._tileWorldRatio=s/32767}toWorldXCoordinate(t){return B(this._tileCenter.x+t*this._tileWorldRatio,-1,1)}toWorldYCoordinate(t){return B(this._tileCenter.y-t*this._tileWorldRatio,-1,1)}toWorldZCoordinate(t){return t*this._tileWorldRatio}toWorldCoordinates(t,e){return g(this.toWorldXCoordinate(t),this.toWorldYCoordinate(e))}}const at={minZoom:0,maxZoom:0,zIndex:0,classId:0};function*lt(t,e,i,s,r=ht(0)){const n=(t.find(t=>t.name===r)||t[0]).classes[e];if(n)for(const o of n.slices)if(o.visibility){at.minZoom=o.visibility.min===s.zoom?-1/0:o.visibility.min,at.maxZoom=o.visibility.max===s.zoom?1/0:o.visibility.max,at.zIndex=o.zIndex,at.classId=e;const t=i(o,at);t&&(yield t)}}function ht(t){switch(t){case 0:return"map";case 1:return"map.night"}}dt(0,0,0,1),dt(1,1,0,1);const ct=dt(0,0,0,0);function dt(t,e,i,s=1){return{r:t,g:e,b:i,a:s}}function ut(t){return{r:(t>>>24)/255,g:(t>>>16&255)/255,b:(t>>>8&255)/255,a:(255&t)/255}}function ft(t,e,i,s){return 255*t|255*e<<8|255*i<<16|255*s<<24}function pt(t){return ft(t.r,t.g,t.b,t.a)}const _t=/^(0x|#)?(([a-fA-F0-9]{3}){1,2}|([a-fA-F0-9]{4}){1,2})$/;function gt(t,e,i){const s=t.substring(i*e,(i+1)*e),r=(1<<4*e)-1;return parseInt(s,16)/r}function yt(t){const e=_t.exec(t);if(!e)return null;const i=e[2],s=i.length>4?2:1;return dt(gt(i,s,0),gt(i,s,1),gt(i,s,2),i.length%4?1:gt(i,s,3))}function mt(t){const e=(255*t).toString(16);return 2===e.length?e:"0"+e}function bt(t){const{r:e,g:i,b:s,a:r}=t;return mt(e)+mt(i)+mt(s)+(r<1?mt(r):"")}const xt={min:512,max:65535},vt={min:65536,max:4294967294};const wt=new Array;function kt(t){switch(t){case 1:return-1;case 2:return-2;default:return 0}}function At(t,e){return t.zoom-kt(e)}function Tt(t,e){return(t&e)===e}function St(t,e){return 0!=(t&e)}const Rt=[],Pt={};function It(t){const e=[0,0];for(const i of t)e[i/32&1]|=1<<i%32;return e}function zt(t){const e=[];for(const i of t){const t="number"==typeof i?i:Pt[i];if(void 0===t)return console.warn(`unknown "tag": "${i}"`),null;e.push(t)}return It(e)}function Ct(t,e){return St(t[0],e[0])||St(t[1],e[1])}function Ot(t,e,i){if(void 0===t&&void 0===e&&void 0===i)return()=>!0;const s=t&&zt(t),r=e&&zt(e),n=i&&zt(i);return null===s||null===r||null===n?(console.warn(`not valid "tags": all=[${t||[]}] any=[${e||[]}] none=[${i||[]}]`),()=>!1):t=>{const e=It(t);return(!s||(o=s,Tt((i=e)[0],o[0])&&Tt(i[1],o[1])))&&(!r||Ct(e,r))&&(!n||!Ct(e,n));var i,o}}function Et(t,e){const i=t.metadata[e],s=i&&i[".yandex.maps.proto.renderer.common.TAG_METADATA"];return s?s.tags:Rt}function Mt(t,e=3){const i=Math.floor(t.length/e),s=g(0,0);for(let r=0;r<e;r++)b(s,t[r*i],s);return v(s,e,s)}function*Bt(t,e,i,s){let r=0,n=0;for(let o=0;o<i;o++)r+=t.coordsx[e],n+=t.coordsy[e],yield s.toWorldCoordinates(r,n),e++}function*Lt(t,e,i,s,r){for(let n=0;n<s;n++){const s=t.ringSize[i+n];yield Bt(t,e,s,r),e+=s}}function Ut(t,e,i,s,r,n,o){if(o&&o.bbox){return{id:t,metadata:e,objectId:(1===n?"night_":"")+o.objectId,meshId:o.meshId,bbox:{minX:s.toWorldXCoordinate(o.bbox.minX),maxX:s.toWorldXCoordinate(o.bbox.maxX),minY:s.toWorldYCoordinate(o.bbox.maxY),maxY:s.toWorldYCoordinate(o.bbox.minY),minZ:i,maxZ:0},color:r[0].color}}}function Dt(t,e){if(t.poly){const i=!!t.poly.extrusion&&t.poly.extrusion.enabled;return Object.assign(Object.assign({},e),{color:ut(t.poly.color),pattern:t.poly.pattern?{imageId:t.poly.pattern.id,scale:t.poly.pattern.scale}:void 0,extruded:i,height:i?t.poly.extrusion.height:0})}}function*jt(t,e,i,s,r,n,o){const{polygons:a}=e;if(a){const l=new ot(t);let h=0,c=0,d=0;const u=a.mesh.reduce((t,e)=>(t.set(e.polygonId,e),t),new Map);for(;h<a.ringCount.length;){const f=a.ringCount[h],p=c,_=d,g=a.classId[h],y=i.polygons.get(h),m=Et(a,h),b=[...lt(e.presentation,g,Dt,t,ht(n))];o.customizePolygon(b,m,At(t,r));const x=y?s(y.get("_vector_id")):4294967295,v=b[0]&&b[0].extruded,w=v?l.toWorldZCoordinate(a.height[h]||b[0].height||0):0,k=v?Ut(x,y,w,l,b,n,u.get(h)):void 0;let A=0;for(let t=0;t<f;t++)A+=a.ringSize[c+t];const T=[...Object(X.c)(Lt(a,_,p,f,l),t=>[...t])];if(v&&y){const t=k?O(k.bbox):Mt(T[0],3);y.set("position",`${t.x},${t.y}`)}const S=a.contourIndex[h];yield{id:x,vertexRings:T,height:w,externalMesh:k,metadata:y,styles:b,hasContour:-1===S},c+=f,d+=A,h++}}}function Nt(t,e=.5){const i=new Array(t.length);i[0]=0;for(let d=1;d<t.length;++d)i[d]=i[d-1]+T(t[d-1],t[d]);const s=e*i[t.length-1],r=i.findIndex(t=>t>=s)||1,n=function(t,e,i,s=g(0,0)){return s.x=(1-i)*t.x+i*e.x,s.y=(1-i)*t.y+i*e.y,s}(t[r-1],t[r],(s-i[r-1])/(i[r]-i[r-1]||1)),o=new Array(r+1);for(let d=0;d<r;++d)o[d]=t[d];o[r]=n;const a=function(t,e,i=1e-6){return _(t.x,e.x,i)&&_(t.y,e.y,i)}(t[r],n,1e-6*s),l=t.length-r,h=new Array(l+(a?0:1));let c=0;a||(h[c++]=m(n));for(let d=0;d<l;d++)h[c++]=t[r+d];return[o,h]}Object.keys(Q).forEach(t=>{Pt[t.toLowerCase()]=Q[t]});const Vt={[Z.Class.LineStyle.JoinStyle.JoinMiter]:0,[Z.Class.LineStyle.JoinStyle.JoinRound]:1,[Z.Class.LineStyle.JoinStyle.JoinBevel]:2},Wt={[Z.Class.LineStyle.CapStyle.CapButt]:0,[Z.Class.LineStyle.CapStyle.CapSquare]:2,[Z.Class.LineStyle.CapStyle.CapRound]:1};function qt(t){return{strokeColor:t.pattern?ct:ut(t.color),strokeWidth:t.width,join:Vt[t.joins],startCap:Wt[t.caps],endCap:Wt[t.caps],dash:t.dash?{fill:t.dash.dashes[0].fill,gap:t.dash.dashes[0].gap}:void 0,pattern:t.pattern?{imageId:t.pattern.id,scale:t.pattern.scale,height:t.width}:void 0}}function Ft(t,e){const i=t.line&&t.line.line||t.poly&&t.poly.contour,s=t.line&&t.line.outline;return i||s?Object.assign(Object.assign({},e),{inline:i?qt(i):void 0,outline:s?qt(s):void 0}):void 0}function Yt(t,e){const i=t.poly&&t.poly.contour;return i?Object.assign(Object.assign({},e),{inline:qt(i),outline:void 0}):void 0}function*Xt(t,e,i,s,r,n){let o=0;for(const a of i){const i=a.styles[0],l=Et(e.polygons,o);if(++o,!a.hasContour||!i)continue;const h=[...lt(e.presentation,i.classId,Yt,t,ht(r))];if(h[0]){n.customizePolygonContour(h,l,At(t,s));for(const t of a.vertexRings)yield{vertices:t.concat(t[0]),styles:h,id:a.id,metadata:a.metadata}}}}function*Gt(t,e,i,s,r,n,o){const a=e.polylines;if(!a)return;const l=(i,s,a,l,h,c,d,u)=>{const f=[...lt(e.presentation,s,Ft,t,ht(n))];o.customizePolyline(f,h,At(t,r));for(const t of f)t.zIndex+=a,void 0!==d&&(t.inline&&(t.inline.startCap=d),t.outline&&(t.outline.startCap=d)),void 0!==u&&t.inline&&(t.inline&&(t.inline.endCap=u),t.outline&&(t.outline.endCap=u));return{vertices:i,styles:f,metadata:l,id:c}},h=new ot(t);for(let c=0,d=0;c<a.lineSize.length;++c){const t=0|a.zOrderBegin[c],e=0|a.zOrderEnd[c],r=a.lineSize[c],n=new Array(r);let o,u,f=0,p=0;for(let i=0;i<r;++i,++d)f+=a.coordsx[d],p+=a.coordsy[d],0===i&&nt(f,p)&&(o=0),i===r-1&&nt(f,p)&&(u=0),n[i]=g(h.toWorldXCoordinate(f),h.toWorldYCoordinate(p));const _=i.polylines.get(c),y=_?s(_.get("_vector_id")):4294967295,m=Et(a,c);if(t!==e){const i=Nt(n);yield l(i[0],a.classId[c],t,_,m,y,o,u),yield l(i[1],a.classId[c],e,_,m,y,o,u)}else yield l(n,a.classId[c],t,_,m,y,o,u)}}function Zt(t){return t.styles.length>0}function Ht(t){return{color:ut(t.color),outlineColor:ut(t.outlineColor),fontId:t.fontId,fontSize:t.fontSize}}function Kt(t,e){const i=[];if(t.label)return t.label.text&&i.push(Ht(t.label.text)),t.label.textAlt&&i.push(Ht(t.label.textAlt)),Object.assign(Object.assign({},e),{distance:0,styles:i,align:1,background:t.label.background?{color:ut(t.label.background.color),verticalPadding:t.label.background.vPadding,horizontalPadding:t.label.background.hPadding}:void 0})}const Qt={[H.StraightLabels.AlignType.Left]:0,[H.StraightLabels.AlignType.Right]:2,[H.StraightLabels.AlignType.Center]:1};function*$t(t,e){t.text[e]&&t.text[e].strings.length&&(yield{textLines:t.text[e].strings.map(t=>({glyphIds:t.glyphs}))}),t.textAlt[e]&&t.textAlt[e].strings.length>0&&(yield{textLines:t.textAlt[e].strings.map(t=>({glyphIds:t.glyphs}))})}function Jt(t,e){const i=Kt(t,e);return i&&t.label&&(i.distance=t.label.vdistance),i}function*te(t,e,i,s,r,n,o){const{pointLabels:a}=e;if(a){const l=new ot(t);for(let h=0;h<a.text.length;h++){const c=a.classId[h],d=[...lt(e.presentation,c,Jt,t,ht(n))];for(const t of d)t.align=Qt[a.align[h]];const u=Et(a,h);o.customizePointLabel(d,u,At(t,r));const f=l.toWorldCoordinates(a.centerX[h],a.centerY[h]),p=s(),_=i.pointLabels.get(h);_&&_.set("position",`${f.x},${f.y}`),yield{id:p,anchorPoint:f,offset:g(a.offsetX[h],a.offsetY[h]),texts:[...$t(a,h)],priority:a.priority[h],styles:d,metadata:_}}}}function*ee(t,e,i,s){let r=0,n=0;for(let o=0;o<i;o++)yield s.toWorldCoordinates(r+=t.vertexX[e+o],n+=t.vertexY[e+o])}function*ie(t,e){t.text[e]&&(yield{textLines:[{glyphIds:t.text[e].glyphs}]}),t.textAlt[e]&&t.textAlt[e].glyphs.length>0&&(yield{textLines:[{glyphIds:t.textAlt[e].glyphs}]})}function se(t,e){const i=Kt(t,e);return i&&t.label&&t.label.hdistance&&(i.distance=t.label.hdistance),i}function*re(t,e,i,s,r,n,o){const{polylineLabels:a}=e;if(a){const l=new ot(t);let h=0;for(let c=0;c<a.text.length;c++){const d=a.classId[c],u=a.verticesCount[c],f=s();if(u>=2){const s=[...lt(e.presentation,d,se,t,ht(n))],p=Et(a,c);o.customizeCurvedLabel(s,p,At(t,r)),yield{id:f,polyline:[...ee(a,h,u,l)],texts:[...ie(a,c)],styles:s,metadata:i.curvedLabels.get(c),priority:a.priority[c]}}else console.warn(`Curved label with ${u} vertices extracted`);h+=u}}}const ne=-1+Math.pow(2,-23),oe=1-Math.pow(2,-23);function ae(t){return B(t/8388607,ne,oe)}function le(t,e){const i=B(t,-2097152,2097151);return B(2*((i- -2097152|e<<22)/16777215)-1,ne,oe)}function he(t,e){return g(-t,e-1)}function ce(t,e){const i=t.point;return i&&i.icon?Object.assign(Object.assign({},e),{imageId:i.icon.id,offset:he(i.anchorX,i.anchorY),scale:i.icon.scale,selectedIcon:i.selectedIcon?{imageId:i.selectedIcon.id,offset:he(i.selectedAnchorX,i.selectedAnchorY),scale:i.selectedIcon.scale}:void 0}):void 0}function*de(t,e,i,s,r,n,o,a,l){var h,c,d,u;const{points:f}=e;if(f){const p=new ot(t);for(let _=0;_<f.classId.length;_++){const g=p.toWorldCoordinates(f.coordsx[_],f.coordsy[_]),y=i.points.get(_);y&&y.set("position",`${g.x},${g.y}`);const m=Et(f,_),b=null===(h=y)||void 0===h?void 0:h.get("objectId"),x=b?r.find(t=>{var e;return(null===(e=t.metadata)||void 0===e?void 0:e.get("objectId"))===b}):r.find(t=>t.anchorPoint.x===g.x&&t.anchorPoint.y===g.y),v=x?x.id:s(),w=[...lt(e.presentation,f.classId[_],ce,t,ht(o))];if(a.customizePoint(w,m,At(t,n)),l){const t=null===(c=x)||void 0===c?void 0:c.metadata;y&&l(y,w),t&&l(t,w)}const k=null!=(u=null===(d=x)||void 0===d?void 0:d.priority)?u:2097151;yield{position:g,styles:w,priority:k,metadata:y,id:v}}}}function ue(...t){const e={};let i,s,r,n;for(const o of t)if(o){if(Object.assign(e,o.content.primitives),o.content.references&&(i=i||[],i.push(...o.content.references)),o.content.metadata){s=s||new Map;for(const[t,e]of o.content.metadata)s.set(t,e)}o.contentToRemove&&(r=r||[],r.push(...o.contentToRemove)),o.metrics&&(n=n||{},Object.assign(n,o.metrics))}return{content:{primitives:e,references:i,metadata:s},contentToRemove:r,metrics:n}}function fe(...t){const e=new Map;for(const i of t)for(const t of i)t.id&&t.metadata&&e.set(t.id,t.metadata);return e}const pe=Date.now();const _e="performance"in self&&"now"in performance?performance.now.bind(performance):function(){return Date.now()-pe};class ge extends class{constructor(t,e,i){this._taskQueue=t,this._priority=e,this._contentPriority=i,this.onContentReady=this._onContentReady=new s,this._scheduleStart=void 0,this._queueWaitingTime=void 0,this._state=0,this._taskStage=0,this._subTasks=[]}get state(){return this._state}destructor(){1===this._state&&this.pause()}start(){0===this._state&&(this._startImpl(),this._state=1);for(const t of this._subTasks)t.start()}pause(){1===this._state&&(this._pauseImpl(),this._state=2);for(const t of this._subTasks)t.pause()}resume(){2===this._state&&(this._resumeImpl(),this._state=1);for(const t of this._subTasks)t.resume()}resetPriority(t){switch(this._priority=t,this._taskStage){case 1:this._taskQueue.remove(this._processingTask),this._processingTask=this._createTask(this._processingTask.execute),this._enqueueProcessingTask();break;case 2:this._processingTask=this._createTask(this._processingTask.execute)}for(const e of this._subTasks)e.resetPriority(t)}_pauseImpl(){switch(this._taskStage){case 1:this._taskQueue.remove(this._processingTask),this._taskStage=2}}_resumeImpl(){switch(this._taskStage){case 2:this._enqueueProcessingTask(),this._taskStage=1}}_startSubTask(t){this._subTasks.push(t),t.onContentReady.addListener(this._onSubTaskContent,this),t.start()}_onSubTaskContent(t){console.warn("Sub task output is not handled",t)}_scheduleProcessing(t){switch(this._taskStage){case 0:this._scheduleStart=_e(),this._processingTask=this._createTask(()=>{this._queueWaitingTime=_e()-this._scheduleStart;const e=this._process(t);e&&this._onContentReady.fire(e),this._state=3,this._taskStage=3}),this._enqueueProcessingTask(),this._taskStage=1}}_getTaskPriority(){return this._priority+this._contentPriority}_createTask(t){return{execute:t,priority:this._getTaskPriority()}}_enqueueProcessingTask(){this._taskQueue.enqueueSync(this._processingTask)}}{constructor(t,e,i){super(t,e,i),this._stage=0,this._loadStart=void 0,this._loadTime=void 0}resetPriority(t){super.resetPriority(t)}_startImpl(){switch(this._stage){case 0:case 2:this._load()}}_pauseImpl(){switch(super._pauseImpl(),this._stage){case 1:this._loadCancel(),this._stage=2}}_resumeImpl(){switch(super._resumeImpl(),this._stage){case 0:case 2:this._load()}}_load(){this._loadStart=_e(),this._request=this._loadImpl(),this._request.then(this._onResponse.bind(this),this._onResponseError.bind(this)),this._stage=1}_onResponse(t){switch(this._stage){case 1:this._stage=3,this._loadTime=_e()-this._loadStart,this._scheduleProcessing(t)}}_onResponseError(t){this.pause()}}var ye=i(1);function me(t){return t>1e4?1:128}function be(t,e){return t-t%e}class xe{constructor(t=[]){this._fontGlyphRanges=new Map;for(const e of t)this.addRangesForGlyphs(e[0],e[1])}addRangesForGlyphs(t,...e){let i=this._fontGlyphRanges.get(t);i||(i=new Map,this._fontGlyphRanges.set(t,i));for(const s of e){const t=me(s),e=be(s,t);i.set(e,e+t)}}contains(t,e){const i=this._fontGlyphRanges.get(t);return!!i&&i.has(e)}containsAll(t){for(const[e,i]of t)for(const[t]of i)if(!this.contains(e,t))return!1;return!0}isEmpty(){return 0===this._fontGlyphRanges.size}clear(){this._fontGlyphRanges.clear()}*[Symbol.iterator](){yield*this._fontGlyphRanges.entries()}}function ve(t,e,i,s,r){const n=t.glyphIds,o=n.length,a=[];for(let l=0;l<o;l++){const t=s.glyphs[n[l]],o=e+(t.bearingX-s.margin)*r,h=e+(t.bearingX+t.width+s.margin)*r,c=i+(t.bearingY+s.margin)*r,d=i+(t.bearingY-t.height-s.margin)*r,u=g(o,c),f=g(h,c),p=g(h,d),_=g(o,d),y={fontId:s.id,glyphId:t.id,scale:r,topLeft:u,topRight:f,bottomRight:p,bottomLeft:_};a.push(y),e+=t.advance*r}return a}function we(t,e,i){const s=[],r=t.texts.map((t,s)=>{const r=e.styles[s],n=i.get(r.fontId),o=r.fontSize,a=o/n.xheight,l=n.height?n.height*a:2*o;return t.textLines.map(t=>{const e=function(t,e){return e.glyphIds.reduce((e,i)=>e+t.glyphs[i].advance,0)}(n,t)*a;return{line:t,font:n,scale:a,width:e,height:l,fontSize:o}})}),n=r.reduce((t,e)=>e.reduce((t,e)=>(t.width=Math.max(t.width,e.width),t.height+=e.height,t),t),{width:0,height:e.distance*(r.length-1)}),o=t.offset.x-n.width/2;let a=t.offset.y+n.height/2,l=!0;for(const h of r){const t=[];for(const i of h){const s=a-=i.height-(l?i.fontSize/2:0),r=o+(0===e.align?0:1===e.align?(n.width-i.width)/2:2===e.align?n.width-i.width:0),h=ve(i.line,r,s,i.font,i.scale);t.push(h),l=!1}a-=e.distance,s.push(t)}return s}function ke(t,e){return t>e?1:t<e?-1:0}function Ae(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function Te(t,e=0,i=t.length){for(let s=e,r=i-1;s<r;++s,--r)Ae(t,s,r)}function Se(t,e=1,i=0,s=t.length){Te(t,i,s),Te(t,i,i+e),Te(t,i+e,s)}function Re(t,e,i=0,s=t.length,r=0){for(let n=i,o=r;n<s;++n,++o)e[o]=t[n]}function Pe(t,e,i){const s=Math.min(e.length,i.length);for(let r=0;r<s;r++){const s=t(e[r],i[r]);if(s)return s}return e.length-i.length}function Ie(t,e=ke,i=0,s=t.length){for(let r=i;r<s;++r)for(let s=r;s>i&&e(t[s-1],t[s])>0;--s)Ae(t,s-1,s)}function ze(t,e,i,s,r,n,o){let a=o,l=s,h=r;for(;l<r&&h<n;)e[a++]=i(t[l],t[h])>0?t[h++]:t[l++];Re(t,e,l,r,a),Re(t,e,h,n,a)}function Ce(t,e,i){const s=[];let r=0;for(const[o,a]of function(t,e,i=((t,e)=>[t,e])){const s=Math.min(t.length,e.length),r=new Array(s);for(let n=0;n<s;++n)r[n]=i(t[n],e[n]);return r}(t.texts,e.styles)){const t=[],n=i.get(a.fontId),l=a.fontSize/n.xheight,h=a.fontSize/2;for(const e of o.textLines)for(const i of e.glyphIds){const e=n.glyphs[i],s=(e.bearingY+n.margin)*l,o=(e.bearingY-e.height-n.margin)*l,a=(e.bearingX-n.margin)*l,c=(e.bearingX+e.width+n.margin)*l,d=(c-a)/2,u=a-d,f=c-d,p=s-h,_=o-h;t.push({fontId:n.id,glyphId:i,scale:l,topLeft:{x:u,y:p},topRight:{x:f,y:p},bottomRight:{x:f,y:_},bottomLeft:{x:u,y:_},lineDisplacement:r+d}),r+=e.advance*l}r+=e.distance,s.push(t)}r-=e.distance;const n=r/2;for(const o of s)for(const t of o)t.lineDisplacement-=n;return s}class Oe extends ge{constructor(t,e,i,s,r,n,o,a,l,h=2e3){super(i,l,h),this._glyphAtlasRegistry=r,this._pointLabelsBufferWriter=n,this._curvedLabelsBufferWriter=o,this._pointLabels=t,this._curvedLabels=e,this._requiredGlyphs=this._getRequiredGlyphs(t,this._requiredGlyphs),this._requiredGlyphs=this._getRequiredGlyphs(e,this._requiredGlyphs),this._collisionPriority=s,this._batchingRule=a}canBeProcessedSynchronously(){return this._requiredGlyphs.isEmpty()||this._glyphAtlasRegistry.hasAllGlyphsLoaded(this._requiredGlyphs)}processSynchronously(){return this._requiredGlyphs.isEmpty()?this._createContentPortion([],[],void 0,void 0):this._process(this._glyphAtlasRegistry.getAtlasWithGlyphs(this._requiredGlyphs))}_process(t){const e=fe(this._pointLabels,this._curvedLabels);return this._createContentPortion(this._writePointLabels(t,e),this._writeCurvedLabels(t,e),this._loadTime,e)}_loadImpl(){return this._glyphAtlasRegistry.loadGlyphsAndGetAtlas(this._requiredGlyphs,Math.floor(this._getTaskPriority()))}_loadCancel(){}_createContentPortion(t,e,i,s){return{content:{primitives:{4:t,5:e},metadata:s},metrics:{glyphsAndResourcesLoadTime:i}}}_getRequiredGlyphs(t,e=new xe){for(const i of t){const{texts:t,styles:s}=i,r=s[0];for(let i=0;i<t.length;i++){const s=r.styles[i];if(s){const{fontId:r}=s,n=t[i].textLines.reduce((t,e)=>(t.push(...e.glyphIds),t),[]);e.addRangesForGlyphs(r,...n)}}}return e}_writePointLabels(t,e){const i=[];for(const r of this._pointLabels){const e=r.id,s=r.styles[0],n=we(r,s,this._glyphAtlasRegistry.loadedFonts),o=t.allocatedGlyphs,a=this._pointLabelsBufferWriter.writePointLabel(e,r,s,n,o,this._collisionPriority);i.push({id:e,location:a,atlasId:t.id})}const s=Object(ye.c)(this._batchingRule,e);return[...Object(ye.b)(i,s)]}_writeCurvedLabels(t,e){const i=[];for(const r of this._curvedLabels){const e=r.id,s=r.styles[0],n=Ce(r,s,this._glyphAtlasRegistry.loadedFonts),o=t.allocatedGlyphs,a=this._curvedLabelsBufferWriter.writeLabel(r,s,n,o,e,this._collisionPriority);i.push({id:e,location:a,atlasId:t.id})}const s=Object(ye.c)(this._batchingRule,e);return[...Object(ye.b)(i,s)]}}var Ee=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{l(s.next(t))}catch(e){n(e)}}function a(t){try{l(s.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))};const Me={imageSize:{width:0,height:0},atlasId:-1,atlasLocation:P};class Be extends ge{constructor(t,e,i,s,r,n,o=1e3){super(e,n,o),this._iconAtlasRegistry=s,this._iconBufferWriter=r,this._icons=t,this._iconDataList=this._icons.map(t=>{const{imageId:e,scale:i,scaleFactor:r,transformer:n}=t.styles[0];return s.getIconData(e,i*(null!=r?r:1),n)||Me}),this._collisionPriority=i}canBeProcessedSynchronously(){return!Object(X.d)(this._iconDataList,t=>t===Me)}processSynchronously(){return this._process()}_process(){return{content:{primitives:{6:this._writeIcons()},metadata:fe(this._icons)},metrics:{glyphsAndResourcesLoadTime:this._loadTime}}}_loadImpl(){return Ee(this,void 0,void 0,(function*(){const t=[];for(let e=0;e<this._iconDataList.length;e++)if(this._iconDataList[e]===Me){const i=e,{imageId:s,scale:r,scaleFactor:n,transformer:o}=this._icons[e].styles[0],a=this._iconAtlasRegistry.loadIcon(s,Math.floor(this._getTaskPriority()),r*(null!=n?n:1),o).then(t=>{this._iconDataList[i]=t});t.push(a)}return yield Promise.all(t),this._iconDataList}))}_loadCancel(){}_writeIcons(){const t=[];for(let e=0;e<this._icons.length;e++){const i=this._icons[e],s=this._iconDataList[e],r=i.styles[0],n=1/this._iconAtlasRegistry.getDpr(),o=this._iconBufferWriter.writeIcon(i,s.atlasLocation,s.imageSize,r.offset,n,this._collisionPriority);t.push({location:o,id:i.id,atlasId:s.atlasId,zIndex:r.zIndex})}return t}}function Le(t){return 255*t|0}function Ue(t){return 65535*t|0}function De(t){return(65535*t-1)/2|0}function je(t,e){return e<<16|65535&t}function Ne(t){return 4294967295*(.5*(t+1))|0}function Ve(t,e){return je(t>>>16,e>>>16)}function We(t,e){return je(t,e)}function qe(t,e){const i=Ne(e.x),s=Ne(e.y);t.writeVertexUint32(Ve(i,s)),t.writeVertexUint32(We(i,s))}class Fe{constructor(t){this._bufferDataProvider=t,this._currentMeshWrittenVertices=0}endMesh(){return this._currentMeshWrittenVertices=0,this._currentBufferData.endMesh()}writeIndices(t){this._ensureEnoughIndexBufferSpace(t.length),this._currentBufferData.writeIndices(t)}writeVertex(...t){return this._ensureEnoughVertexBufferSpace(),this._writeVertex(this._currentBufferData,...t),this._currentMeshWrittenVertices++}_ensureEnoughVertexBufferSpace(t=1){this._currentBufferData||this._requestNewBuffer();const e=this._currentBufferData.vertexBuffer,i=t*e.vertexByteSize;if(e.occupiedByteSize+i>e.byteSize&&(this._requestNewBuffer(),i>this._currentBufferData.vertexBuffer.byteSize))throw new Error("Mesh is too big to write its vertices")}_ensureEnoughIndexBufferSpace(t){this._currentBufferData||this._requestNewBuffer();const e=this._currentBufferData.indexBuffer;if(e.occupiedSize+t>e.size&&(this._requestNewBuffer(),t>this._currentBufferData.indexBuffer.size))throw new Error("Mesh is too big to write its indices")}_requestNewBuffer(){const t=this._currentBufferData;this._currentBufferData=this._bufferDataProvider(),t&&(t.vertexBuffer.transferUnfinishedMesh(this._currentBufferData.vertexBuffer),t.indexBuffer.transferUnfinishedMesh(this._currentBufferData.indexBuffer,t.vertexBuffer.currentMeshBaseIndex))}}function Ye(t,e=4){let i=0;return{attributes:[...Object(X.c)(t,([t,{type:s,size:r,normalized:n}])=>{const o=[t,{type:s,size:r,normalized:n,offset:i}],a=r*function(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4}}(s),l=function(t,e){return(t-1&e)-e}(i+a,-e);return i=l,o})],vertexByteSize:i}}const Xe=Ye([[2,{size:4,type:5121,normalized:!0}],[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[5,{size:2,type:5122,normalized:!0}],[6,{size:2,type:5122,normalized:!0}],[10,{size:1,type:5126,normalized:!1}],[4,{size:2,type:5123,normalized:!0}],[12,{size:4,type:5123,normalized:!1}],[13,{size:1,type:5126,normalized:!1}],[14,{size:2,type:5122,normalized:!0}]]),Ge={};for(const jn of Xe.attributes)Ge[jn[0]]=jn[1].offset/4;class Ze{constructor(){const t=new ArrayBuffer(Xe.vertexByteSize);this._uint32View=new Uint32Array(t),this._float32View=new Float32Array(t)}get data(){return this._uint32View}set position({x:t,y:e}){const i=Ne(t),s=Ne(e);this._uint32View[Ge[0]]=Ve(i,s),this._uint32View[Ge[1]]=We(i,s)}set normal({x:t,y:e}){this._uint32View[Ge[5]]=je(De(t),De(e))}setDisplacement(t,e){this._uint32View[Ge[6]]=je(Ke(t),Ke(e))}setUv(t,e){this._uint32View[Ge[4]]=je(Qe(t),Qe(e))}set iconLocation({minX:t,maxX:e,minY:i,maxY:s}){const r=Ge[12];this._uint32View[r]=je(t,e),this._uint32View[r+1]=je(i,s)}set iconScale(t){this._float32View[Ge[13]]=t}set id(t){this._uint32View[Ge[2]]=t}set zIndex(t){this._float32View[Ge[10]]=ae(t)}set zoom(t){this._zoom=t,this._writeZoomRelatedData()}set vertexZoomScaledTextureUDisplacement(t){this._zoomScaledTextureUDisplacement=t,this._writeZoomRelatedData()}_writeZoomRelatedData(){this._uint32View[Ge[14]]=je(De(B(this._zoom,-64,64)/64),De(B(this._zoomScaledTextureUDisplacement,-1024,1024)/1024))}}class He extends Fe{rewriteIcon(t,e,i,s){const r=new Uint32Array(t.vertexBuffer.data),n=new Float32Array(t.vertexBuffer.data),o=this._getAttribOffset(12),a=this._getAttribOffset(13),l=Xe.vertexByteSize,h=l/4,c=e.vertexByteOffset/4,d=e.vertexByteLength/l;for(let u=0;u<d;u++){const t=c+u*h;r[t+o]=je(i.minX,i.maxX),r[t+o+1]=je(i.minY,i.maxY),n[t+a]=s}}_getAttribOffset(t){const e=Xe.attributes,i=e.findIndex(e=>e[0]===t);return-1!==i?e[i][1].offset/4:-1}writeVertex(t){return super.writeVertex(t)}writeIndices(t){return super.writeIndices(t)}_writeVertex(t,e){for(const i of e.data)t.writeVertexUint32(i)}}function Ke(t){return De(B(t,-256,256)/256)}function Qe(t){return Ue(B(t,0,2048)/2048)}class $e{constructor(t){this._bufferWriter=t,this._vertexBuffer=new Ze}writePolyline({vertices:t},e,i,s,r,n,o,a,l,h,c,d=!1,u=0){const f=.5*i,p=this._vertexBuffer,_={leftVertexIndex:-1,rightVertexIndex:-1,segmentNormal:g(0,0)};p.id=e,p.iconLocation=o,p.iconScale=a,p.zoom=h,p.zIndex=c,p.vertexZoomScaledTextureUDisplacement=0;let y=u;this._writeStartCap(t[0],t[1],s,f,y,p,_);for(let g=1;g<t.length-1;g++)d||(y+=T(t[g],t[g-1])/l),this._writeJoin(t[g],t[g+1],n,f,y,d,l,p,_);return d||(y+=T(t[t.length-1],t[t.length-2])/l),this._writeEndCap(t[t.length-1],r,f,y,p,_),this._bufferWriter.endMesh()}_writeStartCap(t,e,i,s,r,n,o){const a=k(S(x(e,t)));n.position=t,n.normal=a;const l=this._writeVertex(n,0,s,r,2*s),h=this._writeVertex(n,0,-s,r,0);o.segmentNormal=a,o.leftVertexIndex=l,o.rightVertexIndex=h,this._writeStartCapTypeSpecificVertices(i,n,s,r,l,h)}_writeJoin(t,e,i,s,r,n,o,a,l){a.position=t;const h=2*s,c=l.segmentNormal,d=T(e,t)/o,u=function(t,e){const i=x(e,t);return S(i,i),k(i,i),i}(t,e);var f,p;const _=Math.sign((p=u,(f=c).x*p.y-f.y*p.x))>0,g=Math.min(function(t,e){const i=R(t,e),s=Math.abs((1-i)/(1+i));return Math.sqrt(s)}(c,u)*s,d),y=-g,m=this._writeVertex(a,0,0,r,s);let b,v;_?(v=this._writeVertex(a,0,-s,r,0),b=n?this._writeVertex(a,y,s,r,h):this._writeVertexWithUDisplacement(a,y,s,r,h,y)):(b=this._writeVertex(a,0,s,r,h),v=n?this._writeVertex(a,y,-s,r,0):this._writeVertexWithUDisplacement(a,y,-s,r,0,y)),a.normal=u;const w=_?b:this._writeVertex(a,0,s,r,h),A=_?this._writeVertex(a,0,-s,r,0):v;this._bufferWriter.writeIndices([l.leftVertexIndex,l.rightVertexIndex,b,l.rightVertexIndex,v,b,v,m,b,A,w,m]),l.segmentNormal=u,l.leftVertexIndex=w,l.rightVertexIndex=A,0===i&&g>4*s&&(i=1),this._writeJoinTypeSpecificVertices(i,a,l,_,c,u,g,s,r,m,b,v,w,A)}_writeEndCap(t,e,i,s,r,n){r.position=t;const o=this._writeVertex(r,0,i,s,2*i),a=this._writeVertex(r,0,-i,s,0);this._bufferWriter.writeIndices([n.leftVertexIndex,n.rightVertexIndex,o,n.rightVertexIndex,a,o]),this._writeEndCapTypeSpecificVertices(e,r,i,s,o,a)}_writeStartCapTypeSpecificVertices(t,e,i,s,r,n){switch(t){case 2:{const t=this._writeVertex(e,0,0,s,i),r=this._writeVertex(e,0,i,s,0),o=this._writeVertex(e,-i,i,s,0),a=this._writeVertex(e,-i,-i,s,0);this._bufferWriter.writeIndices([t,a,n,t,o,a,t,r,o]);break}}}_writeJoinTypeSpecificVertices(t,e,i,s,r,n,o,a,l,h,c,d,u,f){const p=2*a;switch(t){case 0:if(s){const t=this._writeVertex(e,o,-a,l,0);this._bufferWriter.writeIndices([h,t,d,h,f,t])}else{const t=this._writeVertex(e,o,a,l,p);this._bufferWriter.writeIndices([h,c,t,h,t,u])}break;case 2:{const t=a*a,i=o*o,r=t/Math.sqrt(t+i);if(s){const t=this._writeVertex(e,0,0,l,r);this._bufferWriter.writeIndices([t,d,f])}else{const t=this._writeVertex(e,0,0,l,p-r);this._bufferWriter.writeIndices([t,u,c])}break}}}_writeEndCapTypeSpecificVertices(t,e,i,s,r,n){switch(t){case 2:{const t=this._writeVertex(e,0,0,s,i),r=this._writeVertex(e,0,i,s,0),o=this._writeVertex(e,i,i,s,0),a=this._writeVertex(e,i,-i,s,0);this._bufferWriter.writeIndices([t,n,a,t,a,o,t,o,r]);break}}}_writeVertex(t,e,i,s,r){return t.setDisplacement(e,i),t.setUv(s,r),this._bufferWriter.writeVertex(t)}_writeVertexWithUDisplacement(t,e,i,s,r,n){t.vertexZoomScaledTextureUDisplacement=n;const o=this._writeVertex(t,e,i,s,r);return t.vertexZoomScaledTextureUDisplacement=0,o}}class Je extends $e{writePolyline(t,e,i,s,r,n,o,a,l,h,c){return super.writePolyline(t,e,i,s,r,n,o,a,l,h,c,!0,i/2)}_writeStartCapTypeSpecificVertices(t,e,i,s,r,n){switch(t){case 1:{const t=this._writeVertex(e,-i,i,0,2*i),s=this._writeVertex(e,-i,-i,0,0);this._bufferWriter.writeIndices([r,n,t,n,s,t]);break}default:super._writeStartCapTypeSpecificVertices(t,e,i,s,r,n)}}_writeEndCapTypeSpecificVertices(t,e,i,s,r,n){switch(t){case 1:{const t=2*i,s=this._writeVertex(e,i,i,t,t),o=this._writeVertex(e,i,-i,t,0);this._bufferWriter.writeIndices([r,n,s,n,o,s]);break}case 2:{const t=this._writeVertex(e,0,0,i,i),s=this._writeVertex(e,0,i,i,0),r=this._writeVertex(e,i,i,i,0),o=this._writeVertex(e,i,-i,i,0);this._bufferWriter.writeIndices([t,n,o,t,o,r,t,r,s]);break}}}_writeJoinTypeSpecificVertices(t,e,i,s,r,n,o,a,l,h,c,d,u,f){e.normal=r;const p=2*a;switch(t){case 1:if(o<=a){const t=a+o;if(s){const i=this._writeVertex(e,o,-a,t,0);this._bufferWriter.writeIndices([h,d,i,h,i,f])}else{const i=this._writeVertex(e,o,a,t,p);this._bufferWriter.writeIndices([h,i,c,h,u,i])}}else{const t=1/o*a*a;if(s){const i=a-t,s=this._writeVertex(e,a,-a,p,0),r=this._writeVertex(e,a,-t,p,i);e.normal=n;const o=this._writeVertex(e,-a,-a,p,0);this._bufferWriter.writeIndices([h,d,s,h,s,r,h,r,o,h,o,f])}else{const i=a+t,s=this._writeVertex(e,a,a,p,p),r=this._writeVertex(e,a,t,p,i);e.normal=n;const o=this._writeVertex(e,-a,a,p,p);this._bufferWriter.writeIndices([h,c,s,h,s,r,h,r,o,h,o,u])}}break;default:super._writeJoinTypeSpecificVertices(t,e,i,s,r,n,o,a,l,h,c,d,u,f)}e.normal=n}}class ti extends $e{constructor(t){super(t),this._halfCircleVectorsCache=new Map}writePolyline(t,e,i,s,r,n,o,a,l,h,c){return super.writePolyline(t,e,i,s,r,n,o,a,l,h,c,!1,0)}_writeStartCapTypeSpecificVertices(t,e,i,s,r,n){switch(t){case 1:const o=this._writeVertex(e,0,0,s,i),a=2*i;let l=r;for(const t of this._getHalfCircleVectors(Math.floor(i))){const r=-i*t.y,n=i*t.x,h=this._writeVertex(e,r,n,s,a);this._bufferWriter.writeIndices([o,l,h]),l=h}break;default:super._writeStartCapTypeSpecificVertices(t,e,i,s,r,n)}}_writeEndCapTypeSpecificVertices(t,e,i,s,r,n){switch(t){case 1:const o=this._writeVertex(e,0,0,s,i);let a=r;for(const t of this._getHalfCircleVectors(Math.floor(i))){const r=i*t.y,n=i*t.x,l=this._writeVertex(e,r,n,s,2*i);this._bufferWriter.writeIndices([o,l,a]),a=l}break;default:super._writeEndCapTypeSpecificVertices(t,e,i,s,r,n)}}_writeJoinTypeSpecificVertices(t,e,i,s,r,n,o,a,l,h,c,d,u,f){switch(e.normal=r,s?i.leftVertexIndex=this._writeVertexWithUDisplacement(e,-o,a,l,2*a,o):i.rightVertexIndex=this._writeVertexWithUDisplacement(e,-o,-a,l,0,o),t){case 1:{const t=R(r,n);if(s){const i=[];let s=d;for(const r of this._getHalfCircleVectors(Math.floor(a))){if(!(r.x>t))break;{const t=a*r.y,n=-a*r.x,o=this._writeVertex(e,t,n,l,0);i.push(h,o,s),s=o}}i.push(h,f,s),this._bufferWriter.writeIndices(i)}else{const i=2*a,s=[];let r=c;for(const n of this._getHalfCircleVectors(Math.floor(a))){if(!(n.x>t))break;{const t=a*n.y,o=a*n.x,c=this._writeVertex(e,t,o,l,i);s.push(h,c,r),r=c}}s.push(h,u,r),this._bufferWriter.writeIndices(s)}break}default:super._writeJoinTypeSpecificVertices(t,e,i,s,r,n,o,a,l,h,c,d,u,f)}e.normal=n}_getHalfCircleVectors(t){let e=this._halfCircleVectorsCache.get(t);if(!e){e=[];const i=Math.PI/t,s=g(1,0);for(let r=0;r<t;r++)w(s,i,s),e.push(m(s));this._halfCircleVectorsCache.set(t,e)}return e}}function ei(t,e,i){const s=e<=1&&t<2,r=e<=1&&t>=2?.55:.5,{r:n,g:o,b:a}=i,l=i.a*Math.min(t,1);t=Math.max(t,1);let h=Math.ceil(t+2*r);h+=1-h%2;const c=.5*h-.5,d=.5*t,u=d-r,f=d+r,p=new Uint32Array(h*h);for(let _=0;_<h;_++){const t=_-c;for(let e=0;e<h;e++){const i=e-c,r=Math.sqrt(t*t+i*i),g=s?.5+B(d-r,-.5,.5):D(f,u,r);p[e*h+_]=ft(n,o,a,l*g)}}return{size:{width:h,height:h},data:new Uint8Array(p.buffer)}}function ii(t,e,i,s,r){const n=s<=1&&t<2,o=s<=1&&t>=2?.55:.5,{r:a,g:l,b:h}=r,c=r.a*Math.min(t,1);t=Math.max(t,1);let d=Math.ceil(t+2*o);d+=1-d%2;const u=Math.ceil(e+i),f=Math.ceil(e+2*o),p=new Uint32Array(u*d),_=.5*e,g=.5*f-.5,y=.5*d-.5,m=.5*t,b=_-o,x=_+o,v=m-o,w=m+o;for(let k=0;k<f;k++){const t=D(x,b,Math.abs(k-g));for(let e=0;e<d;e++){const i=Math.abs(e-y),s=n?.5+B(m-i,-.5,.5):D(w,v,i);p[e*u+k]=ft(a,l,h,c*t*s)}}return{size:{width:u,height:d},data:new Uint8Array(p.buffer)}}var si=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{l(s.next(t))}catch(e){n(e)}}function a(t){try{l(s.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))};class ri extends ge{constructor(t,e,i,s,r,n,o,a,l,h=1e3){super(e,l,h),this._pageRegistry=i,this._iconAtlasRegistry=s,this._bufferWriter=r,this._polylines=t,this._zoom=o,this._worldToPxFactor=a,this._missingIcons=function(t,e){var i;const s=[];for(const r of t){const t=r.styles[0].inline||r.styles[0].outline,n=t&&t.pattern;n&&n.imageId&&(e.getIconData(n.imageId,n.scale*(null!=(i=t.patternScaleFactor)?i:1),t.patternTransformer)||s.push(t))}return s}(t,s),this._missingIconsWrittenPrimitives=[],this._solidPolylinesWriter=new Je(r),this._patternPolylineWriter=new ti(r),this._batchingRule=n}hasAsyncContent(){return this._missingIcons.length>0}processSynchronously(){const t=_e(),e=fe(this._polylines),i=Object(ye.c)(this._batchingRule,e),s=[...Object(ye.b)(this._writePolylines(),i)];return this._writtenPrimitives={content:{primitives:{3:s},metadata:e},metrics:{polylinesParsing:_e()-t,glyphsAndResourcesLoadTime:this._loadTime}}}_process(){let t=!1;for(const e of this._missingIconsWrittenPrimitives){const i=this._pageRegistry.getPage(e.primitive.location.bufferId),s=e.imageId,r=this._iconAtlasRegistry.getIconData(s,e.scaleFactor,e.transformer),n=(r.atlasLocation.maxY-r.atlasLocation.minY)/e.widthDIPx;this._bufferWriter.rewriteIcon(i.data,e.primitive.location,r.atlasLocation,n),i.touch(e.primitive.location),e.primitive.atlasId!==r.atlasId&&(t=!0)}return t?Object.assign({contentToRemove:[3]},this._writtenPrimitives):{content:{primitives:{}},metrics:{}}}_loadImpl(){return si(this,void 0,void 0,(function*(){const t=this._missingIcons.map(t=>{var e;return this._iconAtlasRegistry.loadIcon(t.pattern.imageId,Math.floor(this._getTaskPriority()),t.pattern.scale*(null!=(e=t.patternScaleFactor)?e:1),t.patternTransformer)});yield Promise.all(t)}))}_loadCancel(){}_writePolylines(){var t,e;const i=[],s=Object(X.e)(Object(X.a)(this._polylines,Zt),(t,e)=>{const i=e.styles[0];return i.inline&&!i.inline.hidden&&t.push({polyline:e,style:i.inline,zIndex:i.zIndex+.01}),i.outline&&!i.outline.hidden&&t.push({polyline:e,style:i.outline,zIndex:i.zIndex}),t},[]);!function(t,e=ke,i=0,s=t.length){if(s-i<=32)return void Ie(t,e,i,s);{let r=i,n=r+32;for(;n<s;)Ie(t,e,r,n),r=n,n+=32;Ie(t,e,r,s)}const r=new Array(s-i);for(let n=32;n<s-i;n+=n){Re(t,r,i,s);let o=i,a=0,l=n,h=l+n;for(;h<s-i;)ze(r,t,e,a,l,h,o),a=h,l=a+n,h=l+n,o+=2*n;ze(r,t,e,a,Math.min(l,s-i),s-i,o)}}(s,(t,e)=>t.zIndex-e.zIndex);const r=this._iconAtlasRegistry,n=this._zoom,o=this._worldToPxFactor,a=this._iconAtlasRegistry.getDpr();for(const l of s){const s=l.style,h=l.zIndex,c=s.strokeWidth,d=l.polyline.id,u=s.strokeColor,f=s.join;if(s.pattern){const a=s.strokeWidth,c=r.getIconData(s.pattern.imageId,s.pattern.scale*(null!=(t=s.patternScaleFactor)?t:1),s.patternTransformer),u=!!c,f=c?c.atlasId:r.getCurrentAtlas().id,p=c?c.atlasLocation:r.getCurrentAtlas().emptyIcon,_=(p.maxY-p.minY)/a,g={id:d,location:this._patternPolylineWriter.writePolyline(l.polyline,d,a,s.startCap,s.endCap,s.join,p,_,o,n,h),atlasId:f};i.push(g),u||this._missingIconsWrittenPrimitives.push({primitive:g,imageId:s.pattern.imageId,widthDIPx:a,scaleFactor:s.pattern.scale*(e=s.patternScaleFactor,null!=e?e:1),transformer:s.patternTransformer})}else if(l.style.dash){const t=l.style.dash,e=c+"_"+pt(u)+"_"+t.fill+"_"+t.gap,p=r.getIconData(e)||r.addIcon(ii(c*a,l.style.dash.fill*a,l.style.dash.gap*a,a,u),e),_=(p.atlasLocation.maxY-p.atlasLocation.minY)/a;i.push({id:d,location:this._patternPolylineWriter.writePolyline(l.polyline,d,_,s.startCap,s.endCap,f,p.atlasLocation,a,o,n,h),atlasId:p.atlasId})}else{const t=c+"_"+pt(u),e=r.getIconData(t)||r.addIcon(ei(c*a,a,u),t),p=(e.atlasLocation.maxY-e.atlasLocation.minY)/a;i.push({id:d,location:this._solidPolylinesWriter.writePolyline(l.polyline,d,p,s.startCap,s.endCap,f,e.atlasLocation,a,o,n,h),atlasId:e.atlasId})}}return i}}function ni(t){return t.objectId+t.meshId+pt(t.color)}class oi extends ge{constructor(t,e,i,r,n,o,a,l,h,c,d,u,f,p,_){super(r,n,2e3),this._options=t,this._zoom=e,this._worldToPxFactor=i,this._opaquePolygonBufferWriter=o,this._transparentPolygonBufferWriter=a,this._extrudedPolygonBufferWriter=l,this._polylineBufferWriter=h,this._pointLabelsBufferWriter=c,this._curvedLabelsBufferWriter=d,this._iconBufferWriter=u,this._pageRegistry=f,this._glyphAtlasRegistry=p,this._iconAtlasRegistry=_,this.onModelRequired=this._onModelRequired=new s}_writePolygons(t){const e=_e(),i=[],s=[],r=[],n=[];for(const h of t){const t=h.styles[0];t.pattern||(1===t.color.a?i.push({id:h.id,location:this._opaquePolygonBufferWriter.writePolygon(h,t.zIndex,t.color,h.id)}):r.push({id:h.id,location:this._transparentPolygonBufferWriter.writePolygon(h,t.zIndex,t.color,h.id)})),h.height>0&&(h.externalMesh?(this._onModelRequired.fire(h.externalMesh),n.push(ni(h.externalMesh))):s.push({id:h.id,location:this._extrudedPolygonBufferWriter.writePolygon(h,h.height,h.styles[0].color,h.id)}))}const o=fe(t),a=Object(ye.c)(this._options.polygonsBatchingRule,o),l=Object(ye.c)(this._options.modelsBatchingRule,o);return{content:{primitives:{0:[...Object(ye.a)(i,a)],1:[...Object(ye.a)(r,a)],2:[...Object(ye.a)(s,l)]},references:n,metadata:o},metrics:{polygonsParsing:_e()-e}}}_writePolylines(t,e){const i=this._zoom,s=this._worldToPxFactor,r=new ri([...t,...e],this._taskQueue,this._pageRegistry,this._iconAtlasRegistry,this._polylineBufferWriter,this._options.polylinesBatchingRule,i,s,this._priority,1e3),n=r.processSynchronously();return r.hasAsyncContent()?this._startSubTask(r):r.destructor(),n}_writeLabels(t,e){const i=new Oe(t,e,this._taskQueue,this._options.objectsCollisionPriority,this._glyphAtlasRegistry,this._pointLabelsBufferWriter,this._curvedLabelsBufferWriter,this._options.labelsBatchingRule,this._priority,2e3);if(i.canBeProcessedSynchronously()){const t=i.processSynchronously();return i.destructor(),t}this._startSubTask(i)}_writeIcons(t){const e=new Be(t,this._taskQueue,this._options.objectsCollisionPriority,this._iconAtlasRegistry,this._iconBufferWriter,this._priority,1e3);if(e.canBeProcessedSynchronously()){const t=e.processSynchronously();return e.destructor(),t}this._startSubTask(e)}}function ai(t){return Zt(t)&&!t.styles[0].hidden}function li(t){return ai(t)&&t.texts.length>0}class hi extends oi{constructor(t,e,i,s,r,n,o,a,l,h,c,d,u,f,p,_,g,y=(t=>et(t,e.allObjectsInteractive))){super(e,t.tile.zoom-kt(e.tileSize),function(t,e){wt[t]||(wt[t]=[]);let i=wt[t][e];return i||(i=2/(function(t){switch(t){case 1:return 512;case 2:return 1024;default:return 256}}(t)*Math.pow(2,e)),wt[t][e]=i),i}(e.tileSize,t.tile.zoom),i,r,n,o,a,l,h,c,d,u,f,p),this._tile=t,this._tileSpecificOptions=e,this._tileLoader=s,this._metadataPreprocessor=y,this._objectIdProvider=_,this._stylesCustomizer=g,this._modifyIconMetadata=this._modifyIconMetadata.bind(this)}_onSubTaskContent(t){this._onContentReady.fire(t)}_process(t){const e=_e(),i=H.decode(new Uint8Array(t)),s=_e(),r=this._metadataPreprocessor(i,this._tile),n=this._tile.tile,o=this._extractPointLabels(n,i,r),a=this._extractCurvedLabels(n,i,r),l=this._extractPolygons(n,i,r),h=this._extractPolylines(n,i,r),c=this._extractContours(n,i,l),d=this._exractIcons(n,i,r,o);return ue(this._writeLabels(o,a),this._writeIcons(d),this._writePolygons(l),this._writePolylines(h,c),{content:{primitives:{}},metrics:{tileUnpack:s-e,tileLoadTime:this._loadTime,workerQueueDelay:this._queueWaitingTime}})}_loadImpl(){const t=Math.floor(this._getTaskPriority());return this._tileLoader.load(this._tile,t)}_loadCancel(){this._tileLoader.cancel(this._request)}_extractPolygons(t,e,i){return[...Object(X.a)(jt(t,e,i,this._objectIdProvider.idGenerator,this._tileSpecificOptions.tileSize,this._tileSpecificOptions.mapMode,this._stylesCustomizer),ai)]}_extractPolylines(t,e,i){return[...Gt(t,e,i,this._objectIdProvider.idGenerator,this._tileSpecificOptions.tileSize,this._tileSpecificOptions.mapMode,this._stylesCustomizer)]}_extractContours(t,e,i){return[...Xt(t,e,i,this._tileSpecificOptions.tileSize,this._tileSpecificOptions.mapMode,this._stylesCustomizer)]}_extractPointLabels(t,e,i){return[...Object(X.a)(te(t,e,i,this._objectIdProvider.collidingIdGenerator,this._tileSpecificOptions.tileSize,this._tileSpecificOptions.mapMode,this._stylesCustomizer),li)]}_extractCurvedLabels(t,e,i){return[...Object(X.a)(re(t,e,i,this._objectIdProvider.collidingIdGenerator,this._tileSpecificOptions.tileSize,this._tileSpecificOptions.mapMode,this._stylesCustomizer),ai)]}_exractIcons(t,e,i,s){return[...Object(X.a)(de(t,e,i,this._objectIdProvider.collidingIdGenerator,s,this._tileSpecificOptions.tileSize,this._tileSpecificOptions.mapMode,this._stylesCustomizer,this._modifyIconMetadata),ai)]}_modifyIconMetadata(t,e){const i=e[0];if(i&&i.selectedIcon){const e=!1,s=this._iconAtlasRegistry.buildIconUrl(i.selectedIcon.imageId,i.scaleFactor,e);t.set("_vector_selectedIconUrl",s)}}}class ci{constructor(t){this._task=t,this.onContentReady=this._onContentReady=new s,this._onWrappedTaskContentReady=this._onWrappedTaskContentReady.bind(this),this._task.onContentReady.addListener(this._onWrappedTaskContentReady)}destructor(){this._task.onContentReady.removeListener(this._onWrappedTaskContentReady)}start(){this._task.resetPriority(this._calculateTaskPriority()),this._task.start()}_onWrappedTaskContentReady(t){this._onContentReady.fire(t)}}class di extends ci{constructor(t,e,i,s){super(e),this._tile=t,this._viewport=i,this._taskExtraPriority=s,this._tileCenterPosition=function(t){const e=st(t.zoom);return{x:e*(t.x+.5)-1,y:1-e*(t.y+.5)}}(t.tile),this._onTileStateChanged=this._onTileStateChanged.bind(this),this._tile.onStateChanged.addListener(this._onTileStateChanged),this._onViewportUpdated=this._onViewportUpdated.bind(this),this._viewport.onViewportChanged.addListener(this._onViewportUpdated)}destructor(){this._task.destructor(),this._tile.onStateChanged.removeListener(this._onTileStateChanged),this._viewport.onViewportChanged.removeListener(this._onViewportUpdated)}start(){2!==this._tile.state&&super.start()}_calculateTaskPriority(){return(0===this._tile.state?3e4:1===this._tile.state?2e4:1e4)+(1-T(this._viewport.cameraPosition,this._tileCenterPosition)/2)+this._taskExtraPriority}_onTileStateChanged(t){switch(t.state){case 2:case 3:this._task.pause();break;case 0:case 1:this._resetTaskPriority(),0===this._task.state?this._task.start():this._task.resume()}}_onViewportUpdated(){this._resetTaskPriority()}_resetTaskPriority(){this._task.resetPriority(this._calculateTaskPriority())}}class ui extends di{constructor(t,e,i,r,n,o,a,l,h,c,d,u,f,p,_,g,y,m,b){const x=new hi(t,e,i,r,o,a,l,h,c,d,u,f,p,_,g,y,m,b);super(t,x,n,o),this.onModelRequired=this._onModelRequired=new s,x.onModelRequired.addListener(t=>this._onModelRequired.fire(t))}}function fi(t,e="something that is supposed to be defined is undefined"){if(!(void 0!==t))throw new Error(e);return void 0!==t}function pi(t){let e=0;for(let i=0;i<t.length;i++)e+=t.charCodeAt(i);return(e%4+1).toString()}class _i extends ge{constructor(t,e,i,s,r,n,o=1e3,a=!1){super(e,n,o),this._model=t,this._loadManager=i,this._trimeshModelBufferWriter=s,this._meshTemplateUrl=r,this._requestWithCredentials=a}_process(t){const e=this._model.mesh;return{primitives:{2:this._trimeshModelBufferWriter.writeModel(t,e).map(t=>({id:e.id,metadata:e.metadata,location:t}))}}}_loadImpl(){const t=this._model.mesh.meshId;return this._loadManager.load(this._meshTemplateUrl.replace("{{hostAlias}}",pi(t)).replace("{{id}}",t),Math.floor(this._getTaskPriority()),{withCredentials:this._requestWithCredentials})}_loadCancel(){this._loadManager.cancel(this._request)}}class gi extends a{constructor(){super({id:"_NO_ID_",x:-1,y:-1,zoom:-1},2),this._tiles=[],this._onSubTileStateChanged=this._onSubTileStateChanged.bind(this)}addTile(t){this._tiles.find(e=>e===t)||(this._tiles.push(t),t.onStateChanged.addListener(this._onSubTileStateChanged,this),this._recalculateState())}_onSubTileStateChanged(){this._recalculateState()}_recalculateState(){this.state=this._calculateState()}_calculateState(){for(const t of this._tiles)if(0===t.state)return 0;for(const t of this._tiles)if(1===t.state)return 1;return 2}}class yi extends di{constructor(t,e,i,s,r,n,o,a=!1){const l=new gi;super(l,new _i(t,e,i,n,o,r,1e3,a),s,r),this._combinedTile=l}addTile(t){this._combinedTile.addTile(t)}}class mi{constructor(){this.onReleased=this._onReleased=new s,this.onRetain=this._onRetain=new s,this._clients=0}get isRetained(){return 0!==this._clients}retain(){++this._clients,this._onRetain.fire(this)}release(){this._clients>0&&(--this._clients,0===this._clients&&this._onReleased.fire(this))}}class bi extends mi{constructor(t,e){super(),this.id=t,this.mesh=e,this._contentHolder=new o}destructor(){this._contentHolder.destructor()}addContent(t,e){return this._contentHolder.addContent(t,e)}hasContent(){return this._contentHolder.hasContent()}}class xi{constructor(t,e){this._loadManager=t,this._storage=e,this._cache=new Map,this._storage.onRemoved.addListener(this._onTileRemoved,this),this._tileUrlTemplate="",this._tileSize=0,this._tileRequestWithCredentials=!1}destructor(){this._storage.onRemoved.removeListener(this._onTileRemoved)}update(t,e,i){let s=!1;this._tileUrlTemplate!==t&&(this._tileUrlTemplate=t,s=!0),this._tileSize!==e&&(this._tileSize=e,s=!0),i!==this._tileRequestWithCredentials&&(this._tileRequestWithCredentials=i,s=!0),s&&(this._cache.clear(),this._cache=new Map)}load(t,e){const i=this._cache,s=M(t.tile),r=i.get(s);if(r)return r.count++,Promise.resolve(r.data);const n=this._buildTileUrl(t.tile,s),o=this._tileRequestWithCredentials,a=this._loadManager.load(n,e,{withCredentials:o});return a.then(t=>{i.set(s,{count:1,data:t})}),a}cancel(t){this._loadManager.cancel(t)}_onTileRemoved(t){const e=M(t.tile),i=this._cache.get(e);i&&(i.count--,0===i.count&&this._cache.delete(e))}_buildTileUrl(t,e){const{x:i,y:s,zoom:r}=t,n=At(t,this._tileSize);return this._tileUrlTemplate.replace("{{hostAlias}}",pi(e)).replace("{{x}}",i+"").replace("{{y}}",s+"").replace("{{z}}",r+"").replace("{{zmin}}",n+"").replace("{{zmax}}",n+"")}}function vi(t){return Array.isArray(t)?t:[t]}function wi(t,e){console.warn(`not valid "${t}": "${e}"`)}function ki(t,e){return t^e+2654435769+(t<<6)+(t>>2)}function Ai(t,e,i,s){if(void 0!==t)return function(t){let e=0;for(const i of[t.r,t.g,t.b,t.a])e=ki(e,255*i|0);return e}(t);let r=0;return void 0!==e&&(r=ki(r,e/6*255|0)),void 0!==i&&(r=ki(r,function(t){let e=0;for(let i=0;i<t.length;++i)e=ki(e,255*t[i]|0);return e}(i))),void 0!==s&&(r=ki(r,255*s|0)),r}function Ti(t,e,i,s){return r=>{let n=r;return void 0!==t?n=t:(void 0!==e&&(n=function(t,e){const i=Math.min(t.r,t.g,t.b),s=Math.max(t.r,t.g,t.b)-i,r=s*(1-Math.abs(e%2-1));let n=0,o=0,a=0;switch(Math.floor(e)){case 0:n=s,o=r;break;case 1:n=r,o=s;break;case 2:o=s,a=r;break;case 3:o=r,a=s;break;case 4:a=s,n=r;break;case 5:a=r,n=s}return dt(n+i,o+i,a+i,t.a)}(n,e)),void 0!==i&&(n=function({r:t,g:e,b:i,a:s},r){const n=dt(B(r[0]*t+r[1]*e+r[2]*i+r[3],0,1),B(r[4]*t+r[5]*e+r[6]*i+r[7],0,1),B(r[8]*t+r[9]*e+r[10]*i+r[11],0,1),B(r[12]*t+r[13]*e+r[14]*i+r[15],0,1));return n.a*=s,n}(n,i))),void 0!==s&&(n=dt(n.r,n.g,n.b,n.a*s)),n}}function Si(t,e,i,s,r,n){const o=Ai(t,e,i,s),a=function(t,e,i){return(t?"&c1="+bt(t):"")+(e?"&c2="+bt(e):"")+(i?"&c3="+bt(i):"")}(t,r,n);if(0!==o||""!==a)return{key:o,colorQuery:a,transform:Ti(t,e,i,s),transformImage:({size:t,data:r})=>(function(t,e){for(let i=0;i<t.length;i+=4){const{r:s,g:r,b:n,a:o}=e(dt(t[i+0]/255,t[i+1]/255,t[i+2]/255,1));t[i+0]=255*s,t[i+1]=255*r,t[i+2]=255*n,t[i+3]=t[i+3]*o}}(r,Ti(void 0,e,i,s)),{size:t,data:r})}}var Ri;!function(t){t[t.None=0]="None",t[t.Point=1]="Point",t[t.Polyline=2]="Polyline",t[t.Polygon=4]="Polygon",t[t.All=7]="All"}(Ri||(Ri={}));const Pi={point:Ri.Point,polyline:Ri.Polyline,polygon:Ri.Polygon};var Ii;!function(t){t[t.None=0]="None",t[t.GeometryFillRaw=1]="GeometryFillRaw",t[t.GeometryFillPattern=2]="GeometryFillPattern",t[t.GeometryOutline=4]="GeometryOutline",t[t.GeometryFill=3]="GeometryFill",t[t.Geometry=7]="Geometry",t[t.LabelIcon=8]="LabelIcon",t[t.LabelTextFill=16]="LabelTextFill",t[t.LabelTextOutline=32]="LabelTextOutline",t[t.LabelText=48]="LabelText",t[t.Label=56]="Label",t[t.All=63]="All"}(Ii||(Ii={}));const zi={"geometry.fill":Ii.GeometryFill,"geometry.fill.pattern":Ii.GeometryFillPattern,"geometry.outline":Ii.GeometryOutline,geometry:Ii.Geometry,"label.icon":Ii.LabelIcon,"label.text.fill":Ii.LabelTextFill,"label.text.outline":Ii.LabelTextOutline,"label.text":Ii.LabelText,label:Ii.Label};function Ci(){return new Array(9)}Ci();function Oi(t,e,i){return{x:t,y:e,z:i}}Oi(0,0,0),Oi(1,0,0),Oi(-1,0,0),Oi(0,1,0),Oi(0,-1,0),Oi(0,0,1),Oi(0,0,-1);function Ei(t,e=Oi(0,0,0)){return e.x=t.x,e.y=t.y,e.z=t.z,e}function Mi(t,e,i=Oi(0,0,0)){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i}function Bi(t,e,i=Oi(0,0,0)){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i}function Li(){return new Array(16)}!function(t,e=Li()){for(let i=0;i<16;++i)e[i]=t[i]}([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function Ui(t,e,i=Li()){for(let s=0;s<16;s+=4){const r=t[s],n=t[s+1],o=t[s+2],a=t[s+3];for(let t=0;t<4;++t)i[s+t]=r*e[t]+n*e[4+t]+o*e[8+t]+a*e[12+t]}return i}function Di(t,e){return e?Ui(t,e):t}function ji(t,e){if(void 0!==t.visibility&&("off"===t.visibility?e.isHidden=!0:wi("styler.visibility",t.visibility)),void 0!==t.scale&&(t.scale>=0?e.scale=t.scale:wi("styler.scale",t.scale)),void 0!==t.color){const i=yt(t.color);i?e.color=i:wi("styler.color",t.color)}if(void 0!==t["secondary-color"]){const i=yt(t["secondary-color"]);i?e.secondaryColor=i:wi("styler.secondary-color",t["secondary-color"])}if(void 0!==t["tertiary-color"]){const i=yt(t["tertiary-color"]);i?e.tertiaryColor=i:wi("styler.tertiary-color",t["tertiary-color"])}if(void 0!==t.hue){const i=yt(t.hue),s=i?function({r:t,g:e,b:i}){const s=Math.min(t,e,i),r=Math.max(t,e,i),n=r-s;if(_(n,0))return;let o;switch(!0){case _(r,t):o=0+(e-i)/n;break;case _(r,e):o=2+(i-t)/n;break;case _(r,i):o=4+(t-e)/n}return(o+6)%6}(i):void 0;void 0!==s?e.hue=s:wi("styler.hue",t.hue)}void 0!==t.saturation&&(-1<=t.saturation&&t.saturation<=1?e.colorTransform=Di(function(t){const e=.2125*(1-t),i=.7154*(1-t),s=.0721*(1-t);return[e+t,i,s,0,e,i+t,s,0,e,i,s+t,0,0,0,0,1]}(t.saturation+1),e.colorTransform):wi("styler.saturation",t.saturation)),void 0!==t.lightness&&(-1<=t.lightness&&t.lightness<=1?e.colorTransform=Di(function(t){const e=1-Math.abs(t),i=Math.max(0,t);return[e,0,0,i,0,e,0,i,0,0,e,i,0,0,0,1]}(t.lightness),e.colorTransform):wi("styler.lightness",t.lightness)),void 0!==t.opacity&&(0<=t.opacity&&t.opacity<=1?e.opacity=t.opacity:wi("styler.opacity",t.opacity))}function Ni(t){const e=function(t){if(void 0===t)return()=>!0;const e=vi(t);return e.length>1?(s=e[0],r=e[1],t=>s<=t&&t<=r):(i=e[0],t=>t===i);var i,s,r}(t.zoom),i={};return ji(t,i),{matchZoom:e,properties:i}}function Vi(t,e,i){if(i.isHidden)return void t.hide(e);void 0!==i.scale&&t.changeScale(e,i.scale);const s=Si(i.color,i.hue,i.colorTransform,i.opacity,i.secondaryColor,i.tertiaryColor);void 0!==s&&t.changeColor(e,s)}class Wi{constructor(t){var e;this._types=function(t){if(void 0===t)return Ri.All;let e=Ri.None;for(const i of vi(t)){const s=Pi[i];if(!s)return wi("types",t),Ri.None;e|=s}return e}(t.types),this._elements=function(t){if(void 0===t)return Ii.All;let e=Ii.None;for(const i of vi(t)){const s=zi[i];if(!s)return wi("elements",t),Ii.None;e|=s}return e}(t.elements),this._matchTags=function(t){let e,i,s;return"string"==typeof t?e=vi(t):t&&(t.all&&(e=vi(t.all)),t.any&&(i=vi(t.any)),t.none&&(s=vi(t.none))),Ot(e,i,s)}(t.tags),this._stylers=void 0!==(e=t.stylers)?vi(e).map(Ni):[]}match(t,e,i){return St(this._types,t)&&St(this._elements,e)&&this._matchTags(i)}pickStylers(t){const e=[];for(const i of this._stylers)i.matchZoom(t)&&e.push(i.properties);return e}}const qi={hide(t){t.hidden=!0},changeScale(t,e){t.scaleFactor=e},changeColor(t,e){t.transformer=e}};function Fi(t,e){return{hide(i){const s=t(i);s&&e.hide(s)},changeScale(i,s){const r=t(i);r&&e.changeScale(r,s)},changeColor(i,s){const r=t(i);r&&e.changeColor(r,s)}}}const Yi={hide(t){t.hidden=!0},changeScale(t,e){t.strokeWidth*=e},changeColor(t,e){t.strokeColor=e.transform(t.strokeColor)}},Xi=Fi((function(t){return t.inline&&!t.inline.pattern?t.inline:void 0}),Yi),Gi=Fi((function(t){return t.outline}),Yi),Zi=Fi((function(t){return t.inline&&t.inline.pattern?t.inline:void 0}),{hide:Yi.hide,changeScale(t,e){Yi.changeScale(t,e),t.patternScaleFactor=e},changeColor(t,e){t.patternTransformer=e}}),Hi={hide(t){t.hidden=!0},changeScale(){},changeColor(t,e){t.color=e.transform(t.color)}},Ki=Xi,Qi={hide(){},changeScale(){},changeColor(t,e){t.pattern&&(t.patternTransformer=e)}};function $i(t){return{hide(e){for(const i of e.styles)i[t]=ct},changeScale(t,e){for(const i of t.styles)i.fontSize*=e},changeColor(e,i){for(const s of e.styles)s[t]=i.transform(s[t])}}}const Ji=$i("color"),ts=$i("outlineColor");ts.changeScale=()=>{},ts.hide=t=>{for(const e of t.styles){if(e.color===ct)return void(t.hidden=!0);e.outlineColor=ct}};const es=[{element:Ii.LabelIcon,adapter:qi}],is=[{element:Ii.GeometryFillRaw,adapter:Xi},{element:Ii.GeometryOutline,adapter:Gi},{element:Ii.GeometryFillPattern,adapter:Zi}],ss=[{element:Ii.GeometryFill,adapter:Hi},{element:Ii.GeometryFillPattern,adapter:Qi}],rs=[{element:Ii.GeometryOutline,adapter:Ki}],ns=[{element:Ii.LabelTextFill,adapter:Ji},{element:Ii.LabelTextOutline,adapter:ts}];class os{constructor(){this._blocks=[]}update(t){this._blocks=t.map(t=>new Wi(t)),console.log(`styles customization config update: ${this._blocks.length} blocks`)}customizePoint(t,e,i){this._customize(t,e,Ri.Point,i,es)}customizePolyline(t,e,i){this._customize(t,e,Ri.Polyline,i,is)}customizePolygon(t,e,i){this._customize(t,e,Ri.Polygon,i,ss)}customizePolygonContour(t,e,i){this._customize(t,e,Ri.Polygon,i,rs)}customizePointLabel(t,e,i){this._customize(t,e,Ri.Point,i,ns)}customizeCurvedLabel(t,e,i){this._customize(t,e,Ri.Polyline,i,ns)}_customize(t,e,i,s,r){var n;if(this._blocks.length)for(const o of t)for(const{element:t,adapter:a}of r){const r=[];for(const n of this._blocks)n.match(i,t,e)&&r.push(...n.pickStylers(s));if(r.length){Vi(a,o,(n=r,Object.assign({},...n)))}}}}var as=i(15),ls=i.n(as);function hs(t){const e=[],i=[];let s=0;for(const r of t){0!==s&&i.push(s);for(const t of r)e.push(t.x,t.y),s++}return ls()(e,i)}class cs extends Fe{writePolygon(t,e,i,s){const r=ae(e),n=pt(i);for(const o of t.vertexRings)for(const t of o)this.writeVertex(t,n,s,r);return this.writeIndices(hs(t.vertexRings)),this.endMesh()}_writeVertex(t,e,i,s,r){qe(t,e),t.writeVertexUint32(i),t.writeVertexUint32(s),t.writeVertexFloat32(r)}}class ds extends Fe{writePointLabel(t,e,i,s,r,n){const o=e.anchorPoint,a=le(e.priority,n);for(const[l,h]of Object(X.f)(s,i.styles)){const e=pt(h.color),i=pt(h.outlineColor),s=[];for(let n=0;n<l.length;n++){const h=l[n],c=[];for(const s of h){const n=r.get(s.fontId)[s.glyphId],l=this.writeVertex(t,o,s.topLeft,{x:n.minX,y:n.minY},e,i,a,s.scale),h=this.writeVertex(t,o,s.topRight,{x:n.maxX,y:n.minY},e,i,a,s.scale),d=this.writeVertex(t,o,s.bottomRight,{x:n.maxX,y:n.maxY},e,i,a,s.scale),u=this.writeVertex(t,o,s.bottomLeft,{x:n.minX,y:n.maxY},e,i,a,s.scale);this.writeIndices([l,h,d,l,d,u]),c.push({topLeft:l,topRight:h,bottomRight:d,bottomLeft:u})}s.push(c)}this._writeHitTestLabelFillings(s)}return this.endMesh()}_writeHitTestLabelFillings(t){if(1!==t.length)for(let e=0;e<t.length-1;e++)this._writeHitTestFillingIndices(t[e],t[e+1]);else this._writeHitTestFillingIndices(t[0],t[0])}_writeHitTestFillingIndices(t,e){const[i,s,r,n]=[t[0].topLeft,t[t.length-1].topRight,e[e.length-1].bottomRight,e[0].bottomLeft];this.writeIndices([i,n,r,i,r,s])}_writeVertex(t,e,i,s,r,n,o,a,l){t.writeVertexUint32(e),qe(t,i),t.writeVertexFloat32(s.x),t.writeVertexFloat32(s.y),t.writeVertexUint32(je(r.x,r.y)),t.writeVertexUint32(n),t.writeVertexUint32(o),t.writeVertexFloat32(a),t.writeVertexFloat32(l)}}class us extends Fe{writeLabel(t,e,i,s,r,n){const o=le(t.priority,n),a=Nt(t.polyline),l=a[1][0];a[0].reverse();for(const h of a)for(let t=1;t<h.length;t++)x(h[t],l,h[t]);for(const[h,c]of Object(X.f)(i,e.styles)){const t=pt(c.color),e=pt(c.outlineColor);for(const i of h){const n=s.get(i.fontId)[i.glyphId],h=this.writeVertex(r,l,i.topLeft,{x:n.minX,y:n.minY},t,e,o,i.lineDisplacement,a,i.scale),c=this.writeVertex(r,l,i.topRight,{x:n.maxX,y:n.minY},t,e,o,i.lineDisplacement,a,i.scale),d=this.writeVertex(r,l,i.bottomRight,{x:n.maxX,y:n.maxY},t,e,o,i.lineDisplacement,a,i.scale),u=this.writeVertex(r,l,i.bottomLeft,{x:n.minX,y:n.maxY},t,e,o,i.lineDisplacement,a,i.scale);this.writeIndices([h,c,d,h,d,u])}}return this.endMesh()}_writeVertex(t,e,i,s,r,n,o,a,l,h,c){t.writeVertexUint32(e),qe(t,i),t.writeVertexFloat32(s.x),t.writeVertexFloat32(s.y),t.writeVertexFloat32(l),t.writeVertexUint32(je(r.x,r.y)),t.writeVertexUint32(n),t.writeVertexUint32(o),t.writeVertexFloat32(a);const d=this._computePolylineLength(h);for(const u of h)this._writePolylinePart(t,u,d);t.writeVertexFloat32(d),t.writeVertexFloat32(c)}_writePolylinePart(t,e,i){const s=[];for(let a=1;a<=4;a++)s.push(this._encodePoint(e[a],i));for(let a=0;a<4;a+=4)t.writeVertexUint32((r=Le(s[a].ratio),n=Le(s[a+1].ratio),o=Le(s[a+2].ratio),Le(s[a+3].ratio)<<24|(255&o)<<16|(255&n)<<8|255&r));var r,n,o;for(let a=0;a<4;a+=2)t.writeVertexUint32(je(Ue(s[a].angle),Ue(s[a+1].angle)))}_encodePoint(t=g(0,0),e){return{ratio:A(t)/e,angle:(Math.atan2(t.y,t.x)+Math.PI)/(2*Math.PI)}}_computePolylineLength(t){let e=0;for(const i of t)for(let t=1;t<=4;t++)i[t]&&(e+=A(i[t]));return e}}class fs extends Fe{writeIcon(t,e,i,s,r,n){const o=i.height*r*32,a=i.width*r*32,l=(s.x+.5)*a,h=(s.y+.5)*o,c=.5*-o,d=.5*o,u=.5*-a,f=.5*a,p=le(t.priority,n),_=this.writeVertex(t.position,u,d,l,h,e.minX,e.minY,t.id,p),g=this.writeVertex(t.position,u,c,l,h,e.minX,e.maxY,t.id,p),y=this.writeVertex(t.position,f,d,l,h,e.maxX,e.minY,t.id,p),m=this.writeVertex(t.position,f,c,l,h,e.maxX,e.maxY,t.id,p);return this.writeIndices([_,y,g,g,y,m]),this.endMesh()}_writeVertex(t,e,i,s,r,n,o,a,l,h){qe(t,e),t.writeVertexUint32(je(i,s)),t.writeVertexUint32(je(r,n)),t.writeVertexUint32(je(o,a)),t.writeVertexUint32(l),t.writeVertexFloat32(h)}}const ps=Ye([[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[7,{size:4,type:5121,normalized:!0}],[2,{size:4,type:5121,normalized:!0}],[10,{size:1,type:5126,normalized:!1}]]),_s=Ye([[2,{size:4,type:5121,normalized:!1}],[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[6,{size:2,type:5126,normalized:!1}],[4,{size:2,type:5123,normalized:!1}],[7,{size:4,type:5121,normalized:!0}],[8,{size:4,type:5121,normalized:!0}],[9,{size:1,type:5126,normalized:!1}],[11,{size:1,type:5126,normalized:!1}]]),gs=Ye([[2,{size:4,type:5121,normalized:!1}],[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[6,{size:3,type:5126,normalized:!1}],[4,{size:2,type:5123,normalized:!1}],[7,{size:4,type:5121,normalized:!0}],[8,{size:4,type:5121,normalized:!0}],[9,{size:1,type:5126,normalized:!1}],[12,{size:4,type:5121,normalized:!0}],[13,{size:4,type:5123,normalized:!0}],[14,{size:4,type:5121,normalized:!0}],[15,{size:4,type:5123,normalized:!0}],[11,{size:2,type:5126,normalized:!1}]]),ys=Ye([[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[6,{size:2,type:5122,normalized:!1}],[11,{size:2,type:5122,normalized:!1}],[4,{size:2,type:5123,normalized:!1}],[2,{size:4,type:5121,normalized:!1}],[9,{size:1,type:5126,normalized:!1}]]),ms=Ye([[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[3,{size:1,type:5126,normalized:!1}],[7,{size:4,type:5121,normalized:!0}],[2,{size:4,type:5121,normalized:!0}]]);function*bs(t,e){const i=new Set;for(const s of function*(t){for(const e in t)yield Number(e)}(e))for(const t of e[s])i.add(t.location.bufferId);for(const s of i){const e=t.getPage(s);fi(e)&&(yield e)}}function*xs(t,e){const i=new Set,s=e[4];s&&s.forEach(t=>i.add(t.atlasId));const r=e[5];r&&r.forEach(t=>i.add(t.atlasId));for(const n of i){const e=t.getAtlas(n);fi(e)&&(yield e)}}function*vs(t,e){const i=new Set,s=e[6];s&&s.forEach(t=>{i.add(t.atlasId)});const r=e[3];r&&r.forEach(t=>{i.add(t.atlasId)});for(const n of i){const e=t.getAtlas(n);fi(e)&&(yield e)}}class ws extends Fe{_writeVertex(t,e,i,s){qe(t,e),t.writeVertexFloat32(e.z),t.writeVertexUint32(i),t.writeVertexUint32(s)}}function ks(t,e){return(e+1)%t.length}function As(t,e){return(e||t.length)-1}function Ts(t,e){return t[ks(t,e)]}function Ss(t,e){return t[As(t,e)]}const Rs={0:3,1:3,2:1,3:1};class Ps{constructor(t){this._view=new DataView(t),this.header={signature:this._view.getUint32(0,!0),nCmdAdd:this._view.getUint32(4,!0),nCmdEtc:this._view.getUint16(8,!0),nAux:this._view.getUint16(10,!0),precision:this._view.getUint8(12)},this._auxOffset=13,this._cmdOffset=this._auxOffset+2*this.header.nAux,this._diffOffset=this._cmdOffset+this.header.nCmdAdd+this.header.nCmdEtc,this._cmdEnd=this._diffOffset}readCommand(t={type:0,valence:0,shift:0}){const e=this._view.getUint8(this._cmdOffset++),i=3&e;let s=e>>2;s=0!==s?s-1:this._readAux()+62,s+=Rs[i];const r=2===i||3===i?this._readAux():0;return t.type=i,t.valence=s,t.shift=r,t}readDiff(t=Oi(0,0,0)){return t.x=this._readDiff(this._diffOffset+3*this.header.nCmdAdd,this._diffOffset+0*this.header.nCmdAdd),t.y=this._readDiff(this._diffOffset+4*this.header.nCmdAdd,this._diffOffset+1*this.header.nCmdAdd),t.z=this._readDiff(this._diffOffset+5*this.header.nCmdAdd,this._diffOffset+2*this.header.nCmdAdd),this._diffOffset++,t}hasCommands(){return this._cmdOffset<this._cmdEnd}_readAux(){const t=this._view.getUint8(this._auxOffset),e=this._view.getUint8(this._auxOffset+this.header.nAux)<<8|t;return this._auxOffset++,e}_readDiff(t,e){return(i=this._view.getUint8(t)<<8|this._view.getUint8(e))>>1^-(1&i);var i}}class Is{constructor(t,e,i){this.vertex=e,this.index=i,this._neighbours=new Array(t).fill(void 0)}calculateSpan(t,e){const i=this._neighbours.indexOf(t),s=this._neighbours.indexOf(e);return(this._neighbours.length+(s-i))%this._neighbours.length}setNeighbors(t,e,i=0,s){let r=(this._neighbours.indexOf(s)+i)%this._neighbours.length;this._neighbours[r]=t,r=ks(this._neighbours,r),this._neighbours[r]=e}setBefore(t,e){const i=this._neighbours.indexOf(t);this._neighbours[As(this._neighbours,i)]=e}setAfter(t,e){const i=this._neighbours.indexOf(t);this._neighbours[ks(this._neighbours,i)]=e}getPrevNeighbor(t){const e=this._neighbours.indexOf(t);return Ss(this._neighbours,e)}getNextNeighbor(t){const e=this._neighbours.indexOf(t);return Ts(this._neighbours,e)}}const zs=Oi(-1,-1,-1);class Cs extends Is{constructor(t){super(t,zs,-1)}static isHoleNode(t){return t instanceof Cs}}const Os=Oi(0,0,0),Es=Oi(0,0,0),Ms={type:0,valence:0,shift:0};function Bs(t,e,i,s){Cs.isHoleNode(t)||Cs.isHoleNode(e)||Cs.isHoleNode(i)||s.writeIndices([t.index,e.index,i.index])}const Ls=(t,e)=>t-e;function Us(t,e){const i=new Array(t.length);for(let n=0,o=t.length;o>0;){if(i[n]=t[n].calculateSpan(Ss(t,n),Ts(t,n)),i[n]>1)n=ks(t,n),o--;else if(1===i[n]){const s=t[n],r=Ss(t,n),a=Ts(t,n);a.setAfter(s,r),r.setBefore(s,a),Bs(s,r,a,e);for(let t=n;t<i.length-1;t++)i[t]=i[t+1];t.splice(n,1),n=As(t,n),o++}else Se(t,t.length-ks(t,n)),t.splice(t.length-2,2),n=0,o=t.length;if(t.length<3)return}let s=0,r=[i[s],i[As(t,s)],i[ks(t,s)]];for(let n=1;n<t.length;n++){const e=[i[n],i[As(t,n)],i[ks(t,n)]];Pe(Ls,e,r)<0&&(r=e,s=n)}Se(t,t.length-s)}function Ds(t,e,i,s,r,n){s.setNeighbors(e,i,r,n),e.setAfter(i,s),i.setBefore(e,s),Bs(s,e,i,t)}function js(t,e,i,s,r){const n=e[0],o=n[0],a=n[n.length-1];switch(t.type){case 0:{const e=o.getPrevNeighbor(a);let l;Cs.isHoleNode(o)||Cs.isHoleNode(a)||Cs.isHoleNode(e)?l=Cs.isHoleNode(o)?a.vertex:o.vertex:(Mi(a.vertex,o.vertex,Es),Bi(Es,e.vertex,Es),s.clamp(Es,Es),l=Es),i.readDiff(Os),Mi(l,Os,Es);const h=Ei(Es),c=s.decode(h),d=new Is(t.valence,h,r.writeVertex(c));Ds(r,o,a,d,0),n.push(d);break}case 1:{const e=new Cs(t.valence);Ds(r,o,a,e,0),n.push(e);break}case 2:{const i=t.shift;Ds(r,o,a,n[i],t.valence,n[i-1]),e.push(n.slice(0,i+1)),n.splice(0,i);break}case 3:{let i=1;for(;i!==e.length&&e[i].length<=t.shift;i++)t.shift-=e[i].length;Se(e[i],e[i].length-t.shift),Ds(r,o,a,e[i][0],t.valence,e[i][e[i].length-1]),e[i].push(e[i][0]),n.splice(0,0,...e[i]),e.splice(i,1);break}}}function Ns(t,e,i){const s=[function(t,e,i){const s=Oi(0,0,0),r=new Array(3);for(let n=0;n<3;n++){const o=t.readCommand();1===o.type?r[n]=new Cs(o.valence):0===o.type&&(t.readDiff(Os),Mi(s,Os,s),r[n]=new Is(o.valence,Ei(s),i.writeVertex(e.decode(s))))}for(let n=0;n<r.length;n++)r[n].setNeighbors(Ts(r,n),Ss(r,n));return Bs(r[0],r[1],r[2],i),r}(t,e,i)];for(;0!==s.length;){for(Us(s[0],i);s[0].length>2;)js(t.readCommand(Ms),s,t,e,i),Us(s[0],i);s.shift()}return i.flush()}class Vs{constructor(t){this._precisionXY=15&t,this._precisionZ=t>>4,this._shiftXY=16-this._precisionXY,this._shiftZ=16-this._precisionZ,this._maxXY=(1<<this._precisionXY)-1,this._maxZ=(1<<this._precisionZ)-1}clamp(t,e=Oi(0,0,0)){return e.x=B(t.x,0,this._maxXY),e.y=B(t.y,0,this._maxXY),e.z=B(t.z,0,this._maxZ),e}decode(t,e=Oi(0,0,0)){return e.x=Vs._decode(t.x,this._precisionXY,this._shiftXY),e.y=Vs._decode(t.y,this._precisionXY,this._shiftXY),e.z=Vs._decode(t.z,this._precisionZ,this._shiftZ),e}static _decode(t,e,i){return t<<=i,t=(t|=t>>e)/65535}}class Ws extends ws{constructor(t){super(t),this._trimeshWriter={writeVertex:t=>{const e=this._currentMesh;if(e){const i=e.bbox;return t.x=U(i.minX,i.maxX,t.x),t.y=U(i.minY,i.maxY,t.y),t.z=U(i.maxZ,i.minZ,t.z),this.writeVertex(t,this._currentColor,e.id)}return-1},writeIndices:t=>this.writeIndices(t),flush:()=>this.endMesh()}}writeModel(t,e){this._currentMesh=e,this._currentColor=pt(e.color);const i=[];let s;for(const r of function*(t,e){const i=new Ps(t),s=new Vs(i.header.precision);for(;i.hasCommands();)yield Ns(i,s,e)}(t,this._trimeshWriter))s?s.bufferId===r.bufferId?(s.vertexByteLength+=r.vertexByteLength,s.indexByteLength+=r.indexByteLength):(i.push(s),s=r):s=r;return i.push(s),i}}class qs extends ws{writePolygon(t,e,i,s){const r=pt(i),n=t.vertexRings.reduce((t,e)=>(t.push(...e),t),[]);for(const o of n)this.writeVertex(Object.assign(Object.assign({},o),{z:e}),r,s);for(const o of n)this.writeVertex(Object.assign(Object.assign({},o),{z:0}),r,s);return this.writeIndices(hs(t.vertexRings)),this._buildWall(t.vertexRings,n.length),this.endMesh()}_buildWall(t,e){let i=0;for(const s of t){for(let t=0;t<s.length;t++){const r=i+t,n=i+(t+1)%s.length;this.writeIndices([r+e,n,r,r+e,n+e,n])}i+=s.length}}}function Fs(t,e){let i;return()=>{i&&setTimeout(t=>t.release(),0,i),i=t.getFreeOrCreatePage(e),i.retain();const s=t=>{t.release(),t.onRetain.removeListener(s)};return i.retain(),i.onRetain.addListener(s),i.data}}class Ys{constructor(t,e,i,s,r,n,o){this._registry=t,this._glyphAtlasRegistry=e,this._iconAtlasRegistry=i,this._taskQueue=r,this._loadManager=n,this._taskPriority=o,this._objectIdProvider=s,this._opaquePolygonBufferWriter=new cs(Fs(t,ps)),this._transparentPolygonBufferWriter=new cs(Fs(t,ps)),this._extrudedPolygonWriter=new qs(Fs(t,ms)),this._trimeshBufferWriter=new Ws(Fs(t,ms)),this._polylineBufferWriter=new He(Fs(t,Xe)),this._pointLabelBufferWriter=new ds(Fs(t,_s)),this._curvedLabelBufferWriter=new us(Fs(t,gs)),this._iconBufferWriter=new fs(Fs(t,ys)),this._sharedResourcesExtractors=[bs.bind(void 0,this._registry),xs.bind(void 0,this._glyphAtlasRegistry),vs.bind(void 0,this._iconAtlasRegistry)]}_extractSharedResources(t){const e=[];for(const i of this._sharedResourcesExtractors)e.push(...i(t));return e}}class Xs{constructor(t){this._objectIdProvider=t,this._ids=new Map,this._tileIds=new Map}createSharedIdProvider(t){return{idGenerator:e=>this._getObjectId(t,e),collidingIdGenerator:e=>this._getCollidingObjectId(t,e)}}releaseTileObjectIds(t){const e=this._tileIds.get(t);if(e){this._tileIds.delete(t);for(const t of e)this._releaseId(t)}}_getObjectId(t,e){return this._getId(t,e,this._objectIdProvider.idGenerator)}_getCollidingObjectId(t,e){return this._getId(t,e,this._objectIdProvider.collidingIdGenerator)}_getId(t,e,i){if(!e)return i();return this._addIdToTile(t,e),this._retainId(e,i).id}_addIdToTile(t,e){let i=this._tileIds.get(t);i||(i=[],this._tileIds.set(t,i)),i.push(e)}_retainId(t,e){let i=this._ids.get(t);return i?i.count++:(i={id:e(),count:1},this._ids.set(t,i)),i}_releaseId(t){const e=this._ids.get(t);e?(e.count--,0===e.count&&this._ids.delete(t)):console.warn("Tried to release non-existing id")}}function Gs(t){if("function"!=typeof t)throw new Error("Predicate must be a function");return`(${t.toString()})`}const Zs=Gs((t,e)=>{var i,s;return(null===(i=t)||void 0===i?void 0:i.get("objectId"))===(null===(s=e)||void 0===s?void 0:s.get("objectId"))}),Hs={tileUrlTemplate:"no tileUrlTemplate specified",meshUrlTemplate:"no meshUrlTemplate specified",tileSize:0,mapMode:0,customizationConfig:[],objectsCollisionPriority:1,polygonsBatchingRule:Zs,modelsBatchingRule:Gs((t,e)=>{var i,s,r,n;return(null===(i=t)||void 0===i?void 0:i.get("objectId"))===(null===(s=e)||void 0===s?void 0:s.get("objectId"))&&(null===(r=t)||void 0===r?void 0:r.get("indoor_covered"))===(null===(n=e)||void 0===n?void 0:n.get("indoor_covered"))}),polylinesBatchingRule:Zs,labelsBatchingRule:Zs,tileRequestWithCredentials:!1,meshRequestWithCredentials:!1,allObjectsInteractive:!1};class Ks extends Ys{constructor(t,e,i,s,r,n,o,a,l,h,c){super(s,r,n,a,l,h,c),this._communicator=t,this._storage=e,this._modelStorage=i,this._viewport=o,this._requests=new Map,this._modelRequests=new Map,this._options=Object.assign({},Hs),this._tileLoader=new xi(this._loadManager,this._storage),this._stylesCustomizer=new os,this._objectIdManager=new Xs(a),this._communicator.onMessage.addListener(this._onMessage,this),this._storage.onAdded.addListener(this._onTileAdded,this),this._storage.onRemoved.addListener(this._onTileRemoved,this),this._modelStorage.onRemoved.addListener(this._onModelRemoved,this)}destructor(){this._modelStorage.onRemoved.removeListener(this._onModelRemoved),this._storage.onRemoved.removeListener(this._onTileRemoved),this._storage.onAdded.removeListener(this._onTileAdded),this._communicator.onMessage.removeListener(this._onMessage)}_createTileRequest(t,e){const i=this._objectIdManager.createSharedIdProvider(t.id);return new ui(t,e,this._taskQueue,this._tileLoader,this._viewport,this._taskPriority,this._opaquePolygonBufferWriter,this._transparentPolygonBufferWriter,this._extrudedPolygonWriter,this._polylineBufferWriter,this._pointLabelBufferWriter,this._curvedLabelBufferWriter,this._iconBufferWriter,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,i,this._stylesCustomizer)}_onMessage(t){switch(t.type){case 0:this._onSetup(t);break;case 2:this._onCustomize(t)}}_setOptions(t){this._options=Object.assign(Object.assign({},Hs),t)}_onSetup(t){this._setOptions(t.options),this._tileLoader.update(this._options.tileUrlTemplate,this._options.tileSize,this._options.tileRequestWithCredentials)}_onCustomize(t){this._stylesCustomizer.update(t.customizationConfig)}_onTileAdded(t){const e=this._createTileRequest(t,this._options);this._requests.set(t.id,e),e.onContentReady.addListener(e=>this._onTileContentReady(t,e)),e.onModelRequired.addListener(e=>this._onModelRequired(t,e)),e.start()}_onTileRemoved(t){const e=this._requests.get(t.id);fi(e)&&(e.destructor(),this._requests.delete(t.id)),this._objectIdManager.releaseTileObjectIds(t.id)}_onModelRemoved(t){const e=this._modelRequests.get(t.id);fi(e)&&(e.destructor(),this._modelRequests.delete(t.id))}_onTileContentReady(t,e){e.contentToRemove&&this._communicator.sendMessage({type:4,tileId:t.id,content:e.contentToRemove},!1),t.addContent(e.content,this._extractSharedResources(e.content.primitives)),this._registry.flushBackendUpdates(),this._iconAtlasRegistry.flushAtlasesUpdates(),this._communicator.sendMessage({type:3,tileId:t.id,content:e.content,metrics:e.metrics},!0)}_onModelContentReady(t,e){const i=[];for(const s of this._sharedResourcesExtractors)i.push(...s(e.primitives));t.addContent({content:e,resources:i}),this._registry.flushBackendUpdates(),this._communicator.sendMessage({type:5,modelId:t.id,content:e},!0)}_onModelRequired(t,e){if(this._options.meshUrlTemplate){const i=ni(e);let s=this._modelStorage.get(i);s||(s=new bi(i,e),this._modelStorage.add(i,s));let r=this._modelRequests.get(i);r||(r=new yi(s,this._taskQueue,this._loadManager,this._viewport,this._taskPriority,this._trimeshBufferWriter,this._options.meshUrlTemplate,this._options.meshRequestWithCredentials),this._modelRequests.set(s.id,r),r.onContentReady.addListener(t=>this._onModelContentReady(s,t)),r.start()),r.addTile(t),t.addContent(s,[s])}}}var Qs;!function(t){t[t.FROM_BACKEND_ADD_PAGE=0]="FROM_BACKEND_ADD_PAGE",t[t.FROM_BACKEND_UPDATE_PAGE=1]="FROM_BACKEND_UPDATE_PAGE",t[t.FROM_BACKEND_REMOVE_PAGE=2]="FROM_BACKEND_REMOVE_PAGE"}(Qs||(Qs={}));Error;class $s{constructor(t,e){this._wordByteSize=e,this._nextWordOffset=0,this._currentMeshByteOffset=0,this._uint8View=new Uint8Array(t)}get data(){return this._uint8View.buffer}get byteSize(){return this._uint8View.byteLength}get occupiedByteSize(){return this._nextWordOffset*this._wordByteSize}endMesh(){const t=this._currentMeshByteOffset,e=this.occupiedByteSize,i=e-t;return this._currentMeshByteOffset=e,{byteOffset:t,byteSize:i}}transferUnfinishedMesh(t){const e=this.occupiedByteSize,i=e-this._currentMeshByteOffset,s=this._uint8View.subarray(this._currentMeshByteOffset,e);t._uint8View.set(s,0),t._nextWordOffset=i/this._wordByteSize,this._nextWordOffset=this._currentMeshByteOffset/this._wordByteSize}reset(){this._nextWordOffset=0,this._currentMeshByteOffset=0}}class Js extends $s{constructor(t,e){super(t*e,Uint32Array.BYTES_PER_ELEMENT),this.vertexByteSize=e,this._uint32View=new Uint32Array(this._uint8View.buffer),this._float32View=new Float32Array(this._uint8View.buffer),this._currentMeshBaseIndex=0}get currentMeshBaseIndex(){return this._currentMeshBaseIndex}get isFull(){return this._nextWordOffset>=this._uint32View.length}pushUint32(t){this._uint32View[this._nextWordOffset++]=t}pushFloat32(t){this._float32View[this._nextWordOffset++]=t}asUint32Array(){return this._uint32View.subarray(0,this._nextWordOffset)}endMesh(){return this._currentMeshBaseIndex=this.occupiedByteSize/this.vertexByteSize,super.endMesh()}reset(){this._currentMeshBaseIndex=0,super.reset()}}class tr extends $s{constructor(t){const e=Uint16Array.BYTES_PER_ELEMENT;super(t*e,e),this._uint16View=new Uint16Array(this._uint8View.buffer)}get size(){return this._uint16View.length}get occupiedSize(){return this._nextWordOffset}push(t){this._uint16View[this._nextWordOffset++]=t}asUint16Array(){return this._uint16View.subarray(0,this._nextWordOffset)}transferUnfinishedMesh(t,e=0){if(super.transferUnfinishedMesh(t),e)for(let i=0;i<t._nextWordOffset;i++)t._uint16View[i]-=e}}class er{constructor(t,e,i,r){this.id=t,this.vertexBuffer=new Js(e,i),this.indexBuffer=new tr(r),this.onMeshWritten=this._onMeshWritten=new s}writeVertexUint32(t){this.vertexBuffer.pushUint32(t)}writeVertexFloat32(t){this.vertexBuffer.pushFloat32(t)}writeIndices(t){const e=this.vertexBuffer.currentMeshBaseIndex;for(const i of t)this.indexBuffer.push(e+i)}endMesh(){const t=this.vertexBuffer.endMesh(),e=this.indexBuffer.endMesh(),i={vertexByteOffset:t.byteOffset,vertexByteLength:t.byteSize,indexByteOffset:e.byteOffset,indexByteLength:e.byteSize,bufferId:this.id};return this._onMeshWritten.fire(i),i}reset(){this.vertexBuffer.reset(),this.indexBuffer.reset()}}const ir={vertexMinByte:Number.MAX_SAFE_INTEGER,vertexMaxByte:Number.MIN_SAFE_INTEGER,indexMinByte:Number.MAX_SAFE_INTEGER,indexMaxByte:Number.MIN_SAFE_INTEGER};class sr extends mi{constructor(t,e,i,r,n){super(),this.id=t,this.attribMapping=e,this.data=new er(t,i,r,n),this.data.onMeshWritten.addListener(this._onMeshWritten,this),this.onUpdate=this._onUpdate=new s,this._updatedRegion=Object.assign({},ir)}reset(){this.data.reset(),this.flushUpdatedRegion()}touch(t){this._onMeshWritten(t)}flushUpdatedRegion(){const t=this._updatedRegion;return this._updatedRegion=Object.assign({},ir),t}_onMeshWritten(t){t.vertexByteOffset<this._updatedRegion.vertexMinByte&&(this._updatedRegion.vertexMinByte=t.vertexByteOffset);const e=t.vertexByteOffset+t.vertexByteLength;e>this._updatedRegion.vertexMaxByte&&(this._updatedRegion.vertexMaxByte=e),t.indexByteOffset<this._updatedRegion.indexMinByte&&(this._updatedRegion.indexMinByte=t.indexByteOffset);const i=t.indexByteOffset+t.indexByteLength;i>this._updatedRegion.indexMaxByte&&(this._updatedRegion.indexMaxByte=i),this._onUpdate.fire(this)}}class rr{constructor(t){this._communicator=t,this._updatedPages=new Set,this._pages=new Map,this._freePages=new Map,this._lastGeneratedPageId=0}getPage(t){return this._pages.get(t)}getFreeOrCreatePage(t){const e=this._freePages.get(t),i=e&&e.pop();if(i)return i.reset(),i;{const e=this._generateId(),i=new sr(e,t,65536,t.vertexByteSize,131072);return i.onUpdate.addListener(this._onPageUpdated,this),i.onReleased.addListener(this._onPageReleased,this),this._pages.set(e,i),this._communicator.sendMessage({type:Qs.FROM_BACKEND_ADD_PAGE,id:e,attribMapping:t,vertexDataByteSize:i.data.vertexBuffer.byteSize,indexDataByteSize:i.data.indexBuffer.byteSize},!1),i}}flushBackendUpdates(){for(const t of this._updatedPages){const{vertexMinByte:e,vertexMaxByte:i,indexMinByte:s,indexMaxByte:r}=t.flushUpdatedRegion(),n=t.data.vertexBuffer.data.slice(e,i),o=t.data.indexBuffer.data.slice(s,r);this._communicator.sendMessage({type:Qs.FROM_BACKEND_UPDATE_PAGE,id:t.id,vertexData:n,vertexByteOffset:e,indexData:o,indexByteOffset:s},!1,n,o)}this._updatedPages.clear()}_onPageUpdated(t){this._updatedPages.add(t)}_onPageReleased(t){const e=this._freePages.get(t.attribMapping);e?e.push(t):this._freePages.set(t.attribMapping,[t])}_generateId(){return this._lastGeneratedPageId++}}function nr(t){return(t+1>>1)-1}function or(t){return(t+1<<1)-1}class ar{constructor(t=ke){this._items=[],this._comparator=t}insert(t){const e=this._items,i=this._comparator;let s=e.push(t)-1,r=nr(s);for(;r>-1&&i(e[s],e[r])>0;)Ae(e,s,r),s=r,r=nr(s)}pop(){const t=this._items;if(0===t.length)return;const e=t[0];return this._removeByIndex(0),e}peek(){return this._items[0]}*[Symbol.iterator](){for(const t of this._items)yield t}get size(){return this._items.length}remove(t){const e=this._items.findIndex(t);-1!=e&&this._removeByIndex(e)}_restoreOrderDownward(t){let e=t,i=or(e);const s=this._items.length,r=this._comparator,n=this._items;for(;i<s&&(i+1<s&&r(n[i],n[i+1])<0&&(i+=1),!(r(n[e],n[i])>0));)Ae(n,e,i),e=i,i=or(i)}_removeByIndex(t){Ae(this._items,t,this._items.length-1),this._items.pop(),this._restoreOrderDownward(t)}}function lr(t,e){return t.priority-e.priority}class hr{constructor(){this._heap=new ar(lr)}enqueue(t){this._heap.insert(t)}dequeue(){return this._heap.pop()}peek(){return this._heap.peek()}isEmpty(){return 0===this._heap.size}get size(){return this._heap.size}remove(t){this._heap.remove(t)}}class cr extends class{constructor(){this._listeners=new Set}addListener(t){this._listeners.add(t)}removeListener(t){this._listeners.delete(t)}fire(t){this._listeners.forEach(e=>{e(t)})}}{fire(){super.fire(void 0)}}class dr{constructor(t=50){this._queue=new hr,this._frozen=!1,this._dequeueTimeoutHandle=0,this.onEmpty=new cr,this.onAdd=new cr,this._maxDequeueDuration=t}destroy(){clearTimeout(this._dequeueTimeoutHandle)}enqueue(t){return this.onAdd.fire(),this._frozen||this._setDequeueTimeout(),new Promise((e,i)=>{this._queue.enqueue({execute(){try{t.execute(),e()}catch(s){i(s)}},priority:t.priority})})}enqueueSync(t){this._queue.enqueue(t),this._setDequeueTimeout()}remove(t){this._queue.remove(e=>e===t)}isEmpty(){return this._queue.isEmpty()}freeze(){this._dequeueTimeoutHandle&&(clearTimeout(this._dequeueTimeoutHandle),this._dequeueTimeoutHandle=0),this._frozen=!0}unfreeze(){this._frozen=!1,this._queue.isEmpty()||this._setDequeueTimeout()}_dequeue(){if(this._dequeueTimeoutHandle=0,null===this._maxDequeueDuration)for(;this._queue.size;)this._queue.dequeue().execute();else{const t=_e();for(;this._queue.size&&(this._queue.dequeue().execute(),!(_e()-t>this._maxDequeueDuration)););}this._queue.isEmpty()?this.onEmpty.fire():this._setDequeueTimeout()}_setDequeueTimeout(){this._dequeueTimeoutHandle||(this._dequeueTimeoutHandle=setTimeout(()=>this._dequeue(),0))}}var ur;function fr(t=0,e=0){return{width:t,height:e}}!function(t){t[t.TO_BACKEND_SETUP=0]="TO_BACKEND_SETUP",t[t.FROM_BACKEND_ADD_ATLAS=1]="FROM_BACKEND_ADD_ATLAS",t[t.FROM_BACKEND_UPDATE_ATLAS=2]="FROM_BACKEND_UPDATE_ATLAS",t[t.FROM_BACKEND_REMOVE_ATLAS=3]="FROM_BACKEND_REMOVE_ATLAS"}(ur||(ur={}));class pr{constructor(t,e){this.width=t,this.height=e,this._cursor={x:0,y:0,lineHeight:0}}createRestorePoint(){return Object.assign({},this._cursor)}resetToRestorePoint(t){Object.assign(this._cursor,t)}allocate(t,e){const{x:i,y:s,lineHeight:r}=this._cursor,n=this.width-i,o=this.height-s;if(t<=n&&e<=o)return this._cursor.x=i+t,this._cursor.lineHeight=Math.max(r,e),{minX:i,maxX:i+t,minY:s,maxY:s+e};const a=this.height-(s+r);return t<=this.width&&e<=a?(this._cursor.x=t,this._cursor.y=s+r,this._cursor.lineHeight=e,{minY:this._cursor.y,maxY:this._cursor.y+e,minX:0,maxX:t}):void 0}}const _r={minX:Number.MAX_SAFE_INTEGER,maxX:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,maxY:Number.MIN_SAFE_INTEGER};class gr extends mi{constructor(t,e,i){super(),this.id=t,this.width=e,this.height=i,this.data=this._data=new Uint8Array(e*i),this.allocatedGlyphs=this._allocatedGlyphs=new Map,this.allocatedRanges=new xe,this._allocator=new pr(e,i),this._initAllocatorState=this._allocator.createRestorePoint(),this._updatedRegion=Object.assign({},_r)}allocate(t,e){const i=this._allocator.createRestorePoint(),s=new Map;for(const[r,n]of t){const t=e.get(r);if(fi(t)){const e=p(s,r,()=>new Set);for(const[s,o]of n)if(!this.allocatedRanges.contains(r,s)){const r=Math.min(o,t.glyphs.length);for(let n=s;n<r;++n){const s=t.glyphs[n];if(fi(s)){const r=this._allocator.allocate(s.width+2*t.margin,s.height+2*t.margin);if(!r)return this._allocator.resetToRestorePoint(i),!1;e.add({glyph:s,location:r})}}}}}for(const[r,n]of s){const t=p(this._allocatedGlyphs,r,()=>[]);for(const i of n)t[i.glyph.id]=i.location,this._insertGlyphBitmap(i.location,i.glyph.bitmap);this.allocatedRanges.addRangesForGlyphs(r,...Object(X.c)(n,t=>t.glyph.id));const e=this._computeUpdatedRegion(Object(X.c)(n,t=>t.location));e&&(this._updatedRegion=this._computeUpdatedRegion([e,this._updatedRegion]))}return!0}flushUpdates(){if(this._updatedRegion.minX!==_r.minX){const t=this._updatedRegion.maxX-this._updatedRegion.minX,e=this._updatedRegion.maxY-this._updatedRegion.minY,i=new Uint8Array(t*e);let s=0;for(let a=this._updatedRegion.minY;a<this._updatedRegion.maxY;++a)for(let t=this._updatedRegion.minX;t<this._updatedRegion.maxX;++t)i[s]=this._data[a*this.width+t],++s;const r=this._updatedRegion,n=g(r.minX,r.minY),o=fr(r.maxX-r.minX,r.maxY-r.minY);return this._updatedRegion=Object.assign({},_r),{offset:n,size:o,data:i}}}reset(){this._allocatedGlyphs.clear(),this.allocatedRanges.clear(),this._allocator.resetToRestorePoint(this._initAllocatorState),this._updatedRegion=Object.assign({},_r)}_insertGlyphBitmap(t,e){const i=this.width;let s=0;for(let r=t.minY;r<t.maxY;++r)for(let n=t.minX;n<t.maxX;++n)this._data[r*i+n]=e[s],++s}_computeUpdatedRegion(t){const e=function(t){let e;for(const i of t)e?(i.minX<e.minX&&(e.minX=i.minX),i.maxX>e.maxX&&(e.maxX=i.maxX),i.minY<e.minY&&(e.minY=i.minY),i.maxY>e.maxY&&(e.maxY=i.maxY)):e=Object.assign({},i);return e}(t);return e?{minY:e.minY,maxY:e.maxY,minX:4*Math.floor(e.minX/4),maxX:4*Math.ceil(e.maxX/4)}:void 0}}const yr={glyphRangeUrlTemplate:"no url for glyph ranges",glyphRequestWithCredentials:!1};class mr{constructor(t,e,i=2048,s=2048){this._communicator=t,this._fontLoader=e,this._atlasWidth=i,this._atlasHeight=s,this._loadedFontsAsRanges=new xe,this._atlases=[],this._freeAtlases=[],this.loadedFonts=this._loadedFonts=new Map,this._options=Object.assign({},yr),this._communicator.onMessage.addListener(this._onMessage,this)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}getAtlas(t){return this._atlases[t]}hasAllGlyphsLoaded(t){return this._loadedFontsAsRanges.containsAll(t)}getAtlasWithGlyphs(t){return this._getAtlas(t)}loadGlyphsAndGetAtlas(t,e){const i=[];for(const[s,r]of t)for(const[t,n]of r)this._loadedFontsAsRanges.contains(s,t)||i.push(this._loadRange(s,t,n,e));return Promise.all(i).then(()=>this._getAtlas(t))}_onMessage(t){switch(t.type){case ur.TO_BACKEND_SETUP:this._onSetup(t)}}_onSetup(t){Object.assign(this._options,t.options)}_loadRange(t,e,i,s){let r=this._loadedFonts.get(t);r||(r={id:t,xheight:-1,margin:-1,glyphs:[]},this._loadedFonts.set(t,r));const n=this._options.glyphRangeUrlTemplate.replace("{{hostAlias}}",pi(t+e)).replace("{{fontId}}",t).replace("{{range}}",e+","+i),o=this._options.glyphRequestWithCredentials;return this._fontLoader.fillFont(n,r,e,s,{withCredentials:o}).then(()=>{this._loadedFontsAsRanges.addRangesForGlyphs(t,e)})}_getAtlas(t){for(const i of this._atlases)if(i.allocatedRanges.containsAll(t))return i;const e=this._atlases[this._atlases.length-1];if(e&&e.allocate(t,this._loadedFonts)){const t=e.flushUpdates();return fi(t)&&this._communicator.sendMessage(Object.assign({type:ur.FROM_BACKEND_UPDATE_ATLAS,atlasId:e.id},t),!1,t.data.buffer),e}{let e=this._freeAtlases.pop();if(!e){const t=new gr(this._atlases.length,this._atlasWidth,this._atlasHeight);t.onReleased.addListener(()=>{t.reset(),this._freeAtlases.push(t)}),this._atlases.push(t),this._communicator.sendMessage({type:ur.FROM_BACKEND_ADD_ATLAS,atlasId:t.id,width:t.width,height:t.height},!1),e=t}if(e.allocate(t,this._loadedFonts)){const t=e.flushUpdates();return t&&this._communicator.sendMessage(Object.assign({type:ur.FROM_BACKEND_UPDATE_ATLAS,atlasId:e.id},t),!1),e}throw new Error("Couldnt allocate glyphs in atlas")}}}i(32);const br=new TextDecoder("utf-8");const xr=new TextEncoder;class vr{constructor(t=8192,e={}){let i=!1;"number"==typeof t?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const s=e.offset?e.offset>>>0:0,r=t.byteLength-s;let n=s;(ArrayBuffer.isView(t)||t instanceof vr)&&(t.byteLength!==t.buffer.byteLength&&(n=t.byteOffset+s),t=t.buffer),this.lastWrittenByte=i?r:0,this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=n,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,n,r),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),i=new Uint8Array(e);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let i=0;i<t;i++)e[i]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(t=1){return e=this.readBytes(t),br.decode(e);var e}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(function(t){return xr.encode(t)}(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}var wr=i(5);const kr=[137,80,78,71,13,10,26,10],Ar=[];for(let jn=0;jn<256;jn++){let t=jn;for(let e=0;e<8;e++)1&t?t=3988292384^t>>>1:t>>>=1;Ar[jn]=t}function Tr(t,e){return(4294967295^function(t,e,i){let s=t;for(let r=0;r<i;r++)s=Ar[255&(s^e[r])]^s>>>8;return s}(4294967295,t,e))>>>0}var Sr,Rr,Pr,Ir;!function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(Sr||(Sr={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"}(Rr||(Rr={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"}(Pr||(Pr={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"}(Ir||(Ir={}));const zr=new Uint8Array(0),Cr=new Uint16Array([255]),Or=255===new Uint8Array(Cr.buffer)[0];class Er extends vr{constructor(t,e={}){super(t);const{checkCrc:i=!1}=e;this._checkCrc=i,this._inflator=new wr.Inflate,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=Rr.UNKNOWN,this._filterMethod=Pr.UNKNOWN,this._interlaceMethod=Ir.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<kr.length;t++)if(this.readUint8()!==kr[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${kr[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),i=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-i!==t)throw new Error("Length mismatch while decoding chunk "+e);if(this._checkCrc){const i=this.readUint32(),s=t+4,r=Tr(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(r!==i)throw new Error(`CRC mismatch for chunk ${e}. Expected ${i}, found ${r}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=function(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error("invalid bit depth: "+t);return t}(this.readUint8());const e=this.readUint8();let i;switch(this._colorType=e,e){case Sr.GREYSCALE:i=1;break;case Sr.TRUECOLOUR:i=3;break;case Sr.INDEXED_COLOUR:i=1;break;case Sr.GREYSCALE_ALPHA:i=2;break;case Sr.TRUECOLOUR_ALPHA:i=4;break;default:throw new Error("Unknown color type: "+e)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==Rr.DEFLATE)throw new Error("Unsupported compression method: "+this._compressionMethod);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!=0)throw new RangeError("PLTE field length must be a multiple of 3. Got "+t);const e=t/3;this._hasPalette=!0;const i=[];this._palette=i;for(let s=0;s<e;s++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t),!1),this.skip(t)}decodetRNS(t){if(3===this._colorType){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255)}}decodetEXt(t){let e,i="";for(;"\\0"!==(e=this.readChar());)i+=e;this._png.text[i]=this.readChars(t-i.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),i=this.readByte();this._png.resolution={x:t,y:e,unit:i}}decodeImage(){if(this._inflator.push(zr,!0),this._inflator.err)throw new Error("Error while decompressing the data: "+this._inflator.err);const t=this._inflator.result;if(this._filterMethod!==Pr.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==Ir.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(t)}decodeInterlaceNull(t){const e=this._png.height,i=this._png.channels*this._png.depth/8,s=this._png.width*i,r=new Uint8Array(this._png.height*s);let n,o,a=zr,l=0;for(let c=0;c<e;c++){switch(n=t.subarray(l+1,l+1+s),o=r.subarray(c*s,(c+1)*s),t[l]){case 0:Mr(n,o,s);break;case 1:Br(n,o,s,i);break;case 2:Lr(n,o,a,s);break;case 3:Ur(n,o,a,s,i);break;case 4:Dr(n,o,a,s,i);break;default:throw new Error("Unsupported filter: "+t[l])}a=o,l+=s+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.depth){const t=new Uint16Array(r.buffer);if(Or)for(let e=0;e<t.length;e++)t[e]=(255&(h=t[e]))<<8|h>>8&255;this._png.data=t}else this._png.data=r;var h}}function Mr(t,e,i){for(let s=0;s<i;s++)e[s]=t[s]}function Br(t,e,i,s){let r=0;for(;r<s;r++)e[r]=t[r];for(;r<i;r++)e[r]=t[r]+e[r-s]&255}function Lr(t,e,i,s){let r=0;if(0===i.length)for(;r<s;r++)e[r]=t[r];else for(;r<s;r++)e[r]=t[r]+i[r]&255}function Ur(t,e,i,s,r){let n=0;if(0===i.length){for(;n<r;n++)e[n]=t[n];for(;n<s;n++)e[n]=t[n]+(e[n-r]>>1)&255}else{for(;n<r;n++)e[n]=t[n]+(i[n]>>1)&255;for(;n<s;n++)e[n]=t[n]+(e[n-r]+i[n]>>1)&255}}function Dr(t,e,i,s,r){let n=0;if(0===i.length){for(;n<r;n++)e[n]=t[n];for(;n<s;n++)e[n]=t[n]+e[n-r]&255}else{for(;n<r;n++)e[n]=t[n]+i[n]&255;for(;n<s;n++)e[n]=t[n]+jr(e[n-r],i[n],i[n-r])&255}}function jr(t,e,i){const s=t+e-i,r=Math.abs(s-t),n=Math.abs(s-e),o=Math.abs(s-i);return r<=n&&r<=o?t:n<=o?e:i}var Nr;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(Nr||(Nr={}));class Vr{constructor(t){this._comparator=t,this._size=0}get root(){return this._root}get size(){return this._size}get min(){if(this._root)return this._min(this._root).value}get max(){if(this._root)return this._max(this._root).value}insert(t){if(this._size++,!this._root)return this._root={value:t},this._root;let e=this._root;for(;e;)if(this._comparator(t,e.value)<0){if(!e.left)return e.left={parent:e,value:t};e=e.left}else{if(!e.right)return e.right={parent:e,value:t};e=e.right}throw new Error}remove(t){if(this._size--,t.left&&t.right){const e=this._min(t.right);this._replaceSubtree(t,e),t.left&&(e.left=t.left,t.left.parent=e),t.right&&(e.right=t.right,t.right.parent=e)}else t.left?this._replaceSubtree(t,t.left):t.right?this._replaceSubtree(t,t.right):this._replaceSubtree(t,void 0)}*values(t){t&&(yield*this.values(t.left),yield t.value,yield*this.values(t.right))}[Symbol.iterator](){return this.values(this._root)}_min(t){let e=t;for(;e.left;)e=e.left;return e}_max(t){let e=t;for(;e.right;)e=e.right;return e}_replaceSubtree(t,e){t.parent?t.parent.left===t?t.parent.left=e:t.parent.right===t&&(t.parent.right=e):this._root=e,e&&(e.parent&&(e.parent.left===e?e.parent.left=void 0:e.parent.right===e&&(e.parent.right=void 0)),e.parent=t.parent)}}class Wr{constructor(){this._nodes=new Map}get begin(){return this._begin&&this._begin.value}get end(){return this._end&&this._end.value}insert(t){if(!this._nodes.has(t)){const e={value:t};this._end?this.insertAfter(this._end.value,t):(this._begin=this._end=e,this._nodes.set(t,e))}}insertBefore(t,e){const i=this._nodes.get(t);if(i&&!this._nodes.has(e)){const t={value:e};i.prev&&(i.prev.next=t,t.prev=i.prev),t.next=i,i.prev=t,this._nodes.set(e,t),i===this._begin&&(this._begin=t)}}insertAfter(t,e){const i=this._nodes.get(t);if(i&&!this._nodes.has(e)){const t={value:e};i.next&&(i.next.prev=t,t.next=i.next),t.prev=i,i.next=t,this._nodes.set(e,t),i===this._end&&(this._end=t)}}remove(t){const e=this._nodes.get(t);e&&(e===this._begin&&(this._begin=e.next),e===this._end&&(this._end=e.prev),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next),this._nodes.delete(t))}getPrev(t){const e=this._nodes.get(t);if(e&&e.prev)return e.prev.value}getNext(t){const e=this._nodes.get(t);if(e&&e.next)return e.next.value}*values(){let t=this._begin;for(;t;)yield t.value,t=t.next}[Symbol.iterator](){return this.values()}}class qr{constructor(t,e=1){this._size=t,this._alignment=e,this._freeOffset=0,this._allocatedOffsets=new Set}get size(){return this._size}get maxAllocableSize(){return this._size-this._freeOffset}get isEmpty(){return 0===this._allocatedOffsets.size}allocate(t){if(this._size>=this._freeOffset+t){const e=this._freeOffset;return this._freeOffset=function(t,e){return e*Math.ceil(t/e)}(e+t,this._alignment),this._allocatedOffsets.add(e),e}return-1}deallocate(t){this._allocatedOffsets.delete(t)}isAllocated(t){return t<this._freeOffset}extend(t){if(t<this._freeOffset)throw new Error("Could not reduce the size because it conflicts with already allocated region.");this._size=t}}class Fr{constructor(t){this._size=t,this._allRegions=new Wr,this._occupiedRegions=new Map,this._freeRegions=new Vr((t,e)=>t.size-e.size);const e={offset:0,size:t};this._allRegions.insert(e),e._freeNode=this._freeRegions.insert(e)}get size(){return this._size}get maxAllocableSize(){const t=this._freeRegions.max;return t?t.size:0}get isEmpty(){return 0===this._occupiedRegions.size}allocate(t){const e=this._findMinSuitable(t);if(!e)return-1;const i=e.value;this._freeRegions.remove(e);const s={offset:i.offset,size:t};if(this._occupiedRegions.set(i.offset,s),this._allRegions.insertAfter(i,s),this._allRegions.remove(i),i.size>t){const e={offset:i.offset+t,size:i.size-t};e._freeNode=this._freeRegions.insert(e),this._allRegions.insertAfter(s,e)}return s.offset}deallocate(t){let e=this._occupiedRegions.get(t);if(e){const i=this._allRegions.getPrev(e);if(i&&i._freeNode){const t={offset:i.offset,size:i.size+e.size};this._allRegions.insertAfter(i,t),this._allRegions.remove(e),this._allRegions.remove(i),this._freeRegions.remove(i._freeNode),e=t}const s=this._allRegions.getNext(e);if(s&&s._freeNode){const t={offset:e.offset,size:e.size+s.size};this._allRegions.insertBefore(s,t),this._allRegions.remove(e),this._allRegions.remove(s),this._freeRegions.remove(s._freeNode),e=t}this._occupiedRegions.delete(t),e._freeNode=this._freeRegions.insert(e)}}isAllocated(t){return this._occupiedRegions.has(t)}extend(t){if(t<this._size)throw new Error("Size reducing is not allowed in free list allocator");const e=t-this._size,i=this._allRegions.end;if(i&&i._freeNode){this._freeRegions.remove(i._freeNode);const t={offset:i.offset,size:i.size+e,isFree:!0};this._allRegions.insertAfter(i,t),this._allRegions.remove(i),this._freeRegions.insert(t)}else{const t={offset:this._size,size:e,isFree:!0};this._allRegions.insert(t),this._freeRegions.insert(t)}this._size=t}_findMinSuitable(t){let e,i=this._freeRegions.root;for(;i;){if(i.value.size===t){e=i;break}i.value.size<t?i=i.right:(e=i,i=i.left)}return e}}class Yr{constructor(t,e){this.width=t,this.height=e,this._allocator=new Fr(this.width)}allocate(t){return this._allocator.allocate(t)}deallocate(t){this._allocator.deallocate(t)}isAllocated(t){return this._allocator.isAllocated(t)}canAllocate(t){return this._allocator.maxAllocableSize>=t}resize(t){this._allocator.extend(t),this.width=t}}class Xr{constructor(t,e){this.width=t,this.height=e,this._shelves=new Map,this._shelfAllocator=new qr(e)}allocate(t){let e,i=-1,s=-1;for(const[r,n]of this._shelves.entries()){const o=t.height/n.height;if(1===o&&n.canAllocate(t.width)){e=n,i=r;break}o<1&&o>s&&n.canAllocate(t.width)&&(e=n,i=r,s=o)}if(!e&&this._shelfAllocator.maxAllocableSize>=t.height&&this.width>=t.width){const s=this._shelfAllocator.allocate(t.height);e=new Yr(this.width,t.height),i=s,this._shelves.set(s,e)}if(e){const s=e.allocate(t.width),r=i;return{minX:s,maxX:s+t.width,minY:r,maxY:r+t.height}}return null}deallocate(t){const e=this._shelves.get(t.minY);e&&e.deallocate(t.minX)}isAllocated(t){const e=this._shelves.get(t.minY);return!!e&&e.isAllocated(t.minX)}resize(t,e){this._shelfAllocator.extend(e);for(const i of this._shelves.values())i.resize(t);this.width=t,this.height=e}}const Gr=I(Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);function Zr(t,e,i){return 4*(e*(t.y+i)+t.x)}function Hr(t,e,i,s,r,n,{width:o,height:a}){for(let l=0;l<a;++l){const a=Zr(i,r,l),h=Zr(s,n,l);for(let i=0;i<4*o;++i)e[h+i]=t[a+i]}}function Kr(t,e){return new Uint8Array(4*t*e)}class Qr extends mi{constructor(t,e,i){super(),this.id=t,this.width=e,this.height=i,this.emptyIcon={minX:0,maxX:0,minY:0,maxY:0},this._data=Kr(e,i),this._updatedRegion=I(0,0,0,0),this._resetAllocator(),this._resetUpdatedRegion()}allocate(t,e){const i=this._allocator.allocate(fr((s=t).width+1,s.height+1));var s;if(!i)return;const r=function(t){const e=z(t);return e.maxX-=1,e.maxY-=1,e}(i);return this._insertIcon(r,e),C(this._updatedRegion,i,this._updatedRegion),r}flushUpdates(){if(this._updatedRegion.minX===Gr.minX)return;const{minX:t,minY:e,maxX:i,maxY:s}=this._updatedRegion;this._resetUpdatedRegion();const r=i-t,n=s-e,o=Kr(r,n);return Hr(this._data,o,g(t,e),y,this.width,r,fr(r,n)),{offset:g(t,e),size:fr(r,n),data:o}}reset(){this._resetUpdatedRegion(),this._resetAllocator(),this._data.fill(0)}_insertIcon(t,e){const{minX:i,minY:s,maxX:r,maxY:n}=t;Hr(e,this._data,y,g(i,s),r-i,this.width,fr(r-i,n-s))}_resetAllocator(){this._allocator=new Xr(this.width,this.height)}_resetUpdatedRegion(){z(Gr,this._updatedRegion)}}var $r;function Jr(t,e){return t.finally?t.finally(e):t.then(t=>Promise.resolve(e()).then(()=>t),t=>Promise.resolve(e()).then(()=>Promise.reject(t)))}!function(t){t[t.TO_BACKEND_SETUP=0]="TO_BACKEND_SETUP",t[t.FROM_BACKEND_ADD_ATLAS=1]="FROM_BACKEND_ADD_ATLAS",t[t.FROM_BACKEND_UPDATE_ATLAS=2]="FROM_BACKEND_UPDATE_ATLAS",t[t.FROM_BACKEND_REMOVE_ATLAS=3]="FROM_BACKEND_REMOVE_ATLAS"}($r||($r={}));var tn=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{l(s.next(t))}catch(e){n(e)}}function a(t){try{l(s.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))};const en={iconUrlTemplate:"no url for icons",iconRequestWithCredentials:!1,dpr:1};function sn(t,e,i){return t+"_"+e+"_"+i.key+"_"+i.colorQuery}function rn(t,e){const i=e&&t.byteLength%Uint32Array.BYTES_PER_ELEMENT==0&&new Uint32Array(t);if(i&&i[0]===on)return{size:fr(i[1],i[2]),data:new Uint8Array(t,3*Uint32Array.BYTES_PER_ELEMENT)};{const e=new Er(t,s).decode();return{size:fr(e.width,e.height),data:e.data}}var s}const nn={key:0,colorQuery:"",transform:t=>t,transformImage:t=>t},on=2537892953;class an{constructor(t,e,i=1024,s=1024){this._communicator=t,this._atlasWidth=i,this._atlasHeight=s,this._loadManager=e,this._options=Object.assign({},en),this._atlases=[],this._freeAtlases=[],this._currentAtlas=null,this._requests=new Map,this._iconDataMap=new Map,this._communicator.onMessage.addListener(this._onMessage,this)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}getAtlas(t){return this._atlases[t]}getIconData(t,e=1,i=nn){const s=sn(t,e,i);return this._iconDataMap.get(s)}getCurrentAtlas(){return this._currentAtlas||(this._currentAtlas=this._getNextAtlas()),this._currentAtlas}getDpr(){return this._options.dpr}loadIcon(t,e,i=1,s=nn){const r=sn(t,i,s);let n=this._requests.get(r);return n||(n=this._loadIcon(t,e,i,s.colorQuery).then(e=>{const r=s.transformImage(e);return this.addIcon(r,t,i,s)}),Jr(n,()=>this._requests.delete(r)),this._requests.set(r,n),n)}addIcon(t,e,i=1,s=nn){const r=sn(e,i,s),n=this._assignIconToAtlas(t),o={atlasId:this._currentAtlas.id,imageSize:t.size,atlasLocation:n};return this._iconDataMap.set(r,o),o}flushAtlasesUpdates(){for(const t of this._atlases){const e=t.flushUpdates();e&&this._communicator.sendMessage({type:$r.FROM_BACKEND_UPDATE_ATLAS,atlasId:t.id,atlasRegion:e},!1,e.data.buffer)}}buildIconUrl(t,e=1,i=!1,s=""){return this._options.iconUrlTemplate.replace("{{hostAlias}}",pi(t)).replace(/\\{\\{id\\}\\}/g,t).replace("{{scale}}",B(this._options.dpr*e,.1,10).toString())+s+(i?"&format=bmp":"")}_onMessage(t){switch(t.type){case $r.TO_BACKEND_SETUP:this._onSetup(t)}}_onSetup(t){Object.assign(this._options,t.options)}_loadIcon(t,e,i,s){return tn(this,void 0,void 0,(function*(){const r="bmp"===this._options.iconFormat,n=this.buildIconUrl(t,i,r,s),o=this._options.iconRequestWithCredentials;return rn(yield this._loadManager.load(n,e,{withCredentials:o}),r)}))}_getNextAtlas(){if(this._freeAtlases.length>0)return this._freeAtlases.shift();const t=this._atlases.length,e=new Qr(t,this._atlasWidth,this._atlasHeight);return e.retain(),e.onReleased.addListener(()=>{e.reset(),this._freeAtlases.push(e)}),this._atlases.push(e),this._communicator.sendMessage({type:$r.FROM_BACKEND_ADD_ATLAS,atlasId:t,atlasWidth:this._atlasWidth,atlasHeight:this._atlasHeight},!1),e}_assignIconToAtlas({size:t,data:e}){const i=this.getCurrentAtlas();let s=i.allocate(t,e);if(!s&&(i.release(),this._currentAtlas=this._getNextAtlas(),s=this._currentAtlas.allocate(t,e),!s))throw new Error("Couldn\'t allocate icon in atlas");return s}}class ln{constructor(t){this._loadManager=t,this._requests=new Map}fillFont(t,e,i,s,r){const n=e.id+"_"+i;let o=this._requests.get(n);return o||(o=this._loadManager.load(t,s,r).then(t=>{const i=K.decode(new Uint8Array(t));-1===e.xheight&&(e.xheight=i.font.xheight),-1===e.margin&&(e.margin=i.font.margin),void 0===e.height&&void 0!==i.font.height&&(e.height=i.font.height),void 0===e.ascender&&void 0!==i.font.ascender&&(e.ascender=i.font.ascender),void 0===e.descender&&void 0!==i.font.descender&&(e.descender=i.font.descender);for(const s of i.glyphs)e.glyphs[s.id]=s;return e}),Jr(o,()=>this._requests.delete(n)),this._requests.set(n,o)),o}}class hn{constructor(t,e,i,s=300){this._storage=t,this._modelStorage=e,this._taskQueue=i,this._size=s,this._cache=new Set,this._storage.onAdded.addListener(this._onTileAdded,this),this._storage.onRemoved.addListener(this._onTileRemoved,this),this._modelStorage.onAdded.addListener(this._onModelAdded,this),this._modelStorage.onRemoved.addListener(this._onModelRemoved,this)}destructor(){this._modelStorage.onRemoved.removeListener(this._onModelRemoved),this._modelStorage.onAdded.removeListener(this._onModelAdded),this._storage.onRemoved.removeListener(this._onTileRemoved),this._storage.onAdded.removeListener(this._onTileAdded)}_cleaning(){this._cleaningIsScheduled=!1;const t=this._cache.size-this._size;if(t>0){const e=new Array(t);let i=0;for(const s of this._cache){if(!(i<t))break;e[i]=s,++i}for(const t of e)this._destroyTile(t)}}_destroyTile(t){this._storage.remove(t.id)}_onTileAdded(t){t.onStateChanged.addListener(this._onTileStateChanged,this),this._onTileStateChanged(t)}_onTileRemoved(t){this._cache.delete(t),t.onStateChanged.removeListener(this._onTileStateChanged),t.destructor()}_onTileStateChanged(t){2===t.state?this._onTileCached(t):0!==t.state&&1!==t.state||this._onTileUse(t)}_onTileUse(t){this._cache.delete(t)}_onTileCached(t){t.hasContent()?(this._cache.add(t),this._cache.size>this._size&&!this._cleaningIsScheduled&&(this._cleaningIsScheduled=!0,this._taskQueue.enqueueSync({execute:this._cleaning.bind(this),priority:3e4}))):this._destroyTile(t)}_onModelAdded(t){t.onReleased.addListener(this._onModelReleased,this)}_onModelRemoved(t){t.onReleased.removeListener(this._onModelReleased),t.destructor()}_onModelReleased(t){this._modelStorage.remove(t.id)}}class cn extends h{_serialize(t){return t.id}}class dn{constructor(t,e,i="GET",s={}){this._url=t,this._method=i,this._xhr=new XMLHttpRequest,this._xhr.responseType=e,s.withCredentials&&(this._xhr.withCredentials=!0)}get isCanceled(){return this._xhr.readyState===XMLHttpRequest.DONE&&0===this._xhr.status}send(){const t=this._xhr;return t.readyState!==XMLHttpRequest.UNSENT?Promise.reject(new Error("already sent")):new Promise((e,i)=>{t.open(this._method,this._url),t.onload=()=>{this.isCanceled||(200<=t.status&&t.status<300?e(this._prepareResponse(t.response)):i(new Error(`Failed request: ${t.status} ${t.statusText}, ${this._url}`)))},this._xhr.onerror=()=>{i(new Error("Failed request: "+this._url))},this._xhr.send()})}cancel(){this._xhr.readyState===XMLHttpRequest.UNSENT||this.isCanceled||this._xhr.abort()}}class un extends dn{constructor(t,e="GET",i={}){super(t,"arraybuffer",e,i)}_prepareResponse(t){return t instanceof ArrayBuffer?t:new ArrayBuffer(0)}}class fn extends dn{constructor(t,e="GET",i={}){super(t,"json",e,i)}_prepareResponse(t){return t}}class pn{constructor(){this._requests=new Map,this._queue=new hr}load(t,e,i={}){return _n(this._makeLoadRequest(t,e,new un(t,"GET",i)))}loadJson(t,e,i={}){return _n(this._makeLoadRequest(t,e,new fn(t,"GET",i)))}cancel(t){const e=Object(X.b)(this._requests.values(),e=>e.subs.has(t));e&&(!function(t,e){t.subs.get(e)&&t.subs.delete(e)}(e,t),0===e.subs.size&&(this._requests.delete(e.url),e.isRunning?e.httpRequest.cancel():this._queue.remove(t=>t===e),this._checkLoadingQueue()))}_checkLoadingQueue(){if(!this._queue.size)return;let t=Number.NEGATIVE_INFINITY;this._requests.forEach(e=>{e.isRunning&&e.priority>t&&(t=e.priority)});const e=this._queue.peek().priority;if(!(e<t))for(;this._queue.size&&this._queue.peek().priority===e;)this._startLoading(this._queue.dequeue())}_makeLoadRequest(t,e,i){let s=this._requests.get(t);return s&&(s.isRunning||s.priority>=e)||(s?(this._queue.remove(t=>t===s),s.priority=e):(s={url:t,priority:e,httpRequest:i,isRunning:!1,subs:new Map},this._requests.set(t,s)),this._queue.enqueue(s),this._checkLoadingQueue()),s}_startLoading(t){Jr(t.httpRequest.send().then(e=>t.subs.forEach(t=>t.onData(e)),e=>t.subs.forEach(t=>t.onError(e))),()=>{this._requests.delete(t.url),this._checkLoadingQueue()}),t.isRunning=!0}}function _n(t){let e;const i=new Promise((t,i)=>{e={onData:t,onError:i}});return t.subs.set(i,e),i}class gn{constructor(t,e,i=new dr,s=new pn,n=100,o){this._commutator=new r(t),this._objectIdProvider=e,this._taskQueue=i,this._loadManager=s,this._taskPriority=n,this._tileStorage=new c(this._commutator.getCommunicator(1)),this._modelStorage=new cn(this._commutator.getCommunicator(2)),this._viewport=new Y(this._commutator.getCommunicator(0),this._tileStorage),this._registry=new rr(this._commutator.getCommunicator(4)),this._glyphAtlasRegistry=new mr(this._commutator.getCommunicator(5),new ln(this._loadManager)),this._iconAtlasRegistry=new an(this._commutator.getCommunicator(6),this._loadManager),this._tileContentManager=this._createTileVectorContentManagerBackend(),this._gc=new hn(this._tileStorage,this._modelStorage,i,o),this._stylesCustomizer=new os}destructor(){this._gc.destructor(),this._tileContentManager.destructor(),this._iconAtlasRegistry.destructor(),this._glyphAtlasRegistry.destructor(),this._viewport.destructor(),this._commutator.destructor()}_createTileVectorContentManagerBackend(){return new Ks(this._commutator.getCommunicator(3),this._tileStorage,this._modelStorage,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,this._viewport,this._objectIdProvider,this._taskQueue,this._loadManager,this._taskPriority)}}function yn({min:t,max:e}){let i=0;return()=>i++%(e-t+1)+t}var mn;!function(t){t[t.SETUP=0]="SETUP",t[t.ADD=1]="ADD",t[t.DESTROY=2]="DESTROY"}(mn||(mn={}));class bn extends mi{constructor(t){super(),this.id=t}addContent(t){this.content=t}}const xn={indoorPlanUrlTemplate:"No url provided"};class vn{constructor(t,e){this._communicator=t,this._loader=e,this._plans=new Map,this._options=Object.assign({},xn),this._communicator.onMessage.addListener(this._onMessage,this)}destructor(){for(const t of this._plans.values())t.onReleased.removeListener(this._onPlanReleased);this._communicator.onMessage.removeListener(this._onMessage)}getPlan(t){return this._plans.get(t)}getOrCreatePlan(t){let e=this._plans.get(t);return e||(e=new bn(t),e.onReleased.addListener(this._onPlanReleased,this),this._loader.loadPlan(t).then(e=>this._onLoad(t,e)),this._plans.set(t,e)),e}_onPlanReleased(t){this._plans.delete(t.id),this._communicator.sendMessage({type:mn.DESTROY,planId:t.id},!1)}_onLoad(t,e){const i=this._plans.get(t);i&&(i.addContent(e),this._communicator.sendMessage(Object.assign({type:mn.ADD,planId:t},e),!0))}_onMessage(t){switch(t.type){case mn.SETUP:this._options=t.options,this._loader.setUrlProvider(t=>this._options.indoorPlanUrlTemplate.replace("{{id}}",t).replace("{{hostAlias}}",pi(t)))}}}const wn=Gs((t,e)=>{var i,s,r,n;return(null===(i=t)||void 0===i?void 0:i.get("indoor_plan_id"))===(null===(s=e)||void 0===s?void 0:s.get("indoor_plan_id"))&&(null===(r=t)||void 0===r?void 0:r.get("indoor_level_id"))===(null===(n=e)||void 0===n?void 0:n.get("indoor_level_id"))}),kn=Object.assign(Object.assign({},Hs),{polygonsBatchingRule:wn,polylinesBatchingRule:wn});class An extends Ks{constructor(t,e,i,s,r,n,o,a,l,h,c,d){super(t,e,i,s,r,n,o,a,l,h,c),this._indoorPlanRegistry=d,this._metadataPreprocessor=(t,e)=>this._preprocessMetadata(t,e)}_setOptions(t){this._options=Object.assign(Object.assign({},kn),t)}_createTileRequest(t,e){const i=this._objectIdManager.createSharedIdProvider(t.id);return new ui(t,e,this._taskQueue,this._tileLoader,this._viewport,this._taskPriority,this._opaquePolygonBufferWriter,this._transparentPolygonBufferWriter,this._extrudedPolygonWriter,this._polylineBufferWriter,this._pointLabelBufferWriter,this._curvedLabelBufferWriter,this._iconBufferWriter,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,i,this._stylesCustomizer,this._metadataPreprocessor)}_preprocessMetadata(t,e){const i=et(t,this._options.allObjectsInteractive);for(const s of[i.points,i.polylines,i.polygons,i.pointLabels,i.curvedLabels]){const t=s;for(const i of t.values()){const t=i.get("indoor_plan_id");if(t){const i=this._indoorPlanRegistry.getOrCreatePlan(t);e.addContent({primitives:{}},[i])}}}return i}}var Tn=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{l(s.next(t))}catch(e){n(e)}}function a(t){try{l(s.throw(t))}catch(e){n(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}))};class Sn{constructor(t,e){this._loadManager=t,this._urlProvider=e,this._loadings=new Map}setUrlProvider(t){this._urlProvider=t}loadPlan(t){return Tn(this,void 0,void 0,(function*(){let e=this._loadings.get(t);return e||(e=Jr(this._createRequest(t),()=>this._loadings.delete(t)),this._loadings.set(t,e)),e}))}_createRequest(t){return Tn(this,void 0,void 0,(function*(){const e=yield this._loadManager.load(this._urlProvider(t),32e3),{levels:i,defaultLevelId:s,boundary:r}=$.decode(new Uint8Array(e));if(!r)throw new Error("No indoor plan boundary provided");return{levels:i,defaultLevelId:s,boundary:r}}))}}class Rn extends gn{destructor(){this._planRegistry&&this._planRegistry.destructor(),super.destructor()}_createTileVectorContentManagerBackend(){const t=this._getOrCreatePlanRegistry();return new An(this._commutator.getCommunicator(3),this._tileStorage,this._modelStorage,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,this._viewport,this._objectIdProvider,this._taskQueue,this._loadManager,this._taskPriority,t)}_getOrCreatePlanRegistry(){if(!this._planRegistry){const t=new Sn(this._loadManager,()=>{throw new Error("No url for indoor plans provided")});this._planRegistry=new vn(this._commutator.getCommunicator(7),t)}return this._planRegistry}}class Pn extends h{_serialize(t){return{id:t.id,bbox:t.bbox}}}class In extends oi{constructor(t,e,i,s,r,n,o,a,l,h,c,d,u,f,p,_,g,y){super(i,s,r,n,o,a,l,h,c,d,u,f,p,_,g),this._object=t,this._data=e,this._objectIdProvider=y}_onSubTaskContent(t){this._onContentReady.fire({object:this._object,content:t})}_startImpl(){this._scheduleProcessing(this._data)}_process(t){return{object:this._object,content:ue(this._writePolygons(this._extractPolygons(t)),{content:{primitives:{}},metrics:{loadTime:this._loadTime}})}}_loadImpl(){throw new Error("TODO: implement geo content loading")}_loadCancel(){throw new Error("TODO: implement geo content loading cancel")}_extractPolygons(t){const e=[];if("FeatureCollection"===t.type)for(const i of t.features)"Feature"===i.type&&"Polygon"===i.geometry.type&&e.push({id:this._objectIdProvider.idGenerator(),styles:[{color:dt(1,0,0,1),extruded:!1,height:0,minZoom:0,maxZoom:0,zIndex:0,classId:1}],height:0,hasContour:!1,vertexRings:i.geometry.coordinates.map(t=>t.map(t=>g(t[0],t[1])))});return e}}class zn extends o{constructor(t,e){super(),this.id=t,this.bbox=e}}class Cn extends ge{constructor(t,e,i,s,r,n,o,a,l,h,c,d,u,f,p,_){super(s,i,2e3),this._url=t,this._options=e,this._loadManager=r,this._opaquePolygonBufferWriter=n,this._transparentPolygonBufferWriter=o,this._extrudedPolygonBufferWriter=a,this._polylineBufferWriter=l,this._pointLabelsBufferWriter=h,this._curvedLabelsBufferWriter=c,this._iconBufferWriter=d,this._pageRegistry=u,this._glyphAtlasRegistry=f,this._iconAtlasRegistry=p,this._objectIdProvider=_}_process(t){const e=[t];for(const[i,s]of e.entries()){const t=this._url+"_"+i,e=-1,r=new zn(t,{minX:.20893428,maxX:.20993428,minY:.37293635,maxY:.37393635}),n=new In(r,s,this._options,e,this._priority,this._taskQueue,this._priority,this._opaquePolygonBufferWriter,this._transparentPolygonBufferWriter,this._extrudedPolygonBufferWriter,this._polylineBufferWriter,this._pointLabelsBufferWriter,this._curvedLabelsBufferWriter,this._iconBufferWriter,this._pageRegistry,this._glyphAtlasRegistry,this._iconAtlasRegistry,this._objectIdProvider);this._startSubTask(n)}}_onSubTaskContent(t){this._onContentReady.fire(t)}_loadImpl(){return this._loadManager.loadJson(this._url,this._priority).then(()=>{throw new Error("tmp")},()=>({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[.20893428,.37293635],[.20893428,.37393635],[.20993428,.37393635],[.20993428,.37293635]]]},properties:{tags:["animated_polygon"]},id:"Polygon_${tileId.x}_${tileId.y}_${tileId.z}"}]}))}_loadCancel(){this._loadManager.cancel(this._request)}}class On{constructor(t){this.id=t,this._geoObjects=new Set,this.onBBoxExtended=this._onBBoxExtended=new s}get bbox(){return this._bbox||Object.assign({},P)}get geoObjects(){return this._geoObjects}get isEmpty(){return 0===this._geoObjects.size}destructor(){for(const t of this._geoObjects)t.destructor()}addGeoObject(t){this._geoObjects.add(t),this._bbox?C(this._bbox,t.bbox):this._bbox=Object.assign({},t.bbox),this._onBBoxExtended.fire(this)}hasGeoObject(t){return this._geoObjects.has(t)}}const En={contentUrlTemplate:"no contentUtlTemplate specified",objectsCollisionPriority:1,polygonsBatchingRule:Gs(()=>!0),modelsBatchingRule:Gs(()=>!0),polylinesBatchingRule:Gs(()=>!0),labelsBatchingRule:Gs(()=>!0)};class Mn extends Ys{constructor(t,e,i,s,r,n,o,a,l){super(s,r,n,o,a,l,0),this._communicator=t,this._storage=e,this._batchStorage=i,this._requests=new Map,this._options=Object.assign({},En),this._communicator.onMessage.addListener(this._onMessage,this),this._batchStorage.onRemoved.addListener(this._onBatchRemoved,this)}destructor(){this._communicator.onMessage.removeListener(this._onMessage),this._batchStorage.onRemoved.removeListener(this._onBatchRemoved)}fetch(t){if(!this._requests.has(t)){const e=new On(t),i=new Cn(t,this._options,0,this._taskQueue,this._loadManager,this._opaquePolygonBufferWriter,this._transparentPolygonBufferWriter,this._extrudedPolygonWriter,this._polylineBufferWriter,this._pointLabelBufferWriter,this._curvedLabelBufferWriter,this._iconBufferWriter,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,this._objectIdProvider);i.onContentReady.addListener(t=>this._onContentReady(e,t)),i.start(),this._requests.set(t,i),this._batchStorage.add(t,e)}}_onMessage(t){switch(t.type){case 0:this._onSetup(t)}}_onSetup(t){this._options=Object.assign(Object.assign({},En),t.options)}_onContentReady(t,e){const{object:i,content:s}=e;i.addContent(e.content,this._extractSharedResources(s.content.primitives)),t.hasGeoObject(i)||t.addGeoObject(i),this._batchStorage.has(t.id)||this._batchStorage.add(t.id,t),this._storage.has(i.id)||this._storage.add(i.id,i),this._registry.flushBackendUpdates(),this._iconAtlasRegistry.flushAtlasesUpdates(),this._communicator.sendMessage({type:2,objectId:i.id,content:s.content},!0)}_onBatchRemoved(t){const e=this._requests.get(t.id);e&&(e.destructor(),this._requests.delete(t.id))}}class Bn extends l{}class Ln{constructor(t,e,i=6e4){this._communicator=t,this._storage=e,this._longAgoThreshold=i,this._lastNearnessTimeKey=Symbol("geo_gc_nearness_time"),this._currentExtendedViewportBBox=Object.assign({},P),this._communicator.onMessage.addListener(this._onMessage,this),this._storage.onAdded.addListener(this._onBatchAdded,this),this._storage.onRemoved.addListener(this._onBatchRemoved,this);for(const s of e.items)this._onBatchAdded(s)}destructor(){this._communicator.onMessage.removeListener(this._onMessage),this._storage.onAdded.removeListener(this._onBatchAdded),this._storage.onRemoved.removeListener(this._onBatchRemoved);for(const t of this._storage.items)this._onBatchRemoved(t)}_onBatchAdded(t){t[this._lastNearnessTimeKey]=_e(),t.onBBoxExtended.addListener(this._onBatchBBoxExtended,this)}_onBatchRemoved(t){delete t[this._lastNearnessTimeKey],t.onBBoxExtended.removeListener(this._onBatchBBoxExtended)}_onMessage(t){switch(t.type){case 0:this._onCameraUpdate(t)}}_onCameraUpdate(t){const e=_e(),i=t.viewportBBox,s=i.maxX-i.minX,r=i.maxY-i.minY;this._currentExtendedViewportBBox=I(i.minX-=2*s,i.maxX+=2*s,i.minY-=2*r,i.maxY+=2*r);for(const n of this._storage.items)this._updateNearnessTime(n,e);this._garbageCollect()}_onBatchBBoxExtended(t){this._updateNearnessTime(t)}_updateNearnessTime(t,e=_e()){(function(t,e){let i,s,r,n;return t.minX<e.minX?(i=t,s=e):(i=e,s=t),t.maxY>e.maxY?(r=t,n=e):(r=e,n=t),s.minX<i.maxX&&n.maxY>r.minY})(this._currentExtendedViewportBBox,t.bbox)&&(t[this._lastNearnessTimeKey]=e)}_isGarbage(t,e=_e()){return e-t[this._lastNearnessTimeKey]>this._longAgoThreshold}_garbageCollect(t=_e()){const e=[];for(const i of this._storage.items)this._isGarbage(i,t)&&e.push(i);for(const i of e)this._storage.remove(i.id),i.destructor()}}class Un{constructor(t,e,i,s=new pn,n=100){this._objectIdProvider=e,this._taskQueue=i,this._loadManager=s,this._taskPriority=n,this._commutator=new r(t),this._communicator=this._commutator.getCommunicator(0),this._storage=new Pn(this._commutator.getCommunicator(2)),this._batchStorage=new Bn,this._registry=new rr(this._commutator.getCommunicator(3)),this._glyphAtlasRegistry=new mr(this._commutator.getCommunicator(5),new ln(this._loadManager)),this._iconAtlasRegistry=new an(this._commutator.getCommunicator(4),this._loadManager),this._geoContentManager=new Mn(this._commutator.getCommunicator(1),this._storage,this._batchStorage,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,e,i,s),this._gc=new Ln(this._commutator.getCommunicator(6),this._batchStorage),this._communicator.onMessage.addListener(this._onMessage,this)}destructor(){this._geoContentManager.destructor(),this._iconAtlasRegistry.destructor(),this._glyphAtlasRegistry.destructor(),this._gc.destructor(),this._commutator.destructor(),this._communicator.onMessage.removeListener(this._onMessage)}_onMessage(t){switch(t.type){case 0:this._onCameraChanged(t)}}_onCameraChanged(t){t.center.x>.208&&t.center.x<.209&&t.center.y>.372&&t.center.y<.375&&(console.log("fetching, ",t.center),this._geoContentManager.fetch("http://whatever.whh"))}}class Dn{constructor(t){this._addressee=t,this._messageQueue=[],this._transferableQueue=[],this._listeners=[]}addMessage(t,e=[]){this._messageQueue.push(t),this._transferableQueue.push(...e)}onMessage(t){this._listeners.push(t)}flushMessages(){0!==this._messageQueue.length&&this._addressee.postMessage(this._messageQueue,this._transferableQueue),this._messageQueue.length=0,this._transferableQueue.length=0}listen(){this._addressee.onmessage=({data:t})=>{for(const e of t)for(const t of this._listeners)t(e)}}}e.default=new class{constructor(t){var e;this._commutator=new r(new n(t)),this._communicator=this._commutator.getCommunicator(0),this._contentProviders=new Map,this._geoContentProviders=new Map,this._objectIdProvider=(e=xt,{idGenerator:yn(vt),collidingIdGenerator:yn(e)}),this._taskQueue=new dr,this._loadManager=new pn,this._communicator.onMessage.addListener(this._onMessage,this),this._communicator.sendMessage({type:3},!0)}destructor(){for(const t of this._contentProviders.values())t.destructor();this._taskQueue.destroy(),this._commutator.destructor()}_onMessage(t){switch(t.type){case 0:this._onInitContentProvider(t);break;case 1:this._onInitGeoContentProvider(t);break;case 2:this._onDestroyContentProvider(t)}}_onInitContentProvider(t){let e;e="indoor"===t.name?new Rn(this._commutator.getCommunicator(t.id),this._objectIdProvider,this._taskQueue,this._loadManager,t.options.basePriority,t.options.tileCacheSize):new gn(this._commutator.getCommunicator(t.id),this._objectIdProvider,this._taskQueue,this._loadManager,t.options.basePriority,t.options.tileCacheSize),this._contentProviders.set(t.id,e)}_onInitGeoContentProvider(t){const e=new Un(this._commutator.getCommunicator(t.id),this._objectIdProvider,this._taskQueue,this._loadManager);this._geoContentProviders.set(t.id,e)}_onDestroyContentProvider(t){const{id:e}=t,i=this._contentProviders.get(e);if(i)return i.destructor(),void this._contentProviders.delete(e);const s=this._geoContentProviders.get(e);s&&(s.destructor(),this._geoContentProviders.delete(e))}}(new class extends Dn{run(){return this.listen(),this}}(self).run())}]);',null)}},function(t,e){t.exports="#version 100\nattribute vec2 position;uniform sampler2D directPriorityGrid;uniform sampler2D reversePriorityGrid;uniform vec2 idHalfPxSize;uniform vec2 gridHalfPxSize;varying lowp vec4 id;const vec2 A=vec2(0,0);const vec4 B=vec4(2,2,2,1);const float C=255./256.;const float D=0.01;const float E=0.25;const float F=0.5;void main(){vec4 G=texture2D(reversePriorityGrid,position);if(G.rg!=A){vec4 H=texture2D(directPriorityGrid,position);vec2 I=G.rg*C+idHalfPxSize;bool J=G!=H;gl_Position=vec4(I*2.-1.,E,1);id=vec4(A,0,0);if(J&&H.a>=D){gl_Position.z=F;id=vec4(H.rg,0,1);}gl_PointSize=1.;}else{gl_Position=B;}}"},function(t,e){t.exports="#version 100\nattribute vec4 position;varying vec2 idTexCoordinates;void main(){gl_Position=vec4(position.xy,0,1);idTexCoordinates=position.zw;}"},function(t,e){t.exports="#version 100\nprecision mediump float;uniform sampler2D prevVisibility;uniform sampler2D overlaps;uniform sampler2D scene;uniform float fadeAnimationAmount;uniform float currentZoom;uniform float currentTilt;uniform float currentAzimuth;varying vec2 idTexCoordinates;const float A=1./256.;void main(){vec4 B=texture2D(prevVisibility,idTexCoordinates);vec4 C=texture2D(overlaps,idTexCoordinates);vec4 D=texture2D(scene,idTexCoordinates);bool E=D.a>=A;if(E){gl_FragColor=B;bool F=C.a>=A;if(F){if(gl_FragColor.b<A){gl_FragColor.b=currentZoom;gl_FragColor.r=currentTilt;gl_FragColor.g=currentAzimuth;}gl_FragColor.a=clamp(gl_FragColor.a-fadeAnimationAmount,0.,1.);}else{gl_FragColor.a=clamp(gl_FragColor.a+fadeAnimationAmount,0.,1.);gl_FragColor.rgb=vec3(0,0,0);}}else{gl_FragColor=vec4(0,0,0,0);}}"},function(t,e){t.exports="#version 100\nattribute vec4 position;void main(){gl_Position=vec4(position.xy,0,1);}"},function(t,e){t.exports="#version 100\nvoid main(){gl_FragColor=vec4(0,0,0,1);}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexId;uniform vec2 idHalfPxSize;void main(){vec2 A=vertexId.xy/256.+idHalfPxSize;vec4 B=vec4(A*2.-1.,0,1);gl_Position=B;gl_PointSize=1.;}"},function(t,e){t.exports="#version 100\nvoid main(){gl_FragColor=vec4(0,0,0,1);}"},function(t,e){t.exports="#version 100\nuniform lowp vec4 color;void main(){gl_FragColor=color;}"},function(t,e){t.exports="#version 100\nprecision mediump float;uniform vec2 pixelSize;uniform sampler2D texture;uniform float dpr;const float A=0.75;const float B=0.063;const float C=0.0625;const float D=0.0001;float E(vec4 F){return dot(F.xyz,vec3(0.299,0.587,0.114));}vec4 G(vec2 H,sampler2D I,vec2 J,float K,float L,float M){vec2 N;N.x=H.x;N.y=H.y;vec4 O=texture2D(I,N);float P=E(O);float Q=E(texture2D(I,N+vec2(0,1)*J.xy));float R=E(texture2D(I,N+vec2(1,0)*J.xy));float S=E(texture2D(I,N+vec2(0,-1)*J.xy));float T=E(texture2D(I,N+vec2(-1,0)*J.xy));float U=max(Q,P);float V=min(Q,P);float W=max(R,U);float X=min(R,V);float Y=max(S,T);float Z=min(S,T);float a=max(Y,W);float b=min(Z,X);float c=a*L;float d=a-b;float e=max(M,c);bool f=d<e;if(f)return O;float g=E(texture2D(I,N+vec2(-1,-1)*J.xy));float h=E(texture2D(I,N+vec2(1,1)*J.xy));float i=E(texture2D(I,N+vec2(1,-1)*J.xy));float j=E(texture2D(I,N+vec2(-1,1)*J.xy));float k=S+Q;float l=T+R;float m=1./d;float n=k+l;float o=(-2.*P)+k;float p=(-2.*P)+l;float q=i+h;float r=g+i;float s=(-2.*R)+q;float t=(-2.*S)+r;float u=g+j;float v=j+h;float w=(abs(o)*2.)+abs(s);float x=(abs(p)*2.)+abs(t);float y=(-2.*T)+u;float z=(-2.*Q)+v;float AA=abs(y)+w;float AB=abs(z)+x;float AC=u+q;float AD=J.x;bool AE=AA>=AB;float AF=n*2.+AC;if(AE){AD=J.y;}else{S=T;Q=R;}float AG=(AF*(1./12.))-P;float AH=S-P;float AI=Q-P;float AJ=S+P;float AK=Q+P;bool AL=abs(AH)>=abs(AI);float AM=max(abs(AH),abs(AI));if(AL){AD=-AD;}else{AJ=AK;}float AN=clamp(abs(AG)*m,0.,1.);vec2 AO=N;vec2 AP;vec2 AQ;if(AE){AP=vec2(J.x,0.);AQ=vec2(0.,AD);}else{AP=vec2(0.,J.y);AQ=vec2(AD,0.);}vec2 AR=AO-AP*2.;vec2 AS=AO+AP*2.;float AT=((-2.)*AN)+3.;float AU=E(mix(texture2D(I,AR),texture2D(I,AR+AQ),0.5));float AV=AN*AN;float AW=E(mix(texture2D(I,AS),texture2D(I,AS+AQ),0.5));float AX=AM*0.25;float AY=P-AJ*0.5;float AZ=AT*AV;bool Aa=AY<0.;AU-=AJ*0.5;AW-=AJ*0.5;bool Ab=abs(AU)>=AX;bool Ac=abs(AW)>=AX;if(!Ab){AR-=AP*3.;}bool Ad=(!Ab)||(!Ac);if(!Ac){AS+=AP*3.;}if(Ad){if(!Ab){AU=E(mix(texture2D(I,AR),texture2D(I,AR+AQ),0.5));AU=AU-AJ*0.5;}if(!Ac){AW=E(mix(texture2D(I,AS.xy),texture2D(I,AS.xy+AQ),0.5));AW=AW-AJ*0.5;}Ab=abs(AU)>=AX;Ac=abs(AW)>=AX;if(!Ab){AR-=AP*12.;}if(!Ac){AS+=AP*12.;}}float Ae=N.x-AR.x;float Af=AS.x-N.x;if(!AE){Ae=N.y-AR.y;Af=AS.y-N.y;}bool Ag=(AU<0.)!=Aa;float Ah=(Af+Ae);bool Ai=(AW<0.)!=Aa;float Aj=1./Ah;bool Ak=Ae<Af;float Al=min(Ae,Af);bool Am=Ak?Ag:Ai;float An=AZ*AZ;float Ao=(Al*(-Aj))+0.5;float Ap=An*K;float Aq=Am?Ao:0.;float Ar=max(Aq,Ap);vec4 As;float At=Ar;if(AE){As=mix(texture2D(I,N),texture2D(I,N+vec2(0.,AD)),At);}else{As=mix(texture2D(I,N),texture2D(I,N+vec2(AD,0.)),At);}return As;}void main(){vec2 H=gl_FragCoord.xy*pixelSize;vec4 As=G(H,texture,pixelSize,A,B,C);if(As.a>D){As.xyz/=As.a;}gl_FragColor=As;}"},function(t,e){t.exports="#version 100\nprecision mediump float;varying highp vec2 textureCoordinates;varying vec4 iconLocation;uniform sampler2D atlas;uniform vec2 atlasSize;uniform bool isColorTransformed;uniform mat4 colorTransform;vec4 A(vec4 B,mat4 C){return C*vec4(B.rgb,1)*vec4(1,1,1,B.a);}vec4 D(vec4 B,mat4 colorTransform){vec4 E=A(vec4(B.rgb/B.a,B.a),colorTransform);return vec4(E.rgb*B.a,B.a)*E.a;}void main(void){vec2 F=iconLocation.yw-iconLocation.xz;vec2 G=textureCoordinates;G.x=mod(G.x,F.x);vec2 H=iconLocation.xz+G;vec4 B=texture2D(atlas,H/atlasSize);gl_FragColor=isColorTransformed?D(B,colorTransform):B;}"},function(t,e){t.exports="#version 100\nprecision mediump float;uniform sampler2D atlas;uniform bool isColorTransformed;uniform mat4 colorTransform;varying vec2 uv;varying float alpha;vec4 A(vec4 B,mat4 C){return C*vec4(B.rgb,1)*vec4(1,1,1,B.a);}const float D=0.69;vec4 E(vec4 F,vec4 G){F.rgb/=F.a;float H=max(0.2126*F.r+0.7152*F.g+0.0722*F.b,D);vec3 I=mix(G.rgb,vec3(1.),(H-D)/(1.-D));return vec4(I*F.a,F.a)*G.a;}void main(){vec4 B=texture2D(atlas,uv);gl_FragColor=isColorTransformed?E(B,A(B,colorTransform)):B;gl_FragColor*=alpha;}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexUV;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;varying vec2 uv;const float A=1.999969482421875;const float B=0.000030517112463712692;void main(){vec4 C=viewProjMatrix*vec4(A*(vertexPosHigh-lookAtHigh)+B*(vertexPosLow-lookAtLow),0,1);gl_Position=C;uv=vertexUV;}"},function(t,e){t.exports="#version 100\nprecision mediump float;uniform sampler2D atlas;uniform vec2 atlasSize;varying vec2 uv;void main(){gl_FragColor=texture2D(atlas,uv/atlasSize);if(gl_FragColor.a==0.){discard;}}"},function(t,e){t.exports="#version 100\nvarying lowp vec4 color;void main(void){gl_FragColor=color;}"},function(t,e){t.exports="#version 100\n#extension GL_OES_standard_derivatives : require\nprecision highp float;varying vec4 diffuseColor;varying vec4 globalPosition;const vec3 A=vec3(0.2,0.2,1.);const float B=0.4;const float C=1.-B;const float D=C+0.5*B*(A.z+1.);void main(void){vec3 E=globalPosition.xyz;vec3 F=dFdx(E);vec3 G=dFdy(E);vec3 H=cross(F,G);float I=dot(H,A)/length(G)/length(A)/length(F);gl_FragColor=vec4(diffuseColor.rgb*(C+0.5*B*(I+1.))/D,diffuseColor.a);}"},function(t,e){t.exports="#version 100\nprecision mediump float;attribute vec2 vertexPosition;attribute vec2 vertexUV;varying vec2 uv;void main(){gl_Position=vec4(vertexPosition,0,1);uv=vertexUV;}"},function(t,e){t.exports="#version 100\nprecision mediump float;uniform sampler2D texture;varying vec2 uv;void main(){gl_FragColor=texture2D(texture,uv);}"},function(t,e){t.exports="#version 100\nattribute vec4 vertexId;attribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexDisplacement;attribute vec2 vertexUV;attribute float vertexPriority;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform sampler2D visibility;uniform sampler2D overlap;uniform sampler2D scene;uniform vec2 idHalfPxSize;uniform vec2 shift;uniform lowp float currentZoom;uniform lowp float currentTilt;uniform lowp float currentAzimuth;varying lowp vec4 id;const vec4 A=vec4(2,2,2,1);const float B=pow(2.,16.);const float C=pow(2.,-31.);vec4 D(mat4 viewProjMatrix,vec2 lookAtHigh,vec2 lookAtLow,vec2 E,vec2 F,vec2 G,vec2 H){vec4 I=viewProjMatrix*vec4((B*(E-lookAtHigh)+(F-lookAtLow))*C,0,1);I=vec4(I.xy/I.w,0.,1.);return I+vec4(G*H,0.,0.);}const vec4 J=vec4(0,0,0,0);const vec2 K=vec2(0,0);const float L=255./256.;const float M=0.05;const float N=0.15;const float O=0.02;bool P(vec2 Q,vec2 idHalfPxSize,sampler2D overlap,sampler2D scene){vec2 R=texture2D(overlap,Q).rg;return R!=K&&texture2D(scene,R*L+idHalfPxSize)!=J;}float S(vec2 id,vec2 idHalfPxSize,sampler2D visibility,sampler2D overlap,sampler2D scene,float currentZoom,float currentTilt,float currentAzimuth){vec2 Q=id/256.+idHalfPxSize;vec4 T=texture2D(visibility,Q);float U=T.b;float V=T.r;float W=T.g;float X=U-currentZoom;float Y=abs(V-currentTilt);float Z=abs(W-currentAzimuth);if((X>M||(abs(X)<=M&&Y<N&&Z<O))&&P(Q,idHalfPxSize,overlap,scene)){return-1.;}return T.a;}void main(void){float a=S(vertexId.xy,idHalfPxSize,visibility,overlap,scene,currentZoom,currentTilt,currentAzimuth);if(a<0.){gl_Position=A;}else{gl_Position=D(viewProjMatrix,lookAtHigh,lookAtLow,vertexPosHigh,vertexPosLow,vertexDisplacement,pixelSize);gl_Position.xy+=shift;gl_Position.z=vertexPriority;id=vec4(vertexId.xy/255.,0,a);}}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexId;attribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec3 vertexDisplacements;attribute vec2 vertexUV;attribute float vertexPriority;attribute lowp vec4 vertexColor;attribute lowp vec4 vertexOutlineColor;attribute vec2 polylineLength_vertexScale;attribute vec4 leftPolylineRatios;attribute vec4 leftPolylineAngles;attribute vec4 rightPolylineRatios;attribute vec4 rightPolylineAngles;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform sampler2D visibility;uniform sampler2D overlap;uniform sampler2D scene;uniform vec2 idHalfPxSize;uniform vec2 shift;uniform lowp float currentZoom;uniform lowp float currentTilt;uniform lowp float currentAzimuth;varying lowp vec4 id;const vec4 A=vec4(2,2,2,1);const float B=pow(2.,16.);const float C=pow(2.,-31.);const float D=3.1415927410125732;const int E=4;const float F=1000000.;const float G=1./256.;vec2 H(mat4 viewProjMatrix,vec2 lookAtHigh,vec2 lookAtLow,vec2 pixelSize,vec2 I,vec2 J,vec2 K){vec4 L=viewProjMatrix*vec4((B*(I-lookAtHigh)+(J-lookAtLow))*C+K,0,1);vec2 M=L.xy/L.w;return M/pixelSize;}vec2 N(float O,float P,float Q){float R=P*2.*D-D;float S=O*Q;return vec2(cos(R),sin(R))*S;}float T(vec4 R,int U){if(U==0)return R[0];if(U==1)return R[1];if(U==2)return R[2];return R[3];}vec4 V(mat4 viewProjMatrix,vec2 lookAtHigh,vec2 lookAtLow,vec2 W,vec2 X,vec2 Y,vec2 Z,float a,float Q,vec4 leftPolylineRatios,vec4 leftPolylineAngles,vec4 rightPolylineRatios,vec4 rightPolylineAngles){vec2 L=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,vec2(0,0));vec2 b=N(rightPolylineRatios[0],rightPolylineAngles[0],Q);vec2 c=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,b);bool d=a>0.;bool e=c.x<L.x;bool f=d^^e;if(d==e){b=f?N(rightPolylineRatios[0],rightPolylineAngles[0],Q):N(leftPolylineRatios[0],leftPolylineAngles[0],Q);c=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,b);}float g=abs(a);for(int U=1;U<=E;U++){vec2 h=c-L;bool i=U==E||T(f?rightPolylineRatios:leftPolylineRatios,U)<G;float j=i?F:length(h);if(j>g){float k=a>0.?1.:-1.;vec2 l=normalize(h);vec2 m=vec2(-l.y,l.x);L+=l*g;L+=k*l*Z.x;L+=k*m*Z.y;break;}else{g-=j;L+=h;vec2 n=f?N(T(rightPolylineRatios,U),T(rightPolylineAngles,U),Q):N(T(leftPolylineRatios,U),T(leftPolylineAngles,U),Q);c=H(viewProjMatrix,lookAtHigh,lookAtLow,W,X,Y,n);}}return vec4(L*W,0.,1.);}const vec4 o=vec4(0,0,0,0);const vec2 p=vec2(0,0);const float q=255./256.;const float r=0.05;const float s=0.15;const float t=0.02;bool u(vec2 v,vec2 idHalfPxSize,sampler2D overlap,sampler2D scene){vec2 w=texture2D(overlap,v).rg;return w!=p&&texture2D(scene,w*q+idHalfPxSize)!=o;}float x(vec2 id,vec2 idHalfPxSize,sampler2D visibility,sampler2D overlap,sampler2D scene,float currentZoom,float currentTilt,float currentAzimuth){vec2 v=id/256.+idHalfPxSize;vec4 y=texture2D(visibility,v);float z=y.b;float AA=y.r;float AB=y.g;float AC=z-currentZoom;float AD=abs(AA-currentTilt);float AE=abs(AB-currentAzimuth);if((AC>r||(abs(AC)<=r&&AD<s&&AE<t))&&u(v,idHalfPxSize,overlap,scene)){return-1.;}return y.a;}void main(void){float AF=x(vertexId.xy,idHalfPxSize,visibility,overlap,scene,currentZoom,currentTilt,currentAzimuth);if(AF<0.){gl_Position=A;}else{vec2 AG=vertexDisplacements.xy;float AH=vertexDisplacements.z;float Q=polylineLength_vertexScale[0];gl_Position=V(viewProjMatrix,lookAtHigh,lookAtLow,pixelSize,vertexPosHigh,vertexPosLow,AG,AH,Q,leftPolylineRatios,leftPolylineAngles,rightPolylineRatios,rightPolylineAngles);gl_Position.xy+=shift;gl_Position.z=vertexPriority;id=vec4(vertexId.xy/255.,0,AF);}}"},function(t,e){t.exports="#version 100\nattribute vec2 vertexPosHigh;attribute vec2 vertexPosLow;attribute vec2 vertexDisplacement;attribute vec2 vertexOffset;attribute vec4 vertexId;attribute float vertexPriority;uniform vec2 lookAtHigh;uniform vec2 lookAtLow;uniform mat4 viewProjMatrix;uniform vec2 pixelSize;uniform vec2 shift;uniform sampler2D visibility;uniform sampler2D overlap;uniform sampler2D scene;uniform vec2 idHalfPxSize;uniform lowp float currentZoom;uniform lowp float currentTilt;uniform lowp float currentAzimuth;varying vec4 id;const float A=pow(2.,16.);const float B=pow(2.,-31.);const float C=32.;const vec4 D=vec4(2,2,2,1);const vec4 E=vec4(0,0,0,0);const vec2 F=vec2(0,0);const float G=255./256.;const float H=0.05;const float I=0.15;const float J=0.02;bool K(vec2 L,vec2 idHalfPxSize,sampler2D overlap,sampler2D scene){vec2 M=texture2D(overlap,L).rg;return M!=F&&texture2D(scene,M*G+idHalfPxSize)!=E;}float N(vec2 id,vec2 idHalfPxSize,sampler2D visibility,sampler2D overlap,sampler2D scene,float currentZoom,float currentTilt,float currentAzimuth){vec2 L=id/256.+idHalfPxSize;vec4 O=texture2D(visibility,L);float P=O.b;float Q=O.r;float R=O.g;float S=P-currentZoom;float T=abs(Q-currentTilt);float U=abs(R-currentAzimuth);if((S>H||(abs(S)<=H&&T<I&&U<J))&&K(L,idHalfPxSize,overlap,scene)){return-1.;}return O.a;}void main(){float V=N(vertexId.xy,idHalfPxSize,visibility,overlap,scene,currentZoom,currentTilt,currentAzimuth);if(V<0.){gl_Position=D;}else{vec4 W=viewProjMatrix*vec4((A*(vertexPosHigh-lookAtHigh)+(vertexPosLow-lookAtLow))*B,0,1);vec2 X=(vertexDisplacement+vertexOffset)/C;gl_Position=vec4(W.xy/W.w+X*pixelSize,vertexPriority,1.);gl_Position.xy+=shift;id=vec4(vertexId.xy/255.,0,V);}}"},function(t,e,i){"use strict";var r=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var i;try{(i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),i=i.getBlob()}catch(s){i=new Blob([t])}return new Worker(r.createObjectURL(i))}catch(s){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(s){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}},function(t,e,i){"use strict";i.r(e);var r={};i.r(r),i.d(r,"createContentProvider",function(){return Kn}),i.d(r,"Engine",function(){return Er}),i.d(r,"Camera",function(){return Hr}),i.d(r,"Context",function(){return rs}),i.d(r,"EventTrigger",function(){return s}),i.d(r,"YMapContentProvider",function(){return Fe}),i.d(r,"VectorMapContentProvider",function(){return Kt}),i.d(r,"IndoorContentProvider",function(){return Pe}),i.d(r,"VECTOR_METADATA_PREFIX",function(){return Lt}),i.d(r,"IndoorPlan",function(){return Qt}),i.d(r,"CoveredByIndoorFilter",function(){return Se}),i.d(r,"CoveredByIndoorFiltersContainer",function(){return Re}),i.d(r,"BackgroundRenderUnit",function(){return cs}),i.d(r,"BackgroundColor",function(){return hs}),i.d(r,"LayerRenderUnit",function(){return us}),i.d(r,"FxaaRenderUnit",function(){return ms}),i.d(r,"createColorTransform",function(){return Ae}),i.d(r,"ModelsAnimationManager",function(){return gs}),i.d(r,"PolylineRenderUnit",function(){return Ms}),i.d(r,"PointLabelRenderUnit",function(){return Ds}),i.d(r,"IconRenderUnit",function(){return tn}),i.d(r,"TransparentPolygonRenderUnit",function(){return fn}),i.d(r,"PolygonRenderUnit",function(){return dn}),i.d(r,"ModelRenderUnit",function(){return zn}),i.d(r,"CurvedLabelRenderUnit",function(){return In}),i.d(r,"DebugFakePrimitiveRenderUnit",function(){return Ln}),i.d(r,"ColorIdPointLabelRenderer",function(){return Vn}),i.d(r,"LabelResetRemovedRenderer",function(){return Nn}),i.d(r,"ColorIdCurvedLabelRenderer",function(){return Xn}),i.d(r,"ColorIdIconRenderer",function(){return Zn}),i.d(r,"CollidingPrimitiveColorIdRenderer",function(){return Tr}),i.d(r,"CollidingPrimitivesResetRemovedRenderer",function(){return kr});class s{constructor(){this._listeners=new Map}addListener(t,e){this._listeners.set(t,e)}removeListener(t){this._listeners.delete(t)}fire(...t){for(const[e,i]of this._listeners)e.call(i,...t)}}class n{constructor(t){this._rootCommunicator=t,this._listeners={},this._rootCommunicator.onMessage.addListener(this._onMessage,this)}destructor(){this._rootCommunicator.onMessage.removeListener(this._onMessage)}getCommunicator(t){let e=this._listeners[t];return e||(e=new s,this._listeners[t]=e),{onMessage:e,sendMessage:(e,i,...r)=>{this._rootCommunicator.sendMessage({type:t,message:e},i,...r)}}}_onMessage(t){const e=this._listeners[t.type];e&&e.fire(t.message)}}function o(t,e="something that is supposed to be defined is undefined"){if(void 0===t)throw new Error(e);return void 0!==t}class a{constructor(t,e,i){this.id=i,this.page=t,this.location=e}}class l extends a{}function h(t,e){const i=[];for(const r of e){const e=t.getPage(r.location.bufferId);o(e)&&i.push(new l(e,r.location,r.id))}return i}function*c(t){for(const e in t)yield Number(e)}class d extends a{constructor(t,e,i,r){super(t,e,r),this.texture=i}}class u extends d{}function f(t,e,i){const r=[];for(const s of i){const i=t.getPage(s.location.bufferId),n=e.getAtlas(s.atlasId);o(i)&&o(n)&&r.push(new u(i,s.location,n.texture,s.id))}return r}class _ extends d{constructor(t,e,i,r,s){super(t,e,i,s),this.minZoom=r}}function p(t,e,i,r){const s=[];for(const n of i){const i=t.getPage(n.location.bufferId),a=e.getAtlas(n.atlasId);o(i)&&o(a)&&s.push(new _(i,n.location,a.texture,r,n.id))}return s}class m extends d{constructor(t,e,i,r,s,n){super(t,e,i,n),this.zIndex=r,this.minZoom=s}}function g(t,e,i,r){const s=[];for(const n of i){const i=t.getPage(n.location.bufferId),a=e.getAtlas(n.atlasId);o(i)&&o(a)&&s.push(new m(i,n.location,a.texture,n.zIndex,r,n.id))}return s}class v{constructor(t,e,i,r){this._registry=t,this._glyphAtlasRegistry=e,this._iconAtlasRegistry=i,this._additionalMetadata=r}destructor(){}_instantiatePrimitives(t,e){const i={primitives:{},references:[]};for(const r of c(t.primitives))switch(r){case 0:case 1:case 2:i.primitives[r]=h(this._registry,t.primitives[r]);break;case 3:i.primitives[r]=f(this._registry,this._iconAtlasRegistry,t.primitives[r]);break;case 4:case 5:{const s=Math.max(e-2,0);i.primitives[r]=p(this._registry,this._glyphAtlasRegistry,t.primitives[r],s);break}case 6:{const s=Math.max(e-1,0);i.primitives[r]=g(this._registry,this._iconAtlasRegistry,t.primitives[r],s);break}}return t.metadata&&(i.metadata=t.metadata,this._applyAdditionalMetadata(t.metadata)),t.references&&(i.references=i.references||[],i.references.push(...t.references)),i}_applyAdditionalMetadata(t){if(t&&this._additionalMetadata)for(const e of t.values())for(const[t,i]of this._additionalMetadata)e.set(t,i)}}class y extends v{constructor(t,e,i,r,n,o,a,l){super(r,n,o,l),this._communicator=t,this._options=a,this._storage=e,this._modelStorage=i,this._onTileContentAdded=this.onTileContentAdded=new s,this._communicator.onMessage.addListener(this._onMessage,this),this._communicator.sendMessage({type:0,options:this._options},!1),this._options.customizationConfig&&this._options.customizationConfig.length&&this._updateCustomizationConfig()}destructor(){this._communicator.onMessage.removeListener(this._onMessage),super.destructor()}updateOption(t,e){this._options[t]=e,this._communicator.sendMessage({type:0,options:this._options},!1)}updateCustomizationConfig(t){this._options.customizationConfig=t,this._updateCustomizationConfig()}getOption(t){return this._options[t]}_onMessage(t){switch(t.type){case 3:this._onAddPrimitives(t);break;case 5:this._onAddModelPrimitives(t);break;case 4:this._onRemovePrimitives(t)}}_onAddPrimitives(t){const e=this._storage.get(t.tileId);if(o(e)){const i=this._instantiatePrimitives(t.content,e.tile.zoom);e.addContent(i),this._onTileContentAdded.fire(e,i,t.metrics)}}_onRemovePrimitives(t){const e=this._storage.get(t.tileId);if(o(e)){const n={primitives:{},references:[]};for(const o of t.content)i=n.primitives,r=o,s=e.content.primitives[o],i[r]=s;e.removeContent(n)}var i,r,s}_onAddModelPrimitives(t){const e=this._modelStorage.get(t.modelId),i=t.content.primitives[2],r=t.content.metadata;if(o(e)&&o(i)){const t=h(this._registry,i);this._applyAdditionalMetadata(r),e.addContent({primitives:{2:t},metadata:r})}}_updateCustomizationConfig(){this._communicator.sendMessage({type:2,customizationConfig:this._options.customizationConfig},!1)}}function x(t,e){return t.x+"_"+t.y+"_"+t.zoom+"_"+e}function b(t,e){return Object.assign(Object.assign({},t),{id:x(t,e)})}function w(t,e){const i=[];for(const[r,s]of t)e.has(r)||i.push(s);return i}function A(t,e,i){let r=t.get(e);return r||(r=i(),t.set(e,r)),r}new Array;const T={x:0,y:0,zoom:0};class P{constructor(t,e,i=.5,r=1/0){this._camera=t,this._zoomShift=function(t){switch(e){case 1:return-1;case 2:return-2;default:return 0}}(),this._targetZoomShift=i,this._maxZoomWithTilesLoading=r}recalculateVisibleTiles(){const t=this._camera,e=Math.min(this._getTargetZoom(),this._maxZoomWithTilesLoading);return function*(t,e,i,r,s){if(0===s)return void(yield T);const n=1<<s,o=n-1,{minX:a,maxX:l,minY:h,maxY:c}=e,d=Math.floor((a+1)*n/2),u=Math.floor((l+1)*n/2),f=u-d+1,_=new Array(f),p=new Array(f);_.fill(Math.floor((1-h)*n/2)),p.fill(Math.floor((1-c)*n/2));const m=t.length;let g=t[m-1].x+1,v=1-t[m-1].y,y=Math.floor(g*n/2),x=Math.floor(v*n/2);for(let b=0;b<m;++b){const e=t[b].x+1,i=1-t[b].y,r=Math.floor(e*n/2),s=Math.floor(i*n/2),o=Math.abs(r-y)+Math.abs(s-x),a=e-g,l=i-v,h=a>0?1:-1,c=l>0?1:-1,u=2*h*l,f=-2*h*a,m=h*n*(a*v-l*g)+u*(~h>>>31);for(let t=0,n=y,g=x;t<o;++t){const t=u*n+f*g+m;0<=t&&t<=-f?n+=h:g+=c;const e=n-d;p[e]<g&&(p[e]=g),_[e]>g&&(_[e]=g)}g=e,v=i,y=r,x=s}if(2===i&&f>n)for(let b=0;b<n;++b)for(let t=b+n;t<f;t+=n)p[b]<p[t]&&(p[b]=p[t]),_[b]>_[t]&&(_[b]=_[t]);if(2===r)for(let b=0;b<f&&b<n;++b){const t=p[b]-_[b];if(t>n)_[b]=0,p[b]=o;else{const e=_[b]&=o;p[b]=e+t}}else for(let b=0;b<f&&b<n;++b)_[b]=Math.max(_[b],0),p[b]=Math.min(p[b],o);if(2===i)for(let b=0;b<f&&b<n;++b){const t=b+d&o;for(let e=_[b];e<=p[b];++e)yield{x:t,y:e&o,zoom:s}}else for(let b=Math.max(d,0),w=Math.min(u,o);b<=w;++b){const t=b-d;for(let e=_[t];e<=p[t];++e)yield{x:b,y:e&o,zoom:s}}}(t.getVisibleRegion(),t.getVisibleRegionBBox(),t.options.wrapModeX,t.options.wrapModeY,Math.max(0,e+this._zoomShift))}_getTargetZoom(){return Math.floor(this._camera.zoom+this._targetZoomShift)}}class S{constructor(t,e,i,r=new P(e,i.tileSize,i.targetZoomShift,i.maxZoomWithTilesLoading),n=""){this._camera=e,this._communicator=t,this._options=i,this._visibleTilesCalculator=r,this._tileIdPrefix=n,this._visibleTiles=new Map,this.onViewportChanged=this._onViewportChanged=new s,this._onCameraUpdateWrapper=this._onCameraUpdate.bind(this),this._camera.onUpdate.addListener(this._onCameraUpdateWrapper),this._syncOptions()}get visibleTiles(){return this._visibleTiles.values()}set tileIdPrefix(t){this._tileIdPrefix=t,this._syncOptions()}destructor(){this.pause(),this._camera.onUpdate.removeListener(this._onCameraUpdateWrapper)}forceCameraStateRecalculation(){this._onCameraUpdate()}pause(){this._camera.onUpdate.removeListener(this._onCameraUpdateWrapper),this._fireUpdates([],[...this._visibleTiles.values()]),this._visibleTiles.clear()}resume(){this._camera.onUpdate.addListener(this._onCameraUpdateWrapper,this),this.forceCameraStateRecalculation()}_onCameraUpdate(){const t=new Map;for(const s of this._visibleTilesCalculator.recalculateVisibleTiles()){const e=b(s,this._tileIdPrefix);t.set(e.id,e)}const e=this._visibleTiles;this._visibleTiles=t;const i=w(t,e),r=w(e,t);(i.length>0||r.length>0)&&this._fireUpdates(i,r)}_syncOptions(){var t;this._communicator.sendMessage({type:0,tileIdPrefix:this._tileIdPrefix,preloadedTilesBeltWidth:this._options.preloadedTilesBeltWidth,useLowPrecisionBeltTiles:(t=this._options.useLowPrecisionBeltTiles,null==t||t),wrapModeX:this._camera.options.wrapModeX,wrapModeY:this._camera.options.wrapModeY},!1)}_fireUpdates(t,e){this._onViewportChanged.fire({visibleAdded:t,visibleRemoved:e}),this._communicator.sendMessage({type:1,cameraPosition:{x:this._camera.center.x,y:this._camera.center.y,zoom:this._camera.zoom},visibleTilesToAdd:t,visibleTilesToRemove:e},!0)}}class R{constructor(){this._items=new Map,this.onAdded=this._onAdded=new s,this.onRemoved=this._onRemoved=new s}get size(){return this._items.size}get items(){return this._items.values()}get(t){return this._items.get(t)}has(t){return this._items.has(t)}_add(t,e){this._items.set(t,e),this._onAdded.fire(e)}_remove(t){const e=this._items.get(t);e&&(this._items.delete(t),this._onRemoved.fire(e))}}class M extends R{constructor(t){super(),this._communicator=t,this._communicator.onMessage.addListener(this._onMessage,this)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}_onMessage(t){switch(t.type){case 0:this._onAdd(t);break;case 1:this._onRemove(t)}}_onAdd(t){this._add(t.id,this._deserialize(t.item))}_onRemove(t){this._remove(t.id)}}function z(t,e){return t>e?1:t<e?-1:0}function C(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function k(t,e,i=0,r=t.length,s=0){for(let n=i,o=s;n<r;++n,++o)e[o]=t[n]}function B(t,e=z,i=0,r=t.length){for(let s=i;s<r;++s)for(let r=s;r>i&&e(t[r-1],t[r])>0;--r)C(t,r-1,r)}function O(t,e,i,r,s,n,o){let a=o,l=r,h=s;for(;l<s&&h<n;)e[a++]=i(t[l],t[h])>0?t[h++]:t[l++];k(t,e,l,s,a),k(t,e,h,n,a)}function I(t,e){let i=0;for(let r=0;r<t.length;r++)e.has(t[r])||(t[i]=t[r],i++);t.length=i}class E{constructor(t){this.content=this._content=t,this.onContentAdded=this._onContentAdded=new s,this.onContentRemoved=this._onContentRemoved=new s}addContent(t){for(const e of c(t.primitives))this._content.primitives[e]||(this._content.primitives[e]=[]),this._content.primitives[e].push(...t.primitives[e]);if(t.references&&(this._content.references=this._content.references||[],this._content.references.push(...t.references)),t.metadata){this._content.metadata=this._content.metadata||new Map;for(const[e,i]of t.metadata)this._content.metadata.set(e,i)}this._onContentAdded.fire(this,t)}removeContent(t){for(const e of c(t.primitives)){const i=this._content.primitives[e];i&&I(i,new Set(t.primitives[e]))}if(t.references&&this._content.references){const e=new Set(t.references);I(this._content.references,e)}if(t.metadata&&this._content.metadata)for(const e of t.metadata.keys())this._content.metadata.delete(e);this._onContentRemoved.fire(this,t)}}class L extends E{constructor(t){super({primitives:{},references:[]}),this.id=t.id,this.tile=t}}class U extends M{_deserialize(t){return new L(t)}}class D{constructor(t,e,i,r){this._context=t,this.vertexBuffer=this._context.createVertexBuffer(i),this.indexBuffer=this._context.createIndexBuffer(r),this.vao=this._context.createVao(e,this.vertexBuffer,this.indexBuffer),this.indexType=5123}destructor(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.vao.destroy()}updateVertexContent(t,e){this._context.bindVao(null),this._context.uploadDataToBuffer(this.vertexBuffer,t,e)}updateIndexContent(t,e){this._context.bindVao(null),this._context.uploadDataToBuffer(this.indexBuffer,t,e)}}var F;!function(t){t[t.FROM_BACKEND_ADD_PAGE=0]="FROM_BACKEND_ADD_PAGE",t[t.FROM_BACKEND_UPDATE_PAGE=1]="FROM_BACKEND_UPDATE_PAGE",t[t.FROM_BACKEND_REMOVE_PAGE=2]="FROM_BACKEND_REMOVE_PAGE"}(F||(F={}));class V{constructor(t,e){this._communicator=t,this._context=e,this._pages=new Map,this.memoryUsage=this._memoryUsage={memoryForBuffers:0,memoryForVertices:0,memoryForIndices:0},this.onMemoryUsageChanged=this._onMemoryUsageChanged=new s,this._communicator.onMessage.addListener(this._onMessage,this)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}getPage(t){return this._pages.get(t)}_onMessage(t){switch(t.type){case F.FROM_BACKEND_ADD_PAGE:this._onPageAdd(t);break;case F.FROM_BACKEND_UPDATE_PAGE:this._onPageUpdate(t);break;case F.FROM_BACKEND_REMOVE_PAGE:this._onPageRemove(t)}}_onPageAdd(t){this._pages.set(t.id,new D(this._context,t.attribMapping,t.vertexDataByteSize,t.indexDataByteSize))}_onPageUpdate(t){const e=this.getPage(t.id);o(e)&&(e.updateVertexContent(t.vertexData,t.vertexByteOffset),e.updateIndexContent(t.indexData,t.indexByteOffset))}_onPageRemove(t){const e=this._pages.get(t.id);o(e)&&(this._pages.delete(t.id),e.destructor())}}function*j(t,e){for(const i of t)yield e(i)}function*N(t,e){for(const i of t)e(i)&&(yield i)}function H(t,e){for(const i of t)if(!e(i))return!1;return!0}function W(t,e){let i=0;for(const r of t)e&&!e(r)||i++;return i}function q(t){let e="";for(let i=t.zoom;i>0;i--){let r="0";const s=1<<i-1;0!=(t.x&s)&&(r="1"),0!=(t.y&s)&&(r="1"===r?"3":"2"),e+=r}return e}function X(t,e,i){return e<t?t<i?t:i:e}function Y(t,e,i){const r=(t-e)/(i-e);return e+(i-e)*(r-Math.floor(r))}function G(t,e){const i=e.zoom-t.zoom;return i>0&&e.x>>i===t.x&&e.y>>i===t.y}const Z=Date.now(),K="performance"in self&&"now"in performance?performance.now.bind(performance):function(){return Date.now()-Z};class Q{constructor(){this._marks=new Map}mark(t){this._marks.set(t,K())}unmark(t){this._marks.delete(t)}measure(t,e=!1){const i=this._marks.get(t);return void 0!==i?(e||this.unmark(t),K()-i):Q.UNMEASURED}}Q.UNMEASURED=-1;const J={postfix:"",reduce:t=>t[0]},$={postfix:"Avg",reduce:t=>t.reduce((t,e)=>t+e,0)/t.length};class tt{constructor(t,e,i=1,r=[J],s){this._transport=t,this._name=e,this._maxItems=i,this._reducers=r,this._additionalParams=s,this._values={},this._marker=new Q}mark(t){this._marker.mark(t)}unmark(t){this._marker.unmark(t)}putMeasuredValue(t,e=t,i){const r=this._marker.measure(t,i);r!==Q.UNMEASURED&&this.putValue(e,r)}putValue(t,e){let i=this._values[t];i||(i=this._values[t]=[]),i.length<this._maxItems&&i.push(e)}putValues(t){for(const e of Object.keys(t)){const i=t[e];void 0!==i&&this.putValue(e,i)}}submit(){this._transport.submit(this._name,this._getReducedValues())}_getReducedValues(){const t=Object.assign({},this._additionalParams);for(const e of Object.keys(this._values)){const i=this._values[e];if(i&&i.length>0){i.sort((t,e)=>t-e);for(const r of this._reducers)t[e+r.postfix]=r.reduce(i).toFixed(2)}}return t}}function et(t){return!(!t.content.primitives[0]&&!t.content.primitives[1]||!t.content.primitives[4]&&!t.content.primitives[5])}var it,rt;!function(t){t[t.FULL=0]="FULL",t[t.IMMEDIATE=1]="IMMEDIATE"}(it||(it={}));class st{constructor(t,e,i,r,n,o){this._viewport=t,this._storage=e,this._tileContentVisibilityManager=i,this._modelVisibilityManager=r,this._allTileNodes=new Map,this._visualizableTileNodeByQuadKey=new Map,this._visibleTileNodes=new Map,this._visualizedTileNodes=new Map,this._mode=it.FULL,this.onViewportStateChanged=this._onViewportStateChanged=new s,this.viewportState=this._viewportState={visibleTileNumber:0,visualizableTileNumber:0},this._viewport.onViewportChanged.addListener(this._onViewportUpdate,this),this._storage.onAdded.addListener(this._onTileAdd,this),this._storage.onRemoved.addListener(this._onTileRemove,this),this._metrics=new tt(n,"vector."+o+".viewport",1024,[$])}submitMetrics(){this._metrics.submit()}destructor(){this._viewport.onViewportChanged.removeListener(this._onViewportUpdate),this._storage.onAdded.removeListener(this._onTileAdd),this._storage.onRemoved.removeListener(this._onTileRemove),clearTimeout(this._changeModeTimer)}_onTileAdd(t){const e=et(t),i=this._getTileNode(t.tile);i.tile=t,i.isVisualizable=e,e&&this._visualizableTileNodeByQuadKey.set(i.quadKey,i),i.isVisible&&i.isVisualizable&&!i.isVisualized&&this._tryToVisualizeViewport(),t.onContentAdded.addListener(this._onTileContentAdded,this)}_onTileContentAdded(t){const e=this._getTileNode(t.tile);e.isVisualizable=e.isVisualizable||et(t),e.isVisualizable&&this._visualizableTileNodeByQuadKey.set(e.quadKey,e),e.isVisible&&e.isVisualizable&&this._tryToVisualizeViewport()}_onTileRemove(t){const e=this._getTileNode(t.tile);e.isVisible||(this._allTileNodes.delete(e.tileItem.id),this._visualizableTileNodeByQuadKey.delete(e.quadKey)),e.isVisualized&&this._makeNotVisualized(e),delete e.tile,t.onContentAdded.removeListener(this._onTileContentAdded)}_onViewportUpdate({visibleAdded:t,visibleRemoved:e}){for(const i of t){const t=this._getTileNode(i);this._makeVisible(t)}for(const i of e){const t=this._getTileNode(i);this._makeNotVisible(t)}if(t.length>0){const e=new Set,i=t[0].zoom;for(const t of this._visualizedTileNodes.values())e.add(t.tileItem.zoom);if(e.size<=2&&e.has(i+1))for(const t of this._visibleTileNodes.values())if(t.isVisualizable)this._makeVisualized(t);else for(let e=0;e<4;e++){const i=this._visualizableTileNodeByQuadKey.get(t.quadKey+e);i&&this._makeVisualized(i)}else if(e.size<=2&&e.has(i))for(const t of this._visibleTileNodes.values())if(t.isVisualizable)this._makeVisualized(t);else{const e=t.quadKey.slice(0,-1),i=this._visualizableTileNodeByQuadKey.get(e);if(i){let t=!0;for(let i=0;i<4;i++)this._visualizableTileNodeByQuadKey.get(e+i)&&(t=!1);t&&this._makeVisualized(i)}}}this._changeModeTimer||this._mode!==it.FULL||(this._changeModeTimer=setTimeout(()=>{this._mode=it.IMMEDIATE,this._tryToVisualizeViewport()},800)),this._tryToVisualizeViewport()}_tryToVisualizeViewport(){const t=this._visibleTileNodes.size;if(t===W(this._visibleTileNodes.values(),t=>t.isVisualizable)){clearTimeout(this._changeModeTimer),this._changeModeTimer=0,this._mode=it.FULL;for(const t of this._visualizedTileNodes.values())t.isVisible||this._makeNotVisualized(t);for(const t of this._visibleTileNodes.values())this._makeVisualized(t)}else if(this._mode===it.IMMEDIATE)for(const i of this._visibleTileNodes.values())if(!i.isVisualized&&i.isVisualizable){let t=!1;for(const e of this._visualizedTileNodes.values())if(G(i.tileItem,e.tileItem))this._makeNotVisualized(e);else if(G(e.tileItem,i.tileItem)){const i=e,r=[];for(const t of this._visibleTileNodes.values())G(i.tileItem,t.tileItem)&&r.push(t);H(r,t=>t.isVisualizable)?this._makeNotVisualized(i):t=!0}t||this._makeVisualized(i)}const e=W(this._visibleTileNodes.values(),t=>t.isVisualized);t===this._viewportState.visibleTileNumber&&e===this._viewportState.visualizableTileNumber||(this._viewportState.visibleTileNumber=t,this._viewportState.visualizableTileNumber=e,this._onViewportStateChanged.fire(this._viewportState))}_makeVisible(t){t.isVisible||(t.isVisible=!0,this._visibleTileNodes.set(t.id,t),this._metrics.mark(t.id))}_makeNotVisible(t){t.isVisible&&(t.isVisible=!1,this._visibleTileNodes.delete(t.id),this._metrics.unmark(t.id))}_makeVisualized(t){const e=t.tile;t.isVisualizable&&!t.isVisualized&&e&&(this._tileContentVisibilityManager.showObject(e),this._modelVisibilityManager.showTileModels(e),t.isVisualized=!0,this._visualizedTileNodes.set(t.id,t),this._metrics.putMeasuredValue(t.id,"tileVisualizationReady"))}_makeNotVisualized(t){const e=t.tile;t.isVisualized&&e&&(this._tileContentVisibilityManager.hideObject(e),this._modelVisibilityManager.hideTileModels(e),t.isVisualized=!1,this._visualizedTileNodes.delete(t.id))}_getTileNode(t){const e=this._allTileNodes.get(t.id);if(e)return e;{const e={id:t.id,tileItem:t,quadKey:q(t),isVisualizable:!1,isVisible:!1,isVisualized:!1};return this._allTileNodes.set(t.id,e),e}}}function nt(){return devicePixelRatio>1?devicePixelRatio:1}function ot(t,e){return{x:t,y:e}}!function(t){t[t.TO_BACKEND_SETUP=0]="TO_BACKEND_SETUP",t[t.FROM_BACKEND_ADD_ATLAS=1]="FROM_BACKEND_ADD_ATLAS",t[t.FROM_BACKEND_UPDATE_ATLAS=2]="FROM_BACKEND_UPDATE_ATLAS",t[t.FROM_BACKEND_REMOVE_ATLAS=3]="FROM_BACKEND_REMOVE_ATLAS"}(rt||(rt={}));const at=ot(0,0);function lt(t,e=ot(0,0)){return e.x=t.x,e.y=t.y,e}function ht(t,e,i=ot(0,0)){return i.x=t.x+e.x,i.y=t.y+e.y,i}function ct(t,e,i=ot(0,0)){return i.x=t.x*e,i.y=t.y*e,i}function dt(t,e,i=ot(0,0)){return i.x=e(t.x),i.y=e(t.y),i}function ut(t,e,i,r){return{minX:t,maxX:e,minY:i,maxY:r}}function ft(t,e={minX:0,maxX:0,minY:0,maxY:0}){if(0===t.length)return e;e.minX=e.maxX=t[0].x,e.minY=e.maxY=t[0].y;for(let i=1;i<t.length;++i){const{x:r,y:s}=t[i];r<e.minX&&(e.minX=r),r>e.maxX&&(e.maxX=r),s<e.minY&&(e.minY=s),s>e.maxY&&(e.maxY=s)}return e}function _t(t=0,e=0){return{width:t,height:e}}function pt(t,e=_t()){return e.width=t.width,e.height=t.height,e}function mt(t,e){return t.width===e.width&&t.height===e.height}ot(1,0),ot(-1,0),ot(0,1),ot(0,-1);class gt{constructor(t,e,i){this._context=t,this.texture=t.createEmpty2DTexture(e,i,6406,5121,{wrapS:33071,wrapT:33071,magnificationFilter:9729,minificationFilter:9729,premultipliedAlpha:!1,unpackAlignment:1}),"string"==typeof navigator.vendor&&navigator.vendor.match(/^Apple/)&&this.updateContent(ot(0,0),_t(1,1),new Uint8Array(1))}destructor(){this.texture.destroy()}updateContent(t,e,i){this._context.setTextureData(this.texture,i,t,e)}}class vt{constructor(t,e,i){this._communicator=t,this._context=i,this._atlases=[],this.memoryUsage=this._memoryUsage={memoryForGlyphs:0},this.onMemoryUsageChanged=this._onMemoryUsageChanged=new s,this._communicator.onMessage.addListener(this._onMessage,this),this._communicator.sendMessage({type:rt.TO_BACKEND_SETUP,options:e},!1)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}getAtlas(t){return this._atlases[t]}_onMessage(t){switch(t.type){case rt.FROM_BACKEND_ADD_ATLAS:this._onAtlasAdd(t);break;case rt.FROM_BACKEND_UPDATE_ATLAS:this._onAtlasUpdate(t);break;case rt.FROM_BACKEND_REMOVE_ATLAS:this._onAtlasRemove(t)}}_onAtlasAdd(t){this._atlases[t.atlasId]=new gt(this._context,t.width,t.height)}_onAtlasUpdate(t){const{atlasId:e,data:i,offset:r,size:s}=t,n=this._atlases[e];o(n)&&n.updateContent(r,s,i)}_onAtlasRemove(t){const e=this._atlases[t.atlasId];o(e)&&(e.destructor(),delete this._atlases[t.atlasId])}}var yt;!function(t){t[t.TO_BACKEND_SETUP=0]="TO_BACKEND_SETUP",t[t.FROM_BACKEND_ADD_ATLAS=1]="FROM_BACKEND_ADD_ATLAS",t[t.FROM_BACKEND_UPDATE_ATLAS=2]="FROM_BACKEND_UPDATE_ATLAS",t[t.FROM_BACKEND_REMOVE_ATLAS=3]="FROM_BACKEND_REMOVE_ATLAS"}(yt||(yt={}));class xt{constructor(t,e,i){this._context=t,this.texture=t.createEmpty2DTexture(e,i,6408,5121,{wrapS:33071,wrapT:33071,magnificationFilter:9728,minificationFilter:9728,premultipliedAlpha:!0,unpackAlignment:1}),this.onContentUpdated=this._onContentUpdated=new s}destructor(){this.texture.destroy()}updateContent(t){this._context.setTextureData(this.texture,t.data,t.offset,t.size),this._onContentUpdated.fire()}}class bt{constructor(){this.onReleased=this._onReleased=new s,this.onRetain=this._onRetain=new s,this._clients=0}get isRetained(){return 0!==this._clients}retain(){++this._clients,this._onRetain.fire(this)}release(){this._clients>0&&(--this._clients,0===this._clients&&this._onReleased.fire(this))}}class wt{constructor(t){this._comparator=t,this._size=0}get root(){return this._root}get size(){return this._size}get min(){if(this._root)return this._min(this._root).value}get max(){if(this._root)return this._max(this._root).value}insert(t){if(this._size++,!this._root)return this._root={value:t},this._root;let e=this._root;for(;e;)if(this._comparator(t,e.value)<0){if(!e.left)return e.left={parent:e,value:t};e=e.left}else{if(!e.right)return e.right={parent:e,value:t};e=e.right}throw new Error}remove(t){if(this._size--,t.left&&t.right){const e=this._min(t.right);this._replaceSubtree(t,e),t.left&&(e.left=t.left,t.left.parent=e),t.right&&(e.right=t.right,t.right.parent=e)}else t.left?this._replaceSubtree(t,t.left):t.right?this._replaceSubtree(t,t.right):this._replaceSubtree(t,void 0)}*values(t){t&&(yield*this.values(t.left),yield t.value,yield*this.values(t.right))}[Symbol.iterator](){return this.values(this._root)}_min(t){let e=t;for(;e.left;)e=e.left;return e}_max(t){let e=t;for(;e.right;)e=e.right;return e}_replaceSubtree(t,e){t.parent?t.parent.left===t?t.parent.left=e:t.parent.right===t&&(t.parent.right=e):this._root=e,e&&(e.parent&&(e.parent.left===e?e.parent.left=void 0:e.parent.right===e&&(e.parent.right=void 0)),e.parent=t.parent)}}class At{constructor(){this._nodes=new Map}get begin(){return this._begin&&this._begin.value}get end(){return this._end&&this._end.value}insert(t){if(!this._nodes.has(t)){const e={value:t};this._end?this.insertAfter(this._end.value,t):(this._begin=this._end=e,this._nodes.set(t,e))}}insertBefore(t,e){const i=this._nodes.get(t);if(i&&!this._nodes.has(e)){const t={value:e};i.prev&&(i.prev.next=t,t.prev=i.prev),t.next=i,i.prev=t,this._nodes.set(e,t),i===this._begin&&(this._begin=t)}}insertAfter(t,e){const i=this._nodes.get(t);if(i&&!this._nodes.has(e)){const t={value:e};i.next&&(i.next.prev=t,t.next=i.next),t.prev=i,i.next=t,this._nodes.set(e,t),i===this._end&&(this._end=t)}}remove(t){const e=this._nodes.get(t);e&&(e===this._begin&&(this._begin=e.next),e===this._end&&(this._end=e.prev),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next),this._nodes.delete(t))}getPrev(t){const e=this._nodes.get(t);if(e&&e.prev)return e.prev.value}getNext(t){const e=this._nodes.get(t);if(e&&e.next)return e.next.value}*values(){let t=this._begin;for(;t;)yield t.value,t=t.next}[Symbol.iterator](){return this.values()}}class Tt{constructor(t,e=1){this._size=t,this._alignment=e,this._freeOffset=0,this._allocatedOffsets=new Set}get size(){return this._size}get maxAllocableSize(){return this._size-this._freeOffset}get isEmpty(){return 0===this._allocatedOffsets.size}allocate(t){if(this._size>=this._freeOffset+t){const e=this._freeOffset;return this._freeOffset=function(t,e){return e*Math.ceil(t/e)}(e+t,this._alignment),this._allocatedOffsets.add(e),e}return-1}deallocate(t){this._allocatedOffsets.delete(t)}isAllocated(t){return t<this._freeOffset}extend(t){if(t<this._freeOffset)throw new Error("Could not reduce the size because it conflicts with already allocated region.");this._size=t}}class Pt{constructor(t){this._size=t,this._allRegions=new At,this._occupiedRegions=new Map,this._freeRegions=new wt((t,e)=>t.size-e.size);const e={offset:0,size:t};this._allRegions.insert(e),e._freeNode=this._freeRegions.insert(e)}get size(){return this._size}get maxAllocableSize(){const t=this._freeRegions.max;return t?t.size:0}get isEmpty(){return 0===this._occupiedRegions.size}allocate(t){const e=this._findMinSuitable(t);if(!e)return-1;const i=e.value;this._freeRegions.remove(e);const r={offset:i.offset,size:t};if(this._occupiedRegions.set(i.offset,r),this._allRegions.insertAfter(i,r),this._allRegions.remove(i),i.size>t){const e={offset:i.offset+t,size:i.size-t};e._freeNode=this._freeRegions.insert(e),this._allRegions.insertAfter(r,e)}return r.offset}deallocate(t){let e=this._occupiedRegions.get(t);if(e){const i=this._allRegions.getPrev(e);if(i&&i._freeNode){const t={offset:i.offset,size:i.size+e.size};this._allRegions.insertAfter(i,t),this._allRegions.remove(e),this._allRegions.remove(i),this._freeRegions.remove(i._freeNode),e=t}const r=this._allRegions.getNext(e);if(r&&r._freeNode){const t={offset:e.offset,size:e.size+r.size};this._allRegions.insertBefore(r,t),this._allRegions.remove(e),this._allRegions.remove(r),this._freeRegions.remove(r._freeNode),e=t}this._occupiedRegions.delete(t),e._freeNode=this._freeRegions.insert(e)}}isAllocated(t){return this._occupiedRegions.has(t)}extend(t){if(t<this._size)throw new Error("Size reducing is not allowed in free list allocator");const e=t-this._size,i=this._allRegions.end;if(i&&i._freeNode){this._freeRegions.remove(i._freeNode);const t={offset:i.offset,size:i.size+e,isFree:!0};this._allRegions.insertAfter(i,t),this._allRegions.remove(i),this._freeRegions.insert(t)}else{const t={offset:this._size,size:e,isFree:!0};this._allRegions.insert(t),this._freeRegions.insert(t)}this._size=t}_findMinSuitable(t){let e,i=this._freeRegions.root;for(;i;){if(i.value.size===t){e=i;break}i.value.size<t?i=i.right:(e=i,i=i.left)}return e}}class St{constructor(t,e){this.width=t,this.height=e,this._allocator=new Pt(this.width)}allocate(t){return this._allocator.allocate(t)}deallocate(t){this._allocator.deallocate(t)}isAllocated(t){return this._allocator.isAllocated(t)}canAllocate(t){return this._allocator.maxAllocableSize>=t}resize(t){this._allocator.extend(t),this.width=t}}class Rt{constructor(t,e){this.width=t,this.height=e,this._shelves=new Map,this._shelfAllocator=new Tt(e)}allocate(t){let e,i=-1,r=-1;for(const[s,n]of this._shelves.entries()){const o=t.height/n.height;if(1===o&&n.canAllocate(t.width)){e=n,i=s;break}o<1&&o>r&&n.canAllocate(t.width)&&(e=n,i=s,r=o)}if(!e&&this._shelfAllocator.maxAllocableSize>=t.height&&this.width>=t.width){const r=this._shelfAllocator.allocate(t.height);e=new St(this.width,t.height),i=r,this._shelves.set(r,e)}if(e){const r=e.allocate(t.width),s=i;return{minX:r,maxX:r+t.width,minY:s,maxY:s+t.height}}return null}deallocate(t){const e=this._shelves.get(t.minY);e&&e.deallocate(t.minX)}isAllocated(t){const e=this._shelves.get(t.minY);return!!e&&e.isAllocated(t.minX)}resize(t,e){this._shelfAllocator.extend(e);for(const i of this._shelves.values())i.resize(t);this.width=t,this.height=e}}ut(Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);class Mt{constructor(t,e,i){this._communicator=t,this._context=i,this._atlases=[],this.memoryUsage=this._memoryUsage={memoryForIcons:0},this.onMemoryUsageChanged=this._onMemoryUsageChanged=new s,this._communicator.onMessage.addListener(this._onMessage,this),this._communicator.sendMessage({type:yt.TO_BACKEND_SETUP,options:e},!1)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}getAtlas(t){return this._atlases[t]}_onMessage(t){switch(t.type){case yt.FROM_BACKEND_ADD_ATLAS:this._onAddAtlas(t);break;case yt.FROM_BACKEND_UPDATE_ATLAS:this._onUpdateAtlas(t);break;case yt.FROM_BACKEND_REMOVE_ATLAS:this._onRemoveAtlas(t)}}_onAddAtlas(t){this._atlases[t.atlasId]=new xt(this._context,t.atlasWidth,t.atlasHeight)}_onUpdateAtlas(t){const e=this._atlases[t.atlasId];o(e)&&e.updateContent(t.atlasRegion)}_onRemoveAtlas(t){const e=this._atlases[t.atlasId];o(e)&&(e.destructor(),delete this._atlases[t.atlasId])}}class zt extends E{constructor(t){super({primitives:{}}),this.id=t}}class Ct extends M{_deserialize(t){return new zt(t)}}class kt{constructor(t,e){this._contentVisibilityManager=t,this._modelStorage=e,this._modelsToVisualizedTiles=new Map,this._modelStorage.onAdded.addListener(this._onModelAdded,this),this._modelStorage.onRemoved.addListener(this._onModelRemoved,this)}showTileModels(t){for(const e of t.content.references||[]){const i=A(this._modelsToVisualizedTiles,e,()=>new Set);0===i.size&&this._tryToGetAndShowModel(e),i.add(t)}}hideTileModels(t){for(const e of t.content.references||[]){const i=this._modelsToVisualizedTiles.get(e);i&&(i.delete(t),0===i.size&&(this._modelsToVisualizedTiles.delete(e),this._tryToGetAndHideModel(e)))}}_onModelAdded(t){this._modelsToVisualizedTiles.has(t.id)&&this._contentVisibilityManager.showObject(t)}_onModelRemoved(t){this._modelsToVisualizedTiles.has(t.id)&&this._contentVisibilityManager.hideObject(t)}_tryToGetAndShowModel(t){const e=this._modelStorage.get(t);e&&this._contentVisibilityManager.showObject(e)}_tryToGetAndHideModel(t){const e=this._modelStorage.get(t);e&&this._contentVisibilityManager.hideObject(e)}}class Bt{constructor(t,e,i,r,s,n,o){this._storage=r,this._contentManager=s,this._viewport=n,this._tileReadyChecker=o,this._everVisibleTiles=new Set,this._measuringTiles=new Set;const a="vector."+e+".tile_processing";this._metrics=new Ot(t,a,i,{visible:"1"}),r.onRemoved.addListener(this._onTileRemoved,this),s.onTileContentAdded.addListener(this._onTileContentAdded,this),n.onViewportChanged.addListener(this._onViewportChanged,this)}submit(){this._metrics.submit()}destructor(){this._storage.onRemoved.removeListener(this._onTileRemoved),this._contentManager.onTileContentAdded.removeListener(this._onTileContentAdded),this._viewport.onViewportChanged.removeListener(this._onViewportChanged)}_onTileRemoved(t){this._everVisibleTiles.delete(t.id)}_onTileContentAdded(t,e,i){if(this._measuringTiles.has(t.id)){this._metrics.putValues(t.id,i),this._tileReadyChecker(t)&&this._metrics.measure(t.id,"tileReady");const r=e.primitives;(r[0]||r[1])&&this._metrics.measure(t.id,"polygonsReady"),(r[5]||r[4])&&this._metrics.measure(t.id,"labelsReady"),e.primitives[6]&&this._metrics.measure(t.id,"iconsReady")}}_onViewportChanged(t){for(const e of t.visibleAdded)this._everVisibleTiles.has(e.id)||this._storage.get(e.id)||(this._everVisibleTiles.add(e.id),this._measuringTiles.add(e.id),this._metrics.addTilesToMeasure(e.id));for(const e of t.visibleRemoved)this._measuringTiles.delete(e.id)&&this._metrics.removeTileMeasurement(e.id)}}class Ot{constructor(t,e,i,r){const s=[$];this._metrics=new tt(t,e,1024,s,Object.assign({firstViewport:"0"},r)),this._firstViewportMetrics=new tt(t,e,1024,s,Object.assign({firstViewport:"1"},r)),this._firstViewportTiles=new Set,this._isFirstViewport=!0,this._camera=i}addTilesToMeasure(t){this._firstViewportState||(this._firstViewportState={x:this._camera.center.x,y:this._camera.center.y,zoom:this._camera.zoom}),!this._isFirstViewport||this._firstViewportState.x==this._camera.center.x&&this._firstViewportState.y==this._camera.center.y&&this._firstViewportState.zoom==this._camera.zoom||(this._isFirstViewport=!1),this._isFirstViewport?(this._firstViewportTiles.add(t),this._firstViewportMetrics.mark(t)):this._metrics.mark(t)}measure(t,e){this._firstViewportTiles.size>0&&this._firstViewportTiles.has(t)?this._firstViewportMetrics.putMeasuredValue(t,e,!0):this._metrics.putMeasuredValue(t,e,!0)}removeTileMeasurement(t){this._firstViewportTiles.size>0&&this._firstViewportTiles.delete(t)?this._firstViewportMetrics.unmark(t):this._metrics.unmark(t)}putValues(t,e){this._firstViewportTiles.size>0&&this._firstViewportTiles.has(t)?this._firstViewportMetrics.putValues(e):this._metrics.putValues(e)}submit(){this._firstViewportMetrics.submit(),this._metrics.submit()}}class It{constructor(t){this.onUpdate=this._onUpdate=new s,this._camera=t,this._onZoomUpdated=this._onZoomUpdated.bind(this),t.onUpdate.addListener(this._onZoomUpdated)}destructor(){this._camera.onUpdate.removeListener(this._onZoomUpdated)}test(t){return this._camera.zoom>=t.minZoom}_onZoomUpdated(){this._prevZoom!==this._camera.zoom&&(this._onUpdate.fire(),this._prevZoom=this._camera.zoom)}}class Et{constructor(t){this._storages=t,this._index=new Map;for(const e of this._storages){for(const t of e.items)this._onObjectAdded(t);e.onAdded.addListener(this._onObjectAdded,this),e.onRemoved.addListener(this._onObjectRemoved,this)}}destructor(){for(const t of this._storages){for(const e of t.items)this._onObjectRemoved(e);t.onAdded.removeListener(this._onObjectAdded),t.onRemoved.removeListener(this._onObjectRemoved)}}getMetadata(t){var e;return null===(e=this._index.get(t))||void 0===e?void 0:e.metadata}_onObjectAdded(t){this._onContentAdded(t,t.content),t.onContentAdded.addListener(this._onContentAdded,this),t.onContentRemoved.addListener(this._onContentRemoved,this)}_onObjectRemoved(t){this._onContentRemoved(t,t.content),t.onContentAdded.removeListener(this._onContentAdded),t.onContentRemoved.removeListener(this._onContentRemoved)}_onContentAdded(t,e){e.metadata&&this._addPrimitivesMetadata(e.metadata)}_onContentRemoved(t,e){e.metadata&&this._removePrimitivesMetadata(e.metadata)}_addPrimitivesMetadata(t){for(const[e,i]of t.entries())this._retain(e,i)}_removePrimitivesMetadata(t){for(const e of t.keys())this._release(e)}_retain(t,e){const i=this._index.get(t);i?i.count++:this._index.set(t,{metadata:e,count:1})}_release(t){const e=this._index.get(t);e&&(e.count--,0===e.count&&this._index.delete(t))}}const Lt="_vector_";let Ut=0;class Dt{constructor(){this._key=Symbol("array_storage_metadata#"+Ut++),this._data=[],this._isDirty=!1}*[Symbol.iterator](){this._isDirty&&this._shakeDown(),yield*this._data}add(t){let e=this._getMetadata(t);return!e&&(e={index:this._data.push(t)-1},t[this._key]=e,!0)}remove(t){const e=this._getMetadata(t);return!!e&&(delete this._data[e.index],delete t[this._key],this._isDirty=!0,!0)}_shakeDown(){let t=0;for(let e=0;e<this._data.length;++e){const i=this._data[e];if(void 0!==i){const e=this._getMetadata(i);this._data[t]=i,e.index=t,++t}}this._data.length=t,this._isDirty=!1}_getMetadata(t){return t[this._key]}}function Ft(t,e){let i=0;return(...r)=>{i&&clearTimeout(i),i=setTimeout(()=>{i=0,t(...r)},e)}}function Vt(t,e=!1){let i=!1;return(...r)=>{e&&i||(Promise.resolve().then(()=>{t(...r),i=!1}),i=!0)}}class jt{constructor(){this._primitives=new Dt,this.onUpdate=this._onUpdate=new s,this._updateScheduler=Vt(this._fireUpdate.bind(this),!0)}get primitives(){return this._primitives}add(t){for(const e of t)this._primitives.add(e);this._updateScheduler()}delete(t){for(const e of t)this._primitives.remove(e);this._updateScheduler()}_fireUpdate(){this._onUpdate.fire()}}class Nt extends jt{constructor(){super(),this._visiblePrimitives=new Dt}get primitives(){return this.visiblePrimitives}get visiblePrimitives(){return this._visiblePrimitives}add(t){super.add(t),this.show(t)}delete(t){this.hide(t),super.delete(t)}show(t){this._show(t)&&this._updateScheduler()}hide(t){this._hide(t)&&this._updateScheduler()}_show(t){let e=!1;for(const i of t)this._visiblePrimitives.add(i)&&(e=!0);return e}_hide(t){let e=!1;for(const i of t)this._visiblePrimitives.remove(i)&&(e=!0);return e}}class Ht extends Nt{constructor(t){super(),this._appearingEffectDuration=t,this._timeoutIds=new Set,this._removeSchedulerFlagKey=Symbol("1"),this._scheduler=Vt(this._scheduleRemovePrimitives.bind(this),!0),this._scheduledForRemovePrimitives=[]}get primitives(){return this._primitives}add(t){super.add(t);for(const e of t){const t=e[this._removeSchedulerFlagKey];t&&t.isScheduledForRemove&&(t.isScheduledForRemove=!1)}}delete(t){this.hide(t);for(const e of t){let t=e[this._removeSchedulerFlagKey];t||(t={isScheduledForRemove:!0},e[this._removeSchedulerFlagKey]=t),t.isScheduledForRemove=!0}this._scheduledForRemovePrimitives.push(...t),this._scheduler()}destroy(){for(const t of this._timeoutIds)clearTimeout(t)}_scheduleRemovePrimitives(){const t=setTimeout(e=>{super.delete([...N(e,t=>{const e=t[this._removeSchedulerFlagKey];return void 0!==e&&e.isScheduledForRemove})]),this._timeoutIds.delete(t)},this._appearingEffectDuration,[...this._scheduledForRemovePrimitives]);this._scheduledForRemovePrimitives.length=0,this._timeoutIds.add(t)}}class Wt{constructor(...t){this.onUpdate=this._onUpdate=new s,this._filterUpdateListener=()=>this._onUpdate.fire();for(const e of t)e.onUpdate&&e.onUpdate.addListener(this._filterUpdateListener);this._filters=new Set(t)}addFilter(t){this._filters.has(t)||(this._filters.add(t),t.onUpdate&&t.onUpdate.addListener(this._filterUpdateListener),this._onUpdate.fire())}deleteFilter(t){this._filters.delete(t)&&(t.onUpdate&&t.onUpdate.removeListener(this._filterUpdateListener),this._onUpdate.fire())}test(t){return H(this._filters,e=>e.test(t))}}class qt{constructor(t){this._scene=t,this._filter=new Wt,this._visible=new Dt,this._hidden=new Dt,this._onFilterUpdate=this._onFilterUpdate.bind(this),this._filter.onUpdate.addListener(this._onFilterUpdate,this)}addPrimitives(t){const e=[],i=[];for(const r of t)this._filter.test(r)?(e.push(r),this._visible.add(r)):(i.push(r),this._hidden.add(r));this._scene.add(e),this._scene.add(i),this._scene.show(e),this._scene.hide(i)}removePrimitives(t){this._scene.remove(t);for(const e of t)this._visible.remove(e),this._hidden.remove(e)}addFilter(t){this._filter.addFilter(t)}removeFilter(t){this._filter.deleteFilter(t)}_onFilterUpdate(){const t=[];for(const i of this._visible)this._filter.test(i)||(t.push(i),this._visible.remove(i),this._hidden.add(i));this._scene.hide(t);const e=[];for(const i of this._hidden)this._filter.test(i)&&(e.push(i),this._visible.add(i),this._hidden.remove(i));this._scene.show(e)}}class Xt{constructor(t){this._storage=t}add(t){this._storage.add(t)}remove(t){this._storage.delete(t)}show(t){this.add(t)}hide(t){this.remove(t)}}class Yt extends Xt{show(t){this._storage.show(t)}hide(t){this._storage.hide(t)}}class Gt{constructor(t){this._scene=t,this._filteringManagers={}}destructor(){}addFilter(t,e){let i=this._filteringManagers[t];if(!i){const e=this._scene[t],r=e instanceof Nt?new Yt(e):new Xt(e);i=new qt(r),this._filteringManagers[t]=i}return i.addFilter(e),this}removeFilter(t,e){const i=this._filteringManagers[t];i&&i.removeFilter(e)}showObject(t){this._showObjectContent(t,t.content),t.onContentAdded.addListener(this._onContentAdded,this),t.onContentRemoved.addListener(this._onContentRemoved,this)}hideObject(t){this._hideObjectContent(t,t.content),t.onContentAdded.removeListener(this._onContentAdded),t.onContentRemoved.removeListener(this._onContentRemoved)}_showObjectContent(t,e){for(const i of c(e.primitives)){const t=e.primitives[i];if(t&&t.length>0){const e=this._filteringManagers[i];e?e.addPrimitives(t):this._scene[i].add(t)}}}_hideObjectContent(t,e){for(const i of c(e.primitives)){const t=e.primitives[i];if(t){const e=this._filteringManagers[i];e?e.removePrimitives(t):this._scene[i].delete(t)}}}_onContentAdded(t,e){this._showObjectContent(t,e)}_onContentRemoved(t,e){this._hideObjectContent(t,e)}}class Zt{constructor(t,e,i,r,n,o,a){this._isPaused=!1,this.name=t,this._context=e,this._camera=i,this._registry=r,this._glyphAtlasRegistry=n,this._iconAtlasRegistry=o,this._objectMetadataIndex=a,this.scene=this._scene={0:new jt,1:new jt,2:new jt,3:new jt,4:new Ht(150),5:new Ht(150),6:new Ht(150)},this._contentVisibilityManager=new Gt(this._scene),this.memoryUsage=this._memoryUsage=Object.assign(Object.assign(Object.assign({},this._registry.memoryUsage),this._glyphAtlasRegistry.memoryUsage),this._iconAtlasRegistry.memoryUsage),this.onMemoryUsageChanged=this._onMemoryUsageChanged=new s}get isPaused(){return this._isPaused}getObjectMetadata(t){return this._objectMetadataIndex.getMetadata(t)}pause(){this._isPaused=!0}resume(){this._isPaused=!1}_createAdditionalMetadata(){return new Map([[Lt+"layerName",this.name]])}_onMemoryUsageComponentChange(t){Object.assign(this._memoryUsage,t),this._onMemoryUsageChanged.fire(this._memoryUsage)}}class Kt extends Zt{constructor(t,e,i,r,s,o){const a=Object.assign({dpr:nt()},r),l=new n(t),h=new U(l.getCommunicator(1)),c=new Ct(l.getCommunicator(2));super(s,i,e,new V(l.getCommunicator(4),i),new vt(l.getCommunicator(5),a,i),new Mt(l.getCommunicator(6),a,i),new Et([h,c])),this._options=a,this._commutator=l,this._storage=h,this._modelStorage=c,this._viewport=new S(this._commutator.getCommunicator(0),e,this._options),this._tileContentManager=new y(this._commutator.getCommunicator(3),this._storage,this._modelStorage,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,this._options,this._createAdditionalMetadata()),this._contentVisibilityManager.addFilter(4,new It(e)).addFilter(5,new It(e)).addFilter(6,new It(e)),this.visibilityManager=this._visibilityManager=new st(this._viewport,this._storage,this._contentVisibilityManager,new kt(this._contentVisibilityManager,this._modelStorage),o,s),this._metricsCollector=new Bt(o,s,e,this._storage,this._tileContentManager,this._viewport,et),this._tileGeneration=0,this._recalculateViewport(),window.addEventListener("beforeunload",()=>this._submitMetrics())}destructor(){this._viewport.destructor(),this._metricsCollector.destructor(),this._storage.destructor(),this._modelStorage.destructor(),this._tileContentManager.destructor(),this._visibilityManager.destructor(),this._contentVisibilityManager.destructor(),this._registry.destructor(),this._glyphAtlasRegistry.destructor(),this._objectMetadataIndex.destructor(),this._commutator.destructor()}pause(){this._viewport.pause(),super.pause()}resume(){this._viewport.resume(),super.resume()}updateTileUrlTemplate(t){this._tileContentManager.updateOption("tileUrlTemplate",t),this._tileGeneration++,this._recalculateViewport()}setMapMode(t){t!==this._tileContentManager.getOption("mapMode")&&(this._tileContentManager.updateOption("mapMode",t),this._recalculateViewport())}updateCustomizationConfig(t){this._tileContentManager.updateCustomizationConfig(t),this._tileGeneration++,this._recalculateViewport()}addVisibilityFilter(t,e){return this._contentVisibilityManager.addFilter(t,e),this}removeVisibilityFilter(t,e){return this._contentVisibilityManager.removeFilter(t,e),this}_recalculateViewport(){this._viewport.tileIdPrefix=this._getTileIdPrefix(),this._viewport.forceCameraStateRecalculation()}_getTileIdPrefix(){return(1===this._tileContentManager.getOption("mapMode")?"night_":"")+this._tileGeneration.toString()}_submitMetrics(){this._metricsCollector.submit(),this._visibilityManager.submitMetrics()}}class Qt{constructor(t,e,i,r){if(this.id=t,0===e.length)throw new Error("No levels provided for a plan");this.levels=e;const n=this._selectLevelById(e,i);if(!n)throw new Error("Cannot find default level");this.defaultLevel=this._activeLevel=n,this.bbox=r,this.onActiveLevelChange=this._onActiveLevelChange=new s,this.onVisibilityChange=this._onVisibilityChange=new s,this.onOpacityChange=this._onOpacityChange=new s,this._isVisible=!1,this._opacity=1}get activeLevel(){return this._activeLevel}setActiveLevel(t){const e=this._selectLevelById(this.levels,t);if(e&&e!==this._activeLevel){const t=this._activeLevel;this._activeLevel=e,this._onActiveLevelChange.fire({previousLevel:t,currentLevel:e},this)}}get isVisible(){return this._isVisible}set isVisible(t){t!==this._isVisible&&(this._isVisible=t,this._onVisibilityChange.fire(t,this))}get opacity(){return this._opacity}set opacity(t){t!==this._opacity&&(this._opacity=t,this._onOpacityChange.fire(t,this))}_selectLevelById(t,e){return t.find(t=>t.id===e)}}var Jt;!function(t){t[t.SETUP=0]="SETUP",t[t.ADD=1]="ADD",t[t.DESTROY=2]="DESTROY"}(Jt||(Jt={}));class $t{constructor(t,e){this._communicator=t,this._plans=new Map,this.onPlanAdded=this._onPlanAdded=new s,this.onPlanRemoved=this._onPlanRemoved=new s,this._communicator.onMessage.addListener(this._onMessage,this),this._communicator.sendMessage({type:Jt.SETUP,options:e},!0)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}getPlan(t){return this._plans.get(t)}getAllPlans(){return[...this._plans.values()]}_onMessage(t){switch(t.type){case Jt.ADD:this._onAdd(t);break;case Jt.DESTROY:this._onDestroy(t)}}_onAdd(t){const{planId:e,levels:i,defaultLevelId:r,boundary:s}=t,n=new Qt(e,i,r,s);this._plans.set(e,n),this._onPlanAdded.fire(n)}_onDestroy(t){const e=this._plans.get(t.planId);o(e)&&(this._plans.delete(t.planId),this._onPlanRemoved.fire(e))}}class te{constructor(t,e){this._planRegistry=t,this._metadataProvider=e,this.onUpdate=this._onUpdate=new s,this._metaKey=Symbol(),this._currentVersion=0,this._onPlanAdded=this._onPlanAdded.bind(this),this._onPlanRemoved=this._onPlanRemoved.bind(this),this._onPlanVisibilityChange=this._onPlanVisibilityChange.bind(this),this._onPlanLevelChange=this._onPlanLevelChange.bind(this),this._planRegistry.onPlanAdded.addListener(this._onPlanAdded,this),this._planRegistry.onPlanRemoved.addListener(this._onPlanRemoved,this)}destructor(){this._planRegistry.onPlanRemoved.removeListener(this._onPlanRemoved),this._planRegistry.onPlanAdded.removeListener(this._onPlanAdded),this._planRegistry.getAllPlans().forEach(t=>{t.onActiveLevelChange.removeListener(this._onPlanLevelChange),t.onVisibilityChange.removeListener(this._onPlanVisibilityChange)})}test(t){const e=t[this._metaKey];if(e&&e.version===this._currentVersion)return e.result;const i=this._test(t);return e?e.result=i:t[this._metaKey]={version:this._currentVersion,result:i},i}_test(t){const e=t.id&&this._metadataProvider(t.id);if(!e)return!1;const i=e.get("indoor_plan_id");if(!i)return!1;const r=i&&this._planRegistry.getPlan(i);if(!r)return!1;const s=e.get("indoor_level_id");return!!s&&r.isVisible&&r.activeLevel.id===s}_onPlanAdded(t){t.onVisibilityChange.addListener(this._onPlanVisibilityChange),t.onActiveLevelChange.addListener(this._onPlanLevelChange),t.isVisible&&this._fireUpdate()}_onPlanRemoved(t){t.isVisible&&this._fireUpdate(),t.onActiveLevelChange.removeListener(this._onPlanLevelChange),t.onVisibilityChange.removeListener(this._onPlanVisibilityChange)}_onPlanVisibilityChange(){this._fireUpdate()}_onPlanLevelChange(t,e){e.isVisible&&this._fireUpdate()}_fireUpdate(){this._currentVersion++,this._onUpdate.fire()}}function ee(t,e,i){return{x:t,y:e,z:i}}new Array(9);const ie=ee(0,0,0),re=(ee(1,0,0),ee(-1,0,0),ee(0,1,0)),se=(ee(0,-1,0),ee(0,0,1));function ne(t,e=ee(0,0,0)){return e.x=t.x,e.y=t.y,e.z=t.z,e}function oe(t,e,i=ee(0,0,0)){return i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z,i}function ae(t,e,i=ee(0,0,0)){return i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i}function le(t,e=ee(0,0,0)){return function(t,e,i=ee(0,0,0)){return i.x=t.x/e,i.y=t.y/e,i.z=t.z/e,i}(t,function(t){return Math.hypot(t.x,t.y,t.z)}(t),e)}function he(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function ce(t,e,i=ee(0,0,0)){const r=t.y*e.z-t.z*e.y,s=t.z*e.x-t.x*e.z,n=t.x*e.y-t.y*e.x;return i.x=r,i.y=s,i.z=n,i}function de(t,e,i=ee(0,0,0)){const r=Math.cos(e),s=Math.sin(e),n=t.y;return i.x=t.x,i.y=n*r-t.z*s,i.z=n*s+t.z*r,i}function ue(t,e,i=ee(0,0,0)){const r=Math.cos(e),s=Math.sin(e);return t=t===i?ne(t):t,i.x=t.x*r-t.y*s,i.y=t.x*s+t.y*r,i.z=t.z,i}ee(0,0,-1);const fe={normal:se,distance:0};function _e(t,e,i=ee(0,0,0)){const r=he(e.direction,t.normal);if(0===r)return null;const s=(t.distance-he(t.normal,e.origin))/r;return s<0?null:(ne(e.direction,i),ae(i,s,i),function(t,e,i=ee(0,0,0)){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z}(i,e.origin,i),i)}const pe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function me(){return new Array(16)}function ge(t,e=me()){for(let i=0;i<16;++i)e[i]=t[i];return e}const ve=ge(pe);function ye(t,e,i=me()){for(let r=0;r<16;r+=4){const s=t[r],n=t[r+1],o=t[r+2],a=t[r+3];for(let t=0;t<4;++t)i[r+t]=s*e[t]+n*e[4+t]+o*e[8+t]+a*e[12+t]}return i}function xe(t,e=me()){for(let i=0;i<4;i++)for(let r=i;r<4;r++){const s=t[4*i+r];e[4*i+r]=t[4*r+i],e[4*r+i]=s}return e}function be(t,e){return e?ye(t,e):t}function we(t){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,t]}function Ae(t){const{color:e,lightness:i,opacity:r,saturation:s}=t;if(void 0!==e){const t=function({r:t,g:e,b:i,a:r}){return[0,0,0,t,0,0,0,e,0,0,0,i,0,0,0,r]}(e);return xe(t,t)}let n;return void 0!==i&&(n=be(function(t){const e=1-Math.abs(t),i=Math.max(0,t);return[e,0,0,i,0,e,0,i,0,0,e,i,0,0,0,1]}(i),n)),void 0!==s&&(n=be(function(t){const e=.2125*(1-t),i=.7154*(1-t),r=.0721*(1-t);return[e+t,i,r,0,e,i+t,r,0,e,i,r+t,0,0,0,0,1]}(s+1),n)),void 0!==r&&(n=be(we(r),n)),n?xe(n,n):ge(pe)}class Te{constructor(t){this._plans=new Map,this._objectMetadataIndex=t,this.onTransformChanged=this._onTransformChanged=new s}destructor(){for(const{plan:t}of this._plans.values())this.removePlan(t)}addPlan(t){t.onOpacityChange.addListener(this._onOpacityChanged,this);const e=t.opacity<1?Ae({opacity:t.opacity}):void 0;this._plans.set(t.id,{plan:t,transform:e})}removePlan(t){t.onOpacityChange.removeListener(this._onOpacityChanged),this._plans.delete(t.id)}get(t){var e;const i=t.id&&this._objectMetadataIndex.getMetadata(t.id),r=i&&i.get("indoor_plan_id");return r?null===(e=this._plans.get(r))||void 0===e?void 0:e.transform:void 0}_onOpacityChanged(t,e){const i=this._plans.get(e.id);o(i)&&(i.transform=we(t)),this._onTransformChanged.fire()}}class Pe extends Kt{constructor(t,e,i,r,n,o){super(t,e,i,r,"indoor",n),this._planRegistry=new $t(this._commutator.getCommunicator(7),this._options),this._planRegistry.onPlanAdded.addListener(this._onPlanAdded,this),this._planRegistry.onPlanRemoved.addListener(this._onPlanRemoved,this),this._applyContentVisibilityFilters();const a=new Te(this._objectMetadataIndex);this._colorTransformProvider=this.colorTransformProvider=a,this._coveredByIndoorFilters=o,this._coveredByIndoorFilters.activate(),this.onPlansChanged=this._onPlansChanged=new s}destructor(){this._planRegistry&&(this._planRegistry.onPlanRemoved.removeListener(this._onPlanRemoved),this._planRegistry.onPlanAdded.removeListener(this._onPlanAdded),this._planRegistry.destructor()),this._coveredByIndoorFilters.deactivate(),this._colorTransformProvider.destructor(),super.destructor()}pause(){this._coveredByIndoorFilters.deactivate(),super.pause()}resume(){super.resume(),this._coveredByIndoorFilters.activate()}get plans(){return this._planRegistry.getAllPlans()}_applyContentVisibilityFilters(){const t=new te(this._planRegistry,t=>this._objectMetadataIndex.getMetadata(t));this._contentVisibilityManager.addFilter(3,t).addFilter(0,t).addFilter(1,t).addFilter(4,t).addFilter(5,t).addFilter(6,t)}_onPlanAdded(t){this._colorTransformProvider.addPlan(t),this._onPlansChanged.fire(this._planRegistry.getAllPlans())}_onPlanRemoved(t){this._colorTransformProvider.removePlan(t),this._onPlansChanged.fire(this._planRegistry.getAllPlans())}}class Se{constructor(t){this._metadataProvider=t,this._isActive=!1,this.onUpdate=this._onUpdate=new s}activate(){this._isActive=!0,this._onUpdate.fire()}deactivate(){this._isActive=!1,this._onUpdate.fire()}test(t){const e=t.id&&this._metadataProvider(t.id);return!(this._isActive&&e&&"true"===e.get("indoor_covered"))}}class Re{constructor(){this._filters=new Map}get(t){return this._filters.get(t)}add(t,e){this._filters.set(t,e)}remove(t){this._filters.delete(t)}activate(){for(const t of this._filters.values())t.activate()}deactivate(){for(const t of this._filters.values())t.deactivate()}}class Me extends E{constructor(t,e){super({primitives:{},references:[]}),this.id=t,this.bbox=e}}class ze extends M{_deserialize(t){return new Me(t.id,t.bbox)}}class Ce extends v{constructor(t,e,i,r,n,o,a){super(i,r,n,a),this._communicator=t,this._options=o,this._storage=e,this._onContentAdded=this.onContentAdded=new s,this._communicator.onMessage.addListener(this._onMessage,this),this._communicator.sendMessage({type:0,options:this._options},!1)}destructor(){this._communicator.onMessage.removeListener(this._onMessage)}updateOption(t,e){this._options[t]=e,this._communicator.sendMessage({type:0,options:this._options},!1)}_onMessage(t){switch(t.type){case 2:this._onAddPrimitives(t)}}_onAddPrimitives(t){const e=this._storage.get(t.objectId);if(o(e)){const i=this._instantiatePrimitives(t.content,0);e.addContent(i),this._onContentAdded.fire(e,i)}}}class ke{constructor(t,e,i){this._camera=t,this._storage=e,this._contentVisibilityManager=i,this._visibleObjects=new Map,this._cameraArea=this._camera.getVisibleRegionBBox(),this._camera.onUpdate.addListener(this._onCameraChanged,this),this._storage.onAdded.addListener(this._onObjectAdded,this),this._storage.onRemoved.addListener(this._onObjectRemoved,this)}destructor(){this._camera.onUpdate.removeListener(this._onCameraChanged),this._storage.onAdded.removeListener(this._onObjectAdded),this._storage.onRemoved.removeListener(this._onObjectRemoved)}_onCameraChanged(){for(const t of this._storage.items)this._updateObjectVisibility(t)}_onObjectAdded(t){this._updateObjectVisibility(t)}_onObjectRemoved(t){this._visibleObjects.has(t.id)&&(this._visibleObjects.delete(t.id),this._contentVisibilityManager.hideObject(t))}_updateObjectVisibility(t){!function(t,e){let i,r,s,n;return t.minX<e.minX?(i=t,r=e):(i=e,r=t),t.maxY>e.maxY?(s=t,n=e):(s=e,n=t),r.minX<i.maxX&&n.maxY>s.minY}(this._cameraArea,t.bbox)?this._visibleObjects.has(t.id)&&(this._visibleObjects.delete(t.id),this._contentVisibilityManager.hideObject(t)):this._visibleObjects.has(t.id)||(this._visibleObjects.set(t.id,t),this._contentVisibilityManager.showObject(t))}}class Be{constructor(t,e,i){this._camera=e,this._communicator=t,this._storage=i,this._isActive=!1,this._onCameraUpdateDebounced=Ft(this._onCameraUpdate.bind(this),5e3),this._onUpdateInStorage()}destructor(){this._pause()}_pause(){this._isActive&&(this._camera.onUpdate.removeListener(this._onCameraUpdateDebounced),this._isActive=!1)}_resume(){this._isActive||(this._camera.onUpdate.addListener(this._onCameraUpdateDebounced,this),this._isActive=!0)}_onCameraUpdate(){this._communicator.sendMessage({type:0,viewportBBox:this._camera.getVisibleRegionBBox()},!0)}_onUpdateInStorage(){0===this._storage.size?this._pause():this._resume()}}class Oe extends Zt{constructor(t,e,i,r,s){const o=new n(r),a=Object.assign({dpr:nt()},s),l=new ze(o.getCommunicator(2));super(t,e,i,new V(o.getCommunicator(3),e),new vt(o.getCommunicator(5),a,e),new Mt(o.getCommunicator(4),a,e),new Et([l])),this._options=a,this._commutator=o,this._communicator=this._commutator.getCommunicator(0),this._storage=l,this._geoContentManager=new Ce(this._commutator.getCommunicator(1),this._storage,this._registry,this._glyphAtlasRegistry,this._iconAtlasRegistry,this._options),this._visibilityManager=new ke(this._camera,this._storage,this._contentVisibilityManager),this._gc=new Be(this._commutator.getCommunicator(6),this._camera,this._storage),this._onCameraChanged(),this._onCameraChanged=Ft(this._onCameraChanged.bind(this),500),this._camera.onUpdate.addListener(this._onCameraChanged)}destructor(){this._camera.onUpdate.removeListener(this._onCameraChanged),this._storage.destructor(),this._geoContentManager.destructor(),this._visibilityManager.destructor(),this._gc.destructor(),this._commutator.destructor()}_onCameraChanged(){const t=this._camera.center;this._communicator.sendMessage({type:0,center:ot(t.x,t.y),zoom:this._camera.zoom},!0)}}class Ie{constructor(t){this._addressee=t,this._messageQueue=[],this._transferableQueue=[],this._listeners=[]}addMessage(t,e=[]){this._messageQueue.push(t),this._transferableQueue.push(...e)}onMessage(t){this._listeners.push(t)}flushMessages(){0!==this._messageQueue.length&&this._addressee.postMessage(this._messageQueue,this._transferableQueue),this._messageQueue.length=0,this._transferableQueue.length=0}listen(){this._addressee.onmessage=({data:t})=>{for(const e of t)for(const t of this._listeners)t(e)}}}class Ee extends Ie{constructor(t){const e="function"==typeof t?t():new Worker(t);super(e),this._worker=e,this.listen()}destroy(){this._worker.terminate()}}class Le{constructor(t){this._worker=t,this._scheduledFlush=Vt(()=>t.flushMessages()),this.onMessage=this._onMessage=new s,t.onMessage(t=>{this._onMessage.fire(t)})}sendMessage(t,e,...i){this._worker.addMessage(t,i),e&&this._scheduledFlush()}}function Ue(t){if("function"!=typeof t)throw new Error("Predicate must be a function");return`(${t.toString()})`}var De=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]])}return i};class Fe{constructor(t,e,i,r){this._metrics=new tt(r,"vector.map.content_provider"),this._metrics.mark("workerInitialized");const o=new Ee(t);this._context=i,this._camera=e,this._metricsTransport=r,this._commutator=new n(new Le(o)),this._communicator=this._commutator.getCommunicator(0),this.onMemoryUsageChanged=this._onMemoryUsageChanged=new s,this._contentProviders=[],this._coveredByIndoorFilters=new Re,this._currentProviderId=1,this._communicator.onMessage.addListener(this._onMessage,this),window.addEventListener("beforeunload",()=>this._metrics.submit())}getCoveredByIndoorFilterFor(t){return this._coveredByIndoorFilters.get(t.name)}initContentProvider(t,e){var i;const r=null===(i=this._contentProviders.find(e=>e.name===t))||void 0===i?void 0:i.provider;if(r)return r.isPaused?r.resume():console.warn("initializing already initialized and running content provider"),r;const s=this._currentProviderId++,n=function(t){const{polygonsBatchingRule:e,modelsBatchingRule:i,polylinesBatchingRule:r,labelsBatchingRule:s}=t,n=De(t,["polygonsBatchingRule","modelsBatchingRule","polylinesBatchingRule","labelsBatchingRule"]);return e&&(n.polygonsBatchingRule=Ue(e)),i&&(n.modelsBatchingRule=Ue(i)),r&&(n.polylinesBatchingRule=Ue(r)),s&&(n.labelsBatchingRule=Ue(s)),n}(e);let o;return this._communicator.sendMessage({type:0,id:s,name:t,options:n},!1),o="indoor"===t?new Pe(this._commutator.getCommunicator(s),this._camera,this._context,n,this._metricsTransport,this._coveredByIndoorFilters):new Kt(this._commutator.getCommunicator(s),this._camera,this._context,n,t,this._metricsTransport),this._coveredByIndoorFilters.add(t,new Se(t=>o.getObjectMetadata(t))),this._contentProviders.push({id:s,name:t,provider:o}),o}initGeoContentProvider(t,e){const i=this._currentProviderId++;return this._communicator.sendMessage({type:1,id:i,name:t,options:e},!1),new Oe(t,this._context,this._camera,this._commutator.getCommunicator(i),e)}getObjectMetadata(t){for(const e of this._contentProviders){if(!e)continue;const i=e.provider.getObjectMetadata(t);if(i)return i}}destroyContentProvider(t){const e=this._contentProviders.findIndex(e=>e.provider===t);if(-1!==e){const i=this._contentProviders[e];t.destructor(),this._communicator.sendMessage({type:2,id:i.id},!1),this._contentProviders.splice(e,1),this._coveredByIndoorFilters.remove(t.name)}}_onMessage(t){switch(t.type){case 3:this._onWorkerInitialized()}}_onWorkerInitialized(){this._metrics.putMeasuredValue("workerInitialized")}_onMemoryUsageInContentProviderChanged(){const t={};t.total=this._computeTotalMemoryUsage();for(const{name:e,provider:i}of this._contentProviders)t[e]=i.memoryUsage;this._onMemoryUsageChanged.fire(t)}_computeTotalMemoryUsage(){const t=this._contentProviders;return{memoryForBuffers:t.reduce((t,{provider:e})=>t+e.memoryUsage.memoryForBuffers,0),memoryForVertices:t.reduce((t,{provider:e})=>t+e.memoryUsage.memoryForVertices,0),memoryForIndices:t.reduce((t,{provider:e})=>t+e.memoryUsage.memoryForIndices,0),memoryForGlyphs:t.reduce((t,{provider:e})=>t+e.memoryUsage.memoryForGlyphs,0),memoryForIcons:t.reduce((t,{provider:e})=>t+e.memoryUsage.memoryForIcons,0)}}}var Ve=i(10),je=i.n(Ve);class Ne extends class{constructor(){this._listeners=new Set}addListener(t){this._listeners.add(t)}removeListener(t){this._listeners.delete(t)}fire(t){this._listeners.forEach(e=>{e(t)})}}{fire(){super.fire(void 0)}}class He extends class{constructor(t=256,e=256){this.onContentUpdate=new Ne,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this._canvasContext=this.canvas.getContext("2d"),this._allocator=new Rt(this.width,this.height)}get width(){return this.canvas.width}get height(){return this.canvas.height}allocateImage(t,e){const i=this._allocate(t);if(i){const r=ut(0,t.width,0,t.height);this.updateImage(i,e,r,r)}return i}reserveLocation(t){return this._allocate(t)}updateImage(t,e,i=ut(0,t.maxX-t.minX,0,t.maxY-t.minY),r=ut(0,e.width,0,e.height)){const s=r.minX,n=r.minY,o=r.maxX-r.minX,a=r.maxY-r.minY,l=t.minX+i.minX,h=t.minY+i.minY,c=i.maxX-i.minX,d=i.maxY-i.minY;this._canvasContext.clearRect(l,h,c,d),this._canvasContext.drawImage(e,s,n,o,a,l,h,c,d),this.onContentUpdate.fire()}removeImage(t){this._allocator.deallocate(t)}_allocate(t){let e=this._allocator.allocate(t);for(;!e;){const i=2*this.width,r=2*this.height;if(!(i<=2048&&r<=2048))break;this._expand(i,r),e=this._allocator.allocate(t)}return e}_expand(t,e){this._allocator.resize(t,e);const i=this._canvasContext.getImageData(0,0,this.width,this.height);this.canvas.width=t,this.canvas.height=e,this._canvasContext.putImageData(i,0,0)}}{constructor(t,e){super();const{filter:i,premultipliedAlpha:r}=e;this._context=t,this._filter=i,this._premultipliedAlpha=r,this.texture=this._createTexture(this.width,this.height,i,r),this.isDirty=!1}syncTexture(){this._context.setTextureDataFromDomElement(this.texture,this.canvas),this.isDirty=!1}updateImage(t,e,i,r){super.updateImage(t,e,i,r),this.isDirty=!0}destroy(){this.texture.destroy()}_expand(t,e){super._expand(t,e),this.texture.destroy(),this.texture=this._createTexture(this.width,this.height,this._filter,this._premultipliedAlpha),this.isDirty=!0}_createTexture(t,e,i,r){return this._context.createEmpty2DTexture(t,e,6408,5121,{minificationFilter:i,magnificationFilter:i,wrapS:33071,wrapT:33071,premultipliedAlpha:r})}}qe(0,0,0,1);const We=qe(1,1,0,1);function qe(t,e,i,r=1){return{r:t,g:e,b:i,a:r}}qe(0,0,0,0);const Xe={blend:!0,blendFuncSrcRgb:770,blendFuncDstRgb:771,blendFuncSrcAlpha:1,blendFuncDstAlpha:771},Ye={blend:!0,blendFuncSrcRgb:1,blendFuncDstRgb:771,blendFuncSrcAlpha:1,blendFuncDstAlpha:771},Ge={depthTest:!0,depthFunc:518};class Ze{constructor(...t){this.clearColor=qe(0,0,0,0),this.clearDepth=1,this.clearStencil=0,this.colorMaskR=!0,this.colorMaskG=!0,this.colorMaskB=!0,this.colorMaskAlpha=!0,this.blend=!1,this.blendEquationRgb=32774,this.blendEquationAlpha=32774,this.blendFuncSrcRgb=1,this.blendFuncDstRgb=0,this.blendFuncSrcAlpha=1,this.blendFuncDstAlpha=0,this.cullFace=!1,this.cullFaceMode=1029,this.frontFaceMode=2305,this.depthTest=!1,this.depthFunc=513,this.depthRangeNear=0,this.depthRangeFar=1,this.depthMask=!0,this.dither=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.sampleAlphaToCoverage=!1,this.sampleCoverage=!1,this.sampleCoverageValue=1,this.sampleCoverageInvert=!1,this.scissorTest=!1,this.scissorX=0,this.scissorY=0,this.scissorWidth=-1,this.scissorHeight=-1,this.stencilTest=!1,this.stencilReference=0,this.stencilMask=255,this.stencilWriteMask=255,this.stencilFrontFunc=519,this.stencilFrontFailOp=7680,this.stencilFrontDepthFailOp=7680,this.stencilFrontDepthPassOp=7680,this.stencilBackFunc=519,this.stencilBackFailOp=7680,this.stencilBackDepthFailOp=7680,this.stencilBackDepthPassOp=7680,this.viewportX=0,this.viewportY=0,this.viewportWidth=-1,this.viewportHeight=-1,Object.assign(this,...t)}}function Ke(t,e=4){let i=0;return{attributes:[...j(t,([t,{type:r,size:s,normalized:n}])=>{const o=[t,{type:r,size:s,normalized:n,offset:i}],a=s*function(t){switch(r){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4}}(),l=function(t,e){return(i+a-1&e)-e}(0,-e);return i=l,o})],vertexByteSize:i}}function Qe(t){return 65535*t|0}function Je(t){return 4294967295*t|0}function*$e(t){for(let e=2;e<t;++e)yield 0,yield e-1,yield e}function*ti(t){yield 0,yield 1,yield 2;let e=1,i=2;for(let r=3;r<t;++r){yield r-e,yield r-i,yield r;const t=e;e=i,i=t}}class ei{constructor(t){this._nextWordOffset=0,this._initBuffers(t)}get isFull(){return this._nextWordOffset>=this._uint32View.length}get occupiedSize(){return this._nextWordOffset}get byteSize(){return this._uint32View.byteLength}extend(t){const e=this._uint32View;this._initBuffers(t),this._uint32View.set(e)}pushUint32(t){this._uint32View[this._nextWordOffset++]=t}pushFloat32(t){this._float32View[this._nextWordOffset++]=t}asUint32Array(){return this._uint32View.subarray(0,this.occupiedSize)}_initBuffers(t){const e=new ArrayBuffer(t);this._uint32View=new Uint32Array(e),this._float32View=new Float32Array(e)}static transferDataTail(t,e,i,r=0){const s=t.occupiedSize-i,n=t._uint32View.subarray(i,t.occupiedSize);e._uint32View.set(n,r),e._nextWordOffset=s,t._nextWordOffset=i}}class ii{constructor(t){this._nextIndexOffset=0,this._uint16View=new Uint16Array(t)}get occupiedSize(){return this._nextIndexOffset}get size(){return this._uint16View.length}extend(t){const e=this._uint16View;this._uint16View=new Uint16Array(t),this._uint16View.set(e)}push(t){this._uint16View[this._nextIndexOffset++]=t}asUint16Array(){return new Uint16Array(this._uint16View.buffer,0,this.occupiedSize)}static transferDataTail(t,e,i,r,s=0){for(let n=r,o=s;n<t.occupiedSize;n++,o++)e._uint16View[o]=t._uint16View[n]-i;e._nextIndexOffset=t.occupiedSize-r,t._nextIndexOffset=r}}class ri{constructor(t,e=1024,i=65536,r=3072){this._vertexByteSize=t,this._initVertexBufferByteSize=t*e,this._maxVertexBufferByteSize=t*i,this._initIndexBufferUint16Size=r,this._vertexBuffer=new ei(this._initVertexBufferByteSize),this._vertexBuffers=[this._vertexBuffer],this._indexBuffer=new ii(this._initIndexBufferUint16Size),this._indexBuffers=[this._indexBuffer],this._currentMeshVertexOffset=0,this._currentMeshIndexOffset=0,this._currentMeshBaseIndex=0}writeIndices(t){this._ensureEnoughIndexBufferSpace(t.length);const e=this._indexBuffer,i=this._currentMeshBaseIndex;for(let r=0;r<t.length;++r)e.push(i+t[r])}writeIndicesForStrip(t){this._ensureEnoughIndexBufferSpace(3*(t.length-2));const e=this._indexBuffer,i=this._currentMeshBaseIndex;for(const r of ti(t.length))e.push(i+t[r])}writeIndicesForContinuousStrip(t,e=0){this._ensureEnoughIndexBufferSpace(3*(t-2));const i=this._indexBuffer,r=this._currentMeshBaseIndex+e;for(const s of ti(t))i.push(r+s)}writeIndicesForFan(t){this._ensureEnoughIndexBufferSpace(3*(t.length-2));const e=this._indexBuffer,i=this._currentMeshBaseIndex;for(const r of $e(t.length))e.push(i+t[r])}writeIndicesForContinuousFan(t,e=0){this._ensureEnoughIndexBufferSpace(3*(t-2));const i=this._indexBuffer,r=e+this._currentMeshBaseIndex;for(const s of $e(t))i.push(r+s)}endMesh(){const t=this._currentMeshVertexOffset,e=this._vertexBuffer.occupiedSize;this._currentMeshVertexOffset=e,this._currentMeshBaseIndex=(e<<2)/this._vertexByteSize;const i=this._currentMeshIndexOffset,r=this._indexBuffer.occupiedSize;return this._currentMeshIndexOffset=r,{vertexByteOffset:t<<2,vertexByteLength:e-t<<2,indexByteOffset:i<<1,indexByteLength:r-i<<1,bufferIndex:this._vertexBuffers.length-1}}getBuffers(){return function(t,e,i=((t,e)=>[t,e])){const r=Math.min(t.length,e.length),s=new Array(r);for(let n=0;n<r;++n)s[n]=i(t[n],e[n]);return s}(this._vertexBuffers,this._indexBuffers,(t,e)=>({vertexBuffer:t.asUint32Array(),indexBuffer:e.asUint16Array()}))}getCurrentVertexBufferByteOffset(){return this._vertexBuffer.occupiedSize<<2}getCurrentVertexIdx(){return((this._vertexBuffer.occupiedSize<<2)/this._vertexByteSize|0)-this._currentMeshBaseIndex}_writeFloat32(t){this._ensureEnoughVertexBufferSpace(),this._vertexBuffer.pushFloat32(t)}_writeWord(t){this._ensureEnoughVertexBufferSpace(),this._vertexBuffer.pushUint32(t)}_writeHalfWords(t,e){this._writeWord(e<<16|65535&t)}_writeBytes(t,e,i,r){this._writeWord(r<<24|(255&i)<<16|(255&e)<<8|255&t)}_writeWorldCoordinate(t){const e=Je(.5*(t.x+1)),i=Je(.5*(t.y+1));this._writeHalfWords(e>>>16,i>>>16),this._writeHalfWords(e,i)}_getNextVertexBufferByteSize(t){return t<<1}_getNextIndexBufferUint16Size(t){return t<<1}_ensureEnoughVertexBufferSpace(){const t=this._vertexBuffer;if(!t.isFull)return;if(t.byteSize<this._maxVertexBufferByteSize)return void this._vertexBuffer.extend(this._getNextVertexBufferByteSize(t.byteSize));const e=this._currentMeshVertexOffset,i=4*(t.occupiedSize-e);if(i===this._maxVertexBufferByteSize)throw new Error("Mesh is too big to fit in.");let r=this._initVertexBufferByteSize;for(;r<=i;)r=this._getNextVertexBufferByteSize(r);const s=new ei(r);ei.transferDataTail(t,s,e),this._vertexBuffer=s,this._vertexBuffers.push(s),this._currentMeshVertexOffset=0;const n=this._indexBuffer,o=this._currentMeshIndexOffset,a=n.occupiedSize-o;let l=this._initIndexBufferUint16Size;for(;l<=a;)l=this._getNextIndexBufferUint16Size(l);const h=new ii(l);ii.transferDataTail(n,h,this._currentMeshBaseIndex,o),this._currentMeshBaseIndex=0,this._currentMeshIndexOffset=0,this._indexBuffer=h,this._indexBuffers.push(h)}_ensureEnoughIndexBufferSpace(t){const e=this._indexBuffer,i=e.occupiedSize+t;if(i<=e.size)return;let r=e.size;for(;i>r;)r=this._getNextIndexBufferUint16Size(r);this._indexBuffer.extend(r)}}const si=Ke([[0,{size:2,type:5123,normalized:!0}]]);class ni extends ri{constructor(t,e){const i=t*e;super(si.vertexByteSize,i,void 0,0);const r=Qe(1/t),s=Qe(1/e),n=s/2;for(let o=0,a=r/2;o<t;o++,a+=r)for(let t=0,i=n;t<e;t++,i+=s)this._writeHalfWords(a,i);this.data=this.getBuffers()[0].vertexBuffer,this.numberOfSamplers=i}}class oi{constructor(t,e,i,r,s){this._context=t,this._renderState=e,this._program=i,this._hitTestRenderState=r,this._hitTestProgram=s}render(t,...e){this._program&&this._prepareProgram(this._program,...e),this._prepareRenderTarget(t,...e),this._render(...e)}renderHitTestBuffer(t,...e){this._hitTestProgram&&(this._prepareHitTestProgram(this._hitTestProgram,...e),this._prepareHitTestTarget(t,...e),this._renderHitTestBuffer(...e))}destroy(){this._program&&this._program.destroy(),this._hitTestProgram&&this._hitTestProgram.destroy()}_prepareProgram(t,...e){this._context.bindProgram(t)}_prepareHitTestProgram(t,...e){this._context.bindProgram(t)}_prepareRenderTarget(t,...e){this._context.bindRenderState(this._renderState),this._context.bindRenderTarget(t)}_prepareHitTestTarget(t,...e){const i=this._context;this._hitTestRenderState&&i.bindRenderState(this._hitTestRenderState),i.bindRenderTarget(t)}_renderHitTestBuffer(...t){}}class ai extends oi{constructor(t,e){super(t,e)}get target(){return this._target}get content(){return this._context.bindRenderTarget(this._target),this._target.readPixels()}get size(){return this._target.size}updateGrid(...t){return this.render(this._target,...t),this._texture}_render(t,e,i,r,s,n,o,a,l,h){for(const c of i)c.render(this._target,t,e,this._renderState,r,s,n,o,a,l,h)}setResolution(t,e){this._destroyResources(),this._depthBuffer=this._context.createRenderbuffer(t,e,34041),this._texture=this._context.createEmpty2DTexture(t,e,6408,5121),this._target=this._context.createFramebuffer({color:this._texture,depthStencil:this._depthBuffer})}destroy(){this._destroyResources()}_prepareRenderTarget(t,...e){super._prepareRenderTarget(t,...e),this._context.clearCurrentTarget(16640)}_destroyResources(){this._target&&(this._target.destroy(),this._texture.destroy(),this._depthBuffer.destroy())}}class li{render(t,e,i){for(const r of e)r.render(t,i)}}class hi{constructor(t){this._mins=new Array(t),this._maxs=new Array(t),this._mins.fill(Number.POSITIVE_INFINITY),this._maxs.fill(Number.NEGATIVE_INFINITY)}updateValue(t,e){this._mins[t]=Math.min(this._mins[t],e),this._maxs[t]=Math.max(this._maxs[t],e)}*values(){const t={min:0,max:0,index:-1};for(let e=0;e<this._mins.length;e++)t.min=this._mins[e],t.max=this._maxs[e],t.index=e,yield t}}function ci(t,e){return Number.isInteger(t)&&e===t?t-1:Math.floor(t)}const di=ot(-1,-1),ui=t=>{const e=lt(t);return function(t,e,i=ot(0,0)){i.x=t.x-e.x,i.y=t.y-e.y}(e,di,e),ct(e,.5,e),e},fi=t=>.5*(t+1)*4294967295,_i=t=>Math.trunc(t/65536),pi=t=>65535&t,mi=(t,e)=>t.x-e.x||t.y-e.y,gi=ot(0,0),vi=[],yi=[];function xi(t){const e=t.getVisibleRegion();if(0===function(t,e,i){const r=Math.min(e.length,i.length);for(let s=0;s<r;s++){const r=t(e[s],i[s]);if(r)return r}return e.length-i.length}(mi,vi,e))return yi;const i=[];for(const r of function(t){const e=[],i=ft(t),r=Math.floor(i.minX),s=Math.ceil(i.maxX)-r,n=new hi(s);for(let o=t.length-1,a=0;a<t.length;o=a++){let e=t[o],s=t[a];if(e.x>s.x){const t=e;e=s,s=t}const l=Math.floor(e.x+1),h=Math.ceil(s.x-1),c=(e.y-s.y)/(e.x-s.x);n.updateValue(ci(e.x,i.maxX)-r,ci(e.y,i.maxY)),n.updateValue(ci(s.x,i.maxX)-r,ci(s.y,i.maxY));for(let t=l;t<=h;t++){const s=(isFinite(c)?c*(t-e.x):0)+e.y,o=t-r,a=o-1,l=Math.floor(s);Number.isInteger(s)?s===i.maxY?(n.updateValue(a,l-1),n.updateValue(o,l-1)):c>0?(n.updateValue(a,l-1),n.updateValue(o,l)):c<0&&(n.updateValue(a,l),n.updateValue(o,l-1)):(n.updateValue(a,l),n.updateValue(o,l))}}for(const{min:o,max:a,index:l}of n.values()){const t=r+l;for(let i=o;i<=a;i++)e.push(ot(t,i))}return e}(e.map(ui)))2!==t.options.wrapModeX&&0!==r.x||2!==t.options.wrapModeY&&0!==r.y||(ct(r,-2,gi),ht(t.center,gi,gi),dt(gi,fi,gi),i.push({lookAtHigh:dt(gi,_i),lookAtLow:dt(gi,pi)}));k(i,yi),yi.length=i.length,vi.length=e.length;for(let r=0;r<e.length;r++)vi[r]=lt(e[r],vi[r]);return i}var bi=i(11),wi=i.n(bi),Ai=i(0),Ti=i.n(Ai);const Pi=new Ze({depthTest:!0,clearDepth:0,depthFunc:516,dither:!1});class Si extends oi{constructor(t){const e=t.createProgram(wi.a,Ti.a,{attribMap:{position:0}});super(t,Pi,e),t.bindProgram(e),e.setIntScalarUniform("directPriorityGrid",0),e.setIntScalarUniform("reversePriorityGrid",1)}_prepareProgram(t,e,i,r,s,n){super._prepareProgram(t,e,i,r,s,n),this._context.bindTextureUnit(0),this._context.bindTexture(r),this._context.bindTextureUnit(1),this._context.bindTexture(s),t.setVector2Uniform("idHalfPxSize",n),t.setVector2Uniform("gridHalfPxSize",r.getHalfPxSize())}_render(t,e){this._context.bindVao(t),this._context.drawMesh(0,e,0)}_prepareRenderTarget(t,...e){super._prepareRenderTarget(t,...e),this._context.clearCurrentTarget(256)}}var Ri=i(12),Mi=i.n(Ri),zi=i(13),Ci=i.n(zi);const ki=Ke([[0,{size:4,type:5120,normalized:!1}]]);class Bi extends ri{constructor(){super(ki.vertexByteSize,4,4,6),this._writeBytes(-1,-1,0,0),this._writeBytes(-1,1,0,1),this._writeBytes(1,1,1,1),this._writeBytes(1,-1,1,0),this.writeIndicesForFan([0,1,2,3]),this.vertexData=this.getBuffers()[0].vertexBuffer,this.indexData=this.getBuffers()[0].indexBuffer}}const Oi=new Ze({dither:!1});class Ii extends oi{constructor(t){const e=t.createProgram(Mi.a,Ci.a,{attribMap:{position:0}});super(t,Oi,e);const i=new Bi;this._idSamplerVertexBuffer=this._context.createVertexBuffer(i.vertexData.byteLength),this._idSamplerIndexBuffer=this._context.createIndexBuffer(i.indexData.byteLength),this._idSamplerVao=this._context.createVao(ki,this._idSamplerVertexBuffer,this._idSamplerIndexBuffer),this._context.uploadDataToBuffer(this._idSamplerVertexBuffer,i.vertexData),this._context.uploadDataToBuffer(this._idSamplerIndexBuffer,i.indexData),t.bindProgram(e),e.setIntScalarUniform("prevVisibility",0),e.setIntScalarUniform("overlaps",1),e.setIntScalarUniform("scene",2)}_prepareProgram(t,e,i,r,s,n,o,a){super._prepareProgram(t,e,i,r,s,n,o,a),this._context.bindTextureUnit(0),this._context.bindTexture(e),this._context.bindTextureUnit(1),this._context.bindTexture(i),this._context.bindTextureUnit(2),this._context.bindTexture(r),t.setScalarUniform("fadeAnimationAmount",s),t.setScalarUniform("currentZoom",n),t.setScalarUniform("currentTilt",o),t.setScalarUniform("currentAzimuth",a)}_render(){this._context.bindVao(this._idSamplerVao),this._context.drawIndexedMesh(0,6,4)}}var Ei=i(14),Li=i.n(Ei),Ui=i(15),Di=i.n(Ui);const Fi=new Ze({blend:!0,blendFuncSrcRgb:0,blendFuncDstRgb:1,blendFuncSrcAlpha:1,blendFuncDstAlpha:0,dither:!1});class Vi extends oi{constructor(t){const e=t.createProgram(Li.a,Di.a,{attribMap:{position:0}});super(t,Fi,e);const i=new Bi;this._idSamplerVertexBuffer=this._context.createVertexBuffer(i.vertexData.byteLength),this._idSamplerIndexBuffer=this._context.createIndexBuffer(i.indexData.byteLength),this._idSamplerVao=this._context.createVao(ki,this._idSamplerVertexBuffer,this._idSamplerIndexBuffer),this._context.uploadDataToBuffer(this._idSamplerVertexBuffer,i.vertexData),this._context.uploadDataToBuffer(this._idSamplerIndexBuffer,i.indexData)}_render(){this._context.bindVao(this._idSamplerVao),this._context.drawIndexedMesh(0,6,4)}}const ji=new Ze({clearColor:qe(0,0,0,0),dither:!1}),Ni=qe(0,0,0,1),Hi=new Ze({clearColor:Ni,depthTest:!0,clearDepth:-1,depthFunc:518,dither:!1}),Wi=new Ze({clearColor:Ni,depthTest:!0,clearDepth:1,depthFunc:513,dither:!1});class qi{constructor(t,e,i,r,s=150){this.fadeEffectDuration=s,this._context=t,this._camera=e,this._renderLoop=i,this._lastRenderTimeInLoop=-1,this._lastSceneUpdateTime=K(),this._animationTicksCount=0,this._prevTargetSize={width:0,height:0},this._isEnabled=!0,this._camera.onUpdate.addListener(this._onSceneUpdate,this),this._renderLoop.onBeforeRender.addListener(this._onBeforeRender,this),this._directPriorityGridRenderer=new ai(t,Hi),this._reversePriorityGridRenderer=new ai(t,Wi),this._collidingOffVisibilityTexture=this._createPlainTexture(qe(1,1,1,1)),this._currentVisibilityTexture=t.createEmpty2DTexture(256,256,6408,5121),this._prevVisibilityTexture=t.createEmpty2DTexture(256,256,6408,5121),this._sceneTexture=t.createEmpty2DTexture(256,256,6408,5121),this._overlapsTexture=t.createEmpty2DTexture(256,256,6408,5121),this._currentVisibilityBuffer=t.createFramebuffer({color:this._currentVisibilityTexture}),this._prevVisibilityBuffer=t.createFramebuffer({color:this._prevVisibilityTexture}),this._sceneBuffer=t.createFramebuffer({color:this._sceneTexture}),this._overlapsBuffer=t.createFramebuffer({color:this._overlapsTexture,depthStencil:t.createRenderbuffer(256,256,34041)}),this._stabilityShift=ee(0,0,0),this._gridHalfPxSizeUniform=ot(0,0),this._idHalfPxSizeUniform=ot(.5/256,.5/256),this._resetRemoved=new li,this._makeAllOverlapped=new Vi(t),this._findOverlaps=new Si(t),this._computeVisibility=new Ii(t),this._clearVisibility(this._currentVisibilityBuffer),this._clearVisibility(this._overlapsBuffer),this._primitiveProviders=[],this._colorIdRenderers=[],this._resetRemovedRenderers=[],this.setTargetSize(r)}get visibilityTexture(){return this._isEnabled?this._currentVisibilityTexture:this._collidingOffVisibilityTexture}setEnabled(t){this._isEnabled=t,this._renderLoop.update()}setTargetSize(t){const e=3*nt(),i=Math.ceil(t.width/e),r=Math.ceil(t.height/e);this._directPriorityGridRenderer.setResolution(i,r),this._reversePriorityGridRenderer.setResolution(i,r),this._gridSamplerVertexBuffer&&this._destroyGridResources();const s=new ni(i,r),n=this._context;this._gridSamplerVertexBuffer=n.createVertexBuffer(s.data.byteLength),this._gridSamplerVao=n.createVao(si,this._gridSamplerVertexBuffer,null),this._numberOfGridSamplers=s.numberOfSamplers,this._context.uploadDataToBuffer(this._gridSamplerVertexBuffer,s.data),pt(t,this._prevTargetSize),this._gridHalfPxSizeUniform.x=.5/i,this._gridHalfPxSizeUniform.y=.5/r}updateVisibilityIfNeeded(){if(!this._isEnabled||!this._isDirty)return;this._isDirty=!1;const t=this._stabilityShift;lt(this._camera.center,t),t.z=0,function(t,e,i=ee(0,0,0)){const r=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],s=(t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12])/r,n=(t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13])/r,o=(t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14])/r;i.x=s,i.y=n,i.z=o}(this._camera.getViewProjMatrix(),t,t),t.x%=4*this._gridHalfPxSizeUniform.x,t.y%=4*this._gridHalfPxSizeUniform.y;const e=this._currentVisibilityTexture,i=this._currentVisibilityBuffer,r=this._prevVisibilityTexture,s=this._prevVisibilityBuffer,n=this._overlapsTexture,o=this._overlapsBuffer,a=this._sceneTexture,l=this._sceneBuffer;this._currentVisibilityBuffer=s,this._currentVisibilityTexture=r,this._prevVisibilityBuffer=i,this._prevVisibilityTexture=e,this._clearVisibility(s),this._clearVisibility(l),this._resetRemoved.render(l,this._resetRemovedRenderers,this._idHalfPxSizeUniform);const h=this._camera.zoom/this._camera.options.maxZoom,c=this._camera.tilt,d=this._camera.azimuth/(2*Math.PI),u=this._camera.getViewProjMatrix(),f=xi(this._camera),_=this._directPriorityGridRenderer.updateGrid(u,f,this._colorIdRenderers,t,e,n,a,h,c,d),p=this._reversePriorityGridRenderer.updateGrid(u,f,this._colorIdRenderers,t,e,n,a,h,c,d),m=K(),g=this._lastRenderTimeInLoop,v=-1!==g,y=m-this._lastSceneUpdateTime>this.fadeEffectDuration||v&&m-g>this.fadeEffectDuration,x=y?1:v?(m-g)/this.fadeEffectDuration:(m-this._lastSceneUpdateTime)/this.fadeEffectDuration;this._animationTicksCount++;const b=this._idHalfPxSizeUniform,w=this._gridSamplerVao,A=this._numberOfGridSamplers;this._makeAllOverlapped.render(o),this._findOverlaps.render(o,w,A,_,p,b),this._computeVisibility.render(s,e,n,a,x,h,c,d),y&&this._animationTicksCount>1?this._lastRenderTimeInLoop=-1:(this._renderLoop.update(),this._lastRenderTimeInLoop=m)}registerCollidingPrimitives(t,e,i){this._primitiveProviders.push(t),this._colorIdRenderers.push(e),this._resetRemovedRenderers.push(i),t.onUpdate.addListener(this._onSceneUpdate,this)}deregisterCollidingPrimitives(t,e,i){let r=this._primitiveProviders.indexOf(t);r>-1&&this._primitiveProviders.splice(r,1),(r=this._colorIdRenderers.indexOf(e))>-1&&this._colorIdRenderers.splice(r,1),(r=this._resetRemovedRenderers.indexOf(i))>-1&&this._resetRemovedRenderers.splice(r,1),t.onUpdate.removeListener(this._onSceneUpdate)}destroy(){this._destroyGridResources(),this._directPriorityGridRenderer.destroy(),this._reversePriorityGridRenderer.destroy(),this._camera.onUpdate.removeListener(this._onSceneUpdate);for(const t of this._primitiveProviders)t.onUpdate.removeListener(this._onSceneUpdate)}_onSceneUpdate(){this._lastSceneUpdateTime=K(),this._animationTicksCount=0,this._renderLoop.update()}_onBeforeRender(){this._isDirty=!0}_clearVisibility(t){this._context.bindRenderState(ji),this._context.bindRenderTarget(t),this._context.clearCurrentTarget(16384)}_createPlainTexture(t){const e=this._context.createEmpty2DTexture(1,1,6408,5121);return this._context.setTextureData(e,new Uint8Array([255*t.r,255*t.g,255*t.b,255*t.a])),e}_destroyGridResources(){this._gridSamplerVertexBuffer.destroy(),this._gridSamplerVao.destroy()}}class Xi extends class{constructor(){this._refCount=1}retain(){if(0===this._refCount)throw new Error("Tried to retain a destroyed object.");this._refCount++}release(){if(0===this._refCount)throw new Error("Tried to release a destroyed object.");this._refCount--,0===this._refCount&&this._destroy()}}{constructor(t,e){super(),this.page=t,this._location=e}get vertexByteOffset(){return this._location.vertexByteOffset}get indexByteOffset(){return this._location.indexByteOffset}_destroy(){this.page.free(this)}}function Yi(t,e){switch(e){case 5123:return t>>1;case 5125:return t>>2;default:return-1}}class Gi extends class extends class{constructor(){this._delegate=null}setDelegate(t){this._delegate=t}}{constructor(t,e,i,r,s,n){super(),this.vertexBuffer=t,this.indexBuffer=e,this.vao=i,this.indexType=r,this._vertexAllocator=s,this._indexAllocator=n}allocate(t,e){return this._vertexAllocator.maxAllocableSize>=t&&this._indexAllocator.maxAllocableSize>=e?new Xi(this,{vertexByteOffset:this._vertexAllocator.allocate(t),vertexByteLength:t,indexByteOffset:this._indexAllocator.allocate(e),indexByteLength:e}):null}free(t){this._vertexAllocator.deallocate(t.vertexByteOffset),this._indexAllocator.deallocate(t.indexByteOffset),this.isEmpty()&&this._delegate&&this._delegate.onPageEmpty(this)}isEmpty(){return this._vertexAllocator.isEmpty&&this._indexAllocator.isEmpty}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.vao.destroy()}}{constructor(t,e,i,r){super(t,e,i,r,new Tt(t.getSize()),new Tt(e.getSize())),this._failedAllocation=!1}allocate(t,e){if(this._failedAllocation)return null;const i=super.allocate(t,e);return this._failedAllocation=null===i,i}}class Zi{constructor(t){this._context=t,this._pages=new Map,this._emptyPagesClearTimeout=0}allocate(t,e,i){const r=this._context;let s=this._pages.get(i);s||(s=new Set,this._pages.set(i,s));for(const c of s){const i=c.allocate(t.byteLength,e.byteLength);if(i)return this._updatePage(c,i,t,e),i}const n=r.createVertexBuffer(Math.max(65536*i.vertexByteSize,t.byteLength)),o=r.createIndexBuffer(1048576),a=r.createVao(i,n,o),l=new Gi(n,o,a,5123);l.setDelegate(this),s.add(l);const h=l.allocate(t.byteLength,e.byteLength);return this._updatePage(l,h,t,e),h}onPageEmpty(){this._emptyPagesClearTimeout||(this._emptyPagesClearTimeout=setTimeout(()=>{this._clearEmptyPages(),this._emptyPagesClearTimeout=0}))}destroy(){this._emptyPagesClearTimeout&&clearTimeout(this._emptyPagesClearTimeout);for(const[,t]of this._pages)for(const e of t)e.destroy()}_updatePage(t,e,i,r){const s=this._context;s.bindVao(null),s.uploadDataToBuffer(t.vertexBuffer,i,e.vertexByteOffset);const n=e.vertexByteOffset/t.vao.attributeMapping.vertexByteSize|0;for(let o=0;o<r.length;++o)r[o]+=n;s.uploadDataToBuffer(t.indexBuffer,r,e.indexByteOffset)}_clearEmptyPages(){for(const t of this._pages.values())for(const e of t)e.isEmpty()&&(t.delete(e),e.setDelegate(null),e.destroy())}}const Ki=8/nt(),Qi=_t(128,128);function Ji(t){return 128*Math.ceil(t/Ki/128)}class $i{constructor(t,e,i){this._context=t,this._renderer=e,this._renderLoop=i,this._tileCache=new Map,this._isDirty=!0,this._allocateResources(),this._lastRenderTime=0}destroy(){this._deleteResources()}updateSize(){this._deleteResources(),this._allocateResources(),this.setDirty()}setDirty(){this._isDirty||(this._isDirty=!0,this._tileCache.clear())}getIdAt(t){this._isDirty&&(!this._lastRenderTime||K()-this._lastRenderTime>100)&&(this._lastRenderTime=K(),this._renderer.renderHitTestBuffer(this._framebuffer),this._renderLoop.update(),this._tileCache.clear(),this._isDirty=!1);const e=this._context,i=this._framebuffer,r=e.getDefaultRenderTarget().size,s=t.x/r.width,n=1-t.y/r.height,o=s*i.size.width|0,a=n*i.size.height|0,l=ot(128*Math.floor(o/128),128*Math.floor(a/128)),h=l.x<<16|l.y;let c=this._tileCache.get(h);return c||(e.bindRenderTarget(i),c=new Uint32Array(i.readPixels(Qi,l).buffer),this._renderLoop.update(),this._tileCache.set(h,c)),c[128*(a-l.y)+(o-l.x)]}_deleteResources(){this._framebuffer.destroy(),this._colorBuffer.destroy(),this._depthBuffer.destroy()}_allocateResources(){const t=this._context,{width:e,height:i}=t.getDefaultRenderTarget().size,r=Ji(e),s=Ji(i);this._colorBuffer=t.createEmpty2DTexture(r,s,6408,5121),this._depthBuffer=t.createRenderbuffer(r,s,34041),this._framebuffer=t.createFramebuffer({color:this._colorBuffer,depthStencil:this._depthBuffer})}}class tr extends Error{constructor(){super("Base render unit is not in the list")}}class er{constructor(){this.onUpdate=this._onUpdate=new s,this._subRenderUnits=[]}addRenderUnit(t){this._subRenderUnits.push(t),t.onUpdate.addListener(this._onSubRenderUnitUpdate,this),this._onUpdate.fire()}removeRenderUnit(t){const e=this._subRenderUnits.indexOf(t);-1!==e&&(this._subRenderUnits.splice(e,1),t.onUpdate.removeListener(this._onSubRenderUnitUpdate),this._onUpdate.fire())}addRenderUnitAbove(t,e){const i=this._subRenderUnits.indexOf(t);if(-1===i)throw new tr;this._subRenderUnits.splice(i+1,0,e),e.onUpdate.addListener(this._onSubRenderUnitUpdate,this)}addRenderUnitBelow(t,e){const i=this._subRenderUnits.indexOf(t);if(-1===i)throw new tr;this._subRenderUnits.splice(i,0,e),e.onUpdate.addListener(this._onSubRenderUnitUpdate,this)}render(t,...e){for(const i of this._subRenderUnits)i.render(t,...e)}renderHitTestBuffer(t,...e){for(const i of this._subRenderUnits)i.renderHitTestBuffer(t,...e)}_onSubRenderUnitUpdate(){this._onUpdate.fire()}}const ir=new Ze({clearDepth:-1,depthTest:!0,depthFunc:518}),rr=new Ze(Object.assign(Object.assign({},ir),{clearColor:We})),sr={r:0,g:0,b:0,a:0};class nr extends er{constructor(t,e){super(),this._context=t,this._camera=e,this.onRender=this._onRender=new s,this.setBackgroundColor(sr)}render(t){const e=this._camera.getViewProjMatrix(),i=xi(this._camera);this._context.bindRenderTarget(t),this._context.bindRenderState(this._renderState),this._context.clearCurrentTarget(17664);for(const r of this._subRenderUnits)r.render(t,e,i);this._onRender.fire()}renderHitTestBuffer(t){const e=this._camera.getViewProjMatrix(),i=xi(this._camera);this._context.bindRenderTarget(t),this._context.bindRenderState(rr),this._context.clearCurrentTarget(17664);for(const r of this._subRenderUnits)r.renderHitTestBuffer(t,e,i)}setBackgroundColor(t){this._renderState=new Ze(ir,{clearColor:t})}}class or extends a{}function ar(t,e){return e<<16|65535&t}function lr(t){return Je(.5*(t+1))}class hr extends class{constructor(t){this._bufferDataProvider=t,this._currentMeshWrittenVertices=0}endMesh(){return this._currentMeshWrittenVertices=0,this._currentBufferData.endMesh()}writeIndices(t){this._ensureEnoughIndexBufferSpace(t.length),this._currentBufferData.writeIndices(t)}writeVertex(...t){return this._ensureEnoughVertexBufferSpace(),this._writeVertex(this._currentBufferData,...t),this._currentMeshWrittenVertices++}_ensureEnoughVertexBufferSpace(t=1){this._currentBufferData||this._requestNewBuffer();const e=this._currentBufferData.vertexBuffer,i=t*e.vertexByteSize;if(e.occupiedByteSize+i>e.byteSize&&(this._requestNewBuffer(),i>this._currentBufferData.vertexBuffer.byteSize))throw new Error("Mesh is too big to write its vertices")}_ensureEnoughIndexBufferSpace(t){this._currentBufferData||this._requestNewBuffer();const e=this._currentBufferData.indexBuffer;if(e.occupiedSize+t>e.size&&(this._requestNewBuffer(),t>this._currentBufferData.indexBuffer.size))throw new Error("Mesh is too big to write its indices")}_requestNewBuffer(){const t=this._currentBufferData;this._currentBufferData=this._bufferDataProvider(),t&&(t.vertexBuffer.transferUnfinishedMesh(this._currentBufferData.vertexBuffer),t.indexBuffer.transferUnfinishedMesh(this._currentBufferData.indexBuffer,t.vertexBuffer.currentMeshBaseIndex))}}{writeFakePrimitive(t,e,i){const r=this.writeVertex(t,e.minX,e.minY,i),s=this.writeVertex(t,e.minX,e.maxY,i),n=this.writeVertex(t,e.maxX,e.minY,i),o=this.writeVertex(t,e.maxX,e.maxY,i);return this.writeIndices([r,n,s,s,n,o]),this.endMesh()}_writeVertex(t,e,i,r,s){(function(t,e){const i=lr(e.x),r=lr(e.y);t.writeVertexUint32(ar(i>>>16,r>>>16)),t.writeVertexUint32(ar(i,r))})(t,e),t.writeVertexUint32(ar(i,r)),t.writeVertexUint32(s)}}Error;class cr{constructor(t,e){this._wordByteSize=e,this._nextWordOffset=0,this._currentMeshByteOffset=0,this._uint8View=new Uint8Array(t)}get data(){return this._uint8View.buffer}get byteSize(){return this._uint8View.byteLength}get occupiedByteSize(){return this._nextWordOffset*this._wordByteSize}endMesh(){const t=this._currentMeshByteOffset,e=this.occupiedByteSize,i=e-t;return this._currentMeshByteOffset=e,{byteOffset:t,byteSize:i}}transferUnfinishedMesh(t){const e=this.occupiedByteSize,i=e-this._currentMeshByteOffset,r=this._uint8View.subarray(this._currentMeshByteOffset,e);t._uint8View.set(r,0),t._nextWordOffset=i/this._wordByteSize,this._nextWordOffset=this._currentMeshByteOffset/this._wordByteSize}reset(){this._nextWordOffset=0,this._currentMeshByteOffset=0}}class dr extends cr{constructor(t,e){super(t*e,Uint32Array.BYTES_PER_ELEMENT),this.vertexByteSize=e,this._uint32View=new Uint32Array(this._uint8View.buffer),this._float32View=new Float32Array(this._uint8View.buffer),this._currentMeshBaseIndex=0}get currentMeshBaseIndex(){return this._currentMeshBaseIndex}get isFull(){return this._nextWordOffset>=this._uint32View.length}pushUint32(t){this._uint32View[this._nextWordOffset++]=t}pushFloat32(t){this._float32View[this._nextWordOffset++]=t}asUint32Array(){return this._uint32View.subarray(0,this._nextWordOffset)}endMesh(){return this._currentMeshBaseIndex=this.occupiedByteSize/this.vertexByteSize,super.endMesh()}reset(){this._currentMeshBaseIndex=0,super.reset()}}class ur extends cr{constructor(t){const e=Uint16Array.BYTES_PER_ELEMENT;super(t*e,e),this._uint16View=new Uint16Array(this._uint8View.buffer)}get size(){return this._uint16View.length}get occupiedSize(){return this._nextWordOffset}push(t){this._uint16View[this._nextWordOffset++]=t}asUint16Array(){return this._uint16View.subarray(0,this._nextWordOffset)}transferUnfinishedMesh(t,e=0){if(super.transferUnfinishedMesh(t),e)for(let i=0;i<t._nextWordOffset;i++)t._uint16View[i]-=e}}class fr{constructor(t,e,i,r){this.id=t,this.vertexBuffer=new dr(e,i),this.indexBuffer=new ur(r),this.onMeshWritten=this._onMeshWritten=new s}writeVertexUint32(t){this.vertexBuffer.pushUint32(t)}writeVertexFloat32(t){this.vertexBuffer.pushFloat32(t)}writeIndices(t){const e=this.vertexBuffer.currentMeshBaseIndex;for(const i of t)this.indexBuffer.push(e+i)}endMesh(){const t=this.vertexBuffer.endMesh(),e=this.indexBuffer.endMesh(),i={vertexByteOffset:t.byteOffset,vertexByteLength:t.byteSize,indexByteOffset:e.byteOffset,indexByteLength:e.byteSize,bufferId:this.id};return this._onMeshWritten.fire(i),i}reset(){this.vertexBuffer.reset(),this.indexBuffer.reset()}}const _r={vertexMinByte:Number.MAX_SAFE_INTEGER,vertexMaxByte:Number.MIN_SAFE_INTEGER,indexMinByte:Number.MAX_SAFE_INTEGER,indexMaxByte:Number.MIN_SAFE_INTEGER};class pr extends bt{constructor(t,e,i,r,n){super(),this.id=t,this.attribMapping=e,this.data=new fr(t,i,r,n),this.data.onMeshWritten.addListener(this._onMeshWritten,this),this.onUpdate=this._onUpdate=new s,this._updatedRegion=Object.assign({},_r)}reset(){this.data.reset(),this.flushUpdatedRegion()}touch(t){this._onMeshWritten(t)}flushUpdatedRegion(){const t=this._updatedRegion;return this._updatedRegion=Object.assign({},_r),t}_onMeshWritten(t){t.vertexByteOffset<this._updatedRegion.vertexMinByte&&(this._updatedRegion.vertexMinByte=t.vertexByteOffset);const e=t.vertexByteOffset+t.vertexByteLength;e>this._updatedRegion.vertexMaxByte&&(this._updatedRegion.vertexMaxByte=e),t.indexByteOffset<this._updatedRegion.indexMinByte&&(this._updatedRegion.indexMinByte=t.indexByteOffset);const i=t.indexByteOffset+t.indexByteLength;i>this._updatedRegion.indexMaxByte&&(this._updatedRegion.indexMaxByte=i),this._onUpdate.fire(this)}}class mr{constructor(t){this._communicator=t,this._updatedPages=new Set,this._pages=new Map,this._freePages=new Map,this._lastGeneratedPageId=0}getPage(t){return this._pages.get(t)}getFreeOrCreatePage(t){const e=this._freePages.get(t),i=e&&e.pop();if(i)return i.reset(),i;{const e=this._generateId(),i=new pr(e,t,65536,t.vertexByteSize,131072);return i.onUpdate.addListener(this._onPageUpdated,this),i.onReleased.addListener(this._onPageReleased,this),this._pages.set(e,i),this._communicator.sendMessage({type:F.FROM_BACKEND_ADD_PAGE,id:e,attribMapping:t,vertexDataByteSize:i.data.vertexBuffer.byteSize,indexDataByteSize:i.data.indexBuffer.byteSize},!1),i}}flushBackendUpdates(){for(const t of this._updatedPages){const{vertexMinByte:e,vertexMaxByte:i,indexMinByte:r,indexMaxByte:s}=t.flushUpdatedRegion(),n=t.data.vertexBuffer.data.slice(e,i),o=t.data.indexBuffer.data.slice(r,s);this._communicator.sendMessage({type:F.FROM_BACKEND_UPDATE_PAGE,id:t.id,vertexData:n,vertexByteOffset:e,indexData:o,indexByteOffset:r},!1,n,o)}this._updatedPages.clear()}_onPageUpdated(t){this._updatedPages.add(t)}_onPageReleased(t){const e=this._freePages.get(t.attribMapping);e?e.push(t):this._freePages.set(t.attribMapping,[t])}_generateId(){return this._lastGeneratedPageId++}}const gr=Ke([[0,{size:2,type:5123,normalized:!1}],[1,{size:2,type:5123,normalized:!1}],[6,{size:2,type:5122,normalized:!1}],[2,{size:4,type:5121,normalized:!1}]]);var vr=i(1),yr=i.n(vr);function xr(t,e){return e.vertexByteOffset+e.vertexByteLength===t.vertexByteOffset&&e.indexByteOffset+e.indexByteLength===t.indexByteOffset&&(e.vertexByteLength+=t.vertexByteLength,e.indexByteLength+=t.indexByteLength,!0)}function br(t){const e=t.page,i=t.location;return{firstPrimitive:t,page:e,vertexByteOffset:i.vertexByteOffset,vertexByteLength:i.vertexByteLength,indexByteOffset:i.indexByteOffset,indexByteLength:i.indexByteLength}}function wr(t,e){return function*(t,e,i,r=(()=>!0)){const s=t[Symbol.iterator]();let n=s.next().value;if(!n)return;let o=n,a=i(o);for(n=s.next().value;n;){const t=e(n);r(o,n,a)&&xr(t,a)||(yield a,a=i(n)),o=n,n=s.next().value}yield a}(t,t=>t.location,br,(t,i)=>!(t.page!==i.page||e&&!e(t,i)))}class Ar extends oi{constructor(t,e,i,r,n,o){super(e,i,r,n,o),this.primitiveProvider=t,this.onUpdate=this._onUpdate=new s,this._updateListener=()=>this._onUpdate.fire(),this.primitiveProvider.onUpdate.addListener(this._updateListener),this._canBatchPredicate=this._canBatchAdjacentPrimitives.bind(this)}destroy(){this.primitiveProvider.onUpdate.removeListener(this._updateListener),super.destroy()}_render(t,e){const i=this._program;for(const r of e){i.setVector2Uniform("lookAtHigh",r.lookAtHigh),i.setVector2Uniform("lookAtLow",r.lookAtLow);for(const t of wr(this._getPrimitives(),this._canBatchPredicate))this._renderBatch(t,i)}}_renderHitTestBuffer(t,e){const i=this._hitTestProgram;for(const r of e){i.setVector2Uniform("lookAtHigh",r.lookAtHigh),i.setVector2Uniform("lookAtLow",r.lookAtLow);for(const t of wr(this._getHitTestPrimitives(),this._canBatchPredicate))this._renderHitTestBufferBatch(t,i)}}_getPrimitives(){return this.primitiveProvider.primitives}_getHitTestPrimitives(){return this.primitiveProvider.primitives}_prepareProgram(t,e,i,...r){super._prepareProgram(t,e,i,...r),t.setMatrix4Uniform("viewProjMatrix",e)}_prepareHitTestProgram(t,e,i,...r){super._prepareProgram(t,e,i,...r),t.setMatrix4Uniform("viewProjMatrix",e)}_renderBatch(t,e){this._context.bindVao(t.page.vao),this._context.drawIndexedMesh(t.indexByteOffset,Yi(t.indexByteLength,t.page.indexType))}_renderHitTestBufferBatch(t,e){this._context.bindVao(t.page.vao),this._context.drawIndexedMesh(t.indexByteOffset,Yi(t.indexByteLength,t.page.indexType))}_canBatchAdjacentPrimitives(t,e){return!0}}class Tr extends Ar{constructor(t,e,i){super(t,e,new Ze,i)}_getPrimitives(){return this.primitiveProvider.visiblePrimitives}_prepareProgram(t,e,i,r,s,n,o,a,l,h,c){super._prepareProgram(t,e,i,r,s,n,o,a,l,h,c),this._context.bindTextureUnit(0),this._context.bindTexture(n),this._context.bindTextureUnit(1),this._context.bindTexture(o),this._context.bindTextureUnit(2),this._context.bindTexture(a),t.setIntScalarUniform("visibility",0),t.setIntScalarUniform("overlap",1),t.setIntScalarUniform("scene",2),t.setVector2Uniform("idHalfPxSize",n.getHalfPxSize()),t.setVector2Uniform("shift",s),t.setScalarUniform("currentZoom",l),t.setScalarUniform("currentTilt",h),t.setScalarUniform("currentAzimuth",c)}_prepareRenderTarget(t,e,i,r,s,n,o){this._context.bindRenderState(r),this._context.bindRenderTarget(t)}}const Pr={attribMap:{vertexPosHigh:0,vertexPosLow:1,vertexDisplacement:6,vertexId:2}};class Sr extends Tr{constructor(t,e,i){super(t,e,e.createProgram(yr.a,Ti.a,Pr)),this._camera=i}_prepareProgram(t,e,i,r,s,n,o,a,l,h,c){super._prepareProgram(t,e,i,r,s,n,o,a,l,h,c),t.setVector2Uniform("pixelSize",this._camera.pixelSize)}}var Rr=i(16),Mr=i.n(Rr),zr=i(17),Cr=i.n(zr);class kr extends oi{constructor(t,e){const i=e.createProgram(Mr.a,Cr.a,{attribMap:{vertexId:2}});super(e,new Ze,i),this._primitiveProvider=t}_render(){const t=this._primitiveProvider.primitives;for(const e of wr(t))this._context.bindVao(e.page.vao),this._context.drawIndexedMesh(e.indexByteOffset,Yi(e.indexByteLength,e.page.indexType),0)}_prepareProgram(t,e){super._prepareProgram(t,e),t.setVector2Uniform("idHalfPxSize",e)}}class Br{constructor(){this.onMessage=this._onMessage=new s}sendMessage(t,e){this.peerCommunicator&&this.peerCommunicator._onMessage.fire(t)}}class Or{constructor(t,e,i,r){this._pageRegistryCommunicators=function(){const t=new Br,e=new Br;return t.peerCommunicator=e,e.peerCommunicator=t,{master:t,worker:e}}(),this._pageRegistry=new V(this._pageRegistryCommunicators.master,t),this._pageRegistryBackend=new mr(this._pageRegistryCommunicators.worker),this._bufferWriter=new hr(function(t,e){let i;return()=>{i&&setTimeout(t=>t.release(),0,i),(i=t.getFreeOrCreatePage(e)).retain();const r=t=>{t.release(),t.onRetain.removeListener(r)};return i.retain(),i.onRetain.addListener(r),i.data}}(this._pageRegistryBackend,gr)),this._visibilityManager=i,this._fakePrimitiveStorage=new Nt,this._fakePrimitiveColorIdRenderer=new Sr(this._fakePrimitiveStorage,t,e),this._fakePrimitiveResetRemovedRenderer=new kr(this._fakePrimitiveStorage,t),this._visibilityManager.registerCollidingPrimitives(this._fakePrimitiveStorage,this._fakePrimitiveColorIdRenderer,this._fakePrimitiveResetRemovedRenderer),this._idGenerator=r,this._primitives=new Map}destructor(){this._visibilityManager.deregisterCollidingPrimitives(this._fakePrimitiveStorage,this._fakePrimitiveColorIdRenderer,this._fakePrimitiveResetRemovedRenderer),this._fakePrimitiveResetRemovedRenderer.destroy(),this._fakePrimitiveColorIdRenderer.destroy(),this._pageRegistry.destructor()}addPrimitives(...t){const e=t.map(({anchor:t,rect:e})=>{const i=this._idGenerator();return{id:i,location:this._bufferWriter.writeFakePrimitive(t,e,i)}});this._pageRegistryBackend.flushBackendUpdates();const i=e.map(({location:t,id:e})=>{const i=this._pageRegistry.getPage(t.bufferId);if(!i)throw new Error("No page for created fake primitive");return new or(i,t,e)});return this._fakePrimitiveStorage.add(i),this._createCollidingPrimitives(i)}removePrimitives(...t){const e=[];for(const i of t){const t=this._primitives.get(i);t&&(e.push(t),this._primitives.delete(i))}this._fakePrimitiveStorage.delete(e)}clear(){this.removePrimitives(...this._primitives.keys())}_createCollidingPrimitives(t){return t.map(t=>{const e={};return this._primitives.set(e,t),e})}}const Ir={min:1,max:511};class Er{constructor(t,e,i,r=new qi(t,e,i,t.getDefaultRenderTarget().size)){this.camera=e,this.context=t,this._renderTarget=t.getDefaultRenderTarget(),this.renderer=new nr(t,e),this.renderLoop=i,this.memoryManager=new Zi(t),this._hitTestManager=new $i(t,this.renderer,i),this._atlases=new Set,this.visibilityManager=r,this.visibilityTextureProvider=()=>(this.visibilityManager.updateVisibilityIfNeeded(),this.visibilityManager.visibilityTexture),this.invisibleCollidingPrimitiveManager=new Or(t,e,r,function({min:t,max:e}){let i=0;return()=>i++%(e-t+1)+t}(Ir)),this._onRender=this._onRender.bind(this),i.onRender.addListener(this._onRender),this._updateListener=()=>this.renderLoop.update(),this.onInternalError=new Ne,this.camera.onUpdate.addListener(this._updateListener),this.renderer.onUpdate.addListener(this._updateListener),this._contextLostListener=()=>this.onInternalError.fire(),this.context.onLoss.addListener(this._contextLostListener)}setRenderTargetSize(t){mt(this._renderTarget.size,t)||(this._renderTarget.size=t,this.visibilityManager.setTargetSize(t),this._hitTestManager.updateSize())}createImageAtlas(t){const e=new He(this.context,t);return e.onContentUpdate.addListener(this._updateListener),this._atlases.add(e),e}removeImageAtlas(t){t.destroy(),t.onContentUpdate.removeListener(this._updateListener),this._atlases.delete(t)}destroy(){this.camera.onUpdate.removeListener(this._updateListener),this.renderer.onUpdate.removeListener(this._updateListener);for(const t of this._atlases)t.onContentUpdate.removeListener(this._updateListener),t.destroy();this.context.onLoss.removeListener(this._contextLostListener),this.invisibleCollidingPrimitiveManager.destructor()}getObjectIdAt(t){return this._hitTestManager.getIdAt(t)}setBackgroundColor(t){this.renderer.setBackgroundColor(t),this.renderLoop.update()}_onRender(){this.renderer.render(this._renderTarget),this._hitTestManager.setDirty()}}const Lr=Math.PI/180;function Ur(t){return t*Lr}function Dr(t,...e){const i=Object.assign({},t);for(const r of e)if(r)for(const t of Object.keys(r)){const e=r[t];void 0!==e&&(i[t]=e)}return i}const Fr=Ur(20),Vr=[ee(-1,1,-1),ee(1,1,-1),ee(1,-1,-1),ee(-1,-1,-1)],jr={wrapModeX:1,wrapModeY:1,minZoom:0,maxZoom:24,fov:Ur(30),maxTilt:Ur(40),minTilt:Ur(0)};function Nr(t,e){switch(t){case 0:return e;case 1:return X(e,-1,1);case 2:return Y(e,-1,1)}}class Hr{constructor(t){this.options=Dr(jr,t),this.center=new Hr._Center(this),this.onUpdate=this._onUpdate=new s;const e=new Hr._ScreenSize(this);this.screenSize=e,this._distanceToCenter=1,this._recalculateMinDistanceToCenter(),this._zoom=this.options.minZoom,this._fov=this._computeFovAtZoom(this._zoom),this._tilt=this._azimuth=0,this._dirtyBits=-1,this._viewProjMatrix=ge(pe),this._visibleQuadrilateral=[ee(0,0,0),ee(0,0,0),ee(0,0,0),ee(0,0,0)],this._visibleQuadrilateralBBox=ft(this._visibleQuadrilateral),this._pixelSize=ot(0,0)}get aspectRatio(){const{width:t,height:e}=this.screenSize;return 0!==e?t/e:1}get zoom(){return this._zoom}get worldToPxFactor(){return this._worldToPxFactor}set zoom(t){(t=X(t,this.options.minZoom,this.options.maxZoom))!==this._zoom&&(this._zoom=t,this._recalculateDistanceToCenter(),this._fov=this._computeFovAtZoom(t),this._tilt=this._constrainTilt(this._tilt),this._worldToPxFactor=2/(256*Math.pow(2,t)),this._setDirtyBits(3))}get fov(){return this._fov}get tilt(){return this._tilt}set tilt(t){t=this._constrainTilt(t),this._tilt!==t&&(this._tilt=t,this._setDirtyBits(3))}get azimuth(){return this._azimuth}set azimuth(t){t=Y(t,0,2*Math.PI),this._azimuth!==t&&(this._azimuth=t,this._setDirtyBits(3))}get pixelSize(){return this._pixelSize}setDirty(){this._setDirtyBits(-1)}getViewProjMatrix(){const t=this._viewProjMatrix;if(1&this._dirtyBits){ge(pe,t),function(t,e,i,r,s=me()){const n=function(t,e,i=ee(0,0,0)){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i}(e,i);le(n,n);const o=ce(r,n);le(o,o);const a=ce(n,o);ve[0]=o.x,ve[1]=a.x,ve[2]=n.x,ve[4]=o.y,ve[5]=a.y,ve[6]=n.y,ve[8]=o.z,ve[9]=a.z,ve[10]=n.z,ve[12]=-he(o,e),ve[13]=-he(a,e),ve[14]=-he(n,e),ye(t,ve,s)}(t,this._computeCenterToCameraVector(),ie,ue(re,this._azimuth),t);const e=Math.tan(Math.abs(this._tilt))*Math.tan(.5*this._fov);!function(t,e,i,r,s,n=me()){const o=1/Math.tan(.5*e),a=o/i,l=(r+s)/(r-s),h=2*r*s/(r-s);for(let c=0;c<16;c+=4){n[c]=t[c]*a,n[c+1]=t[c+1]*o;const e=t[c+2],i=t[c+3];n[c+2]=e*l+i*h,n[c+3]=-e}}(t,this._fov,this.aspectRatio,Math.min(.01*this._distanceToCenter,this._distanceToCenter/(1+e)),this._distanceToCenter/(1-e),t),this._dirtyBits&=-2}return t}getVisibleRegion(){return this._computeVisibleQuadrilateral(),this._visibleQuadrilateral}getVisibleRegionBBox(){return this._computeVisibleQuadrilateral(),this._visibleQuadrilateralBBox}_constrainTilt(t){const e=function(t,e,i){const r=X((i-1)/1,0,1);return r*r*(3-2*r)}(0,0,this._zoom);return X(t,this.options.minTilt*e,this.options.maxTilt*e)}_setDirtyBits(t){t^t&this._dirtyBits&&(this._dirtyBits|=t,this._onUpdate.fire())}_computeFovAtZoom(t){if(t<=19)return this.options.fov;const e=t-19;return 2*Math.atan(Math.pow(2,-e)*Math.tan(.5*this.options.fov))}_computeDistanceToCenter(t){return this.screenSize.height*Math.pow(2,-t)/(256*Math.tan(.5*this.options.fov))}_recalculateDistanceToCenter(){this._distanceToCenter=Math.max(this._computeDistanceToCenter(this._zoom),this._minDistanceToCenter)}_recalculateMinDistanceToCenter(){this._minDistanceToCenter=this._computeDistanceToCenter(19)}_computeCenterToCameraVector(t=ee(0,0,0)){return ae(se,this._distanceToCenter,t),de(t,this._tilt,t),ue(t,this._azimuth,t),t}_computeVisibleQuadrilateral(){if(2&this._dirtyBits){const t=this._visibleQuadrilateral,e=Math.tan(.5*this._fov),i=this._computeCenterToCameraVector();ht(i,this.center,i);const r=ee(e*this.aspectRatio,e,1),s=ee(0,0,0),n={origin:i,direction:s};for(let o=0;o<4;++o)if(oe(Vr[o],r,s),de(s,this._computeFrustumTiltAngle(Vr[o]),s),ue(s,this._azimuth,s),!_e(fe,n,t[o]))throw new Error("Visible quadrilateral is unbounded, engine can't handle that case (yet)");ft(t,this._visibleQuadrilateralBBox),this._dirtyBits&=-3}}_computeFrustumTiltAngle(t){const e=this._tilt,i=this._fov/2;return-1!==t.y||e<=i?e:Math.max(e-Fr,i)}}Hr._Center=class{constructor(t){this._camera=t,this._x=this._y=0}get x(){return this._x}set x(t){const e=this._camera;t=Nr(e.options.wrapModeX,t),this._x!==t&&(this._x=t,e._setDirtyBits(2))}get y(){return this._y}set y(t){const e=this._camera;t=Nr(e.options.wrapModeY,t),this._y!==t&&(this._y=t,e._setDirtyBits(2))}},Hr._ScreenSize=class{constructor(t){this._camera=t,this._width=this._height=0}get width(){return this._width}set width(t){if(this._width!==t){this._width=t;const e=this._camera;e._setDirtyBits(3),e._pixelSize.x=2/this._width}}get height(){return this._height}set height(t){if(this._height!==t){this._height=t;const e=this._camera;e._recalculateMinDistanceToCenter(),e._recalculateDistanceToCenter(),e._setDirtyBits(3),e._pixelSize.y=2/this._height}}};class Wr{constructor(t,e,i){this._gl=t,this._target=e,this._handle=t.createBuffer(),this._size=i}get size(){return this._size}bind(){this._gl.bindBuffer(this._target,this._handle)}isBound(){const t=this._gl,e=this._handle;switch(this._target){case t.ARRAY_BUFFER:return t.getParameter(t.ARRAY_BUFFER_BINDING)===e;case t.ELEMENT_ARRAY_BUFFER:return t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING)===e}return!1}getTarget(){return this._target}getSize(){return this._size}destroy(){this._gl.deleteBuffer(this._handle)}}class qr{constructor(t,e){this.isClear=!1,this._gl=t,this._handle=t.createFramebuffer(),this.size=pt(e)}bind(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._handle)}isBound(){const t=this._gl;return t.getParameter(t.FRAMEBUFFER_BINDING)===this._handle}readPixels(t=this.size,e=at,i=new Uint8Array(t.width*t.height*4)){return this._gl.readPixels(e.x,e.y,t.width,t.height,6408,5121,i),i}destroy(){this._gl.deleteFramebuffer(this._handle)}}function Xr(t,e){const i=Object.keys(e).map(t=>"#define "+t+" "+e[t]).join("\n"),r=t.indexOf("#version");if(-1===r)return i+"\n"+t;const s=t.indexOf("\n",r)+1;return t.slice(0,s)+i+"\n"+t.slice(s)}function Yr(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}class Gr{constructor(t,e,i,r){this._gl=t;const s=this._handle=t.createProgram();r&&r.defines&&(e=Xr(e,r.defines),i=Xr(i,r.defines));const n=Yr(t,t.VERTEX_SHADER,e),o=Yr(t,t.FRAGMENT_SHADER,i);t.attachShader(s,n),t.attachShader(s,o),t.deleteShader(n),t.deleteShader(o),r&&r.attribMap&&Object.keys(r.attribMap).forEach(e=>t.bindAttribLocation(s,r.attribMap[e],e)),t.linkProgram(s),this._uniformCache=new Map}bind(){const t=this._gl,e=this._handle;t.useProgram(e)}isBound(){const t=this._gl;return t.getParameter(t.CURRENT_PROGRAM)===this._handle}setIntScalarUniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniform1i(i,e)}setScalarUniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniform1f(i,e)}setVector2Uniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniform2f(i,e.x,e.y)}setVector3Uniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniform3f(i,e.x,e.y,e.z)}setVector4Uniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniform4f(i,e.x,e.y,e.z,e.w)}setColorUniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniform4f(i,e.r,e.g,e.b,e.a)}setMatrix3Uniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniformMatrix3fv(i,!1,e)}setMatrix4Uniform(t,e){const i=this._getUniformLocation(t);i&&this._gl.uniformMatrix4fv(i,!1,e)}destroy(){this._gl.deleteProgram(this._handle)}_getUniformLocation(t){const e=this._uniformCache;let i=e.get(t);return i||(i=this._gl.getUniformLocation(this._handle,t),e.set(t,i),i)?i:null}}class Zr{constructor(t,e,i){this._gl=t,this._handle=t.createRenderbuffer(),this._width=e,this._height=i}bind(){const t=this._gl;t.bindRenderbuffer(t.RENDERBUFFER,this._handle)}isBound(){const t=this._gl;return t.getParameter(t.RENDERBUFFER_BINDING)===this._handle}attachToFramebuffer(t){const e=this._gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,this._handle)}getWidth(){return this._width}getHeight(){return this._height}destroy(){this._gl.deleteRenderbuffer(this._handle)}}class Kr{constructor(t){this._gl=t,this._paramValues=new Map}getAliasedLineWidthRange(){return this._getParam(33902)}getAliasedPointSizeRange(){return this._getParam(33901)}getMaxCombinedTextureImageUnits(){return this._getParam(35661)}getMaxCubeMapTextureSize(){return this._getParam(34076)}getMaxFragmentUniformVectors(){return this._getParam(36349)}getMaxRenderbufferSize(){return this._getParam(34024)}getMaxTextureImageUnits(){return this._getParam(34930)}getMaxTextureSize(){return this._getParam(3379)}getMaxVaryingVectors(){return this._getParam(36348)}getMaxVertexAttribs(){return this._getParam(34921)}getMaxVertexTextureImageUnits(){return this._getParam(35660)}getMaxVertexUniformVectors(){return this._getParam(36347)}getMaxViewportDims(){return this._getParam(3386)}getRenderer(){return this._getParam(7937)}getSubpixelBits(){return this._getParam(3408)}getVendor(){return this._getParam(7936)}getVersion(){return this._getParam(7938)}getUnmaskedVendor(){return this._getParam(37445)}getUnmaskedRenderer(){return this._getParam(37446)}_getParam(t){const e=this._paramValues;let i=e.get(t);return i||(i=this._gl.getParameter(t),e.set(t,i)),i}}const Qr={wrapS:33071,wrapT:33071,magnificationFilter:9728,minificationFilter:9728,premultipliedAlpha:!1,unpackAlignment:4};class Jr{constructor(t,e,i,r,s,n){const o=Object.assign(Object.assign({},Qr),n);this._gl=t,this._format=r,this._type=s,this._params=o,this._width=e,this._height=i,this._halfPxSize=ot(.5/e,.5/i),this._handle=t.createTexture(),this._magnificationFilter=null,this._minificationFilter=null}initialize(){const t=this._gl;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT),this.setFilters(this._params.magnificationFilter,this._params.minificationFilter),t.texImage2D(t.TEXTURE_2D,0,this._format,this._width,this._height,0,this._format,this._type,null)}bind(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,this._handle)}isBound(){const t=this._gl;return t.getParameter(t.TEXTURE_BINDING_2D)===this._handle}attachToFramebuffer(t){const e=this._gl;e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,this._handle,0)}getWidth(){return this._width}getHeight(){return this._height}getFormat(){return this._format}getType(){return this._type}getParams(){return this._params}getHalfPxSize(){return this._halfPxSize}setFilters(t=this._params.magnificationFilter,e=this._params.minificationFilter){const i=this._gl;this._magnificationFilter!==t&&(this._magnificationFilter=t,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t)),this._minificationFilter!==e&&(this._minificationFilter=e,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e))}destroy(){this._gl.deleteTexture(this._handle)}}class $r{constructor(t,e,i,r,s){this._gl=t,this._vaoExt=e,this._handle=e.createVertexArrayOES(),this.attributeMapping=i,this.vertexBuffer=r,this.indexBuffer=s,this.onDestroy=new Ne}bind(){this._vaoExt.bindVertexArrayOES(this._handle)}isBound(){return this._gl.getParameter(this._vaoExt.VERTEX_ARRAY_BINDING_OES)===this._handle}destroy(){this._vaoExt.deleteVertexArrayOES(this._handle),this.onDestroy.fire()}}const ts=new Float32Array([-1,-1,0,0,1,1,1,1,-1,1,0,1,-1,-1,0,0,1,-1,1,0,1,1,1,1]),es=Ke([[0,{size:2,type:5126,normalized:!1}],[4,{size:2,type:5126,normalized:!1}]]);class is{constructor(t){this.isClear=!1,this._gl=t}bind(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null)}setSize(t,e){const i=this._gl.canvas;i.width=t,i.height=e}get size(){return _t(this._gl.drawingBufferWidth,this._gl.drawingBufferHeight)}set size(t){const e=this._gl.canvas;e.width=t.width,e.height=t.height}destroy(){}}class rs{constructor(t){this._gl=t,this.onLoss=new Ne,this._contextLostListener=t=>{t.preventDefault(),this.onLoss.fire()},t.canvas.addEventListener("webglcontextlost",this._contextLostListener),this._capabilities=new Kr(t);const e=t.getExtension("OES_vertex_array_object");if(!e)throw new Error("OES_vertex_array_object is required.");if(this._vaoExt=e,!t.getExtension("OES_standard_derivatives"))throw new Error("OES_standard_derivatives is required.");const i=this._boundRenderTarget=this._defaultRenderTarget=new is(t),r=this._boundRenderState=new Ze;this._unpackPremultiplyAlpha=!1,this._unpackAlignment=4;const{width:s,height:n}=i.size;r.scissorWidth=r.viewportWidth=s,r.scissorHeight=r.viewportHeight=n;const o=this._quadVertexBuffer=new Wr(t,t.ARRAY_BUFFER,t.STATIC_DRAW);o.bind(),t.bufferData(t.ARRAY_BUFFER,ts,t.STATIC_DRAW),this._quadVao=this.createVao(es,o,null),t.bindBuffer(t.ARRAY_BUFFER,null),this._boundProgram=null,this._boundVao=null,this._boundTextures=new Array(this._capabilities.getMaxCombinedTextureImageUnits()),this._boundTextures.fill(null),this._boundTextureUnit=0}getCapabilities(){return this._capabilities}createFramebuffer({color:t,depth:e,stencil:i,depthStencil:r}){const s=this._gl;let n=0,o=0;t?(n=t.getWidth(),o=t.getHeight()):e?(n=e.getWidth(),o=e.getHeight()):i?(n=i.getWidth(),o=i.getHeight()):r&&(n=r.getWidth(),o=r.getHeight());const a=new qr(s,_t(n,o));return this.bindRenderTarget(a),t&&t.attachToFramebuffer(s.COLOR_ATTACHMENT0),e&&e.attachToFramebuffer(s.DEPTH_ATTACHMENT),i&&i.attachToFramebuffer(s.STENCIL_ATTACHMENT),r&&r.attachToFramebuffer(s.DEPTH_STENCIL_ATTACHMENT),a}createRenderbuffer(t,e,i){const r=this._gl,s=new Zr(r,t,e);return s.bind(),r.renderbufferStorage(r.RENDERBUFFER,i,t,e),s}createEmpty2DTexture(t,e,i,r,s){const n=new Jr(this._gl,t,e,i,r,s);return this.bindTexture(n),n.initialize(),n}createProgram(t,e,i){return new Gr(this._gl,t,e,i)}createVertexBuffer(t,e=35044){return this._createBuffer(this._gl.ARRAY_BUFFER,t,e)}createIndexBuffer(t,e=35044){return this._createBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t,e)}uploadDataToBuffer(t,e,i=0){t.bind(),this._gl.bufferSubData(t.getTarget(),i,e)}createVao(t,e,i,r=t.vertexByteSize){const s=this._gl,n=new $r(s,this._vaoExt,t,e,i);n.bind(),i?i.bind():s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),e.bind();for(const[o,a]of t.attributes)s.enableVertexAttribArray(o),s.vertexAttribPointer(o,a.size,a.type,a.normalized,r,a.offset);return this._vaoExt.bindVertexArrayOES(null),n}setTextureData(t,e,i={x:0,y:0},r={width:t.getWidth(),height:t.getHeight()}){const s=this._gl,n=t.getFormat(),o=t.getType(),a=t.getParams(),{width:l,height:h}=r;this._setTextureDataUnpackParams(a),this.bindTexture(t),s.texSubImage2D(s.TEXTURE_2D,0,i.x,i.y,l,h,n,o,e),this._onTextureDataUpdated(t)}setTextureDataFromDomElement(t,e){const i=this._gl,r=t.getFormat(),s=t.getType(),n=t.getParams();this._setTextureDataUnpackParams(n),this.bindTexture(t),i.texSubImage2D(i.TEXTURE_2D,0,0,0,r,s,e),this._onTextureDataUpdated(t)}getDefaultRenderTarget(){return this._defaultRenderTarget}clearCurrentTarget(t){t&&(this._gl.clear(t),this._boundRenderTarget.isClear=!0)}bindRenderTarget(t){this._boundRenderTarget!==t&&(t.bind(),this._boundRenderTarget=t);const{width:e,height:i}=t.size;this._setViewportState(new Ze({viewportWidth:e,viewportHeight:i}))}bindRenderState(t){this._setColorBufferState(t),this._setBlendState(t),this._setCullFaceState(t),this._setFrontFaceState(t),this._setDepthTestState(t),this._setDitherState(t),this._setPolygonOffsetState(t),this._setAlphaToCoverageState(t),this._setSampleCoverageState(t),this._setStencilTestState(t),this._setScissorTestState(t),this._setViewportState(t)}bindProgram(t){this._boundProgram!==t&&(t.bind(),this._boundProgram=t)}bindVao(t){this._boundVao!==t&&(t?t.bind():this._vaoExt.bindVertexArrayOES(null),this._boundVao=t)}bindQuadVao(){this.bindVao(this._quadVao)}bindTextureUnit(t){const e=this._gl;this._boundTextureUnit!==t&&(e.activeTexture(e.TEXTURE0+t),this._boundTextureUnit=t)}bindTexture(t,e,i){const r=this._boundTextureUnit;this._boundTextures[r]!==t&&(t.bind(),this._boundTextures[r]=t),t.setFilters(e,i)}drawQuad(){this.drawMesh(0,6,4)}drawMesh(t,e,i=4){this._gl.drawArrays(i,t,e),this._boundRenderTarget.isClear=!1}drawIndexedMesh(t,e,i=4){const r=this._gl;r.drawElements(i,e,r.UNSIGNED_SHORT,t),this._boundRenderTarget.isClear=!1}destroy(){this._quadVao.destroy(),this._quadVertexBuffer.destroy(),this._gl.canvas.removeEventListener("webglcontextlost",this._contextLostListener)}static createFromCanvas(t,e){const i=t.getContext("webgl",e);if(!i)throw new Error("Failed to create GL context from canvas.");return new rs(i)}_setCapabilityEnabled(t,e){e?this._gl.enable(t):this._gl.disable(t)}_setColorBufferState(t){const e=this._gl,i=this._boundRenderState,r=t.clearColor;var s,n;n=r,((s=i.clearColor).r!==n.r||s.g!==n.g||s.b!==n.b||s.a!==n.a)&&(e.clearColor(r.r,r.g,r.b,r.a),function(t,e=qe(0,0,0,0)){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}(r,i.clearColor)),i.colorMaskR===t.colorMaskR&&i.colorMaskG===t.colorMaskG&&i.colorMaskB===t.colorMaskB&&i.colorMaskAlpha===t.colorMaskAlpha||(this._gl.colorMask(t.colorMaskR,t.colorMaskG,t.colorMaskB,t.colorMaskAlpha),i.colorMaskR=t.colorMaskR,i.colorMaskG=t.colorMaskG,i.colorMaskB=t.colorMaskB,i.colorMaskAlpha=t.colorMaskAlpha)}_setBlendState(t){const e=this._gl,i=this._boundRenderState;i.blend!==t.blend&&(this._setCapabilityEnabled(e.BLEND,t.blend),i.blend=t.blend),t.blend&&(i.blendEquationRgb===t.blendEquationRgb&&i.blendEquationAlpha===t.blendEquationAlpha||(e.blendEquationSeparate(t.blendEquationRgb,t.blendEquationAlpha),i.blendEquationRgb=t.blendEquationRgb,i.blendEquationAlpha=t.blendEquationAlpha),i.blendFuncDstRgb===t.blendFuncDstRgb&&i.blendFuncSrcRgb===t.blendFuncSrcRgb&&i.blendFuncDstAlpha===t.blendFuncDstAlpha&&i.blendFuncSrcAlpha===t.blendFuncSrcAlpha||(e.blendFuncSeparate(t.blendFuncSrcRgb,t.blendFuncDstRgb,t.blendFuncSrcAlpha,t.blendFuncDstAlpha),i.blendFuncSrcRgb=t.blendFuncSrcRgb,i.blendFuncDstRgb=t.blendFuncDstRgb,i.blendFuncSrcAlpha=t.blendFuncSrcAlpha,i.blendFuncDstAlpha=t.blendFuncDstAlpha))}_setCullFaceState(t){const e=this._gl,i=this._boundRenderState;i.cullFace!==t.cullFace&&(this._setCapabilityEnabled(e.CULL_FACE,t.cullFace),i.cullFace=t.cullFace),t.cullFace&&i.cullFaceMode!==t.cullFaceMode&&(e.cullFace(t.cullFaceMode),i.cullFaceMode=t.cullFaceMode)}_setFrontFaceState(t){const e=this._boundRenderState;e.frontFaceMode!==t.frontFaceMode&&(this._gl.frontFace(t.frontFaceMode),e.frontFaceMode=t.frontFaceMode)}_setDepthTestState(t){const e=this._gl,i=this._boundRenderState;i.depthTest!==t.depthTest&&(this._setCapabilityEnabled(e.DEPTH_TEST,t.depthTest),i.depthTest=t.depthTest),t.depthTest&&(i.clearDepth!==t.clearDepth&&(e.clearDepth(t.clearDepth),i.clearDepth=t.clearDepth),i.depthMask!==t.depthMask&&(e.depthMask(t.depthMask),i.depthMask=t.depthMask),i.depthFunc!==t.depthFunc&&(e.depthFunc(t.depthFunc),i.depthFunc=t.depthFunc),i.depthRangeNear===t.depthRangeNear&&i.depthRangeFar===t.depthRangeFar||(e.depthRange(t.depthRangeNear,t.depthRangeFar),i.depthRangeNear=t.depthRangeNear,i.depthRangeFar=t.depthRangeFar))}_setDitherState(t){const e=this._boundRenderState;e.dither!==t.dither&&(this._setCapabilityEnabled(this._gl.DITHER,t.dither),e.dither=t.dither)}_setPolygonOffsetState(t){const e=this._gl,i=this._boundRenderState;i.polygonOffset!==t.polygonOffset&&(this._setCapabilityEnabled(e.POLYGON_OFFSET_FILL,t.polygonOffset),i.polygonOffset=t.polygonOffset),!t.polygonOffset||i.polygonOffsetFactor===t.polygonOffsetFactor&&i.polygonOffsetUnits===t.polygonOffsetUnits||(e.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits)}_setAlphaToCoverageState(t){const e=this._boundRenderState;e.sampleAlphaToCoverage!==t.sampleAlphaToCoverage&&(this._setCapabilityEnabled(this._gl.SAMPLE_ALPHA_TO_COVERAGE,t.sampleAlphaToCoverage),e.sampleAlphaToCoverage=t.sampleAlphaToCoverage)}_setSampleCoverageState(t){const e=this._gl,i=this._boundRenderState;i.sampleCoverage!==t.sampleCoverage&&(this._setCapabilityEnabled(e.SAMPLE_COVERAGE,t.sampleCoverage),i.sampleCoverage=t.sampleCoverage),!t.sampleCoverage||i.sampleCoverageValue===t.sampleCoverageValue&&i.sampleCoverageInvert===t.sampleCoverageInvert||(e.sampleCoverage(t.sampleCoverageValue,t.sampleCoverageInvert),i.sampleCoverageValue=t.sampleCoverageValue,i.sampleCoverageInvert=t.sampleCoverageInvert)}_setStencilTestState(t){const e=this._gl,i=this._boundRenderState;if(i.stencilTest!==t.stencilTest&&(this._setCapabilityEnabled(e.STENCIL_TEST,t.stencilTest),i.stencilTest=t.stencilTest),t.stencilTest){i.clearStencil!==t.clearStencil&&(e.clearStencil(t.clearStencil),i.clearStencil=t.clearStencil),i.stencilWriteMask!==t.stencilWriteMask&&(e.stencilMask(t.stencilWriteMask),i.stencilWriteMask=t.stencilWriteMask);const r=i.stencilMask!==t.stencilMask||i.stencilReference!==t.stencilReference;r&&(i.stencilMask=t.stencilMask,i.stencilReference=t.stencilReference),(i.stencilFrontFunc!==t.stencilFrontFunc||r)&&(e.stencilFuncSeparate(e.FRONT,t.stencilFrontFunc,t.stencilReference,t.stencilMask),i.stencilFrontFunc=t.stencilFrontFunc),(i.stencilBackFunc!==t.stencilBackFunc||r)&&(e.stencilFuncSeparate(e.BACK,t.stencilBackFunc,t.stencilReference,t.stencilMask),i.stencilBackFunc=t.stencilBackFunc),i.stencilFrontFailOp===t.stencilFrontFailOp&&i.stencilFrontDepthFailOp===t.stencilFrontDepthFailOp&&i.stencilFrontDepthPassOp===t.stencilFrontDepthPassOp||(e.stencilOpSeparate(e.FRONT,t.stencilFrontFailOp,t.stencilFrontDepthFailOp,t.stencilFrontDepthPassOp),i.stencilFrontFailOp=t.stencilFrontFailOp,i.stencilFrontDepthFailOp=t.stencilFrontDepthFailOp,i.stencilFrontDepthPassOp=t.stencilFrontDepthPassOp),i.stencilBackFailOp===t.stencilBackFailOp&&i.stencilBackDepthFailOp===t.stencilBackDepthFailOp&&i.stencilBackDepthPassOp===t.stencilBackDepthPassOp||(e.stencilOpSeparate(e.BACK,t.stencilBackFailOp,t.stencilBackDepthFailOp,t.stencilBackDepthPassOp),i.stencilBackFailOp=t.stencilBackFailOp,i.stencilBackDepthFailOp=t.stencilBackDepthFailOp,i.stencilBackDepthPassOp=t.stencilBackDepthPassOp)}}_setScissorTestState(t){const e=this._gl,i=this._boundRenderState;i.scissorTest!==t.scissorTest&&(this._setCapabilityEnabled(e.SCISSOR_TEST,t.scissorTest),i.scissorTest=t.scissorTest),t.scissorTest&&t.scissorWidth>=0&&t.scissorHeight>=0&&(i.scissorX!==t.scissorX||i.scissorY!==t.scissorY||i.scissorWidth!==t.scissorWidth||i.scissorHeight!==t.scissorHeight)&&(e.scissor(t.scissorX,t.scissorY,t.scissorWidth,t.scissorHeight),i.scissorX=t.scissorX,i.scissorY=t.scissorY,i.scissorWidth=t.scissorWidth,i.scissorHeight=t.scissorHeight)}_setViewportState(t){const e=this._boundRenderState;t.viewportWidth>=0&&t.viewportHeight>=0&&(e.viewportX!==t.viewportX||e.viewportY!==t.viewportY||e.viewportWidth!==t.viewportWidth||e.viewportHeight!==t.viewportHeight)&&(this._gl.viewport(t.viewportX,t.viewportY,t.viewportWidth,t.viewportHeight),e.viewportX=t.viewportX,e.viewportY=t.viewportY,e.viewportWidth=t.viewportWidth,e.viewportHeight=t.viewportHeight)}_setTextureDataUnpackParams(t){const e=this._gl;this._unpackPremultiplyAlpha!==t.premultipliedAlpha&&(e.pixelStorei(37441,+t.premultipliedAlpha),this._unpackPremultiplyAlpha=t.premultipliedAlpha),this._unpackAlignment!==t.unpackAlignment&&(e.pixelStorei(3317,t.unpackAlignment),this._unpackAlignment=t.unpackAlignment)}_onTextureDataUpdated(t){const e=this._gl;t.getParams().minificationFilter>=9984&&e.generateMipmap(e.TEXTURE_2D)}_createBuffer(t,e,i=this._gl.STATIC_DRAW){const r=this._gl,s=new Wr(r,t,e);return this.bindVao(null),s.bind(),r.bufferData(t,e,i),s}}var ss=i(2),ns=i.n(ss),os=i(18),as=i.n(os);const ls=new Ze({depthTest:!0,depthFunc:518}),hs={LIGHT:{r:.98,g:.97,b:.94,a:1},DARK:{r:.12,g:.14,b:.18,a:1}};class cs extends oi{constructor(t){const e=t.createProgram(ns.a,as.a,{attribMap:{vertexPosition:0,vertexUv:4}});super(t,ls,e),this._color=hs.LIGHT,t.bindProgram(e),e.setScalarUniform("zIndex",-1),this.onUpdate=new s}setColor(t){this._color=t,this.onUpdate.fire()}_render(){this._context.bindQuadVao(),this._context.drawQuad()}_prepareProgram(t){super._prepareProgram(t),t.setScalarUniform("dpr",nt());const{r:e,g:i,b:r,a:s}=this._color;t.setVector4Uniform("color",{x:e,y:i,z:r,w:s})}}const ds=new Ze({depthTest:!0,clearDepth:-1});class us extends er{constructor(t,e=0){super(),this._depthClearStrategy=e,this._context=t}render(t,...e){this._clearDepthIfNeeded(t),super.render(t,...e)}renderHitTestBuffer(t,...e){this._clearDepthIfNeeded(t),super.renderHitTestBuffer(t,...e)}_clearDepthIfNeeded(t){1===this._depthClearStrategy&&(this._context.bindRenderState(ds),this._context.bindRenderTarget(t),this._context.clearCurrentTarget(256))}}var fs=i(19),_s=i.n(fs);const ps=new Ze(Xe);class ms extends oi{constructor(t,e){super(t,ps,t.createProgram(ns.a,_s.a,{attribMap:{vertexPosition:0}})),this._renderers=new er,this._renderLoop=e,this.onUpdate=this._renderers.onUpdate,this._pixelSize=ot(0,0)}addRenderUnit(t){this._renderers.addRenderUnit(t)}removeRenderUnit(t){this._renderers.removeRenderUnit(t)}render(t,...e){if(this._renderLoop.isActive)return this._renderers.render(t,...e),void this._renderLoop.update();this._intermediateRenderbuffer?mt(this._intermediateRenderbuffer.size,t.size)||(this._destroyInternalRenderTargets(),this._initIntermediateRenderTargets(t.size)):this._initIntermediateRenderTargets(t.size),this._context.bindRenderTarget(this._intermediateRenderbuffer),this._context.clearCurrentTarget(17664),this._renderers.render(this._intermediateRenderbuffer,...e),this._intermediateRenderbuffer.isClear||(this._updateFrameUniformState(t),super.render(t,...e))}renderHitTestBuffer(t,...e){this._renderers.renderHitTestBuffer(t,...e)}destroy(){this._intermediateRenderbuffer&&this._destroyInternalRenderTargets()}_render(){this._context.bindQuadVao(),this._context.drawQuad()}_prepareProgram(t,...e){super._prepareProgram(t,...e),this._context.bindTextureUnit(0),this._context.bindTexture(this._intermediateColorBuffer),t.setIntScalarUniform("texture",0),t.setVector2Uniform("pixelSize",this._pixelSize),t.setScalarUniform("dpr",nt())}_updateFrameUniformState(t){this._pixelSize.x=1/t.size.width,this._pixelSize.y=1/t.size.height}_initIntermediateRenderTargets({width:t,height:e}){const i=this._context,r=this._intermediateColorBuffer=i.createEmpty2DTexture(t,e,6408,5121),s=this._intermediateDepthStencilBuffer=i.createRenderbuffer(t,e,34041);this._intermediateRenderbuffer=i.createFramebuffer({color:r,depthStencil:s})}_destroyInternalRenderTargets(){this._intermediateRenderbuffer.destroy(),this._intermediateColorBuffer.destroy(),this._intermediateDepthStencilBuffer.destroy()}}class gs{constructor(t,e,i,r,s,n){this._camera=t,this._renderLoop=e,this._viewport=i,this._startFromZoom=s,this._duration=r,this._limitByZoom=n,this._isWorld3D=!1,this._lastAnimationTick=void 0,this._heightFactor=0,this.heightProvider=()=>this._heightFactor,this._viewport.onViewportStateChanged.addListener(this._onViewportUpdate,this),this._camera.onUpdate.addListener(this._onViewportUpdate,this),this._renderLoop.onBeforeRender.addListener(this._onBeforeRender,this),this._onViewportUpdate(this._viewport.viewportState)}destroy(){this._renderLoop.onBeforeRender.removeListener(this._onBeforeRender),this._viewport.onViewportStateChanged.removeListener(this._onViewportUpdate)}get _maxHeightFactor(){return X(1-(this._startFromZoom-this._camera.zoom)/this._limitByZoom,0,1)}_onViewportUpdate(t=this._viewport.viewportState){const e=t.visualizableTileNumber>0,i=this._camera.zoom>=this._startFromZoom;e&&i!==this._isWorld3D&&(this._lastAnimationTick=K(),this._isWorld3D=i,this._renderLoop.update())}_onBeforeRender(){if(void 0!==this._lastAnimationTick){const t=K(),e=(t-this._lastAnimationTick)/this._duration;this._heightFactor=X(this._heightFactor+(this._isWorld3D?e:-e),0,this._maxHeightFactor);const i=this._isWorld3D?this._heightFactor<1:this._heightFactor>0;this._lastAnimationTick=i?t:void 0,this._renderLoop.update()}}}var vs=i(4),ys=i.n(vs),xs=i(20),bs=i.n(xs);class ws extends Ar{constructor(t,e,i,r,s,n,o){super(t,e,i,r,s,n),this._colorTransformProvider=o}_renderBatch(t,e){const i=this._colorTransformProvider&&this._colorTransformProvider.get(t.firstPrimitive);i?(e.setIntScalarUniform("isColorTransformed",1),e.setMatrix4Uniform("colorTransform",i)):e.setIntScalarUniform("isColorTransformed",0),super._renderBatch(t,e)}_canBatchAdjacentPrimitives(t,e){const i=this._colorTransformProvider;return super._canBatchAdjacentPrimitives(t,e)&&(!i||i.get(t)===i.get(e))}}const As={hitTest:!1},Ts=Object.assign(Object.assign({},As),{maxZoomWithTilesLoading:1/0}),Ps=new Ze(Ye,{depthTest:!0,depthMask:!1,depthFunc:518}),Ss={attribMap:{vertexId:2,vertexPosHigh:0,vertexPosLow:1,vertexNormal:5,vertexDisplacement:6,vertexZIndex:10,vertexUv:4,vertexIconLocation:12,vertexScale:13,vertexZoomRelatedData:14}},Rs={attribMap:Ss.attribMap,defines:{YV_COLOR_ID:1}};class Ms extends ws{constructor(t,e,i,r,s){var n;const o=Dr(Ts,s),a=e.createProgram(ys.a,bs.a,Ss),l=o.hitTest?e.createProgram(ys.a,Ti.a,Rs):void 0;super(t,e,Ps,a,new Ze(Ge),l,null===(n=r)||void 0===n?void 0:n.colorTransform),this._camera=i,this._atlasSizeUniform=ot(0,0),this._maxZoomWithTilesLoading=o.maxZoomWithTilesLoading}_prepareProgram(t,e,i,...r){super._prepareProgram(t,e,i,...r),this._prepareProgramState(t)}_prepareHitTestProgram(t,e,i,...r){super._prepareHitTestProgram(t,e,i,...r),this._prepareProgramState(t)}_renderBatch(t,e){const i=t.firstPrimitive.texture;this._atlasSizeUniform.x=i.getWidth(),this._atlasSizeUniform.y=i.getHeight(),e.setVector2Uniform("atlasSize",this._atlasSizeUniform),this._context.bindTextureUnit(0),this._context.bindTexture(i,9729,9729),super._renderBatch(t,e)}_canBatchAdjacentPrimitives(t,e){return super._canBatchAdjacentPrimitives(t,e)&&t.texture===e.texture}_prepareProgramState(t){const e=this._camera.zoom,i=X((e-this._maxZoomWithTilesLoading)/2*.5+.5,.5,1);t.setScalarUniform("worldToPxFactor",this._camera.worldToPxFactor),t.setScalarUniform("zoom",e),t.setScalarUniform("zoomScaleFactor",i)}}var zs=i(5),Cs=i.n(zs),ks=i(3),Bs=i.n(ks);const Os=new Ze(Xe,{cullFace:!0,cullFaceMode:1028}),Is=new Ze;class Es extends ws{constructor(t,e,i,r,s,n){super(t,e,Os,r,Is,s,n.colorTransform),this._camera=i,this._visibilityProvider=n.visibility,this._metadataProvider=n.metadata,this._atlasSizeUniform=ot(0,0)}_render(t,e){this._program.setScalarUniform("isOutlinePhase",1),super._render(t,e),this._program.setScalarUniform("isOutlinePhase",0),super._render(t,e)}_prepareProgram(t,e,i){const r=this._visibilityProvider();super._prepareProgram(t,e,i),this._prepareProgramState(t,r)}_prepareHitTestProgram(t,e,i){const r=this._visibilityProvider();super._prepareHitTestProgram(t,e,i),this._prepareProgramState(t,r)}_renderBatch(t,e){const i=t.firstPrimitive.texture;this._atlasSizeUniform.x=i.getWidth(),this._atlasSizeUniform.y=i.getHeight(),e.setIntScalarUniform("atlas",1),e.setVector2Uniform("atlasSize",this._atlasSizeUniform),this._context.bindTextureUnit(1),this._context.bindTexture(i),super._renderBatch(t,e)}_getHitTestPrimitives(){const t=this._metadataProvider,e=super._getHitTestPrimitives();return t?N(e,({id:e})=>!!e&&!!t(e)):e}_canBatchAdjacentPrimitives(t,e){return super._canBatchAdjacentPrimitives(t,e)&&t.texture===e.texture}_prepareProgramState(t,e){this._context.bindTextureUnit(0),this._context.bindTexture(e),t.setVector2Uniform("idHalfPxSize",e.getHalfPxSize()),t.setVector2Uniform("pixelSize",this._camera.pixelSize),t.setScalarUniform("dpr",window.devicePixelRatio)}}const Ls={attribMap:{vertexId:2,vertexPosHigh:0,vertexPosLow:1,vertexDisplacement:6,vertexUV:4,vertexPriority:9,vertexColor:7,vertexOutlineColor:8,vertexScale:11}},Us={defines:{YV_COLOR_ID:1},attribMap:Ls.attribMap};class Ds extends Es{constructor(t,e,i,r,s){const n=Dr(As,s),o=e.createProgram(Cs.a,Bs.a,Ls),a=n.hitTest?e.createProgram(Cs.a,Ti.a,Us):void 0;super(t,e,i,o,a,r)}}var Fs=i(6),Vs=i.n(Fs),js=i(21),Ns=i.n(js),Hs=i(22),Ws=i.n(Hs),qs=i(23),Xs=i.n(qs);const Ys=new Ze(Ye),Gs=new Ze;class Zs extends ws{constructor(t,e,i=e.createProgram(Ws.a,Xs.a,{attribMap:{vertexPosHigh:0,vertexPosLow:1,vertexUV:4}}),r,s){super(t,e,Ys,i,Gs,r,s),this._atlasSizeUniform=ot(0,0)}_renderBatch(t,e){const i=t.firstPrimitive.texture;this._atlasSizeUniform.x=i.getWidth(),this._atlasSizeUniform.y=i.getHeight(),e.setVector2Uniform("atlasSize",this._atlasSizeUniform),this._prepareTexture(i),super._renderBatch(t,e)}_prepareTexture(t){this._context.bindTextureUnit(0),this._context.bindTexture(t)}_canBatchAdjacentPrimitives(t,e){return super._canBatchAdjacentPrimitives(t,e)&&t.texture===e.texture}}class Ks{constructor(t,e){this._primitivesProvider=t,this._orderingPredicate=e,this._orderedPrimitives=[],this._isDirty=!1,this._updatePrimitivesListener=()=>this._isDirty=!0,this._primitivesProvider.onUpdate.addListener(this._updatePrimitivesListener)}destroy(){this._orderedPrimitives=[],this._primitivesProvider.onUpdate.removeListener(this._updatePrimitivesListener)}get orderedPrimitives(){return this._isDirty&&this._updatePrimitivesStorage(),this._orderedPrimitives}_updatePrimitivesStorage(){const{primitives:t}=this._primitivesProvider,e=[...t];!function(t,e=z,i=0,r=t.length){if(r-i<=32)return void B(t,e,i,r);{let s=i,n=s+32;for(;n<r;)B(t,e,s,n),s=n,n+=32;B(t,e,s,r)}const s=new Array(r-i);for(let n=32;n<r-i;n+=n){k(t,s,i,r);let o=i,a=0,l=n,h=l+n;for(;h<r-i;)O(s,t,e,a,l,h,o),h=(l=(a=h)+n)+n,o+=2*n;O(s,t,e,a,Math.min(l,r-i),r-i,o)}}(e,this._orderingPredicate),this._orderedPrimitives=e,this._isDirty=!1}}const Qs=Object.assign(Object.assign({},As),{iconHitTestField:0,iconHitTestMinSize:0}),Js={attribMap:{vertexPosHigh:0,vertexPosLow:1,vertexDisplacement:6,vertexOffset:11,vertexUV:4,vertexId:2,vertexPriority:9}},$s={attribMap:Js.attribMap,defines:{YV_COLOR_ID:1}};class tn extends Zs{constructor(t,e,i,r,s){const n=Dr(Qs,s),o=e.createProgram(Vs.a,Ns.a,Js),a=n.hitTest?e.createProgram(Vs.a,Ti.a,$s):void 0;super(t,e,o,a,r.colorTransform),this._camera=i,this._linearFilterFrames=0,this._cameraUpdateListener=()=>{this._linearFilterFrames=3},this._camera.onUpdate.addListener(this._cameraUpdateListener),this._orderedPrimitiveStorage=new Ks(t,(t,e)=>t.zIndex-e.zIndex),this._visibilityProvider=r.visibility,this._extensionAndMinSize={x:n.iconHitTestField,y:n.iconHitTestMinSize}}destroy(){this._camera.onUpdate.removeListener(this._cameraUpdateListener),this._orderedPrimitiveStorage.destroy(),super.destroy()}_render(t,e){super._render(t,e),this._linearFilterFrames>0&&(this._linearFilterFrames--,this._requestRerender())}_prepareProgram(t,e,i){const r=this._visibilityProvider();super._prepareProgram(t,e,i),this._prepareProgramState(t,r),t.setVector2Uniform("extensionAndMinSize",at)}_prepareHitTestProgram(t,e,i){const r=this._visibilityProvider();super._prepareHitTestProgram(t,e,i),this._prepareProgramState(t,r),t.setVector2Uniform("extensionAndMinSize",this._extensionAndMinSize)}_prepareTexture(t){this._context.bindTextureUnit(0);const e=this._linearFilterFrames>0?9729:void 0;this._context.bindTexture(t,e,e)}_getPrimitives(){return this._orderedPrimitiveStorage.orderedPrimitives}_requestRerender(){this._onUpdate.fire()}_prepareProgramState(t,e){this._context.bindTextureUnit(1),this._context.bindTexture(e),t.setIntScalarUniform("visibility",1),t.setVector2Uniform("idHalfPxSize",e.getHalfPxSize()),t.setVector2Uniform("pixelSize",this._camera.pixelSize)}}var en=i(7),rn=i.n(en),sn=i(24),nn=i.n(sn);const on={depthTest:!0,depthFunc:518},an={vertexPosHigh:0,vertexPosLow:1,vertexColor:7,vertexZIndex:10,vertexId:2},ln={attribMap:an},hn={attribMap:an,defines:{YV_COLOR_ID:1}},cn=Object.assign(Object.assign({},As),{renderState:new Ze(on)});class dn extends ws{constructor(t,e,i,r){var s;const n=Dr(cn,r),o=e.createProgram(rn.a,nn.a,ln),a=n.hitTest?e.createProgram(rn.a,Ti.a,hn):void 0;super(t,e,n.renderState,o,new Ze(Ge),a,null===(s=i)||void 0===s?void 0:s.colorTransform)}}const un=new Ze(on,{depthMask:!1},Xe);class fn extends dn{constructor(t,e,i,r){super(t,e,i,Object.assign(Object.assign({},r),{renderState:un}))}}var _n=i(8),pn=i.n(_n),mn=i(25),gn=i.n(mn),vn=i(26),yn=i.n(vn),xn=i(27),bn=i.n(xn);const wn=new Ze(Xe),An={attribMap:{vertexPosition:0,vertexUV:4}};class Tn extends oi{constructor(t){super(t,wn,t.createProgram(yn.a,bn.a,An))}_render(t){this._context.bindTextureUnit(0),this._context.bindTexture(t),this._context.bindQuadVao(),this._context.drawQuad()}}const Pn=new Ze({depthTest:!0}),Sn={attribMap:{vertexPosHigh:0,vertexPosLow:1,vertexHeight:3,vertexColor:7,vertexId:2}},Rn={attribMap:Sn.attribMap,defines:{YV_COLOR_ID:1}},Mn=()=>1;class zn extends ws{constructor(t,e,i,r){var s,n;const o=Dr(As,r),a=e.createProgram(pn.a,gn.a,Sn),l=o.hitTest?e.createProgram(pn.a,Ti.a,Rn):void 0;super(t,e,Pn,a,Pn,l,null===(s=i)||void 0===s?void 0:s.colorTransform),this._heightFactorProvider=(null===(n=i)||void 0===n?void 0:n.heightFactor)||Mn,this._outputSize=_t(-1,-1),this._overlayRenderer=new Tn(e)}render(t,e,i){this._syncOutputBuffer(t),super.render(this._outputBuffer,e,i),this._outputBuffer.isClear||this._overlayRenderer.render(t,this._outputTexture)}destroy(){this._overlayRenderer.destroy(),this._outputTexture&&this._outputTexture.destroy(),this._outputDepthBuffer&&this._outputDepthBuffer.destroy(),this._outputBuffer&&this._outputBuffer.destroy(),super.destroy()}_prepareProgram(t,e,i,...r){super._prepareProgram(t,e,i,...r),t.setScalarUniform("zFactor",this._heightFactorProvider())}_prepareHitTestProgram(t,e,i,...r){this._prepareProgram(t,e,i,...r)}_syncOutputBuffer(t){if(!mt(this._outputSize,t.size)){(this._outputTexture||this._outputDepthBuffer||this._outputBuffer)&&(this._outputTexture.destroy(),this._outputDepthBuffer.destroy(),this._outputBuffer.destroy());const{width:e,height:i}=pt(t.size,this._outputSize);this._outputTexture=this._context.createEmpty2DTexture(e,i,6408,5121),this._outputDepthBuffer=this._context.createRenderbuffer(e,i,34041),this._outputBuffer=this._context.createFramebuffer({color:this._outputTexture,depthStencil:this._outputDepthBuffer})}}_prepareRenderTarget(t,e,i){super._prepareRenderTarget(t,e,i),this._context.clearCurrentTarget(16640)}_prepareHitTestTarget(t,e,i){super._prepareHitTestTarget(t,e,i),this._context.clearCurrentTarget(256)}}var Cn=i(9),kn=i.n(Cn);const Bn={attribMap:{vertexId:2,vertexPosHigh:0,vertexPosLow:1,vertexDisplacements:6,vertexUV:4,vertexColor:7,vertexOutlineColor:8,vertexPriority:9,leftPolylineRatios:12,leftPolylineAngles:13,rightPolylineRatios:14,rightPolylineAngles:15,polylineLength_vertexScale:11}},On={defines:{YV_COLOR_ID:1},attribMap:Bn.attribMap};class In extends Es{constructor(t,e,i,r,s){const n=Dr(As,s),o=e.createProgram(kn.a,Bs.a,Bn),a=n.hitTest?e.createProgram(kn.a,Ti.a,On):void 0;super(t,e,i,o,a,r)}}const En={vertexPosHigh:0,vertexPosLow:1,vertexDisplacement:6};class Ln extends Ar{constructor(t,e,i,r=new Ze){super(t,e,r,e.createProgram(yr.a,Ti.a,{attribMap:En})),this._camera=i}_prepareProgram(t,e,i){super._prepareProgram(t,e,i),t.setVector2Uniform("pixelSize",this._camera.pixelSize)}}var Un=i(28),Dn=i.n(Un);class Fn extends Tr{constructor(t,e,i,r){super(t,e,i),this._camera=r}_prepareProgram(t,e,i,r,s,n,o,a,l,h,c){super._prepareProgram(t,e,i,r,s,n,o,a,l,h,c),t.setVector2Uniform("pixelSize",this._camera.pixelSize)}}class Vn extends Fn{constructor(t,e,i){super(t,e,e.createProgram(Dn.a,Ti.a,Ls),i)}}const jn=new Map;class Nn extends kr{_render(){const t=this._primitiveProvider.primitives;for(const e of wr(t)){const t=e.page.vao.attributeMapping.vertexByteSize,i=Hn(t)*t,r=e.page.vao;jn.get(r)||(jn.set(r,this._context.createVao(e.page.vao.attributeMapping,e.page.vao.vertexBuffer,null,i)),r.onDestroy.addListener(()=>{jn.get(r).destroy(),jn.delete(r)})),this._context.bindVao(jn.get(r)),this._context.drawMesh(e.vertexByteOffset/i,e.vertexByteLength/i,0)}}}function Hn(t){const e=Math.floor(255/t);return Math.min(e,4)}var Wn=i(29),qn=i.n(Wn);class Xn extends Fn{constructor(t,e,i){super(t,e,e.createProgram(qn.a,Ti.a,Bn),i)}}var Yn=i(30),Gn=i.n(Yn);class Zn extends Tr{constructor(t,e,i){super(t,e,e.createProgram(Gn.a,Ti.a,Js)),this._camera=i}_prepareProgram(t,e,i,r,s,n,o,a,l,h,c){super._prepareProgram(t,e,i,r,s,n,o,a,l,h,c),t.setVector2Uniform("pixelSize",this._camera.pixelSize)}}function Kn(t,e,i){return new Fe(je.a,t,e,i)}e.default=r}]).default)},468:function(t,e,i){"use strict";i.r(e);var r,s=i(8),n=i(11),o=i(76),a=i(25),l=i(94),h=i(10),c=i(114),d=i(115),u=i(12),f=i(103),_=i(77),p=i(197);var m=function(){function t(t){void 0===t&&(t={}),this._additionalData=t}return t.prototype.submit=function(t,e){var i,n="/dtype=stred/pid=443/cid=73323/path="+t+"/"+(i=Object(s.a)(Object(s.a)({},e),this._additionalData),Object.keys(i).map(function(t){return t+"="+i[t]}).join("/"))+"/*",o=function(){if(r)return r;switch(location.hostname.split(".").pop()){case"tr":return r="https://yandex.com.tr/clck/counter";case"com":case"fr":return r="https://yandex.com/clck/counter";case"eu":return r="https://yandex.eu/clck/counter";default:return r="https://yandex.ru/clck/counter"}}();window.navigator.sendBeacon?navigator.sendBeacon(o,n):document.createElement("img").src=""+o+n},t}(),g=i(78),v=(i(35),i(81)),y=i(21),x=i(14);i.d(e,"VectorMapEngine",function(){return R});var b={},w={r:.98,g:.97,b:.94,a:1},A={r:.12,g:.14,b:.18,a:1},T=function(){function t(t,e){var i=this;this._destroyed=!1,this.onBeforeRender=new t.EventTrigger,this.onRender=new t.EventTrigger,this._renderLoop=e,this._renderLoopSubscription=this._renderLoop.on("beforeRender",function(){return i.onBeforeRender.fire()}).on("render",function(){return i.onRender.fire()})}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._renderLoop.isActive},enumerable:!1,configurable:!0}),t.prototype.update=function(){this._destroyed||this._renderLoop.update()},t.prototype.destroy=function(){this._destroyed=!0,this._renderLoopSubscription.offAll()},t}(),P=function(){function t(t,e){this.source=t,this._plan=e}return t.prototype.getId=function(){return this._plan.id},t.prototype.getBounds=function(){var t=this._plan.bbox;return[[t.lowerCorner.lon,t.lowerCorner.lat],[t.upperCorner.lon,t.upperCorner.lat]]},t.prototype.isVisible=function(){return this._plan.isVisible},t.prototype.setVisible=function(t){this._plan.isVisible=t},t.prototype.getLevels=function(){return this._plan.levels},t.prototype.getDefaultLevel=function(){return this._plan.defaultLevel},t.prototype.getActiveLevel=function(){return this._plan.activeLevel},t.prototype.setActiveLevel=function(t){this._plan.setActiveLevel(t)},t.prototype.getOpacity=function(){return this._plan.opacity},t.prototype.setOpacity=function(t){this._plan.opacity=t},t}(),S=function(t){var e=Math.floor(t);return t-e<.5?e:e+1},R=function(t){function e(e,i,r,o,a,l,h,c){var d=t.call(this)||this;return d._processingQueue=new _.a(20),d._contentProvidersBySource=new n.Map,d._layersById=new n.Map,d._layerDescriptions=[],d._tileDataSources={},d._filters=new n.Map,d._finalizeSetLayers=function(t,e,i){d._layersById.forEach(function(t){for(var e=0,i=t.renderUnits;e<i.length;e++){var r=i[e];d._engine.renderer.removeRenderUnit(r)}}),d._contentProvidersBySource=i,d._layerDescriptions=t,d._layersById=e,d._layersById.forEach(function(t){for(var e=0,i=t.renderUnits;e<i.length;e++){var r=i[e];d._engine.renderer.addRenderUnit(r)}}),d._asyncSetLayersAbortController=void 0,d._emit("indoorPlansChanged")},d._createContentProvider=function(t){var e,i,r=t.tileSource,s=t.sourceName,n=r.vectorSourceDescription,o={iconUrlTemplate:n.imageUrl,glyphRangeUrlTemplate:n.glyphRangeUrl,tileUrlTemplate:n.tileUrl,meshUrlTemplate:n.meshUrl,tileSize:{X1:0,X4:1,X16:2}[n.requestTileSize||"X1"],preloadedTilesBeltWidth:n.tileBeltSize||0,useLowPrecisionBeltTiles:n.lowPrecisionBeltTiles,tileCacheSize:n.tileCacheSize||100,indoorPlanUrlTemplate:n.indoorPlanUrl,basePriority:{low:100,medium:200,high:300}[n.priority],objectsCollisionPriority:{low:0,medium:1,high:2,ultra:3}[null!==(e=n.collisionPriority)&&void 0!==e?e:"medium"],customizationConfig:null!==(i=n.customization)&&void 0!==i?i:[],tileRequestWithCredentials:n.tileRequestWithCredentials,iconRequestWithCredentials:n.imageRequestWithCredentials,glyphRequestWithCredentials:n.glyphRequestWithCredentials,meshRequestWithCredentials:n.meshRequestWithCredentials,mapMode:"night"===n.mapMode?1:0,allObjectsInteractive:n.allObjectsInteractive},a=d._contentProdiver.initContentProvider(s,o);if(a instanceof d.vector.IndoorContentProvider)a.onPlansChanged.addListener(d._onPlansChanged),d._colorTransformers.indoorOpacity=a.colorTransformProvider;else{var l=d._contentProdiver.getCoveredByIndoorFilterFor(a);l&&d._toggleVisibilityFilter(a,l,!0,[6,4,2])}var h=r.group().on("changed",function(){var t;d._currentCustomization!==r.vectorSourceDescription.customization&&(d._currentCustomization=r.vectorSourceDescription.customization,a.updateCustomizationConfig(null!==(t=d._currentCustomization)&&void 0!==t?t:[])),d._currentTileUrl!==r.vectorSourceDescription.tileUrl&&(d._currentTileUrl=r.vectorSourceDescription.tileUrl,a.updateTileUrlTemplate(d._currentTileUrl)),d._applyMapMode(a)});return a.visibilityManager.onViewportStateChanged.addListener(d._onViewportStateChanged),d._filters.forEach(function(t){d._toggleVisibilityFilter(a,t,!0)}),{contentProvider:a,tileSource:r,tileSourceSubscription:h}},d._destroyContentProvider=function(t){t.contentProvider.visibilityManager.onViewportStateChanged.removeListener(d._onViewportStateChanged),t.tileSourceSubscription.offAll(),d._contentProdiver.destroyContentProvider(t.contentProvider)},d._onPlansChanged=function(){return d._emit("indoorPlansChanged")},d._onViewportStateChanged=function(){d._emit("stateChanged"),d._areTilesReady()&&(d._emit("tilesLoaded"),d._emit("tilesReady"))},d._createLayerImplementation=function(t,e,i){var r,n=b[t.type];n||Object(x.c)(new Error("Unknown type for vector layer: "+t.type));var o=Object(s.a)(Object(s.a)({},n(d.vector,d._engine,e,t.options.vector)),{tileSource:d._tileDataSources[t.source],tileSourceSubscription:d._tileDataSources[t.source].group()});o.colorTransformer.provider=i||d._colorTransformers.general,d._setupHotspotLayer(o,t),o.tileSourceSubscription.on("changed",function(){d._teardownHotspotLayer(o),d._setupHotspotLayer(o,t)});for(var a=0,l=o.collidingPrimitives;a<l.length;a++){var h=l[a];(r=d._engine.visibilityManager).registerCollidingPrimitives.apply(r,h)}return o},d._destroyLayerImplementation=function(t){var e;t.tileSourceSubscription.offAll(),d._teardownHotspotLayer(t);for(var i=t.collidingPrimitives.length-1;i>=0;i--)(e=d._engine.visibilityManager).deregisterCollidingPrimitives.apply(e,t.collidingPrimitives[i]);for(i=t.renderUnits.length-1;i>=0;i--){var r=t.renderUnits[i];d._engine.renderer.removeRenderUnit(r),r.destroy&&r.destroy()}for(var s=0,n=t.destroyables;s<n.length;s++){n[s].destroy()}},d.renderLoop=h,d.vector=e,d.worldOptions=c,d._metricsTransport=new m(i),d._applyDataSources(l),d.element=r.canvas,d.element.style.width="100%",d.element.style.height="100%",d._context=new d.vector.Context(r),d._vectorRenderLoop=new T(d.vector,h),d._size=o,d._renderLoopSubscription=h.on("render",function(t){d._layersById.forEach(function(e){var i=e.hotspotLayer;return i&&i.render(t)})}).on("beforeRender",function(){(!d._renderedSize&&Boolean(d._size)||!u.areEqual(d._size,d._renderedSize))&&d._doResize()}),d._engine=new d.vector.Engine(d._context,new d.vector.Camera({wrapModeX:2,wrapModeY:0,minTilt:v.d,maxTilt:v.c}),d._vectorRenderLoop),d._backgroundRenderUnit=new d.vector.BackgroundRenderUnit(d._context),d._engine.renderer.addRenderUnit(d._backgroundRenderUnit),d._applyBackgroundColor(l),d._engine.onInternalError.addListener(function(){return d._emit("internalError")}),d._updateRenderLoop=d.renderLoop.update.bind(d.renderLoop),d._contentProdiver=d.vector.createContentProvider(d._engine.camera,d._engine.context,d._metricsTransport),d._colorTransformers={general:{get:function(t){var e,i;return(null===(e=d._colorTransformers.hoverHighlight)||void 0===e?void 0:e.get(t))||(null===(i=d._colorTransformers.indoorOpacity)||void 0===i?void 0:i.get(t))}}},d.update(a),d}return Object(s.b)(e,t),e.prototype.getLayerReadyState=function(t){var e,i=null===(e=this._layersById.get(t))||void 0===e?void 0:e.contentProvider;if(i){var r=i.visibilityManager.viewportState.visibleTileNumber,s=i.visibilityManager.viewportState.visualizableTileNumber;return{tilesReady:s,tilesLoaded:s,tilesTotal:r}}},e.prototype.destroy=function(){this.setLayers([]),this._backgroundRenderUnit.destroy(),this._renderLoopSubscription.offAll(),this._engine.destroy(),this._context.destroy(),this._vectorRenderLoop.destroy(),this._asyncSetLayersAbortController&&(this._asyncSetLayersAbortController.abort(),this._asyncSetLayersAbortController=void 0)},e.prototype.setDataSources=function(t){this._applyDataSources(t),this._applyBackgroundColor(t),this.setLayers(this._layerDescriptions)},e.prototype.update=function(t){var e=this;this._camera=t,this._engine.camera.zoom=t.zoom,this._engine.camera.center.x=t.worldCenter.x,this._engine.camera.center.y=t.worldCenter.y,this._engine.camera.azimuth=t.azimuth,this._engine.camera.tilt=t.tilt,this._layersById.forEach(function(i){var r=i.hotspotLayer;return r&&r.update(t,e.fov)})},e.prototype.resize=function(t){this._size=t},e.prototype.setLayers=function(t){var e=this;this._abortAndCleanupAsyncLayersInitIfInProgress();for(var i=new n.Map,r=new n.Map,s=0,o=t;s<o.length;s++){var a=o[s],l=this._tileDataSources[a.source];l.vectorSourceDescription||Object(x.c)(new Error(a.id+" does not have vector source")),i.set(a.id,a),r.set(a.source,{tileSource:l,sourceName:a.source})}var h=Object(d.a)(this._contentProvidersBySource,r,this._createContentProvider,this._destroyContentProvider,function(){},function(){return!0}).result,c=this._getColorTransformersByLayers(t),u=Object(d.a)(this._layersById,i,function(t){var i=h.get(t.source).contentProvider;return e._createLayerImplementation(t,i,c[t.id])},this._destroyLayerImplementation,function(t,i){t.colorTransformer.provider=c[i.id]||e._colorTransformers.general},function(t,i){return t.tileSource===e._tileDataSources[i.source]});this._finalizeSetLayers(t,u.result,h)},e.prototype.initLayersAsync=function(t,e){var i,r=this;if(e.aborted)return Promise.reject(new g.a);this._asyncSetLayersAbortController=new o.AbortController;var s=this._asyncSetLayersAbortController.signal,l=function(){e.removeEventListener("abort",l),r._abortAndCleanupAsyncLayersInitIfInProgress()};e.addEventListener("abort",l);for(var h=this._getColorTransformersByLayers(t),c=new n.Map,d=new n.Map,u=[],f=function(t){var e=_._tileDataSources[t.source];e.vectorSourceDescription||Object(x.c)(new Error(t.id+" does not have vector source."));var n=null!==(i=c.get(t.source))&&void 0!==i?i:_._createContentProvider({tileSource:e,sourceName:t.source});c.set(t.source,n);u.push(new Promise(function(t){return setTimeout(t)}).then(function(){if(!s.aborted){var e=r._createLayerImplementation(t,n.contentProvider,h[t.id]);d.set(t.id,e)}}))},_=this,p=0,m=t;p<m.length;p++){f(m[p])}return Object(a.promiseFinally)(new Promise(function(t,e){s.addEventListener("abort",function(){c.forEach(r._destroyContentProvider),t()}),Promise.all(u).then(function(){return t()}).catch(function(t){Object(x.b)(t),e(t)})}).then(function(){s.aborted||r._finalizeSetLayers(t,d,c)}),function(){e.removeEventListener("abort",l),r._asyncSetLayersAbortController&&(r._asyncSetLayersAbortController=void 0)})},e.prototype.preloadHotspotsInPoint=function(t){this._layersById.forEach(function(e){e.hotspotLayer&&e.hotspotLayer.preloadHotspotsInPoint(t)})},e.prototype.preloadHotspotsForViewport=function(){this._layersById.forEach(function(t){t.hotspotLayer&&t.hotspotLayer.preloadHotspotsForViewport()})},e.prototype.setObjectFilters=function(t){for(var e=this,i=Object(d.a)(this._filters,t,function(t){var i=new e.vector.EventTrigger,r=t.on("update",function(){return i.fire()});return{filter:t,onUpdate:i,subscription:r,test:function(i){return t.test(i,i.id?e._contentProdiver.getObjectMetadata(i.id):void 0)}}},function(t){t.subscription.offAll()}),r=function(t){s._contentProvidersBySource.forEach(function(i){var r=i.contentProvider;e._toggleVisibilityFilter(r,t,!1)})},s=this,n=0,o=i.removed;n<o.length;n++){r(o[n])}for(var a=function(t){l._contentProvidersBySource.forEach(function(i){var r=i.contentProvider;e._toggleVisibilityFilter(r,t,!0)})},l=this,h=0,c=i.created;h<c.length;h++){a(c[h])}this._filters=i.result},e.prototype.setInvisibleCollidingPrimitives=function(t){var e=this._engine.invisibleCollidingPrimitiveManager,i=[];t.forEach(function(t){return i.push(t)}),e.clear(),e.addPrimitives.apply(e,i)},e.prototype.getIndoorPlans=function(){var t=this,e=[];if(this._contentProvidersBySource.forEach(function(i,r){var s=i.contentProvider;s instanceof t.vector.IndoorContentProvider&&e.push([s,r])}),0===e.length)return null;for(var i=[],r=0,s=e;r<s.length;r++)for(var n=s[r],o=n[0],a=n[1],l=0,h=o.plans;l<h.length;l++){var c=h[l];i.push(new P(a,c))}return i},e.prototype.getVisibleObjects=function(t){var e=this._contentProvidersBySource.get(t);if(!e)return null;for(var i=[],r=e.contentProvider.scene[6].visiblePrimitives[n.Symbol.iterator](),s=r.next();!s.done;s=r.next()){var o=s.value.id&&e.contentProvider.getObjectMetadata(s.value.id);o&&i.push(o)}return i},e.prototype._abortAndCleanupAsyncLayersInitIfInProgress=function(){this._asyncSetLayersAbortController&&(this._asyncSetLayersAbortController.abort(),this._asyncSetLayersAbortController=void 0)},e.prototype._applyDataSources=function(t){this._tileDataSources={};for(var e=0,i=Object.keys(t);e<i.length;e++){var r=i[e],s=t[r];s instanceof f.a&&s.vectorSourceDescription&&(this._tileDataSources[r]=s)}},e.prototype._isNightMapMode=function(t){var e=Object(n.arrayFind)(Object.keys(t),function(e){var i,r=t[e];return r instanceof f.a&&"night"===(null===(i=r.vectorSourceDescription)||void 0===i?void 0:i.mapMode)});return Boolean(e)},e.prototype._applyMapMode=function(t){this._applyBackgroundColor(this._tileDataSources);var e=this._isNightMapMode(this._tileDataSources)?1:0;t.setMapMode(e)},e.prototype._applyBackgroundColor=function(t){this._backgroundRenderUnit.setColor(this._isNightMapMode(t)?A:w)},e.prototype._doResize=function(){var t=this,e=Math.max(this._size.x,1),i=Math.max(this._size.y,1),r=Object(c.a)();this._engine.camera.screenSize.width=e,this._engine.camera.screenSize.height=i,this._engine.setRenderTargetSize({width:e*r,height:i*r}),this._layersById.forEach(function(e){var i=e.hotspotLayer;return i&&i.resize(t._size)}),this._renderedSize=this._size},e.prototype._getColorTransformersByLayers=function(t){var e=this;return t.reduce(function(t,i){var r=i.options.vector.transformLayers||{};return Object.keys(r).forEach(function(i){var s=e.vector.createColorTransform(r[i]);t[i]={get:function(){return s}}}),t},{})},e.prototype._setupHotspotLayer=function(t,e){var i=this._tileDataSources[e.source],r=(i.vectorSourceDescription.hotspots||{})[e.type];if("function"==typeof r){var s=new p.a(this._size,this._camera,{fetchHotspots:r,hotspotAbortRadius:i.hotspotAbortRadius,tileSize:i.tileSize,zoomRange:i.zoomRange,inset:l.b,padding:0,internalFindHotspotInPosition:void 0},this._processingQueue,this.worldOptions,S);s.on("requestRender",this._updateRenderLoop),t.hotspotLayer=s}},e.prototype._teardownHotspotLayer=function(t){t.hotspotLayer&&(t.hotspotLayer.offSingle("requestRender",this._updateRenderLoop),t.hotspotLayer.destroy())},e.prototype._areTilesReady=function(){var t=!0;return this._contentProvidersBySource.forEach(function(e){var i=e.contentProvider.visibilityManager.viewportState;t=t&&i.visibleTileNumber===i.visualizableTileNumber}),t},e.prototype.findObjectInPosition=function(t){var e=Object(y.d)(t,Object(s.a)(Object(s.a)({},this._camera),{fov:this.fov,size:{x:this._engine.camera.screenSize.width,y:this._engine.camera.screenSize.height}})),i=this._engine.getObjectIdAt(u.muln(e,Object(c.a)())),r=this._contentProdiver.getObjectMetadata(i);if(!r)return this._findRasterHotspotObjectAbove(t,void 0);var n=r.get("uri"),o=r.get("position"),a=r.get("objectId"),l=o?o.split(",").map(Number):void 0,h=(r.get("tags")||r.get("eventTags")||r.get("group")||"").split(",").filter(Boolean),d=r.get(this.vector.VECTOR_METADATA_PREFIX+"layerName"),f=this._findLayerForMetadata(h,d),_=this._findRasterHotspotObjectAbove(t,f);if(_)return _;if(!f)return null;var p=this._tileDataSources[d].vectorSourceDescription.hotspots;return p&&!this._areHotspotsEnabled(p[f.type])?null:{type:"hotspot",layer:f.id,source:d,feature:{type:"Feature",id:a||n||o||"",geometry:l&&{type:"Point",coordinates:{x:l[0],y:l[1]}},properties:{uri:n,tags:h,name:r.get("name"),selectedIconUrl:r.get(this.vector.VECTOR_METADATA_PREFIX+"selectedIconUrl"),vectorMetadata:r,vectorId:i}}}},e.prototype.findObjectInPositionEx=function(t){var e,i=this.findObjectInPosition(t),r=this._layerDescriptions.slice().reverse(),s=Object(n.arrayFindIndex)(r,function(t){return t.id===(null==i?void 0:i.layer)});s>=0&&(r=r.slice(0,s));var o={layers:[]};return(e=o.layers).push.apply(e,r.map(function(t){return{layer:t.id,object:null}})),i&&o.layers.push({layer:i.layer,object:i}),o},e.prototype.setObjectHighlight=function(t){var e,i,r=null==t?void 0:t.object.properties.vectorMetadata,s=null==r?void 0:r.get("objectId");if(t&&r&&s){var n=r.get(this.vector.VECTOR_METADATA_PREFIX+"layerName"),o=null!==(i=null===(e=this._contentProvidersBySource.get(n))||void 0===e?void 0:e.contentProvider)&&void 0!==i?i:this._contentProdiver,a=this.vector.createColorTransform(t.color);this._colorTransformers.hoverHighlight={get:function(t){var e=t.id&&o.getObjectMetadata(t.id);return e&&e.get("objectId")===s?a:void 0}}}else this._colorTransformers.hoverHighlight=void 0;this._vectorRenderLoop.update()},e.prototype._findRasterHotspotObjectAbove=function(t,e){for(var i=0,r=this._layerDescriptions.slice().reverse();i<r.length;i++){var n=r[i],o=this._layersById.get(n.id);if(o.hotspotLayer){var a=o.hotspotLayer.findObjectInPosition(t);if(a)return Object(s.a)(Object(s.a)({},a),{layer:n.id,source:n.source})}if(n===e)return null}return null},e.prototype._findLayerForMetadata=function(t,e){for(var i=-1!==t.indexOf("building"),r=0,s=this._layerDescriptions;r<s.length;r++){var o=s[r];if(o.source===e&&(i&&"buildings"===o.type||"icons"===o.type))return o}return Object(n.arrayFind)(this._layerDescriptions,function(t){return t.source===e})},e.prototype._areHotspotsEnabled=function(t){return"object"==typeof t?void 0===t.minZoom||this._engine.camera.zoom>=t.minZoom:void 0===t||!0===t},e.prototype._toggleVisibilityFilter=function(t,e,i,r){void 0===r&&(r=[6,4]);for(var s=i?"addVisibilityFilter":"removeVisibilityFilter",n=0,o=r;n<o.length;n++){var a=o[n];t[s](a,e)}},Object.defineProperty(e.prototype,"fov",{get:function(){return this._engine.camera.fov},enumerable:!1,configurable:!0}),e}(Object(h.a)().with());b.ground=function(t,e,i){var r=e.context,s=e.camera,n=i.scene,o={get:function(t){var e;return null===(e=this.provider)||void 0===e?void 0:e.get(t)}};return{contentProvider:i,colorTransformer:o,renderUnits:[new t.LayerRenderUnit(r,1),i instanceof t.IndoorContentProvider?new t.TransparentPolygonRenderUnit(n[0],r,{colorTransform:o},{hitTest:!0}):new t.PolygonRenderUnit(n[0],r,{colorTransform:o},{hitTest:!0}),new t.TransparentPolygonRenderUnit(n[1],r,{colorTransform:o},{hitTest:!0}),new t.PolylineRenderUnit(n[3],r,s,{colorTransform:o},{hitTest:!0})],collidingPrimitives:[],destroyables:[]}},b.buildings=function(t,e,i,r){var s;(null==r?void 0:r.modelsAppearingAnimation)&&(s=new t.ModelsAnimationManager(e.camera,e.renderLoop,i.visibilityManager,r.modelsAppearingAnimation.duration,r.modelsAppearingAnimation.transitionZoom,r.modelsAppearingAnimation.limitByZoom));var n={get:function(t){var e;return null===(e=this.provider)||void 0===e?void 0:e.get(t)}},o=new t.ModelRenderUnit(i.scene[2],e.context,{heightFactor:null==s?void 0:s.heightProvider,colorTransform:n},{hitTest:!0}),a=new t.FxaaRenderUnit(e.context,e.renderLoop);a.addRenderUnit(o);var l=[o];return s&&l.push(s),{contentProvider:i,destroyables:l,colorTransformer:n,renderUnits:[a],collidingPrimitives:[]}},b.icons=function(t,e,i,r){var s,n,o={get:function(t){var e;return null===(e=this.provider)||void 0===e?void 0:e.get(t)}},a=new t.IconRenderUnit(i.scene[6],e.context,e.camera,{visibility:e.visibilityTextureProvider,colorTransform:o},{hitTest:!0,iconHitTestField:null===(s=null==r?void 0:r.iconsInteractiveArea)||void 0===s?void 0:s.field,iconHitTestMinSize:null===(n=null==r?void 0:r.iconsInteractiveArea)||void 0===n?void 0:n.minSize}),l=new t.ColorIdIconRenderer(i.scene[6],e.context,e.camera),h=new t.CollidingPrimitivesResetRemovedRenderer(i.scene[6],e.context);return{contentProvider:i,colorTransformer:o,renderUnits:[a],collidingPrimitives:[[i.scene[6],l,h]],destroyables:[l,h]}},b.labels=function(t,e,i){var r=e.context,s=e.camera,n=i.scene,o={get:function(t){var e;return null===(e=this.provider)||void 0===e?void 0:e.get(t)}},a=new t.PointLabelRenderUnit(n[4],r,s,{visibility:e.visibilityTextureProvider,colorTransform:o,metadata:function(t){return i.getObjectMetadata(t)}},{hitTest:!0}),l=new t.CurvedLabelRenderUnit(n[5],r,s,{visibility:e.visibilityTextureProvider}),h=new t.ColorIdCurvedLabelRenderer(n[5],e.context,e.camera),c=new t.LabelResetRemovedRenderer(n[5],e.context),d=new t.ColorIdPointLabelRenderer(n[4],e.context,e.camera),u=new t.LabelResetRemovedRenderer(n[4],e.context);return{contentProvider:i,colorTransformer:o,renderUnits:[l,a],collidingPrimitives:[[n[5],h,c],[n[4],d,u]],destroyables:[h,d,c,u]}}},49:function(t,e,i){"use strict";i.d(e,"a",function(){return r}),i.d(e,"b",function(){return s});var r=Math.PI/180,s=180/Math.PI},64:function(t,e,i){"use strict";function r(t,e,i){return{x:t,y:e,z:i}}i.d(e,"e",function(){return r}),i.d(e,"a",function(){return s}),i.d(e,"d",function(){return n}),i.d(e,"c",function(){return o}),i.d(e,"m",function(){return a}),i.d(e,"i",function(){return l}),i.d(e,"j",function(){return h}),i.d(e,"g",function(){return c}),i.d(e,"f",function(){return d}),i.d(e,"k",function(){return u}),i.d(e,"l",function(){return f}),i.d(e,"b",function(){return _}),i.d(e,"h",function(){return p});var s=r(0,0,0);function n(t,e){return void 0===e&&(e=r(0,0,0)),e.x=t.x,e.y=t.y,e.z=t.z,e}function o(t,e,i){return void 0===i&&(i=r(0,0,0)),i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i}function a(t,e,i){return void 0===i&&(i=r(0,0,0)),i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i}function l(t,e,i){return void 0===i&&(i=r(0,0,0)),i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z,i}function h(t,e){return void 0===e&&(e=r(0,0,0)),function(t,e,i){return void 0===i&&(i=r(0,0,0)),i.x=t.x/e,i.y=t.y/e,i.z=t.z/e,i}(t,function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))}(t),e)}function c(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function d(t,e,i){void 0===i&&(i=r(0,0,0));var s=t.y*e.z-t.z*e.y,n=t.z*e.x-t.x*e.z,o=t.x*e.y-t.y*e.x;return i.x=s,i.y=n,i.z=o,i}function u(t,e,i){void 0===i&&(i=r(0,0,0));var s=Math.cos(e),n=Math.sin(e),o=t.y;return i.x=t.x,i.y=o*s-t.z*n,i.z=o*n+t.z*s,i}function f(t,e,i){void 0===i&&(i=r(0,0,0));var s=Math.cos(e),o=Math.sin(e);return t=t===i?n(t):t,i.x=t.x*s-t.y*o,i.y=t.x*o+t.y*s,i.z=t.z,i}var _={normal:r(0,0,1),distance:0};function p(t,e,i){void 0===i&&(i=r(0,0,0));var s=c(e.direction,t.normal);if(0===s)return null;var a=(t.distance-c(t.normal,e.origin))/s;return a<0?null:(n(e.direction,i),function(t,e,i){void 0===i&&(i=r(0,0,0)),i.x=t.x*e,i.y=t.y*e,i.z=t.z*e}(i,a,i),o(i,e.origin,i),i)}},76:function(t,e,i){"use strict";i.r(e),i.d(e,"AbortController",function(){return r});var r,s=i(8),n=i(10),o=window;if(o.AbortController)r=o.AbortController;else{var a=function(t){function e(e){var i=t.call(this)||this;return i.onabort=null,i._controller=e,i}return Object(s.b)(e,t),Object.defineProperty(e.prototype,"aborted",{get:function(){return this._controller.aborted},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(t,e){this.on(String(t),e)},e.prototype.removeEventListener=function(t,e){this.offSingle(String(t),e)},e.prototype.dispatchEvent=function(t){return this.onabort&&this.onabort(t),this._emit(t.type,t),!1},e}(Object(n.a)().with());r=function(){function t(){this._aborted=!1,this.signal=new a(this)}return t.prototype.abort=function(){if(!this._aborted){this._aborted=!0;var t=document.createEvent("Event");t.initEvent("abort",!1,!1),this.signal.dispatchEvent(t)}},Object.defineProperty(t.prototype,"aborted",{get:function(){return this._aborted},enumerable:!1,configurable:!0}),t}()}},77:function(t,e,i){"use strict";i.d(e,"a",function(){return l}),i.d(e,"b",function(){return a});var r=i(76),s=i(25),n=i(78),o=i(14),a=function(){var t=this;this.promise=new Promise(function(e,i){t.resolve=e,t.reject=function(t){t&&Object(o.b)(t),i(t)}})},l=function(){function t(t){var e=this;this._queue=[],this._processing=[],this._paused=!1,this._changed=!1,this._onTaskAbort=function(t,i){var r=e._processing.indexOf(t);if(-1!==r)e._processing.splice(r,1);else{var s=e._queue.indexOf(t);-1!==s&&e._queue.splice(s,1),i.reject(new n.a)}},this._maxConcurrency=t}return t.prototype.enqueue=function(t,e){var i=this;void 0===e&&(e=0);var s=new r.AbortController,n=new a,o={task:t,abortController:s,process:function(){return t(s.signal).then(n.resolve,n.reject)},priority:e};return s.signal.addEventListener("abort",function(){return i._onTaskAbort(o,n)}),this._queue.push(o),this._changed=!0,this._paused||this._process(),{abortController:s,promise:n.promise,updatePriority:function(){o.priority=e,i._changed=!0}}},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1,this._process()},t.prototype._process=function(){var t,e=this;if(!(this._processing.length>=this._maxConcurrency)){this._changed&&this._queue.sort(function(t,e){return t.priority-e.priority});var i=this._queue.splice(0,this._maxConcurrency-this._processing.length);(t=this._processing).push.apply(t,i);for(var r=function(t){Object(s.promiseFinally)(t.process(),function(){var i=e._processing.indexOf(t);-1!==i&&e._processing.splice(i,1),e._process()})},n=0,o=i;n<o.length;n++){r(o[n])}}},t}()},78:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(8),s=function(t){function e(i){var r=t.call(this,void 0===i?"Aborted":i)||this;return r.name="AbortError",r.__proto__=e.prototype,r}return Object(r.b)(e,t),e}(Error)},79:function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"c",function(){return s}),i.d(e,"b",function(){return o});var r=i(14),s=function(){return{min:0,max:21}},n=function(t){t.min>=t.max&&Object(r.c)(new Error("Invalid zoom range, min >= max ("+t.min+" >= "+t.max+")")),(t.min<0||t.max<0)&&Object(r.c)(new Error("Invalid zoom range, min or max is less than zero (min="+t.min+" max="+t.max+")"))},o=function(t,e,i){return void 0===i&&(i=s()),i.min=Math.max(t.min,e.min),i.max=Math.min(t.max,e.max),i}},80:function(t,e,i){"use strict";i.d(e,"a",function(){return d}),i.d(e,"c",function(){return u}),i.d(e,"b",function(){return f}),i.d(e,"f",function(){return m}),i.d(e,"h",function(){return p}),i.d(e,"d",function(){return g}),i.d(e,"e",function(){return v}),i.d(e,"g",function(){return _});var r=i(8),s=i(11),n=i(18),o=i(12),a=i(17),l=i(95),h=i(64),c=i(14);function d(t,e,i,r){var s=o.divn(e,2*i),n=o.sub(t,s);o.divn(n,r,n),o.applyFunction(n,Math.floor,n);var a=o.add(t,s);return o.divn(a,r,a),o.applyFunction(a,Math.floor,a),{minX:n.x,minY:n.y,maxX:a.x,maxY:a.y}}function u(t,e,i,r,s){var n=o.divn(i,2*r);return[{x:n.x,y:n.y},{x:n.x,y:-n.y},{x:-n.x,y:-n.y},{x:-n.x,y:n.y}].map(function(t){return o.rotate(t,-e)}).map(function(e){return o.sub(t,e)}).map(function(t){return o.divn(t,s)})}function f(t,e,i,a,l,d,u){var f={worldCenter:t,zoom:Object(s.mathLog2)(Math.pow(2,a)*l),azimuth:e,tilt:i},_=function(t,e,i,s,a){var l=e.worldCenter,d=e.tilt,u=e.azimuth,f=e.zoom,_={x:0,y:0,z:.5*-n.a.convertPixelSizeToWorldSize(i,f).y/Math.tan(.5*t)};h.k(_,d,_),h.l(_,u,_),h.c(_,Object(r.a)(Object(r.a)({},l),{z:0}),_);for(var p=Math.tan(.5*t),m=i.x/i.y,g=h.e(p*m,p,1),v=[h.d(h.a),h.d(h.a),h.d(h.a),h.d(h.a)],x=h.e(0,0,0),b={origin:_,direction:x},w=0;w<4;++w){h.i(y[w],g,x),h.k(x,d,x),h.l(x,u,x),h.h(h.b,b,v[w])||Object(c.c)(new Error("Visible quadrilateral is unbounded, engine can't handle that case (yet)"))}return v.map(function(t){var e=n.a.worldToPixels(t,s);return o.divn(e,a)})}(Math.PI/6,f,d,a,u),p=function(t){for(var e=1/0,i=-1/0,r=[],s=0,n=1;s<t.length;++s,n=++n%t.length){var o=[t[s],t[(s+1)%t.length]].sort(function(t,e){return t.y-e.y}),a=o[0],l=o[1],h=Math.floor(a.y),c=Math.ceil(l.y);e=Math.min(e,h),i=Math.max(i,c);var d=(l.x-a.x)/(l.y-a.y),u=a.x-(isFinite(d)?d*(a.y-h):0);r.push({firstRow:h,lastRow:c,startX:a.x,endX:l.x,x:u,k:d})}for(var f=[],_=e;_<i;_++){for(var p=1/0,m=-1/0,g=0,v=r;g<v.length;g++){var y=v[g];if(!(_<y.firstRow||_>=y.lastRow)){var x=y.x+y.k,b=y.k>=0?Math.max(y.x,y.startX):Math.min(y.x,y.startX),w=y.k>=0?Math.min(x,y.endX):Math.max(x,y.endX);p=Math.floor(Math.min(p,b,w)),m=Math.ceil(Math.max(m,b,w)),y.x=x}}for(u=p;u<m;u++)f.push({x:u,y:_})}return f}(_),m=new s.Map;return p.forEach(function(t){return m.set(v(t,a),Object(r.a)(Object(r.a)({},t),{border:!1}))}),{tiles:m,tileBounds:_}}function _(t,e){return t.every(function(t){return Object(l.b)(e,t)})}function p(t,e){return{x:Object(a.a)(t.x,0,e),y:Object(a.a)(t.y,0,e)}}function m(t,e,i){var r=t.x,s=t.y;return(i.cycledX||r<e&&r>=0)&&(i.cycledY||s<e&&s>=0)}function g(t,e){return Math.ceil(Math.pow(2,t+8)/e)}function v(t,e){return t.x+"."+t.y+"."+e}var y=[h.e(-1,1,-1),h.e(1,1,-1),h.e(1,-1,-1),h.e(-1,-1,-1)]},81:function(t,e,i){"use strict";i.d(e,"e",function(){return c}),i.d(e,"a",function(){return o}),i.d(e,"b",function(){return n}),i.d(e,"d",function(){return l}),i.d(e,"c",function(){return h});var r=i(12),s=i(49),n=0,o=50*s.a,a=10*s.a,l=n-a,h=o+a;function c(t,e){return r.areFuzzyEqual(t.worldCenter,e.worldCenter)&&t.zoom===e.zoom&&t.azimuth===e.azimuth&&t.tilt===e.tilt}},95:function(t,e,i){"use strict";function r(t,e){for(var i=e.x,r=e.y,s=t.length-1,n=!1,o=0;o<t.length;o++){var a=t[o].y<=r&&t[s].y>r||t[s].y<=r&&t[o].y>r,l=i>(t[s].x-t[o].x)*(r-t[o].y)/(t[s].y-t[o].y)+t[o].x;a&&l&&(n=!n),s=o}return n}function s(t,e){for(var i=1;i<t.length;i++)if(r(t[i],e))return!1;return r(t[0],e)}function n(t,e){if("Point"===t.type)return!1;if("LineString"===t.type)return!1;if("Polygon"===t.type)return s(t.coordinates,e);if("MultiPolygon"===t.type){for(var i=0,r=t.coordinates;i<r.length;i++){if(s(r[i],e))return!0}return!1}return!1}i.d(e,"b",function(){return r}),i.d(e,"a",function(){return n})}}]);